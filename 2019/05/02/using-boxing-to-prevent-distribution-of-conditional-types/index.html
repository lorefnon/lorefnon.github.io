<!DOCTYPE html><html class="no-js"><head> <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/blog.css"><meta property="og:title" content="Gaurab Paul | Blog"><meta property="og:description" content="Ramblings on Web Development and software architecture"><meta name="generator" content="Hexo 5.3.0"></head><body class="blog-body" hx-boost="true"><a class="blog-summary" href="/" hx-boost="false"><h1 class="header-text">ICICLES OF THOUGHT</h1><h2 class="header-text">Ramblings on Web Development and Software Architecture</h2></a><div class="blog-sidebar"><span class="posted-date header-text" title="2019-05-02">Posted &nbsp;2 years ago</span><hr><h1 class="header-text">Tags</h1><ul class="tag-list"><li class="body-text"><a class="tag-link" href="/tags/Typescript/"><img src="/images/tag.svg">Typescript</a></li></ul></div><div class="blog-header"><div class="blog-header-inner header-text">Using Boxing to prevent distribution of conditional types</div></div><div class="blog-main"><div class="page-content"><link rel="stylesheet" href="/css/crayon.min.css" >
<link rel="stylesheet" href="/css/crayon-flatui-light.css" >



	<p>TypeScript <a class="wp-editor-md-post-content-link" target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#conditional-types">conditional types</a> have an interesting property that they can “distribute” over union types. As explained better by the <a class="wp-editor-md-post-content-link" target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#distributive-conditional-types">official docs</a>:</p>
<blockquote><p>
  Conditional types in which the checked type is a naked type parameter are called distributive conditional types. Distributive conditional types are automatically distributed over union types during instantiation. For example, an instantiation of <code>T extends U ? X : Y</code> with the type argument <code>A | B | C</code> for <code>T</code> is resolved as <code>(A extends U ? X : Y) | (B extends U ? X : Y) | (C extends U ? X : Y)</code>.
</p></blockquote>
<p>While I understand the rationale behind this behavior, this can sometimes lead to somewhat non-intuitive outcomes in real-world scenarios:</p>
<p><span id="more-570"></span></p>
<p>For example, let us consider following usage:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5fba4471ef19e550077826" class="crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums" data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 15px !important; line-height: 20px !important;"><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-1">1</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-2">2</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-3">3</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-4">4</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-5">5</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-6">6</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-7">7</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-8">8</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-9">9</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-10">10</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-11">11</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-12">12</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-13">13</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-14">14</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-15">15</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-16">16</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-17">17</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-18">18</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-19">19</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-20">20</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-21">21</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-22">22</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-23">23</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-24">24</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-25">25</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-26">26</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-27">27</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-28">28</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-29">29</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-30">30</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-31">31</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-32">32</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-33">33</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-34">34</div><div class="crayon-num" data-line="crayon-5fba4471ef19e550077826-35">35</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5fba4471ef19e550077826-1">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-2"><span class="crayon-t">interface</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span><span class="crayon-v">TBase</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TKeys</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">_base</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">TBase</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">_keys</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">TKeys</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-5"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-6">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-7">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-8"><span class="crayon-r">declare</span><span class="crayon-h"> </span><span class="crayon-t">namespace</span><span class="crayon-h"> </span><span class="crayon-e">DeferredKeySelection</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">type </span><span class="crayon-v">SetBase</span><span class="crayon-o">&lt;</span><span class="crayon-v">TSelection</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">TBase</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TSelection </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">any</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">infer </span><span class="crayon-v">TKeys</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span><span class="crayon-v">TBase</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">TKeys</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span><span class="crayon-v">TBase</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">never</span><span class="crayon-o">&gt;</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-15">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">type </span><span class="crayon-v">AddKey</span><span class="crayon-o">&lt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">TSelection</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">TKey </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-t">string</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TSelection </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span><span class="crayon-e">infer </span><span class="crayon-v">TBase</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">infer </span><span class="crayon-v">TKeys</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span><span class="crayon-v">TBase</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">TKeys</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">TKey</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">never</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-22">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-23"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">type </span><span class="crayon-v">Augment</span><span class="crayon-o">&lt;</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">TBase</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">TKey </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">AddKey</span><span class="crayon-o">&lt;</span><span class="crayon-v">SetBase</span><span class="crayon-o">&lt;</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">TBase</span><span class="crayon-o">&gt;</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">TKey</span><span class="crayon-o">&gt;</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-24">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">type </span><span class="crayon-v">Resolve</span><span class="crayon-o">&lt;</span><span class="crayon-v">TSelection</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TSelection </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">infer </span><span class="crayon-v">Base</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">infer </span><span class="crayon-v">Keys</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-28"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-e">Keys </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">keyof </span><span class="crayon-v">Base</span><span class="crayon-sy">?</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Pick</span><span class="crayon-o">&lt;</span><span class="crayon-v">Base</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">keyof </span><span class="crayon-v">Base</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">any</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">TSelection</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-33">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-34"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5fba4471ef19e550077826-35">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0059 seconds] -->
<p></p>
<p>It was <a class="wp-editor-md-post-content-link" target="_blank" rel="noopener" href="https://github.com/tgriesser/knex/pull/3168">written</a> to model a fluent API (of <a class="wp-editor-md-post-content-link" target="_blank" rel="noopener" href="https://knexjs.org/">Knex query builder</a>) where the base type of a partial could be available later, for example:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5fba4471ef1ab318307946" class="crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums" data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 15px !important; line-height: 20px !important;"><div class="crayon-num" data-line="crayon-5fba4471ef1ab318307946-1">1</div><div class="crayon-num" data-line="crayon-5fba4471ef1ab318307946-2">2</div><div class="crayon-num" data-line="crayon-5fba4471ef1ab318307946-3">3</div><div class="crayon-num" data-line="crayon-5fba4471ef1ab318307946-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5fba4471ef1ab318307946-1">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef1ab318307946-2"><span class="crayon-e">await </span><span class="crayon-v">knex</span><span class="crayon-o">&lt;</span><span class="crayon-v">User</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-s">"users"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">select</span><span class="crayon-sy">(</span><span class="crayon-s">"id"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"name"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Resolves to Pick&lt;User, "id" | "name"&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef1ab318307946-3"><span class="crayon-e">await </span><span class="crayon-v">knex</span><span class="crayon-sy">.</span><span class="crayon-e">select</span><span class="crayon-sy">(</span><span class="crayon-s">"id"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"name"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-v">from</span><span class="crayon-o">&lt;</span><span class="crayon-v">User</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-s">"users"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Resolves to Pick&lt;User, "id" | "name"&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef1ab318307946-4">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<p>Note that we can’t just use <code>Pick</code> directly in select’s return value because it is possible that the base type (User above) hasn’t been provided yet.</p>
<p>So, instead we use a container type for bookkeeping and use <code>DeferredKeySelection.Resolve</code> to resolve it – basically deferring the Pick operation till the <a class="wp-editor-md-post-content-link" target="_blank" rel="noopener" href="https://github.com/tgriesser/knex/blob/cc109c4cadb06e6ed6909fe6dd2002398bf67eab/types/index.d.ts#L934-L936">termination of the fluent chain</a>. If this pattern of using an identically named interface and namespace pair seems strange, checkout my <a class="wp-editor-md-post-content-link" href="/2018/11/30/simplifying-generics-heavy-typescript-code-using-container-interfaces-extractor-types-and-companion-namespaces/">previous post</a> on the topic.</p>
<p>However, if we try to use it, we will notice something strange:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5fba4471ef1af088739162" class="crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums" data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 15px !important; line-height: 20px !important;"><div class="crayon-num" data-line="crayon-5fba4471ef1af088739162-1">1</div><div class="crayon-num" data-line="crayon-5fba4471ef1af088739162-2">2</div><div class="crayon-num" data-line="crayon-5fba4471ef1af088739162-3">3</div><div class="crayon-num" data-line="crayon-5fba4471ef1af088739162-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5fba4471ef1af088739162-1">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef1af088739162-2"><span class="crayon-i">type</span><span class="crayon-h"> </span><span class="crayon-v">T</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-sy">.</span><span class="crayon-v">Resolve</span><span class="crayon-o">&lt;</span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span><span class="crayon-v">User</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"id"</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-s">"age"</span><span class="crayon-o">&gt;&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef1af088739162-3"><span class="crayon-c">// Pick&lt;User, "id"&gt; | Pick&lt;User, "age"&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef1af088739162-4">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<p>We might have expected the resolved type (<code>T</code>) to be <code>Pick&lt;User, "id" | "age"&gt;</code> here but of course that is not the case because of the distributive behavior of conditional types mentioned above.</p>
<p>Fortunately the solution is very simple, we can box the first type parameter of conditional so it is no longer a simple union type:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5fba4471ef1b3266345075" class="crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums" data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 15px !important; line-height: 20px !important;"><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-1">1</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-2">2</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-3">3</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-4">4</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-5">5</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-6">6</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-7">7</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-8">8</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-9">9</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-10">10</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-11">11</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-12">12</div><div class="crayon-num" data-line="crayon-5fba4471ef1b3266345075-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-1">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-2"><span class="crayon-c">// A container type to wrap the value in an object</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-3"><span class="crayon-t">interface</span><span class="crayon-h"> </span><span class="crayon-e">Boxed</span><span class="crayon-o">&lt;</span><span class="crayon-e">T</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">_value</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">T</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-4">&nbsp;</div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-5"><span class="crayon-c">// Later:</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-6"><span class="crayon-e">type </span><span class="crayon-v">ResolveSingle</span><span class="crayon-o">&lt;</span><span class="crayon-v">TSelection</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">TSelection </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-v">DeferredKeySelection</span><span class="crayon-o">&lt;</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">infer </span><span class="crayon-v">Base</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">infer</span><span class="crayon-h"> </span><span class="crayon-e">Keys</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-9"><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-e">Base</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-v">Boxed</span><span class="crayon-o">&lt;</span><span class="crayon-v">Keys</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-v">Boxed</span><span class="crayon-o">&lt;</span><span class="crayon-e">keyof </span><span class="crayon-v">Base</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-v">Pick</span><span class="crayon-o">&lt;</span><span class="crayon-v">Base</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Keys</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-e">keyof </span><span class="crayon-v">Base</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">any</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">any</span></div><div class="crayon-line" id="crayon-5fba4471ef1b3266345075-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">TSelection</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0021 seconds] -->
<p></p>
<p></p>
<p>Now our Resolve function behaves as we would expect.</p>
<p>(PS. The container types here have no runtime overhead because we never any values/instances of these types. They are just used for type-level book-keeping).</p>


    </div></div><div class="blog-footer body-text"><p class="copyright-container"><strong>© 2021 Gaurab Paul</strong></p><p>Unless otherwise mentioned in specific contexts, all code is licensed under the The MIT License and all content and artwork is licensed under CC BY-NC-SA.</p><p>The opinions expressed herein are author's personal viewpoints and may not be taken as professional recommendations from any of his previous or current employers.</p><hr><p> Header Image credit: <a href="https://www.pexels.com/photo/stainless-steel-lamp-788855/" target="_blank" rel="noreferrer noopener">Nikita Khandelwal</a></p></div><script src="https://unpkg.com/htmx.org@1.0.2"></script><script src="/js/blog.js"></script></body></html>