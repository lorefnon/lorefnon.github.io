<!DOCTYPE html><html class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/blog.css"><title>Lorefnon | Blog | Sharing Jade templates between Node.js server and client</title><meta property="og:title" content="Lorefnon | Blog | Sharing Jade templates between Node.js server and client"><meta property="og:description" content="Ramblings on Web Development and software architecture"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="icon" href="/images/favicon/favicon.ico"><script data-goatcounter="https://analytics.lorefnon.com/count" async src="https://analytics.lorefnon.com/count.js"></script><script src="https://unpkg.com/htmx.org@1.7.0/dist/htmx.min.js" defer></script><script src="https://unpkg.com/dompurify@2.3.6/dist/purify.min.js" defer></script><script src="/js/blog.js" defer></script><meta name="generator" content="Hexo 6.1.0"></head><body class="blog-body" hx-boost="true"><div class="blog-summary"><a class="primary-link" href="/" hx-boost="false"><h1 class="header-text">Gaurab Paul</h1><h2 class="header-text">Polyglot software developer &amp; consultant passionate about web development, distributed systems and open source technologies</h2></a><div class="blog-support"><div class="blog-support-cta-container"><a class="blog-support-btn" href="https://ko-fi.com/lorefnon" target="_blank" title="Support my work"></a></div></div></div><div class="blog-sidebar"><div class="blog-support"><div class="blog-support-cta-container"><a class="blog-support-btn" href="https://ko-fi.com/lorefnon" target="_blank" title="Support my work"></a><div class="blog-support-arrow"></div><p class="support-text body-text">Support my blog and open-source work</p></div></div><h1 class="header-text">Tags</h1><ul class="tag-list"><li class="body-text"><a class="tag-link" href="/tags/Javascript/"><img src="/images/tag.svg">Javascript</a></li><li class="body-text"><a class="tag-link" href="/tags/Jade/"><img src="/images/tag.svg">Jade</a></li><li class="body-text"><a class="tag-link" href="/tags/Node-js/"><img src="/images/tag.svg">Node.js</a></li></ul></div><div class="blog-header blog-post-header"><div class="blog-post-header-inner"><div class="header-text">Sharing Jade templates between Node.js server and client</div><div class="posted-date sub-header-text" title="2012-12-12">Posted &nbsp;10 years ago</div><hr class="blog-header-separator"></div></div><div class="blog-main"><div class="flex-row post-warning"><img src="/images/primary/alert-triangle.svg" style="margin-right: 1rem">This post has not been updated in quite some time and the content here may be out of date 
or not reflect my current my recommedation in the matter.</div><div class="page-content"><p>Although there are several templating options available for the client eg. <a href="http://handlebarsjs.com/" target="_blank" rel="noopener external nofollow noreferrer">Handlebars</a>, <a href="http://mustache.github.com/" target="_blank" rel="noopener external nofollow noreferrer">Mustache</a>, <a href="http://beebole.com/pure/" target="_blank" rel="noopener external nofollow noreferrer">Pure</a> etc. nevertheless, <a href="http://jade-lang.com/" target="_blank" rel="noopener external nofollow noreferrer">Jade</a> is attractive in its own right.  Its succinct syntax is cleaner even than <a href="http://haml.info/" target="_blank" rel="noopener external nofollow noreferrer">Haml</a>, which is arguably the predecessor and inspiration-source of all the minimalist whitespace sensitive templating systems. Using Node.js on the server offers an interesting opportunity to reuse the same servers on the server as well as client. This has been made particulary easy by the <a href="https://github.com/search?q=jade&ref=commandbar" target="_blank" rel="noopener external nofollow noreferrer">numerous community contributions</a> by Jade enthusiasts which I will attempt to highlight in this post.</p>
<p>When using Jade on the client the most naive approach would be  fetching our typical .jade file via ajax and then parsing the file and then  manipulating the structure and  interpolating the various variables. However,  we can pre-process the jade file beforehand thereby eliminating the heavyweight parsing step in the client. The end result of the pre-processing is a function which takes in the variables needed to render the template and then outputs the resultant HTML string which can be injected into the DOM.</p>
<p>Preprocessing also takes care of <a href="https://github.com/visionmedia/jade#template-inheritance" target="_blank" rel="noopener external nofollow noreferrer">template-inheritance</a> and <a href="https://github.com/visionmedia/jade#includes" target="_blank" rel="noopener external nofollow noreferrer">template-inclusion</a> seamlessly which are difficult to implement in pure clienside parsing without an added layer of complexity and overhead of multiple ajax calls.</p>
<p>Client-side rendering is made possible by a Jade feature called jade-runtime. On supplying a -c flag to jade, it generates the compiled javascript template which can be used along with the <a href="https://github.com/visionmedia/jade/blob/master/runtime.js" target="_blank" rel="noopener external nofollow noreferrer">runtime.js</a> .</p>
<p><a href="https://github.com/jgallen23/clientjade" target="_blank" rel="noopener external nofollow noreferrer">Clientjade</a> takes the process to next level of simplicity.  It is simple npm module which provides you with a command line utility to compile several jade templates into a single compiled javascript file. Compilation is as simple as:</p>
<pre><code>clientjade test1.jade test2.jade &gt; templates.js
</code></pre>
<p>Once templates.js has been included in the page,  individual templates can be accessed using their filenames.</p>
<pre><code>jade.render($(&#39;#target&#39;), &#39;test1&#39;, &#123; name: &#39;Bob&#39; &#125;);
</code></pre>
<p>First argument is the DOM node where the template is to be rendered, second is a reference to the template and last is the data required to render the template.</p>
<p>While this entire procedure is very simple, inclusion of multiple compiled templates in an HTML page leads to headaches.  Reason is that every individual compiled file assigns an empty hash to internal object containing references to templates. While in casual usage this is usually not a problem because you can always compile all the templates you need into a single javascript file, this can become troublesome if you are loading templates on-the-fly, as per requirements. The most common scenario is the case when an AMD loader eg. RequireJS is being used to manage dependencies.</p>
<p>Fortunately there is a sister project <a href="https://github.com/mysociety/node-jade-amd" target="_blank" rel="noopener external nofollow noreferrer">node-jade-amd</a> which focusses on exactly this usage scenario. As you might expect, after installing the <a href="https://github.com/mysociety/node-jade-amd" target="_blank" rel="noopener external nofollow noreferrer">jade-amd</a> npm module you have a handy command line utility using which is as simple as :</p>
<pre><code>jade-amd --from &lt;source-folder&gt; --to &lt;destination-folder&gt;
</code></pre>
<p>The compiled templates have a dependency on jadeRuntime amd module which can be obtained by :</p>
<pre><code>jade-amd --runtime &gt; jadeRuntime.js
</code></pre>
<p>Then the compiled template can be used just like you would use any other amd module :</p>
<pre><code class="hljs javascript"><span class="hljs-built_in">require</span>([ <span class="hljs-string">&#x27;templates/person&#x27;</span> ],            <span class="hljs-comment">// Compiled template AMD modules</span>
    <span class="hljs-keyword">function</span>(<span class="hljs-params">personTemplate</span>) &#123;
        <span class="hljs-keyword">var</span> rendered_content = <span class="hljs-title function_">personTemplate</span>(&#123;
              <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Joe Bloggs&#x27;</span>                <span class="hljs-comment">// Data to be used in the template</span>
         &#125;);
    &#125;
);</code></pre>
<p>Note that explitly requiring the runtime is not necessary because it is implicitly required by the compiled templates.</p>
<p>If repeated manual recompilation feels like a headache, and you don’t already have a file watcher setup there is a connect middleware <a href="https://github.com/storify/jade-browser" target="_blank" rel="noopener external nofollow noreferrer">jade-browser</a> which exposes jade templates to the web browser and also provides a few additional features like express-like render function with partial handling. If you already using <a href="http://gruntjs.com/" target="_blank" rel="noopener external nofollow noreferrer">grunt</a>, you can checkout the plugin <a href="https://github.com/phated/grunt-jade" target="_blank" rel="noopener external nofollow noreferrer">grunt-jade</a> .</p>
<p>So jade is an immensely popular templating solution among Node.js developers and the benefit of this is that there are numerous compilation options available to fit into your development toolchain.  I hope this quick detour around jade was helpful.  There are multiple other similar projects aiming to solve similar scenarios.  The ones aforementioned, were a few that I recently used. Please feel free to express any opinions or criticisms. If there is a project with related objectives which is particularly noteworthy,  feel free to add a link.</p>
</div></div><div class="blog-footer body-text"><p class="copyright-container"><strong>© 2022 Gaurab Paul</strong></p><p>Unless otherwise mentioned in specific contexts, all code is licensed under the The MIT License and all content and artwork is licensed under CC BY-NC-SA.</p><p>The opinions expressed herein are author's personal viewpoints and may not be taken as professional recommendations from any of his previous or current employers.</p></div></body></html>