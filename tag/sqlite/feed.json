{
    "version": "https://jsonfeed.org/version/1",
    "title": "Icicles of Thought • All posts by \"sqlite\" tag",
    "description": "",
    "home_page_url": "https://lorefnon.me",
    "items": [
        {
            "id": "https://lorefnon.me/2012/09/08/creating-a-basic-command-line-based-todo-app-using-ruby-and-sqlite.html",
            "url": "https://lorefnon.me/2012/09/08/creating-a-basic-command-line-based-todo-app-using-ruby-and-sqlite.html",
            "title": "Creating a basic command line based todo app using ruby and sqlite.",
            "date_published": "2012-09-08T00:00:00.000Z",
            "content_html": "<p>This tutorial aims to demonstrate how Ruby can be used to create simple command line applications.  A basic familiarity with Ruby and SQLite is assumed. Also availability of a POSIX compliant system is assumed. Although it is quite possible to port this tutorial to other proprietary platforms, I will not make any effort in this regard because of sheer lack of interest. In the tutorial, we create a simple command line based Task management application which is persisted through a local sqlite database. Thanks to the awesome commander library for ruby, the usual legwork of dealing with command line arguments and managing flags is greatly simplified.</p>\n<p>Hopefully you are already using RVM. So we begin by creating a new gemset :</p>\n<pre><code>rvm gemset create task-trooper\nrvm gemset use task-trooper\n</code></pre>\n<p>Running gem list presents us with the following :</p>\n<pre><code>*** LOCAL GEMS ***\n\nbundler (1.1.5)\nrake (0.9.2.2)\nrubygems-bundler (1.0.3)\nrvm (1.11.3.5)\n</code></pre>\n<p>If you are not using rvm (though I would highly recommend you to use it) you would have to manually install bundler at this point.</p>\n<p>If you don’t already have SQLite, you will have to install it using your favourite package manager. Installation for ubuntu is as simple as :</p>\n<pre><code>sudo apt-get install sqlite3 libsqlite3-dev\n</code></pre>\n<p>Let us create a project directory and a Gemfile for managing our ruby dependencies :</p>\n<pre><code>mkdir task-trooper\ncd task-trooper\ntouch Gemfile\n</code></pre>\n<p>Populate your gemfile with the following :</p>\n<pre><code class=\"hljs ruby\">source <span class=\"hljs-string\">&quot;http://rubygems.org&quot;</span>\ngem <span class=\"hljs-string\">&quot;commander&quot;</span>\ngem <span class=\"hljs-string\">&quot;sqlite3&quot;</span>\ngem <span class=\"hljs-string\">&quot;sequel&quot;</span></code></pre>\n\n<p>and run <strong>bundle install</strong>.\nCommander is a ruby library for managing command line arguments. sqlite3 is the ruby adapter for sqlite. And since we don’t want to dabble with SQL strings, we use a simple ruby ORM – Sequel.\nIf all goes well, the dependencies will be fetched and you should see something like this :</p>\n<pre><code>Fetching gem metadata from http://rubygems.org/........\nUsing highline (1.6.14)\nUsing commander (4.1.2)\nUsing sequel (3.39.0)\nInstalling sqlite3 (1.3.6) with native extensions\nUsing bundler (1.1.5)\nYour bundle is complete! Use `bundle show [gemname]` to see where a bundled gem is installed.\n</code></pre>\n<p>Now, let us begin with the actual application code.\nWe will eventually deploy it as a rubygem. For now let us just focus on the core essentials.\nFor now our application code resides in a single file : task-trooper.rb</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;rubygems&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&quot;bundler/setup&quot;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;commander/import&#x27;</span>\n\nprogram <span class=\"hljs-symbol\">:name</span>, <span class=\"hljs-string\">&quot;Task Trooper&quot;</span>\nprogram <span class=\"hljs-symbol\">:version</span>, <span class=\"hljs-string\">&#x27;1.0.0&#x27;</span>\nprogram <span class=\"hljs-symbol\">:description</span>, <span class=\"hljs-string\">&#x27;A simple command line based task manager&#x27;</span></code></pre>\n\n<p>The above code does not add a lot of functionality, it simply simply supplies the name of the application and some version related information. Nevertheless the commander DSL takes care of some bootstrapping for us. Try running the follwing :\n    $ ruby task-trooper.rb</p>\n<p>This was expected. Let us see what help has to offer:</p>\n<pre><code>$ ruby task-trooper.rb --help\n\n  NAME:\n\n    Task Trooper\n\n  DESCRIPTION:\n\n    A simple command line based task manager\n\n  COMMANDS:\n\n    help                 Display global or [command] help documentation.\n\n  GLOBAL OPTIONS:\n\n    -h, --help\n        Display help documentation\n\n    -v, --version\n        Display version information\n\n    -t, --trace\n        Display backtrace when an error occurs\n</code></pre>\n<p>Not so bad, huh ?</p>\n<p>Now we extend our code to incorporate database features :</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;rubygems&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&quot;bundler/setup&quot;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;commander/import&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;sequel&#x27;</span>\n\nprogram <span class=\"hljs-symbol\">:name</span>, <span class=\"hljs-string\">&quot;Task Trooper&quot;</span>\nprogram <span class=\"hljs-symbol\">:version</span>, <span class=\"hljs-string\">&#x27;1.0.0&#x27;</span>\nprogram <span class=\"hljs-symbol\">:description</span>, <span class=\"hljs-string\">&#x27;A simple command line based task manager&#x27;</span>\n\n<span class=\"hljs-variable constant_\">DB</span> = Sequel.sqlite(<span class=\"hljs-string\">&#x27;tasks_db.db&#x27;</span>)\n\n<span class=\"hljs-keyword\">unless</span> <span class=\"hljs-variable constant_\">DB</span>.table_exists? <span class=\"hljs-symbol\">:tasks</span>\n  <span class=\"hljs-variable constant_\">DB</span>.create_table(<span class=\"hljs-symbol\">:tasks</span>) <span class=\"hljs-keyword\">do</span>\n      primary_key <span class=\"hljs-symbol\">:id</span>\n  String <span class=\"hljs-symbol\">:title</span>\n  String <span class=\"hljs-symbol\">:description</span>\n  Boolean <span class=\"hljs-symbol\">:completed</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\nds = <span class=\"hljs-variable constant_\">DB</span>[<span class=\"hljs-symbol\">:tasks</span>]</code></pre>\n\n<p>The above piece of code shows how easy it is to use the Sequel library to manage database. The above code simply checks for the existence of a database table. In case the table does not exist, it is created. For now we keep the schema simple. Please note that thanks to database-agonistic api of Sequel you can use any other database here instead of Sqlite and all that would require is the alteration of one single line of configuration. Its time now to implement our first command :</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:new</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper new&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Creates a new task&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    puts <span class=\"hljs-string\">&#x27;Task created!&#x27;</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The syntax and description methods simply provide the metadata which will be presented in the help text. As far as the actual action is concerned, it simply\nprints ‘Task created!’ and exits.</p>\n<p>Lets checkout if the command new is actually available.</p>\n<pre><code>$ ruby task-trooper.rb new\n\nTask created!\n\n$ ruby task-trooper.rb new --help\n\n  NAME:\n\n    new\n\n  SYNOPSIS:\n\n    task-trooper new\n\n  DESCRIPTION:\n\n    Creates a new task\n</code></pre>\n<p>Great ! That works. Of course, at this point our task does not do anything. So let us add some functionality.</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:new</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper new&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Creates a new task&#x27;</span>\n  c.option <span class=\"hljs-string\">&#x27;--title STRING&#x27;</span>, String, <span class=\"hljs-string\">&#x27;Title of the task&#x27;</span>\n  c.option <span class=\"hljs-string\">&#x27;--description STRING&#x27;</span>, String, <span class=\"hljs-string\">&#x27;Task Description&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> options.title.<span class=\"hljs-literal\">nil</span>?\n      options.title = ask(<span class=\"hljs-string\">&#x27;Provide a title for the task :&#x27;</span>)\n    <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">if</span> options.description.<span class=\"hljs-literal\">nil</span>?\n      options.description = ask(<span class=\"hljs-string\">&#x27;Provide a description for the task :&#x27;</span>)\n    <span class=\"hljs-keyword\">end</span>\n    ds.insert(<span class=\"hljs-symbol\">:title</span> =&gt; options.title, <span class=\"hljs-symbol\">:description</span> =&gt; options.description, <span class=\"hljs-symbol\">:completed</span> =&gt; <span class=\"hljs-literal\">false</span>)\n    say <span class=\"hljs-string\">&#x27;Task added !&#x27;</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>So, in the above code we specified the options that this command will expect.\nif the title and description are not provided, the user will be prompted for\nthese options. Once both title and description are available, a record will be\ninserted in the database.</p>\n<p>Next, we need some way to show to the list of tasks. That’s not difficult either.</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:list</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper list&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Lists the tasks.&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    ds.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">task</span>|\n      status = <span class=\"hljs-keyword\">if</span> task[<span class=\"hljs-symbol\">:completed</span>] <span class=\"hljs-keyword\">then</span> <span class=\"hljs-string\">&quot;completed&quot;</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">&quot;pending&quot;</span> <span class=\"hljs-keyword\">end</span>\n      puts <span class=\"hljs-string\">&quot;Task [<span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:id</span>]&#125;</span>] - &lt;<span class=\"hljs-subst\">#&#123;status&#125;</span>&gt; : <span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:title</span>]&#125;</span>&quot;</span>\n    <span class=\"hljs-keyword\">end</span>\n    pending_count = ds.where(<span class=\"hljs-symbol\">:completed</span> =&gt; <span class=\"hljs-literal\">false</span>).count\n    count = ds.count\n    completed_count = count - pending_count\n    puts <span class=\"hljs-string\">&quot;\\n&quot;</span>\n    puts <span class=\"hljs-string\">&quot;Out of <span class=\"hljs-subst\">#&#123;count&#125;</span> Total Tasks : <span class=\"hljs-subst\">#&#123;pending_count&#125;</span> pending, <span class=\"hljs-subst\">#&#123;completed_count&#125;</span> completed.&quot;</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>So, at this point basic creation and listing of tasks is available to us.</p>\n<pre><code>$ ruby task-trooper.rb new --title &quot;Water plants&quot; --description &quot;The plants in the garden have to be watered before sundown.&quot;\nTask added !\n\n$ ruby task-trooper.rb new\nProvide a title for the task :\nAdd fertilizer\nProvide a description for the task :\nAdd some fertilizer to the pot of roses.\nTask added !\n\n$ ruby task-trooper.rb list\nTask [1] - &lt;pending&gt; : Water plants\nTask [2] - &lt;pending&gt; : Add fertilizer\n\nOut of 2 Total Tasks : 2 pending, 0 completed.\n</code></pre>\n<p>Next, we need a way to mark a task as completed :</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:done</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper done &lt;id&gt;&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Mark a task as done&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> args.first.<span class=\"hljs-literal\">nil</span>?\n      puts <span class=\"hljs-string\">&#x27;Please specify the task to be marked as complete&#x27;</span>\n    <span class=\"hljs-keyword\">else</span>\n      items = ds.where(<span class=\"hljs-symbol\">:id</span> =&gt; args.first)\n      <span class=\"hljs-keyword\">if</span> items.count &gt; <span class=\"hljs-number\">0</span>\n        items.update(<span class=\"hljs-symbol\">:completed</span> =&gt; <span class=\"hljs-literal\">true</span>)\n        puts <span class=\"hljs-string\">&quot;Updated&quot;</span>\n      <span class=\"hljs-keyword\">else</span>\n        puts <span class=\"hljs-string\">&#x27;No item found&#x27;</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Try running <strong>ruby task-trooper.rb done 1</strong> follwed by <strong>ruby task-trooper.rb list</strong>\nto make sure that the task has indeed been marked as done.</p>\n<p>After this, we add facility to show details for a task and delete a task :</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:show</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper show &lt;id&gt;&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Shows the description of a task&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> args.first.<span class=\"hljs-literal\">nil</span>?\n      puts <span class=\"hljs-string\">&quot;Please specify the task to be shown.&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n      ds.where(<span class=\"hljs-symbol\">:id</span> =&gt; args.first).each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">task</span>|\n        puts <span class=\"hljs-string\">&quot;Title : <span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:title</span>]&#125;</span>&quot;</span>\n        puts <span class=\"hljs-string\">&quot;Description : &quot;</span>\n        puts task[<span class=\"hljs-symbol\">:description</span>]\n        puts <span class=\"hljs-string\">&quot;Completed : <span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:completed</span>]&#125;</span>&quot;</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\ncommand <span class=\"hljs-symbol\">:delete</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper delete &lt;id&gt;&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Delete a task&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> args.first.<span class=\"hljs-literal\">nil</span>?\n      puts <span class=\"hljs-string\">&quot;Please specify the task to be deleted&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n      items = ds.where(<span class=\"hljs-symbol\">:id</span> =&gt; args.first)\n      <span class=\"hljs-keyword\">if</span> items.count &gt; <span class=\"hljs-number\">0</span>\n        items.delete\n        puts <span class=\"hljs-string\">&quot;Deleted&quot;</span>\n      <span class=\"hljs-keyword\">else</span>\n        puts <span class=\"hljs-string\">&quot;No task found&quot;</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now that we have all the basic facilities up and running, lets us proceed to\ncreate a ruby gem so we can make the application available to other users.</p>\n<p>We create a bin director, move our script to it and make it executable.</p>\n<pre><code>mkdir bin\nmv task-trooper.rb bin/task-trooper\nchmod a+x bin/task-trooper\n</code></pre>\n<p>Also, we need to add a shebang to direct the shell to run it with ruby.\n    #!&#x2F;usr&#x2F;bin&#x2F;env ruby</p>\n<p>Next, we need to add a gemspec to specify the required metadata for the\ngem.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-title class_\">Gem::Specification</span>.new <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">s</span>|\n  s.name = <span class=\"hljs-string\">&#x27;task-trooper&#x27;</span>\n  s.version = <span class=\"hljs-string\">&#x27;1.0.0&#x27;</span>\n  s.date = <span class=\"hljs-string\">&#x27;2012-09-09&#x27;</span>\n  s.summary = <span class=\"hljs-string\">&quot;Task Trooper&quot;</span>\n  s.description = <span class=\"hljs-string\">&quot;Simple command line based task manager&quot;</span>\n  s.authors = [ <span class=\"hljs-string\">&quot;Lorefnon&quot;</span> ]\n  s.email = <span class=\"hljs-string\">&#x27;lorefnon@gmail.com&#x27;</span>\n  s.executables &lt;&lt; <span class=\"hljs-string\">&#x27;task-trooper&#x27;</span>\n\n  [<span class=\"hljs-string\">&#x27;commander&#x27;</span>, <span class=\"hljs-string\">&#x27;sqlite3&#x27;</span>, <span class=\"hljs-string\">&#x27;sequel&#x27;</span>].each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">dep</span>|\n    s.add_dependency dep\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>We might also want to have our sqlite database in a hidden folder in user’s\nhome directory. This is easily accomplished :</p>\n<pre><code class=\"hljs ruby\">config_dir = File.expand_path(<span class=\"hljs-string\">&#x27;~/.task-trooper&#x27;</span>)\n<span class=\"hljs-keyword\">unless</span> Dir[config_dir].length &gt; <span class=\"hljs-number\">0</span>\n  Dir::mkdir(config_dir)\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-variable constant_\">DB</span> = Sequel.sqlite(<span class=\"hljs-string\">&quot;<span class=\"hljs-subst\">#&#123;config_dir&#125;</span>/tasks.db&quot;</span>)\n\n<span class=\"hljs-keyword\">unless</span> <span class=\"hljs-variable constant_\">DB</span>.table_exists? <span class=\"hljs-symbol\">:tasks</span>\n  <span class=\"hljs-variable constant_\">DB</span>.create_table(<span class=\"hljs-symbol\">:tasks</span>) <span class=\"hljs-keyword\">do</span>\n    primary_key <span class=\"hljs-symbol\">:id</span>\n    String <span class=\"hljs-symbol\">:title</span>\n    String <span class=\"hljs-symbol\">:description</span>\n    Boolean <span class=\"hljs-symbol\">:completed</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Having done that, we can build our gem :\n    gem build task-trooper.gemset</p>\n<p>We can test our gem in a fresh rvm gemset\n    rvm gemset create test\n    rvm gemset use test\n    gem install .&#x2F;task-trooper-1.0.0.gem</p>\n<p>Hold your breath while the dependencies are auto-matically fetched and installed. Now you can use task-trooper as you would use any other command line executable.\nHere is an obligatory screenshot :</p>\n<img src=\"/images/task_trooper.png\" />\n\n<p>So in less than an hour we were able to create a simple but functional todo app which is persisted in an Sqlite database. We can easily see that creating simple command line applications is not at all cumbersome in ruby. I do really hope that you can expand upon the material presented above to create some nifty CLI-apps. For some inspiration do check out : cli-apps.org .</p>\n<p>Also, as usual feel free to provide your suggestions, criticism or details regarding any problems that you faced.</p>\n",
            "tags": [
                "Ruby",
                "SQLite"
            ]
        }
    ]
}