{
    "version": "https://jsonfeed.org/version/1",
    "title": "Icicles of Thought â€¢ All posts by \"mongodb\" tag",
    "description": "",
    "home_page_url": "https://lorefnon.me",
    "items": [
        {
            "id": "https://lorefnon.me/2018/08/20/uploading-files-to-mongodb-gridfs-via-apollo-powered-graphql-api/",
            "url": "https://lorefnon.me/2018/08/20/uploading-files-to-mongodb-gridfs-via-apollo-powered-graphql-api/",
            "title": "Uploading files to MongoDB GridFS via Apollo powered GraphQL API",
            "date_published": "2018-08-20T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>GraphQL multi-part request spec outlines a specification for multipart form requests in GraphQL. <a href=\"https://github.com/jaydenseric\">Jayden Seric</a>, the author of the spec, has also authored two libraries <a href=\"https://github.com/jaydenseric/apollo-upload-client\">apollo-upload-client</a> and <a href=\"https://github.com/jaydenseric/apollo-upload-server\">apollo-upload-server</a> which makes it effortless to integrate file uploads in Apollo Server.</p>\n<p><a href=\"https://docs.mongodb.com/manual/core/gridfs/\">GridFS</a> is a simple file system abstraction on top of MongoDB. This facilitates storage of large files (beyond BSON document size limit) in mongo database.</p>\n<p>This post outlines the minimal integration required to save the files uploaded through the GraphQL API to GridFS.</p>\n<p><span id=\"more-364\"></span></p>\n<p>We will use Koa as the HTTP server but the approach is applicable to any Apollo supported backend.</p>\n<p>The <a href=\"https://npm.im/apollo-server-koa\">Apollo-koa integration library</a> comes built in with apollo-upload-server, so if we initialize our Apollo server and configure it use koa server, it will automatically configure body parser and enable file uploads.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f824925651077\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-21\">21</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Koa </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ApolloServer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gql</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-server-koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graphQLServer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApolloServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">typeDefs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Described below</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">resolvers</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Query</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... add queries here</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Mutation</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">addFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Described below</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... add other mutations here</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-17\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-18\"><span class=\"crayon-v\">graphQLServer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">applyMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-20\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-21\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0045 seconds] -->\n<p></p>\n<p>Apollo server <a href=\"https://github.com/apollographql/apollo-server/blob/fa6c973f3685fceea905acf259824005e0e0ffe2/packages/apollo-server-core/src/index.ts#L46-L47\">exports</a> an Upload scalar type which we can use in our typedefs:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f832588453116\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-17\">17</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gql</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-server-koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">typeDefs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gql</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">filename</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Mutation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">uploadFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Upload</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">File</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-16\"><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-17\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0017 seconds] -->\n<p></p>\n<p>Now our add file resolver is ready to accept the incoming file stream and can pass it on to GridFS:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f835312978293\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-16\">16</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">mongodb </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mongodb\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_parent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bucket</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongodb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GridFSBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_db</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bucket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">openUploadStream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">await </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Promise</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">stream</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pipe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"error\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"finish\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-15\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-16\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0030 seconds] -->\n<p></p>\n<p>In order to facilitate uploading of files from the client, we need to configure Apollo client to use an upload link:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f839458028925\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-31\">31</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloProvider</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react-apollo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-client\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-4\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">InMemoryCache</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-cache-inmemory\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-5\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">HttpLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link-http\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-6\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">onError</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link-error\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-7\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-8\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">createUploadLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-upload-client\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-10\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApolloClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">link</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ApolloLink</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Report errors to console in a user friendly format</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">onError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">networkError</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">locations</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">GraphQL </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Message</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Location</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">locations</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">networkError</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Network </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">networkError</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-23\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">createUploadLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">APP_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/graphql\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">credentials</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"same-origin\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">cache</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InMemoryCache</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-30\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-31\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0055 seconds] -->\n<p></p>\n<p>Note that using http link is no longer required, and any configuration options that could be passed to http link can be passed to <code>createUploadLink</code>. In fact, if http link is used before <code>createUploadLink</code> file uploads wonâ€™t work at all because http link is a terminal link and the upload link added after would not be used.</p>\n<p>Now we can upload files to our GraphQL endpoint using <code>Mutation</code> component.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f83c771609500\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-32\">32</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">gql </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"graphql-tag\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Mutation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react-apollo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UPLOAD_FILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gql</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">mutation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Upload</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">uploadFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">_id</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-9\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">filename</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-12\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-13\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-14\"><span class=\"crayon-e\">export </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-15\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">ApolloProvider </span><span class=\"crayon-v\">client</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Mutation </span><span class=\"crayon-v\">mutation</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">UPLOAD_FILE</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">mutate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-19\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"file\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">required</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-21\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">onChange</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">event</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">files</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">mutate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">variables</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-28\"><span class=\"crayon-c\">&nbsp;&nbsp;&nbsp;&nbsp;)}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-29\"><span class=\"crayon-c\">&nbsp;&nbsp;&lt;/M</span><span class=\"crayon-v\">utation</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-30\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ApolloProvider</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-31\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-32\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0031 seconds] -->\n<p></p>\n<p>This concludes our server side as well as client side setup involved in connecting a file input field to mongodb gridfs.</p>\n\n\n    ",
            "tags": [
                "Apollo",
                "GraphQL",
                "MongoDB"
            ]
        }
    ]
}