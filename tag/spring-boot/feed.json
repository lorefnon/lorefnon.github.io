{
    "version": "https://jsonfeed.org/version/1",
    "title": "Icicles of Thought • All posts by \"spring-boot\" tag",
    "description": "",
    "home_page_url": "https://lorefnon.me",
    "items": [
        {
            "id": "https://lorefnon.me/2021/09/04/bootstrapping-a-grpc-server-with-spring-boot-and-kotlin/",
            "url": "https://lorefnon.me/2021/09/04/bootstrapping-a-grpc-server-with-spring-boot-and-kotlin/",
            "title": "Bootstrapping a Kotlin gRPC service with Spring Boot",
            "date_published": "2021-09-04T00:00:00.000Z",
            "content_html": "<p>It has always been possible to build gRPC services in kotlin through java interop, but with the recently improved first class support for kotlin in the official gRPC/protobuf libraries it is quite straightforward to build gRPC services in Kotlin which take advantage of kotlin native features like coroutines. In addition, the grpc-spring-boot-starter makes it really convenient for spring boot users to integrate gRPC.</p>\n<p>Note that while our services are using coroutines, we will not need webflux (although it is perfectly fine to use both of them together)</p>\n<p>This post is primarily a recipe for integrating these components to quickly get started with gRPC on spring boot. </p>\n<h1 id=\"Gradle-configuration\"><a href=\"#Gradle-configuration\" class=\"headerlink\" title=\"Gradle configuration:\"></a>Gradle configuration:</h1><p>First part is to configure our gradle configuration (<code>build.gradle.kts</code>) to use the protobuf and grpc codegen utilities.</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.google.protobuf.gradle.*\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">val</span> protobufVersion <span class=\"hljs-keyword\">by</span> extra(<span class=\"hljs-string\">&quot;3.17.3&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">val</span> protobufPluginVersion <span class=\"hljs-keyword\">by</span> extra(<span class=\"hljs-string\">&quot;0.8.14&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">val</span> grpcVersion <span class=\"hljs-keyword\">by</span> extra(<span class=\"hljs-string\">&quot;1.40.1&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">plugins {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tid(<span class=\"hljs-string\">&quot;org.springframework.boot&quot;</span>) version <span class=\"hljs-string\">&quot;2.5.4&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tid(<span class=\"hljs-string\">&quot;io.spring.dependency-management&quot;</span>) version <span class=\"hljs-string\">&quot;1.0.11.RELEASE&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tkotlin(<span class=\"hljs-string\">&quot;jvm&quot;</span>) version <span class=\"hljs-string\">&quot;1.5.21&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tkotlin(<span class=\"hljs-string\">&quot;plugin.spring&quot;</span>) version <span class=\"hljs-string\">&quot;1.5.21&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tid(<span class=\"hljs-string\">&quot;com.google.protobuf&quot;</span>) version <span class=\"hljs-string\">&quot;0.8.17&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">group = <span class=\"hljs-string\">&quot;com.example&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">version = <span class=\"hljs-string\">&quot;0.0.1-SNAPSHOT&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">java.sourceCompatibility = JavaVersion.VERSION_11\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">repositories {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tmavenCentral()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">dependencies {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-reflect&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-stdlib-jdk8&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\ttestImplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;net.devh:grpc-server-spring-boot-starter:2.12.0.RELEASE&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;io.grpc:grpc-protobuf:<span class=\"hljs-subst\">${grpcVersion}</span>&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;io.grpc:grpc-stub:1.40.1&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;io.grpc:grpc-kotlin-stub:1.1.0&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tcompileOnly(<span class=\"hljs-string\">&quot;jakarta.annotation:jakarta.annotation-api:1.3.5&quot;</span>) <span class=\"hljs-comment\">// Java 9+ compatibility - Do NOT update to 2.0.0</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;com.google.protobuf:protobuf-java:<span class=\"hljs-variable\">$protobufVersion</span>&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;net.devh:grpc-client-spring-boot-starter:2.12.0.RELEASE&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.5.1&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t<span class=\"hljs-keyword\">if</span> (JavaVersion.current().isJava9Compatible) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\timplementation(<span class=\"hljs-string\">&quot;javax.annotation:javax.annotation-api:+&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">tasks.withType&lt;KotlinCompile&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tkotlinOptions {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tfreeCompilerArgs = listOf(<span class=\"hljs-string\">&quot;-Xjsr305=strict&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tjvmTarget = <span class=\"hljs-string\">&quot;11&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">tasks.withType&lt;Test&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tuseJUnitPlatform()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\ttestLogging.showStandardStreams = <span class=\"hljs-literal\">true</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">sourceSets {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\ttest {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tjava.srcDirs.add(File(<span class=\"hljs-string\">&quot;src/test/kotlin&quot;</span>))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">protobuf {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tprotoc {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tartifact = <span class=\"hljs-string\">&quot;com.google.protobuf:protoc:<span class=\"hljs-subst\">${protobufVersion}</span>&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tplugins {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tid(<span class=\"hljs-string\">&quot;grpc&quot;</span>) {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t\tartifact = <span class=\"hljs-string\">&quot;io.grpc:protoc-gen-grpc-java:<span class=\"hljs-subst\">${grpcVersion}</span>&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tid(<span class=\"hljs-string\">&quot;grpckt&quot;</span>) {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t\tartifact = <span class=\"hljs-string\">&quot;io.grpc:protoc-gen-grpc-kotlin:1.1.0:jdk7@jar&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tgenerateProtoTasks {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tofSourceSet(<span class=\"hljs-string\">&quot;main&quot;</span>).forEach {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t\tit.plugins {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t\t\tid(<span class=\"hljs-string\">&quot;grpc&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t\t\tid(<span class=\"hljs-string\">&quot;grpckt&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t\t}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\t}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Note the use of the additional grpckt plugin for protoc along with the grpc plugin for java code-generation.</p>\n<p>Given, the above configuration, we can start defining our API schema in protobuf format.</p>\n<p>Let us start with a minimal example of <code>src/main/proto/demo.proto</code>: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">syntax = <span class=\"hljs-string\">&quot;proto3&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/wrappers.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/timestamp.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">service</span> <span class=\"hljs-title\">UserService</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-function\"><span class=\"hljs-keyword\">rpc</span> getUserById (google.protobuf.Int64Value) <span class=\"hljs-keyword\">returns</span> (User)</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">message</span> <span class=\"hljs-title\">User</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-built_in\">int64</span> id = <span class=\"hljs-number\">1</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-built_in\">string</span> name = <span class=\"hljs-number\">2</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr></table></code></pre>\n\n<p>We will look at the code generated for the above in a bit. But let us first look at how to implement this service in our kotlin backend. Our UserService has just one method for now which returns a user given it&#39;s id. </p>\n<p>Our <code>UserService.kt</code> implementing this RPC service looks something like this:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.google.protobuf.Int64Value\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> net.devh.boot.grpc.server.service.GrpcService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@GrpcService</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserService</span>: <span class=\"hljs-type\">UserServiceGrpcKt.UserServiceCoroutineImplBase</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(userId: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> Demo.User\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .newBuilder()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .setId(<span class=\"hljs-number\">1</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .setName(<span class=\"hljs-string\">&quot;Gaurab&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Our implementation derives from the <code>UserServiceGrpcKt.UserServiceCoroutineImplBase</code> which was generated for us. The generated functions use some protobuf specific types and we return a <code>User</code> instance constructed through the builder that was also generated for us.</p>\n<p>Overall our code loooks pretty readable, and we didn&#39;t have to write any mapping boilerplate.</p>\n<p>If we peek into the build directory, we can find all the code our code-generator generated for us:</p>\n<pre><code class=\"hljs plain\">▾ \u0007build&#x2F;\n  ▸ \u0007classes&#x2F;\n  ▸ \u0007extracted-include-protos&#x2F;\n  ▸ \u0007extracted-protos&#x2F;\n  ▾ \u0007generated&#x2F;\n    ▾ \u0007source&#x2F;proto&#x2F;main&#x2F;\n      ▾ \u0007grpc&#x2F;com&#x2F;example&#x2F;grpcdemo&#x2F;service&#x2F;\n          \u0007UserServiceGrpc.java\n      ▾ \u0007grpckt&#x2F;com&#x2F;example&#x2F;grpcdemo&#x2F;service&#x2F;\n          \u0007DemoGrpcKt.kt</code></pre>\n<p>The first thing we want to look at is the <code>UserServiceKt</code> where our base class we derived from resides: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-18\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">25 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.google.protobuf.Int64Value\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.example.grpcdemo.service.UserServiceGrpc.getServiceDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.CallOptions\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.CallOptions.DEFAULT\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Channel\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Metadata\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.MethodDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.ServerServiceDefinition\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.ServerServiceDefinition.builder\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.ServiceDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Status\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Status.UNIMPLEMENTED\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.StatusException\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.AbstractCoroutineServerImpl\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.AbstractCoroutineStub\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ClientCalls.serverStreamingRpc\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ClientCalls.unaryRpc\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ServerCalls.serverStreamingServerMethodDefinition\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ServerCalls.unaryServerMethodDefinition\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.StubFor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.String\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.coroutines.CoroutineContext\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.coroutines.EmptyCoroutineContext\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.jvm.JvmOverloads\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.jvm.JvmStatic\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlinx.coroutines.flow.Flow\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> * Holder for Kotlin coroutine-based client and server APIs for\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> * com.example.grpcdemo.service.UserService.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">object</span> UserServiceGrpcKt {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">val</span> SERVICE_NAME: String = UserServiceGrpc.SERVICE_NAME\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-meta\">@JvmStatic</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">val</span> serviceDescriptor: ServiceDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">get</span>() = UserServiceGrpc.getServiceDescriptor()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">val</span> getUserByIdMethod: MethodDescriptor&lt;Int64Value, Demo.User&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@JvmStatic</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">get</span>() = UserServiceGrpc.getGetUserByIdMethod()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * A stub for issuing RPCs to a(n) com.example.grpcdemo.service.UserService service as\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * suspending coroutines.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-meta\">@StubFor(UserServiceGrpc::class)</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserServiceCoroutineStub</span> <span class=\"hljs-meta\">@JvmOverloads</span> <span class=\"hljs-keyword\">constructor</span></span>(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    channel: Channel,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    callOptions: CallOptions = DEFAULT\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  ) : AbstractCoroutineStub&lt;UserServiceCoroutineStub&gt;(channel, callOptions) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">build</span><span class=\"hljs-params\">(channel: <span class=\"hljs-type\">Channel</span>, callOptions: <span class=\"hljs-type\">CallOptions</span>)</span></span>: UserServiceCoroutineStub =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        UserServiceCoroutineStub(channel, callOptions)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * Executes this RPC and returns the response message, suspending until the RPC completes\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * with [`Status.OK`][Status].  If the RPC completes with another status, a corresponding\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * [StatusException] is thrown.  If this coroutine is cancelled, the RPC is also cancelled\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * with the corresponding exception as a cause.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * <span class=\"hljs-doctag\">@param</span> request The request message to send to the server.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * <span class=\"hljs-doctag\">@return</span> The single response from the server.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(request: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User = unaryRpc(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      channel,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      UserServiceGrpc.getGetUserByIdMethod(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      request,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      callOptions,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      Metadata()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * Skeletal implementation of the com.example.grpcdemo.service.UserService service based on\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * Kotlin coroutines.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   */</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserServiceCoroutineImplBase</span></span>(\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    coroutineContext: CoroutineContext = EmptyCoroutineContext\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">  ) : AbstractCoroutineServerImpl(coroutineContext) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * Returns the response to an RPC for com.example.grpcdemo.service.UserService.getUserById.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * If this method fails with a [StatusException], the RPC will fail with the corresponding\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * [Status].  If this method fails with a [java.util.concurrent.CancellationException], the RPC\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * will fail\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * with status `Status.CANCELLED`.  If this method fails for any other reason, the RPC will\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * fail with `Status.UNKNOWN` with the exception as a cause.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * <span class=\"hljs-doctag\">@param</span> request The request from the client.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     */</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">open</span> <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(request: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User = <span class=\"hljs-keyword\">throw</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        StatusException(UNIMPLEMENTED.withDescription(<span class=\"hljs-string\">&quot;Method com.example.grpcdemo.service.UserService.getUserById is unimplemented&quot;</span>))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">bindService</span><span class=\"hljs-params\">()</span></span>: ServerServiceDefinition = builder(getServiceDescriptor())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      .addMethod(unaryServerMethodDefinition(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      context = <span class=\"hljs-keyword\">this</span>.context,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      descriptor = UserServiceGrpc.getGetUserByIdMethod(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      implementation = ::getUserById\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    ))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      .addMethod(serverStreamingServerMethodDefinition(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      context = <span class=\"hljs-keyword\">this</span>.context,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      descriptor = UserServiceGrpc.getListUsersMethod(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      implementation = ::listUsers\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )).build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>There isn&#39;t much rocket science here. The code looks much similar to what we would have written if we were implementing this boilerplate ourselves. </p>\n<p>In our previous example, we have used a unary call. gRPC also has good support for streaming. </p>\n<p>Before we conclude our post, let&#39;s quickly look at what implementing a stream returning endpoint looks like. We add a <code>listUsers</code> method to our <code>UserService</code> which returns a stream of <code>User</code>. </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">syntax = <span class=\"hljs-string\">&quot;proto3&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/wrappers.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/timestamp.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">service</span> <span class=\"hljs-title\">UserService</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-function\"><span class=\"hljs-keyword\">rpc</span> getUserById (google.protobuf.Int64Value) <span class=\"hljs-keyword\">returns</span> (User)</span>;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-function\"><span class=\"hljs-keyword\">rpc</span> listUsers(ListUsersInput) <span class=\"hljs-keyword\">returns</span> (stream User)</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">message</span> <span class=\"hljs-title\">ListUsersInput</span> </span>{}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">message</span> <span class=\"hljs-title\">User</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-built_in\">int64</span> id = <span class=\"hljs-number\">1</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-built_in\">string</span> name = <span class=\"hljs-number\">2</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr></table></code></pre>\n\n<p>One weird gRPC oddity is that even though our function does not need an argument, it is required to accept an argument, and hence we have defined an empty message type. </p>\n<p>As you may expect, on the kotlin side our return value is a <a href=\"https://kotlinlang.org/docs/flow.html#sequences\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Flow</a> - enabling us to return a collection of values over time. </p>\n<p>In our simple example below, we simply return a list, converted to a flow through a convenient extension function from kotlinx.coroutines. </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@GrpcService</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserService</span>: <span class=\"hljs-type\">UserServiceGrpcKt.UserServiceCoroutineImplBase</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-19\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">5 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(userId: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">            id = userId.value\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">            name = <span class=\"hljs-string\">&quot;Gaurab&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">        }.build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">listUsers</span><span class=\"hljs-params\">(request: <span class=\"hljs-type\">Demo</span>.<span class=\"hljs-type\">ListUsersInput</span>)</span></span>: Flow&lt;Demo.User&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> listOf(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id = <span class=\"hljs-number\">10</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                name = <span class=\"hljs-string\">&quot;Harry&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }.build(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id = <span class=\"hljs-number\">20</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                name = <span class=\"hljs-string\">&quot;Hermione&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }.build(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id = <span class=\"hljs-number\">20</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                name = <span class=\"hljs-string\">&quot;Ron&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }.build()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        ).asFlow()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>This brings us to the end of this short post. We explored how we can bootstrap a simple gRPC service using kotlin and spring boot, and handle unary calls and streaming. As next steps you are encouraged to explore the <a href=\"https://yidongnan.github.io/grpc-spring-boot-starter/en/server/getting-started.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">grpc-spring-boot-starter&#39;s introduction</a> and the <a href=\"https://grpc.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">gRPC official site</a> which provide detailed documentation on gRPC integrations. </p>\n",
            "tags": [
                "Kotlin",
                "Spring",
                "Spring-Boot",
                "gRPC"
            ]
        }
    ]
}