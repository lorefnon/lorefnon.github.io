{
    "version": "https://jsonfeed.org/version/1",
    "title": "Icicles of Thought â€¢ All posts by \"apollo\" tag",
    "description": "",
    "home_page_url": "https://lorefnon.me",
    "items": [
        {
            "id": "https://lorefnon.me/2021/08/08/Vue-composition-api-and-type-safe-graphql-access/",
            "url": "https://lorefnon.me/2021/08/08/Vue-composition-api-and-type-safe-graphql-access/",
            "title": "Vue composition API and type-safe GraphQL access",
            "date_published": "2021-08-07T00:00:00.000Z",
            "content_html": "<h1 id=\"About-setup-script\"><a href=\"#About-setup-script\" class=\"headerlink\" title=\"About setup script\"></a>About setup script</h1><p>The <a href=\"https://v3.vuejs.org/guide/composition-api-introduction.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">vue composition API</a> is pretty cool, esp. with the recent addition of <a href=\"https://github.com/vuejs/rfcs/blob/master/active-rfcs/0040-script-setup.md\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">setup script support</a> in <a href=\"https://blog.vuejs.org/posts/vue-3.2.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Vue 3.2</a> which drastically reduces unnecessary boilerplate when most of the logic is present in the setup function of the component.</p>\n<p>From the announcement post:</p>\n<blockquote>\n<p><code>&lt;script setup&gt;</code> is a <strong>compile-time syntactic sugar</strong> that greatly improves the ergonomics when using Composition API inside SFCs.</p>\n</blockquote>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"javascript\"></span>\n<span class=\"javascript\"><span class=\"hljs-keyword\">import</span> &#123; ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span>\n<span class=\"javascript\"></span>\n<span class=\"javascript\"><span class=\"hljs-keyword\">const</span> color = ref(<span class=\"hljs-string\">&#x27;red&#x27;</span>)</span>\n<span class=\"javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;color = color === &#x27;red&#x27; ? &#x27;green&#x27; : &#x27;red&#x27;&quot;</span>&gt;</span>\n    Color is: &#123;&#123; color &#125;&#125;\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></code></pre>\n\n<h1 id=\"GraphQL-through-Composition-API\"><a href=\"#GraphQL-through-Composition-API\" class=\"headerlink\" title=\"GraphQL through Composition API\"></a>GraphQL through Composition API</h1><p>With <a href=\"https://v4.apollo.vuejs.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">vue-apollo-composable</a> we can use a composable API to access our GraphQL API which can take advantage of above support.</p>\n<p>Lastly, using <a href=\"https://www.graphql-code-generator.com/docs/presets/gql-tag-operations\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">gql-tag-operations-preset</a> we can ensure that we get type-safety while accessing resources over GraphQL.</p>\n<p>This combination works seamlessly and unlike previous codegen based approaches doesn&#39;t require us to manually import types or functions generated from graphql files.</p>\n<p>The rest of this post is primarily an overview of the involved configuration.</p>\n<h1 id=\"Dependencies\"><a href=\"#Dependencies\" class=\"headerlink\" title=\"Dependencies\"></a>Dependencies</h1><p>Currently, my preferred way to get started with Vue project is to scaffold it through vite (<code>yarn create vite</code>) which internally uses the really fast <a href=\"https://github.com/evanw/esbuild\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">esbuild</a> native transpiler.</p>\n<p>Other build tools may require minor adjustment around import aliasing.</p>\n<p>Here is what our package.json looks like:</p>\n<pre><code class=\"hljs json\">&#123;\n  <span class=\"hljs-attr\">&quot;scripts&quot;</span>: &#123;\n    <span class=\"hljs-attr\">&quot;dev&quot;</span>: <span class=\"hljs-string\">&quot;vite&quot;</span>,\n    <span class=\"hljs-attr\">&quot;build&quot;</span>: <span class=\"hljs-string\">&quot;vue-tsc --noEmit &amp;&amp; vite build&quot;</span>,\n    <span class=\"hljs-attr\">&quot;serve&quot;</span>: <span class=\"hljs-string\">&quot;vite preview&quot;</span>,\n    <span class=\"hljs-attr\">&quot;codegen:graphql&quot;</span>: <span class=\"hljs-string\">&quot;yarn run graphql-codegen -c graphql-codegen.yaml&quot;</span>\n  &#125;,\n  <span class=\"hljs-attr\">&quot;dependencies&quot;</span>: &#123;\n    <span class=\"hljs-attr\">&quot;@apollo/client&quot;</span>: <span class=\"hljs-string\">&quot;^3.4.5&quot;</span>,\n    <span class=\"hljs-attr\">&quot;@graphql-typed-document-node/core&quot;</span>: <span class=\"hljs-string\">&quot;^3.1.0&quot;</span>,\n    <span class=\"hljs-attr\">&quot;@vue/apollo-composable&quot;</span>: <span class=\"hljs-string\">&quot;^4.0.0-alpha.14&quot;</span>,\n    <span class=\"hljs-attr\">&quot;graphql&quot;</span>: <span class=\"hljs-string\">&quot;^15.5.1&quot;</span>,\n    <span class=\"hljs-attr\">&quot;graphql-tag&quot;</span>: <span class=\"hljs-string\">&quot;^2.12.5&quot;</span>,\n    <span class=\"hljs-attr\">&quot;vue&quot;</span>: <span class=\"hljs-string\">&quot;^3.0.5&quot;</span>,\n    <span class=\"hljs-attr\">&quot;vue-router&quot;</span>: <span class=\"hljs-string\">&quot;4&quot;</span>\n  &#125;,\n  <span class=\"hljs-attr\">&quot;devDependencies&quot;</span>: &#123;\n    <span class=\"hljs-attr\">&quot;@app/gql&quot;</span>: <span class=\"hljs-string\">&quot;link:./src/gql&quot;</span>,\n    <span class=\"hljs-attr\">&quot;@graphql-codegen/cli&quot;</span>: <span class=\"hljs-string\">&quot;^2.0.1&quot;</span>,\n    <span class=\"hljs-attr\">&quot;@graphql-codegen/gql-tag-operations-preset&quot;</span>: <span class=\"hljs-string\">&quot;^1.0.1&quot;</span>,\n    <span class=\"hljs-attr\">&quot;@graphql-codegen/typescript-graphql-request&quot;</span>: <span class=\"hljs-string\">&quot;^4.0.0&quot;</span>,\n    <span class=\"hljs-attr\">&quot;@vitejs/plugin-vue&quot;</span>: <span class=\"hljs-string\">&quot;^1.4.0&quot;</span>,\n    <span class=\"hljs-attr\">&quot;@vue/compiler-sfc&quot;</span>: <span class=\"hljs-string\">&quot;^3.1.5&quot;</span>,\n    <span class=\"hljs-attr\">&quot;typescript&quot;</span>: <span class=\"hljs-string\">&quot;^4.3.5&quot;</span>,\n    <span class=\"hljs-attr\">&quot;vite&quot;</span>: <span class=\"hljs-string\">&quot;^2.5.0-beta.1&quot;</span>,\n    <span class=\"hljs-attr\">&quot;vue-tsc&quot;</span>: <span class=\"hljs-string\">&quot;^0.2.2&quot;</span>\n  &#125;\n&#125;</code></pre>\n\n<h1 id=\"Configuration-for-graphql-code-generator\"><a href=\"#Configuration-for-graphql-code-generator\" class=\"headerlink\" title=\"Configuration for graphql-code-generator\"></a>Configuration for graphql-code-generator</h1><p>We have a <code>codegen:graphql</code> script configured above, which we can use to generate types for our GraphQL accessors.</p>\n<p>Here is what our <code>graphql-codegen.yaml</code> looks like:</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">schema:</span> <span class=\"hljs-string\">./schema/schema.graphqls</span>\n<span class=\"hljs-attr\">documents:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x27;src/**/*.ts&#x27;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x27;src/**/*.vue&#x27;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x27;!src/gql/**/*&#x27;</span>\n<span class=\"hljs-attr\">generates:</span>\n  <span class=\"hljs-string\">./src/schema/generated/graphql.d.ts:</span>\n    <span class=\"hljs-attr\">plugins:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">typescript</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">typescript-operations</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">typescript-graphql-request</span>\n  <span class=\"hljs-string\">./src/gql/:</span>\n    <span class=\"hljs-attr\">preset:</span> <span class=\"hljs-string\">gql-tag-operations-preset</span></code></pre>\n\n<p>From the docs for <a href=\"https://www.graphql-code-generator.com/docs/presets/gql-tag-operations\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">gql-tag-operations-preset</a>:</p>\n<blockquote>\n<p>This preset generates typings for your inline gql function usages, without having to manually specify import statements for the documents. All you need to do is import your gql function and run codegen in watch mode.</p>\n</blockquote>\n<p>Since <code>yarn run</code> forwards our arguments to the underlying scripts, to run the aforementioned watch mode, we can simply run:</p>\n<pre><code class=\"hljs sh\">yarn run codegen:graphql --watch</code></pre>\n\n<p>This will keep scanning our code for usage of graphql queries/mutations and generate corresponding types.</p>\n<p>We will look at some examples below.</p>\n<h2 id=\"Import-aliasing\"><a href=\"#Import-aliasing\" class=\"headerlink\" title=\"Import aliasing:\"></a>Import aliasing:</h2><p>The last piece of setup we need to do is configuration for imports.</p>\n<p>This may get simplified in future, but as of this writing this needs to be done in both tsconfig.json (in case you are using typescript,  make typescript compiler &amp; editor tooling happy) and vite config (to make vite happy).</p>\n<p>In <code>tsconfig.json</code>:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">&quot;compilerOptions&quot;</span>: {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;target&quot;</span>: <span class=\"hljs-string\">&quot;esnext&quot;</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;module&quot;</span>: <span class=\"hljs-string\">&quot;esnext&quot;</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;moduleResolution&quot;</span>: <span class=\"hljs-string\">&quot;node&quot;</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;strict&quot;</span>: <span class=\"hljs-literal\">true</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;jsx&quot;</span>: <span class=\"hljs-string\">&quot;preserve&quot;</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;sourceMap&quot;</span>: <span class=\"hljs-literal\">true</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;resolveJsonModule&quot;</span>: <span class=\"hljs-literal\">true</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;esModuleInterop&quot;</span>: <span class=\"hljs-literal\">true</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;lib&quot;</span>: [<span class=\"hljs-string\">&quot;esnext&quot;</span>, <span class=\"hljs-string\">&quot;dom&quot;</span>],\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;paths&quot;</span>: {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">      <span class=\"hljs-attr\">&quot;@app/gql&quot;</span>: [<span class=\"hljs-string\">&quot;./src/gql&quot;</span>]\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  },\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">&quot;include&quot;</span>: [<span class=\"hljs-string\">&quot;src/**/*.ts&quot;</span>, <span class=\"hljs-string\">&quot;src/**/*.d.ts&quot;</span>, <span class=\"hljs-string\">&quot;src/**/*.tsx&quot;</span>, <span class=\"hljs-string\">&quot;src/**/*.vue&quot;</span>]\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>In <code>vite.config.ts</code>:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> { defineConfig } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vite&#x27;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> vue <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@vitejs/plugin-vue&#x27;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> { resolve } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;path&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-comment\">// https://vitejs.dev/config/</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> defineConfig({\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">plugins</span>: [\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    vue()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  ],\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">resolve</span>: {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">alias</span>: {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">      <span class=\"hljs-string\">&quot;@app/gql&quot;</span>: resolve(__dirname, <span class=\"hljs-string\">&quot;./src/gql&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">})\n</td></tr></table></code></pre>\n\n<p>What this enables us to do is to import a helper function from <code>@app/gql</code> which we will use to make graphql queries (or perform mutations).</p>\n<p>And the watcher will keep adding overloads to this helper for each of our usage.</p>\n<h1 id=\"Usage-in-application\"><a href=\"#Usage-in-application\" class=\"headerlink\" title=\"Usage in application\"></a>Usage in application</h1><p>Here is what a usage of this helper looks like in our component:</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;pug&quot;</span>&gt;</span>\ndiv(v-if=&quot;loading&quot;)\n  | Loading ...\ndiv(v-else)\n  div(v-if=&quot;result?.currentUser&quot;)\n    | Hello &#123;&#123; result.currentUser.name &#125;&#125;\n  div(v-else)\n    | Not logged in\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"javascript\"></span>\n<span class=\"javascript\"><span class=\"hljs-keyword\">import</span> &#123; gql &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@app/gql&quot;</span></span>\n<span class=\"javascript\"><span class=\"hljs-keyword\">import</span> &#123; useQuery &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@vue/apollo-composable&quot;</span></span>\n<span class=\"javascript\"></span>\n<span class=\"javascript\"><span class=\"hljs-keyword\">const</span> &#123; result, loading &#125; = useQuery(</span>\n<span class=\"javascript\">    gql(<span class=\"hljs-comment\">/* GraphQL */</span> <span class=\"hljs-string\">`</span></span>\n<span class=\"hljs-string\"><span class=\"javascript\">        query CurrentUserQuery &#123;</span></span>\n<span class=\"hljs-string\"><span class=\"javascript\">            currentUser &#123;</span></span>\n<span class=\"hljs-string\"><span class=\"javascript\">                name</span></span>\n<span class=\"hljs-string\"><span class=\"javascript\">            &#125;</span></span>\n<span class=\"hljs-string\"><span class=\"javascript\">        &#125;</span></span>\n<span class=\"hljs-string\"><span class=\"javascript\">    `</span>)</span>\n<span class=\"javascript\">)</span>\n<span class=\"javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></code></pre>\n\n<p>Note that other than <code>gql</code> we didn&#39;t need to import anything else. And we may get a type error initially, it will quickly disappear once our watcher generates the necessary overloads, and our <code>result</code> and <code>loading</code> variables will be correctly typed as vue refs.</p>\n<p>The result&#39;s value type will be derived from our query and if we update the query, the type will auto-update too.</p>\n<p>And because these are reactive refs, we can directly use them in templates without needing any watchers or cleanup code.</p>\n<p>Lastly, if you are curious, here is what the overloads generated look like:</p>\n<pre><code class=\"hljs typescript\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> graphql <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./graphql&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> documents = &#123;\n    <span class=\"hljs-string\">&quot;query CurrentUserQuery &#123;...&#125;&quot;</span>: graphql.CurrentUserQueryDocument,\n&#125;;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">gql</span>(<span class=\"hljs-params\">source: <span class=\"hljs-string\">&quot;query CurrentUserQuery &#123;...&#125;&quot;</span></span>): (<span class=\"hljs-params\"><span class=\"hljs-keyword\">typeof</span> documents</span>)[&quot;<span class=\"hljs-title\">query</span> <span class=\"hljs-title\">CurrentUserQuery</span> </span>&#123;...&#125;<span class=\"hljs-string\">&quot;];</span>\n<span class=\"hljs-string\"></span>\n<span class=\"hljs-string\">export function gql(source: string): unknown;</span>\n<span class=\"hljs-string\">export function gql(source: string) &#123;</span>\n<span class=\"hljs-string\">  return (documents as any)[source] ?? &#123;&#125;;</span>\n<span class=\"hljs-string\">&#125;</span></code></pre>\n\n<p>Not quite pretty :), but usually you never have to peek into this file at all.</p>\n",
            "tags": [
                "Apollo",
                "GraphQL",
                "Vue",
                "TypeScript"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/03/19/Using-apollo-batch-link-selectively/",
            "url": "https://lorefnon.me/2021/03/19/Using-apollo-batch-link-selectively/",
            "title": "Using Apollo Batch Link selectively",
            "date_published": "2021-03-19T00:00:00.000Z",
            "content_html": "<p>In a <a href=\"/2021/03/18/Using-apollo-file-link-and-batch-link-simultaneously/\">previous post</a> we have explored the concept of <a href=\"https://www.apollographql.com/docs/react/api/link/introduction/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Links</a> in Apollo and usage of <code>ApolloLink.split</code> for routing requests selectively towards one of multiple terminating links.</p>\n<p>This utility is also useful when we want to selectively batch our operations. </p>\n<p>The caveat with <a href=\"https://www.apollographql.com/docs/react/api/link/apollo-link-batch-http/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Apollo batch-link</a> is that, the entire batch is delivered only once the slowest operation in the batch completes.</p>\n<p>If we know ahead of time that some of our operations are expected to take longer time (We may at times be ok with that because they don&#39;t impact the user experience) then we can exclude them from batching.</p>\n<p>The link selector predicate we pass to ApolloLink.split can look at the operation name and decide whether to route the request to BatchLink or normal HttpLink.</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123;\n  ApolloClient,\n  InMemoryCache,\n  ApolloLink,\n  Operation,\n  HttpLink,\n&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@apollo/client&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> httpLink = <span class=\"hljs-keyword\">new</span> HttpLink(&#123;\n  <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-string\">&quot;/graphql&quot;</span>\n  <span class=\"hljs-comment\">// ...Additional options</span>\n&#125;);\n\n<span class=\"hljs-keyword\">const</span> batchLink = <span class=\"hljs-keyword\">new</span> BatchHttpLink(&#123;\n    <span class=\"hljs-attr\">batchInterval</span>: <span class=\"hljs-number\">250</span>\n&#125;);\n\n<span class=\"hljs-keyword\">const</span> operationBatchingBlacklist = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Set</span>&lt;string&gt;();\noperationBatchingBlacklist.add(<span class=\"hljs-string\">&quot;someExpensiveOperation&quot;</span>);\n\n<span class=\"hljs-keyword\">const</span> mediatorLink = ApolloLink.split(\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">shouldBatchRequests</span>(<span class=\"hljs-params\">&#123; operationName &#125;: Operation</span>) </span>&#123;\n    <span class=\"hljs-keyword\">return</span> !operationBatchingBlacklist.has(operationName);\n  &#125;,\n  batchLink,\n  httpLink\n);\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> client = <span class=\"hljs-keyword\">new</span> ApolloClient(&#123;\n  <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-string\">&#x27;/graphql&#x27;</span>,\n  <span class=\"hljs-attr\">link</span>: mediatorLink\n&#125;);</code></pre>\n",
            "tags": [
                "Apollo",
                "GraphQL"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/03/18/Using-apollo-file-link-and-batch-link-simultaneously/",
            "url": "https://lorefnon.me/2021/03/18/Using-apollo-file-link-and-batch-link-simultaneously/",
            "title": "Using Apollo Upload Link and Batch Link together",
            "date_published": "2021-03-18T00:00:00.000Z",
            "content_html": "<p>Apollo GraphQL client offers generic extensibility of the client-server interaction through a &quot;Link&quot; API. </p>\n<p>From the <a href=\"https://www.apollographql.com/docs/react/api/link/introduction/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official docs</a>, the high level idea is: </p>\n<blockquote>\n<p>The Apollo Link library helps you customize the flow of data between Apollo Client and your GraphQL server. You can define your client&#39;s network behavior as a chain of link objects that execute in a sequence</p>\n</blockquote>\n<p>This is conceptually pretty similar to middlewares in server-side routing libraries like express.</p>\n<p>Links enable us to extend the capabilities of the graphql client in interesting ways.</p>\n<p><a href=\"https://www.npmjs.com/package/apollo-upload-client\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">upload link</a> for example, uses an unofficial (but widely adopted among server implementation) <a href=\"https://github.com/jaydenseric/graphql-multipart-request-spec\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">extension</a> for integrating file uploads in GraphQL API. </p>\n<p><a href=\"https://www.apollographql.com/docs/react/api/link/apollo-link-batch-http/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Batch link</a> is another  very useful link which is able to transparently combine multiple GraphQL operations into a single HTTP request without any code-change on the side of API invoker component.</p>\n<p>However, the problem when using both of them in the same application, is that they are both terminating links. So we can not just add them both to our ApolloClient and call it a day. Whichever comes first, terminates the request and the other never gets executed.</p>\n<p>However, batch link is particularly useful primarily for queries, and upload link is useful for mutations. So we simply needs a mediator that reroutes the request to one of the two after looking at the incoming request. </p>\n<p>This is made very easy by <code>ApolloLink.split</code> function: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123;\n  ApolloClient,\n  InMemoryCache,\n  ApolloLink,\n  Operation,\n  NextLink,\n&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@apollo/client&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> batchLink = <span class=\"hljs-keyword\">new</span> BatchHttpLink(batchLinkOptions);\n\n<span class=\"hljs-keyword\">const</span> uploadLink = createUploadLink(uploadLinkOptions);\n\n<span class=\"hljs-comment\">// This split is needed because both batchLink and uploadLink are</span>\n<span class=\"hljs-comment\">// terminating links</span>\n<span class=\"hljs-comment\">//</span>\n<span class=\"hljs-keyword\">const</span> mediatorLink = ApolloLink.split(\n  hasFile,\n  batchLink,\n  uploadLink\n);</code></pre>\n\n<p>Here <code>hasFile</code> is a function that can return true/false depending on which of the subsequent links is to be selected. </p>\n<p>A simple implementation of <code>hasFile</code> can look like: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">hasFile</span>(<span class=\"hljs-params\">operation</span>) </span>&#123;\n    <span class=\"hljs-comment\">// A single GraphQL operation can comprise of a combination of multiple queries and mutation</span>\n    <span class=\"hljs-keyword\">if</span> (operation.query.definitions.find(<span class=\"hljs-function\"><span class=\"hljs-params\">it</span> =&gt;</span> it.operation === <span class=\"hljs-string\">&#x27;mutation&#x27;</span>)) &#123;\n        <span class=\"hljs-comment\">// Check if there is atleast one mutation present</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n    &#125;\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n&#125;</code></pre>\n\n<p>We have access to the complete operation object here, so we can also take a decision based on the name of the operation, variables we receive etc.</p>\n<p>Now, instead of passing either of these links to the ApolloClient options, we can pass the mediator link instead:</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> client = <span class=\"hljs-keyword\">new</span> ApolloClient(&#123;\n  <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-string\">&#x27;/graphql&#x27;</span>,\n  <span class=\"hljs-attr\">link</span>: mediatorLink,\n  <span class=\"hljs-comment\">// ... other options</span>\n&#125;);</code></pre>\n",
            "tags": [
                "Apollo",
                "GraphQL"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/08/20/uploading-files-to-mongodb-gridfs-via-apollo-powered-graphql-api/",
            "url": "https://lorefnon.me/2018/08/20/uploading-files-to-mongodb-gridfs-via-apollo-powered-graphql-api/",
            "title": "Uploading files to MongoDB GridFS via Apollo powered GraphQL API",
            "date_published": "2018-08-20T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>GraphQL multi-part request spec outlines a specification for multipart form requests in GraphQL. <a href=\"https://github.com/jaydenseric\">Jayden Seric</a>, the author of the spec, has also authored two libraries <a href=\"https://github.com/jaydenseric/apollo-upload-client\">apollo-upload-client</a> and <a href=\"https://github.com/jaydenseric/apollo-upload-server\">apollo-upload-server</a> which makes it effortless to integrate file uploads in Apollo Server.</p>\n<p><a href=\"https://docs.mongodb.com/manual/core/gridfs/\">GridFS</a> is a simple file system abstraction on top of MongoDB. This facilitates storage of large files (beyond BSON document size limit) in mongo database.</p>\n<p>This post outlines the minimal integration required to save the files uploaded through the GraphQL API to GridFS.</p>\n<p><span id=\"more-364\"></span></p>\n<p>We will use Koa as the HTTP server but the approach is applicable to any Apollo supported backend.</p>\n<p>The <a href=\"https://npm.im/apollo-server-koa\">Apollo-koa integration library</a> comes built in with apollo-upload-server, so if we initialize our Apollo server and configure it use koa server, it will automatically configure body parser and enable file uploads.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f824925651077\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-21\">21</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Koa </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ApolloServer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gql</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-server-koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graphQLServer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApolloServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">typeDefs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Described below</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">resolvers</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Query</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... add queries here</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Mutation</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">addFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Described below</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... add other mutations here</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-17\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-18\"><span class=\"crayon-v\">graphQLServer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">applyMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-20\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-21\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0045 seconds] -->\n<p></p>\n<p>Apollo server <a href=\"https://github.com/apollographql/apollo-server/blob/fa6c973f3685fceea905acf259824005e0e0ffe2/packages/apollo-server-core/src/index.ts#L46-L47\">exports</a> an Upload scalar type which we can use in our typedefs:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f832588453116\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-17\">17</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gql</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-server-koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">typeDefs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gql</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">filename</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Mutation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">uploadFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Upload</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">File</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-16\"><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-17\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0017 seconds] -->\n<p></p>\n<p>Now our add file resolver is ready to accept the incoming file stream and can pass it on to GridFS:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f835312978293\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-16\">16</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">mongodb </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mongodb\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_parent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bucket</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongodb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GridFSBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_db</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bucket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">openUploadStream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">await </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Promise</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">stream</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pipe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"error\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"finish\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-15\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-16\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0030 seconds] -->\n<p></p>\n<p>In order to facilitate uploading of files from the client, we need to configure Apollo client to use an upload link:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f839458028925\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-31\">31</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloProvider</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react-apollo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-client\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-4\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">InMemoryCache</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-cache-inmemory\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-5\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">HttpLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link-http\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-6\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">onError</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link-error\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-7\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-8\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">createUploadLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-upload-client\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-10\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApolloClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">link</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ApolloLink</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Report errors to console in a user friendly format</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">onError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">networkError</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">locations</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">GraphQL </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Message</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Location</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">locations</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">networkError</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Network </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">networkError</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-23\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">createUploadLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">APP_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/graphql\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">credentials</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"same-origin\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">cache</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InMemoryCache</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-30\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-31\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0055 seconds] -->\n<p></p>\n<p>Note that using http link is no longer required, and any configuration options that could be passed to http link can be passed to <code>createUploadLink</code>. In fact, if http link is used before <code>createUploadLink</code> file uploads wonâ€™t work at all because http link is a terminal link and the upload link added after would not be used.</p>\n<p>Now we can upload files to our GraphQL endpoint using <code>Mutation</code> component.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f83c771609500\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-32\">32</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">gql </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"graphql-tag\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Mutation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react-apollo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UPLOAD_FILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gql</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">mutation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Upload</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">uploadFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">_id</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-9\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">filename</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-12\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-13\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-14\"><span class=\"crayon-e\">export </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-15\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">ApolloProvider </span><span class=\"crayon-v\">client</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Mutation </span><span class=\"crayon-v\">mutation</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">UPLOAD_FILE</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">mutate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-19\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"file\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">required</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-21\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">onChange</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">event</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">files</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">mutate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">variables</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-28\"><span class=\"crayon-c\">&nbsp;&nbsp;&nbsp;&nbsp;)}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-29\"><span class=\"crayon-c\">&nbsp;&nbsp;&lt;/M</span><span class=\"crayon-v\">utation</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-30\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ApolloProvider</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-31\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-32\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0031 seconds] -->\n<p></p>\n<p>This concludes our server side as well as client side setup involved in connecting a file input field to mongodb gridfs.</p>\n\n\n    ",
            "tags": [
                "Apollo",
                "GraphQL",
                "MongoDB"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/08/18/integrating-next-js-apollo-server-and-koa/",
            "url": "https://lorefnon.me/2018/08/18/integrating-next-js-apollo-server-and-koa/",
            "title": "Integrating Next.js, Apollo Server and Koa",
            "date_published": "2018-08-18T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>It is fairly straightforward to add a GraphQL API powered by <a href=\"https://www.apollographql.com/docs/apollo-server/\" target=\"_blank\" rel=\"noreferrer noopener\">Apollo Server</a> to a <a href=\"http://nextjs.org/\" target=\"_blank\" rel=\"noreferrer noopener\">Next.js</a> application through a <a href=\"https://koajs.com/\" target=\"_blank\" rel=\"noreferrer noopener\">koa</a> middleware.</p>\n<p>The abbreviated snippet below summarizes the setup along with the libraries involved:</p>\n<p><span id=\"more-325\"></span><br>\n<script src=\"https://gist.github.com/lorefnon/65b50deebef37228416331234885cde6.js\"></script></p>\n\n\n    ",
            "tags": [
                "Next.js",
                "Koa",
                "Apollo"
            ]
        }
    ]
}