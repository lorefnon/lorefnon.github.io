{
    "version": "https://jsonfeed.org/version/1",
    "title": "Icicles of Thought",
    "description": "",
    "home_page_url": "https://lorefnon.me",
    "items": [
        {
            "id": "https://lorefnon.me/2022/06/18/type-safe-event-handling-with-zod-and-ts-pattern/",
            "url": "https://lorefnon.me/2022/06/18/type-safe-event-handling-with-zod-and-ts-pattern/",
            "title": "Type-safe event handling in Typescript with zod and ts-match",
            "date_published": "2022-06-18T21:12:06.108Z",
            "content_html": "<h1 id=\"Event-handling\"><a href=\"#Event-handling\" class=\"headerlink\" title=\"Event handling\"></a>Event handling</h1><p>It is no surprise to anyone that event handling is bread and butter in javascript. However, often we receive several types of events from an event source which makes handling them in a type-safe manner harder. Eg. if we are consuming websocket events on the backend we may write something like: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">import</span> ws <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;ws&quot;</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>()\n\n<span class=\"hljs-keyword\">const</span> server = app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">3000</span>)\n\n<span class=\"hljs-keyword\">const</span> wss = <span class=\"hljs-keyword\">new</span> ws.<span class=\"hljs-title class_\">Server</span>(&#123; server &#125;)\n\nwss.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&quot;connection&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">ws: ws.WebSocket</span>) =&gt;</span> &#123;\n    ws.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&quot;message&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> &#123;\n        <span class=\"hljs-keyword\">const</span> parsed = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(data); \n               ^\n               <span class=\"hljs-string\">`----- any :(</span>\n<span class=\"hljs-string\">    &#125;)</span>\n<span class=\"hljs-string\">&#125;)</span></code></pre>\n\n<p>Similarly we could be receiving a message from a different window&#x2F;frame through postMessage, or another peer over a webrtc data channel, the problem remains the same: After receiving the data we need to disambiguate it into one of the multiple possible types of messages and branch out the handling logic from there.</p>\n<p>The most basic way would be to write a <a href=\"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">type-guard</a> for each possible type.</p>\n<p>Typescript offers flow-sensitive typing so once we have established in a branch that a value is of a particular type, we do need any extra casts. </p>\n<p>So we could write something like this: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">PostDetails</span> &#123;\n    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-built_in\">string</span>;\n    <span class=\"hljs-attr\">description</span>: <span class=\"hljs-built_in\">string</span>;\n&#125;\n\n<span class=\"hljs-comment\">// Types for our events:</span>\n<span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">CreatePost</span> &#123;\n    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;CreatePost&quot;</span>,\n    <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetails</span>\n&#125;\n\n<span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">UpdatePost</span> &#123;\n    <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;UpdatePost&quot;</span>,\n    <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetails</span>\n&#125;\n\n<span class=\"hljs-comment\">// Type-guards for different message types</span>\n<span class=\"hljs-keyword\">const</span> isCreatePost = (<span class=\"hljs-attr\">event</span>: <span class=\"hljs-built_in\">any</span>): event is <span class=\"hljs-title class_\">CreatePost</span> =&gt; event.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&quot;CreatePost&quot;</span>\n<span class=\"hljs-keyword\">const</span> isUpdatePost = (<span class=\"hljs-attr\">event</span>: <span class=\"hljs-built_in\">any</span>): event is <span class=\"hljs-title class_\">CreatePost</span> =&gt; event.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&quot;UpdatePost&quot;</span>\n\n<span class=\"hljs-comment\">// Later in our message receiver: </span>\n\nws.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&quot;message&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> &#123;\n    <span class=\"hljs-keyword\">const</span> parsed = <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(data); \n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isCreatePost</span>(parsed)) &#123;\n        ws.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-title function_\">handleCreatePost</span>(parsed))\n        <span class=\"hljs-comment\">//                       ^</span>\n        <span class=\"hljs-comment\">//                       `---- type of parsed is CreatePost in this branch</span>\n    &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_\">isUpdatePost</span>(parsed)) &#123;\n        ws.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-title function_\">handleUpdatePost</span>(parsed))\n        <span class=\"hljs-comment\">//                        ^</span>\n        <span class=\"hljs-comment\">//                         `---- type of parsed is UpdatePost in this branch</span>\n    &#125;\n    <span class=\"hljs-comment\">// ....</span>\n&#125;)</code></pre>\n\n<p>This works, but it is quite a bit of boilerplate to discriminate&#x2F;disambiguate between different possible types. This boilerpate is also repetitive if we adopt a convention that we will always discriminate the types based on a <code>type</code> attribute which all the events will have. </p>\n<p>Other issue is that we are trusting the rest of the shape of the data based on the type attribute. Our type-guards (isCreatePost, isUpdatePost etc.) just check for the type property - and assumes that rest of the properties are as expected. If the websocket client sends an invalid object like <code>&#123; type: &quot;CreatePost&quot; &#125;</code> (no data) we will get a runtime error which may surface deeper inside the handling logic with a confusing stack trace. </p>\n<p>When we are receiving data over a network boundary or from a persisted store, it is generally safer to validate the complete payload at the boundary itself (which is our message receiver function in this example) and fail early with a clean error.</p>\n<p>We could write our type-guard to be more defensive like: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">const</span> isCreatePost = (<span class=\"hljs-attr\">event</span>: <span class=\"hljs-built_in\">any</span>): event is <span class=\"hljs-title class_\">CreatePost</span> =&gt; &#123;\n    <span class=\"hljs-keyword\">return</span> event.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&quot;CreatePost&quot;</span> &amp;&amp;\n        <span class=\"hljs-keyword\">typeof</span> event.<span class=\"hljs-property\">data</span> === <span class=\"hljs-string\">&quot;object&quot;</span> &amp;&amp;\n        <span class=\"hljs-keyword\">typeof</span> event.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">title</span> === <span class=\"hljs-string\">&quot;string&quot;</span> &amp;&amp;\n        <span class=\"hljs-keyword\">typeof</span> event.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">description</span> === <span class=\"hljs-string\">&quot;string&quot;</span>;\n&#125;</code></pre>\n\n<p>But this is now a ton of additional work. </p>\n<p>This is also error prone because tomorrow if we add another field in PostDetails we will also need to update all these type-guards to accomodate the same. They have to kept in sync manually with no help from type-checker whatsoever.</p>\n<p>Fortunately, we have libraries to simplify this validation logic for us. One such library is <a href=\"https://github.com/colinhacks/zod\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">zod</a> which is what I currently use in my production applications.</p>\n<p>With zod we can define the shape of our events through zod&#39;s API: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> zod <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;zod&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">PostDetailsSchema</span> = z.<span class=\"hljs-title function_\">object</span>(&#123;\n    <span class=\"hljs-attr\">title</span>: z.<span class=\"hljs-title function_\">string</span>(),\n    <span class=\"hljs-attr\">description</span>: z.<span class=\"hljs-title function_\">string</span>()\n&#125;);\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">CreatePostSchema</span> = z.<span class=\"hljs-title function_\">object</span>(&#123;\n    <span class=\"hljs-attr\">type</span>: z.<span class=\"hljs-title function_\">literal</span>(<span class=\"hljs-string\">&quot;CreatePost&quot;</span>),\n    <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetailsSchema</span>\n&#125;);\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">UpdatePostSchema</span> = z.<span class=\"hljs-title function_\">object</span>(&#123;\n    <span class=\"hljs-attr\">type</span>: z.<span class=\"hljs-title function_\">literal</span>(<span class=\"hljs-string\">&quot;UpdatePost&quot;</span>),\n    <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetailsSchema</span>.<span class=\"hljs-title function_\">partial</span>()\n&#125;)</code></pre>\n\n<p>The benefit of defining these schema objects, is that we are able to perform runtime validation of unknown data.</p>\n<p>So our isCreatePost type-guard can be written as: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">const</span> isCreatePost = (<span class=\"hljs-attr\">event</span>: <span class=\"hljs-built_in\">any</span>): event is <span class=\"hljs-title class_\">CreatePost</span> =&gt;\n    <span class=\"hljs-title class_\">CreatePostSchema</span>.<span class=\"hljs-title function_\">safeParse</span>(event).<span class=\"hljs-property\">success</span></code></pre>\n\n<p>We also don&#39;t have to manually define the typescript interfaces for <code>CreatePost</code>, <code>UpdatePost</code> etc. ourselves. They can instead be inferred from the Schema objects. </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">type</span> <span class=\"hljs-title class_\">CreatePost</span> = z.<span class=\"hljs-property\">TypeOf</span>&lt;<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-title class_\">CreatePostSchema</span>&gt;;\n<span class=\"hljs-keyword\">type</span> <span class=\"hljs-title class_\">UpdatePost</span> = z.<span class=\"hljs-property\">TypeOf</span>&lt;<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-title class_\">UpdatePostSchema</span>&gt;;</code></pre>\n\n<p>The above approach of discriminating between multiple types using a shared property is very common in practice, and we call union of such types as discriminated unions. </p>\n<p>Zod has built in support for discriminated unions, and we can define an EventSchema as follows: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-comment\">//                                          ,---- Property based on which we will discriminate</span>\n<span class=\"hljs-comment\">//                                         V           the members of our union type</span>\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">EventSchema</span> = z.<span class=\"hljs-title function_\">discriminatedUnion</span>(<span class=\"hljs-string\">&quot;type&quot;</span>, [\n    <span class=\"hljs-title class_\">CreatePostSchema</span>,\n    <span class=\"hljs-title class_\">UpdatePostSchema</span>\n])</code></pre>\n\n<p>Often, we won&#39;t define the individual members separately: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">EventSchema</span> = z.<span class=\"hljs-title function_\">discriminatedUnion</span>(<span class=\"hljs-string\">&quot;type&quot;</span>, [\n   z.<span class=\"hljs-title function_\">object</span>(&#123;\n     <span class=\"hljs-attr\">type</span>: z.<span class=\"hljs-title function_\">literal</span>(<span class=\"hljs-string\">&quot;CreatePost&quot;</span>),\n     <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetailsSchema</span>\n   &#125;),\n   z.<span class=\"hljs-title function_\">object</span>(&#123;\n     <span class=\"hljs-attr\">type</span>: z.<span class=\"hljs-title function_\">literal</span>(<span class=\"hljs-string\">&quot;UpdatePost&quot;</span>),\n     <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetailsSchema</span>\n   &#125;)\n])</code></pre>\n\n<p>which is exactly the same as above. </p>\n<p>If we use the previously mentioned TypeOf type to get the static type of EventSchema we will get a union of the CreatePost and UpdatePost types. </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">type</span> <span class=\"hljs-title class_\">Event</span> = z.<span class=\"hljs-property\">TypeOf</span>&lt;<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-title class_\">EventSchema</span>&gt;</code></pre>\n\n<p>The above will be inferred as: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">type</span> <span class=\"hljs-title class_\">Event</span> = \n    | &#123; <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;CreatePost&quot;</span>, <span class=\"hljs-attr\">data</span>: &#123; <span class=\"hljs-attr\">title</span>: <span class=\"hljs-built_in\">string</span>, <span class=\"hljs-attr\">description</span>: <span class=\"hljs-built_in\">string</span> &#125; &#125;\n    | &#123; <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&quot;UpdatePost&quot;</span>, <span class=\"hljs-attr\">data</span>: &#123; title?: <span class=\"hljs-built_in\">string</span>, description?: <span class=\"hljs-built_in\">string</span> &#125; &#125;</code></pre>\n\n<p>which is effectively: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">type</span> <span class=\"hljs-title class_\">Event</span> = <span class=\"hljs-title class_\">CreatePost</span> | <span class=\"hljs-title class_\">UpdatePost</span></code></pre>\n\n<p>One additional thing that we gain from defining a discriminated union is an exhaustiveness check. So we if we use <code>EventSchema.parse(someData)</code> this will throw a runtime error if someData does not conform to the complete shape of one of the errors.</p>\n<p>We can write our handler as: </p>\n<pre><code class=\"hljs ts\">ws.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&quot;message&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> &#123;\n    <span class=\"hljs-keyword\">try</span> &#123; \n        <span class=\"hljs-keyword\">const</span> parsed = <span class=\"hljs-title class_\">EventSchema</span>.<span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(data)); <span class=\"hljs-comment\">// Parse will throw for invalid events</span>\n        <span class=\"hljs-comment\">//     ^</span>\n        <span class=\"hljs-comment\">//      `--- CreatePost | UpdatePost</span>\n        <span class=\"hljs-keyword\">switch</span> (parsed.<span class=\"hljs-property\">type</span>) &#123;\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;CreatePost&quot;</span>:\n            ws.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-title function_\">handleCreatePost</span>(parsed)) \n            <span class=\"hljs-comment\">//                        ^</span>\n            <span class=\"hljs-comment\">//                        `---- type of parsed is CreatePost in this branch</span>\n            <span class=\"hljs-keyword\">return</span>; \n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;UpdatePost&quot;</span>:\n            ws.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-title function_\">handleUpdatePost</span>(parsed))\n            <span class=\"hljs-comment\">//                      ^</span>\n            <span class=\"hljs-comment\">//                       `---- type of parsed is UpdatePost in this branch</span>\n            <span class=\"hljs-keyword\">return</span>;\n        &#125;\n    &#125; <span class=\"hljs-keyword\">catch</span> (e) &#123;\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(e);\n        <span class=\"hljs-comment\">// Also see https://github.com/colinhacks/zod#error-formatting</span>\n    &#125;\n&#125;)\n</code></pre>\n\n<p>However, it would be also nice to have this exhaustiveness check enforced in our handler at compile time. The way our code is currently written, tomorrow if we add a new type of event in the discriminated union, but forget to add an if-else branch in the above code, it will get silently ignored - Not great. </p>\n<p>We can take advantage of the typescript compiler option <a href=\"https://www.typescriptlang.org/tsconfig#noImplicitReturns\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">noImplicitReturns</a> to enforce this: </p>\n<pre><code class=\"hljs ts\">ws.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&quot;message&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> &#123;\n    <span class=\"hljs-keyword\">try</span> &#123; \n        ws.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-title function_\">handleEvent</span>(<span class=\"hljs-title class_\">EventSchema</span>.<span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(data)))); <span class=\"hljs-comment\">// Parse will throw for invalid events</span>\n    &#125; <span class=\"hljs-keyword\">catch</span> (e) &#123;\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(e);\n    &#125;\n&#125;);\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleEvent</span> = (<span class=\"hljs-params\">event: Event</span>) =&gt; &#123;\n    <span class=\"hljs-keyword\">switch</span> (event.<span class=\"hljs-property\">type</span>) &#123;\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;CreatePost&quot;</span>:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">handleCreatePost</span>(event);\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;UpdatePost&quot;</span>:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">handleUpdatePost</span>(event);\n    &#125;\n&#125;</code></pre>\n\n<p>Note that our switch statement does not have a default case. </p>\n<p>So if we update our Event have another variant like: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">EventSchema</span> = z.<span class=\"hljs-title function_\">discriminatedUnion</span>(<span class=\"hljs-string\">&quot;type&quot;</span>, [\n   z.<span class=\"hljs-title function_\">object</span>(&#123;\n     <span class=\"hljs-attr\">type</span>: z.<span class=\"hljs-title function_\">literal</span>(<span class=\"hljs-string\">&quot;CreatePost&quot;</span>),\n     <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetailsSchema</span>\n   &#125;),\n   z.<span class=\"hljs-title function_\">object</span>(&#123;\n     <span class=\"hljs-attr\">type</span>: z.<span class=\"hljs-title function_\">literal</span>(<span class=\"hljs-string\">&quot;UpdatePost&quot;</span>),\n     <span class=\"hljs-attr\">data</span>: <span class=\"hljs-title class_\">PostDetailsSchema</span>.<span class=\"hljs-title function_\">partial</span>()\n   &#125;),\n   z.<span class=\"hljs-title function_\">object</span>(&#123;\n     <span class=\"hljs-attr\">type</span>: z.<span class=\"hljs-title function_\">literal</span>(<span class=\"hljs-string\">&quot;DeletePost&quot;</span>),\n     <span class=\"hljs-attr\">data</span>: z.<span class=\"hljs-title function_\">object</span>(&#123; <span class=\"hljs-attr\">id</span>: z.<span class=\"hljs-title function_\">string</span>() &#125;)\n   &#125;)\n])</code></pre>\n\n<p>None of the switch-case branches will now match for <code>DeletePost</code> and we will end up with a possible branch of code that returns implicitly. Typescript will now complain about that.</p>\n<p>We could wrap-up the post here - given that we have accomplished all the type-safety features we wanted. However, I am not a huge fan of having to rely on implicit returns (or similar workarounds) for exhaustiveness check. </p>\n<p>In many functional languages, we have support for <a href=\"https://abitofocaml.weebly.com/12-pattern-matching.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">pattern-matching</a> with built in support for exhaustiveness check. Typescript does not have this at the moment but there are userland implementations that emulate pattern matching. One such library is <a href=\"https://github.com/gvergnaud/ts-pattern\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">ts-pattern</a>, which I have found to work very well in practice. </p>\n<p>With ts-pattern we could write our handler as: </p>\n<pre><code class=\"hljs ts\"><span class=\"hljs-keyword\">import</span> &#123; match &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;ts-pattern&quot;</span>;\n\n<span class=\"hljs-comment\">// --- </span>\n\n<span class=\"hljs-title function_\">match</span>(event)\n    .<span class=\"hljs-title function_\">with</span>(&#123; <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;CreatePost&#x27;</span> &#125;, handleCreatePost)\n    .<span class=\"hljs-title function_\">with</span>(&#123; <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;UpdatePost&#x27;</span> &#125;, handleUpdatePost)\n    .<span class=\"hljs-title function_\">exhaustive</span>()   <span class=\"hljs-comment\">// &lt;--- will be a type error if Event type has any other union members</span></code></pre>\n\n<p>Not only is this more succinct for this use case, ts-pattern becomes more useful when we have more complex scenario like combining multiple predicates or performing checks based on multiple properties. Take a look at some of their examples in the <a href=\"https://github.com/gvergnaud/ts-pattern#readme\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">docs</a>.</p>\n<p>Also, unlike our switch-case or if-else examples above, the entire match invocation is a single expression so we could use the return value of our handler without needing temporary variables.</p>\n<pre><code class=\"hljs ts\">ws.<span class=\"hljs-title function_\">send</span>(\n    <span class=\"hljs-title function_\">match</span>(event)\n        .<span class=\"hljs-title function_\">with</span>(&#123; <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;CreatePost&#x27;</span> &#125;, handleCreatePost)\n        .<span class=\"hljs-title function_\">with</span>(&#123; <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&#x27;UpdatePost&#x27;</span> &#125;, handleUpdatePost)\n        .<span class=\"hljs-title function_\">exhaustive</span>()\n)</code></pre>\n\n<p>Cool, eh ?</p>\n",
            "tags": [
                "typescript",
                "zod",
                "ts-match"
            ]
        },
        {
            "id": "https://lorefnon.me/2022/04/26/using-jte-kotlin-templates-in-spring-boot/",
            "url": "https://lorefnon.me/2022/04/26/using-jte-kotlin-templates-in-spring-boot/",
            "title": "Using jte kotlin templates in spring-boot",
            "date_published": "2022-04-26T00:00:00.000Z",
            "content_html": "<h1 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h1><p><a href=\"https://github.com/casid/jte\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">jte</a> is a new and performant template engine for JVM.\nIt supports precompilation of templates in production and hot reloading in development, and also has good tooling support though an intellij plugin.</p>\n<p>jte has recently introduced support for kotlin templates - where the embedded expressions are kotlin instead of java.\nThis is a natural fit if your backend is implemented in kotlin and this post is a quick recipe for configuring this in spring-boot.</p>\n<p>jte already provides a spring-boot-starter which takes care of all of the plumbing. We just need to add the jte-kotlin dependency for kotlin template support.</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-comment\">// In build.gradle.kts</span>\n\ndependencies &#123;\n\t<span class=\"hljs-keyword\">var</span> jteVersion = <span class=\"hljs-string\">&quot;2.0.2&quot;</span>\n\n\timplementation(<span class=\"hljs-string\">&quot;gg.jte:jte-spring-boot-starter:<span class=\"hljs-variable\">$jteVersion</span>&quot;</span>)\n        <span class=\"hljs-comment\">// jte-kotlin is needed to compile kte templates</span>\n\timplementation(<span class=\"hljs-string\">&quot;gg.jte:jte-kotlin:<span class=\"hljs-variable\">$jteVersion</span>&quot;</span>)\n\n        <span class=\"hljs-comment\">// ... other dependencies</span>\n&#125;</code></pre>\n\n<p>As an additional convenience we configure the view resolver below to automatically pick kte templates (with embedded kotlin expressions)\nwhen no template extension is provided:</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">package</span> com.example.config\n\n<span class=\"hljs-keyword\">import</span> gg.jte.TemplateEngine\n<span class=\"hljs-keyword\">import</span> gg.jte.springframework.boot.autoconfigure.JteViewResolver\n<span class=\"hljs-keyword\">import</span> org.springframework.context.<span class=\"hljs-keyword\">annotation</span>.Bean\n<span class=\"hljs-keyword\">import</span> org.springframework.context.<span class=\"hljs-keyword\">annotation</span>.Configuration\n\n<span class=\"hljs-meta\">@Configuration</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TemplateConfig</span> </span>&#123;\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">jteViewResolver</span><span class=\"hljs-params\">(templateEngine: <span class=\"hljs-type\">TemplateEngine</span>)</span></span> =\n        JteViewResolver(templateEngine).apply &#123;\n            setSuffix(<span class=\"hljs-string\">&quot;.kte&quot;</span>)\n        &#125;\n&#125;</code></pre>\n\n<p>Now, if we have a controller like this:</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">package</span> com.kaljourn.server.controller\n\n<span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Controller\n<span class=\"hljs-keyword\">import</span> org.springframework.web.bind.<span class=\"hljs-keyword\">annotation</span>.GetMapping\n\n<span class=\"hljs-meta\">@Controller</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HomeController</span> </span>&#123;\n    <span class=\"hljs-meta\">@GetMapping(<span class=\"hljs-string\">&quot;/&quot;</span>)</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">home</span><span class=\"hljs-params\">()</span></span>: String = <span class=\"hljs-string\">&quot;home/index&quot;</span>\n&#125;</code></pre>\n\n<p>Now, the template file at <code>src/main/jte/home/index.kte</code> will be automatically picked up and rendered whenever user visits the <code>/</code> endpoint.</p>\n",
            "tags": [
                "kotlin",
                "spring-boot"
            ]
        },
        {
            "id": "https://lorefnon.me/2022/03/13/configuring-spring-security-to-use-komapper/",
            "url": "https://lorefnon.me/2022/03/13/configuring-spring-security-to-use-komapper/",
            "title": "Configuring spring security to use komapper",
            "date_published": "2022-03-13T00:00:00.000Z",
            "content_html": "<h1 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h1><p><a href=\"https://spring.io/projects/spring-security\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Spring security</a> is a versatile and popular authentication solution for the JVM ecosystem. It is an officially supported component of spring ecosystem and widely deployed in many production solutions.</p>\n<p><a href=\"https://www.komapper.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">KOMapper</a> is a new ORM for Kotlin that embraces KSP.</p>\n<p>Because spring-security is, at its core, agnostic of any specific persistence solution (even spring-data is not mandatory), we can easily configure it to use komapper for authenticating users.</p>\n<h1 id=\"Bootstrapping-the-application\"><a href=\"#Bootstrapping-the-application\" class=\"headerlink\" title=\"Bootstrapping the application\"></a>Bootstrapping the application</h1><p>We can download a scaffolded project from the <a href=\"https://start.spring.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">https://start.spring.io</a> after selecting spring-boot-starter-jdbc, spring-boot-starter-web and spring-boot-starter-security.</p>\n<p>While in this post we use JDBC and spring-web, both komapper and spring-security also work with r2dbc &amp; spring webflux.</p>\n<p>Our final build.gradle.kts file will look something like this:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">plugins {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tid(<span class=\"hljs-string\">&quot;org.springframework.boot&quot;</span>) version <span class=\"hljs-string\">&quot;2.6.4&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tid(<span class=\"hljs-string\">&quot;io.spring.dependency-management&quot;</span>) version <span class=\"hljs-string\">&quot;1.0.11.RELEASE&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tkotlin(<span class=\"hljs-string\">&quot;jvm&quot;</span>) version <span class=\"hljs-string\">&quot;1.6.10&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tkotlin(<span class=\"hljs-string\">&quot;plugin.spring&quot;</span>) version <span class=\"hljs-string\">&quot;1.6.10&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tid(<span class=\"hljs-string\">&quot;com.google.devtools.ksp&quot;</span>) version <span class=\"hljs-string\">&quot;1.6.10-1.0.4&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">kotlin {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tsourceSets.main {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">// This directory contains the source files generated by</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">// Komapper&#x27;s KSP processor</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tkotlin.srcDir(<span class=\"hljs-string\">&quot;build/generated/ksp/main/kotlin&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-20\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">7 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">group = <span class=\"hljs-string\">&quot;com.test&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">version = <span class=\"hljs-string\">&quot;0.0.1-SNAPSHOT&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">java.sourceCompatibility = JavaVersion.VERSION_16\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">repositories {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\tmaven { url = uri(<span class=\"hljs-string\">&quot;https://repo.spring.io/release&quot;</span>) }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\tmavenCentral()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">dependencies {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\t<span class=\"hljs-keyword\">val</span> komapperVersion = <span class=\"hljs-string\">&quot;0.30.0&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-actuator&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-jdbc&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-jersey&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-security&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.komapper:komapper-spring-boot-starter-jdbc:<span class=\"hljs-variable\">$komapperVersion</span>&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.komapper:komapper-dialect-h2-jdbc:<span class=\"hljs-variable\">$komapperVersion</span>&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">// We need to explicitly enable komapper&#x27;s KSP processor</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tksp(<span class=\"hljs-string\">&quot;org.komapper:komapper-processor:<span class=\"hljs-variable\">$komapperVersion</span>&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;com.fasterxml.jackson.module:jackson-module-kotlin&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-reflect&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-stdlib-jdk8&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;org.liquibase:liquibase-core&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\tdevelopmentOnly(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-devtools&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\timplementation(<span class=\"hljs-string\">&quot;com.h2database:h2&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\ttestImplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-20\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">9 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">tasks.withType&lt;KotlinCompile&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\tkotlinOptions {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tfreeCompilerArgs = listOf(<span class=\"hljs-string\">&quot;-Xjsr305=strict&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\t\tjvmTarget = <span class=\"hljs-string\">&quot;16&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\t}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">tasks.withType&lt;Test&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">\tuseJUnitPlatform()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-20\"><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Spring-security autoconfigures the application to use a form based login screen, that looks like this:</p>\n<p><img src=\"/images/2020-03-13/spring-security-login-page.png\" alt=\"Spring security login page\" loading=\"lazy\"></p>\n<p>Before we can access any of the protected routes (all by default) we will need to authenticate.</p>\n<p>To keep this post simple, we will use <a href=\"https://h2database.com/html/main.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">h2 database</a> here - we can configure the location where our db will store data in application.properties.</p>\n<pre><code class=\"hljs plaintext\">spring.datasource.url=jdbc:h2:/tmp/db\nspring.datasource.driverClassName=org.h2.Driver\nspring.datasource.username=sa\nspring.datasource.password=\nspring.jpa.database-platform=org.hibernate.dialect.H2Dialect</code></pre>\n\n<p>Please ensure that any location chosen here is writable by the running user.</p>\n<p>We will need a user table which will store our user details. In production we should use a migration system like dbmate or liquibase. To simplify things here, we can create this table through h2-console\navailable in localhost:8080&#x2F;h2-console</p>\n<pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> users (\n    id <span class=\"hljs-keyword\">identity</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">null</span> <span class=\"hljs-keyword\">primary</span> key,\n    name <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">null</span>,\n    email <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">null</span>,\n    password <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>)\n)</code></pre>\n\n<p>We can map this table to a Kotlin data class through the komapper provided annotations:</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">package</span> com.test.server.entity\n\n<span class=\"hljs-keyword\">import</span> org.komapper.<span class=\"hljs-keyword\">annotation</span>.*\n<span class=\"hljs-keyword\">import</span> java.time.LocalDateTime\n\n<span class=\"hljs-meta\">@KomapperEntity</span>\n<span class=\"hljs-meta\">@KomapperTable(<span class=\"hljs-string\">&quot;users&quot;</span>)</span>\n<span class=\"hljs-keyword\">data</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">User</span> </span>(\n    <span class=\"hljs-meta\">@KomapperId</span>\n    <span class=\"hljs-meta\">@KomapperAutoIncrement</span>\n    <span class=\"hljs-keyword\">var</span> id: <span class=\"hljs-built_in\">Int</span>,\n\n    <span class=\"hljs-keyword\">var</span> name: String,\n\n    <span class=\"hljs-keyword\">var</span> email: String,\n\n    <span class=\"hljs-keyword\">var</span> password: String,\n)</code></pre>\n\n<p>In ideal setup, we will also keep track of whether the email has been validated, how many times auth attempts have been successful, whether password meets expected strength etc. But in this article we will focus on just validating the user provided password against the value stored in database.</p>\n<p>spring-security will, by default, find and delegate to a UserDetailsService implementation in the application context. So we will need to provide an UserDetailsService implementation that uses komapper.</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.test.server.service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-21\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">9 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.test.server.entity.User\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.test.server.entity.user\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.komapper.core.dsl.Meta\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.komapper.core.dsl.QueryDsl\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.komapper.core.dsl.query.first\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.komapper.jdbc.JdbcDatabase\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.springframework.security.core.GrantedAuthority\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.springframework.security.core.userdetails.UserDetails\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.springframework.security.core.userdetails.UserDetailsService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-21\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Service</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserDetailsServiceImpl</span></span>(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">// The komapper spring-boot starter is aware of spring managed</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">// datasources configured through application.properties</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">//</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">// so we will not need to define this bean separately</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> db: JdbcDatabase\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">): UserDetailsService {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">loadUserByUsername</span><span class=\"hljs-params\">(username: <span class=\"hljs-type\">String</span>)</span></span>: UserDetails {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">// Fetch a user from database using the username coming from the form</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">val</span> userQuery = QueryDsl.from(Meta.user)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .<span class=\"hljs-keyword\">where</span> { user.name eq username }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .first() <span class=\"hljs-comment\">// Throws if user is not found</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> UserDetailsImpl(db.runQuery(userQuery))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> user = Meta.user\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>The Meta.user is an extension method generated by komapper&#39;s ksp processor that returns the meta-model instance for the User entity defined above.\nMode details about komapper&#39;s meta-model approach is available <a href=\"https://v0-24.komapper.org/docs/overview/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">here</a>.</p>\n<p>We will need a wrapper over our User class that complies with the UserDetails interface that spring-security expects:</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserDetailsImpl</span></span>(<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> user: User): UserDetails &#123;\n\n    <span class=\"hljs-comment\">// We prefix the password stored in database with &#123;bcrypt&#125; to indicate</span>\n    <span class=\"hljs-comment\">// to spring-security that this password is bcrypt encrypted.</span>\n    <span class=\"hljs-comment\">//</span>\n    <span class=\"hljs-comment\">// This prefix will be used to identify the password encoder to be used</span>\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getPassword</span><span class=\"hljs-params\">()</span></span> = <span class=\"hljs-string\">&quot;&#123;bcrypt&#125;<span class=\"hljs-subst\">$&#123;user.password&#125;</span>&quot;</span>\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUsername</span><span class=\"hljs-params\">()</span></span> = user.name\n\n    <span class=\"hljs-comment\">// In a more full-featured integration, we can use below</span>\n    <span class=\"hljs-comment\">// overrides to ensure that current user is not locked/expired/disabled etc.</span>\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">isAccountNonExpired</span><span class=\"hljs-params\">()</span></span> = <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">isAccountNonLocked</span><span class=\"hljs-params\">()</span></span> = <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">isCredentialsNonExpired</span><span class=\"hljs-params\">()</span></span> = <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">isEnabled</span><span class=\"hljs-params\">()</span></span> = <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getAuthorities</span><span class=\"hljs-params\">()</span></span> = <span class=\"hljs-literal\">null</span>\n&#125;</code></pre>\n\n<p>Now, if we try to access localhost:8080 we will be prompted for username, password and our &#96;UserDetailsServiceImpl will be automatically used to find the corresponding user before password is validated.</p>\n<p>However, we don&#39;t have a built-in way to manage&#x2F;insert users. To test out things we can insert a user directly in the db. One simple way to generate an encrypted password is to use the <a href=\"https://www.npmjs.com/package/bcrypt-cli\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">bcrypt-cli</a> utility available through npm.</p>\n<pre><code class=\"hljs plaintext\"> npx bcrypt-cli &quot;sillypassword&quot; 10\nNeed to install the following packages:\n  bcrypt-cli\nOk to proceed? (y) y\n$2a$10$drlJ6SdzEBso.CLHkO9W0e/lMtySOyArGmixOiSvOESMYBHvEEBoO</code></pre>\n\n<p>We can insert this as user password into the h2 db:</p>\n<pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">insert</span> <span class=\"hljs-keyword\">into</span> users (name, email, password)\n<span class=\"hljs-keyword\">values</span> (<span class=\"hljs-string\">&#x27;test&#x27;</span>, <span class=\"hljs-string\">&#x27;test@example.com&#x27;</span>, <span class=\"hljs-string\">&#x27;$2a$10$drlJ6SdzEBso.CLHkO9W0e/lMtySOyArGmixOiSvOESMYBHvEEBoO&#x27;</span>)</code></pre>\n\n<p>Now, we should be able to login through test&#x2F;sillypassword as credentials.</p>\n",
            "tags": [
                "kotlin",
                "spring",
                "spring-security",
                "komapper"
            ]
        },
        {
            "id": "https://lorefnon.me/2022/01/29/hiding-jsx-closing-tag-noise-in-vim/",
            "url": "https://lorefnon.me/2022/01/29/hiding-jsx-closing-tag-noise-in-vim/",
            "title": "Hiding JSX closing tag noise in vim through conceal",
            "date_published": "2022-01-29T00:00:00.000Z",
            "content_html": "<p>Thanks to popularity of React and other frameworks that have partly embraced its idioms, the verbose JSX syntax extension to javascript remains quite popular in 2022, despite the declining popularity of XML in the industry at large.</p>\n<p>While alternatives exist, in most existing projects one can expect to find JSX in use, and alternatives usually don&#39;t have as great support from typescript, which has first class support for JSX.</p>\n<p>Here is a simple tip that makes code using JSX easier to quickly scan through in vim by getting rid of the closing tag noise at editor level. While the tags still exist in the source code we simply collapse them in the editor. Any project level or source level changes are thus not needed.</p>\n<p>The end result looks like this:</p>\n<p><img src=\"/images/collapsed-end-tags.png\" alt=\"Collapsed end tags\" loading=\"lazy\"></p>\n<p>This is achieved by utilizing the <a href=\"https://vimhelp.org/syntax.txt.html#conceal\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">conceal feature</a> of vim. While the configuration here has only been tested in neovim, it should work on vanilla vim as well.</p>\n<p>To achieve the above, we can add the following to <code>~/.config/nvim/after/syntax/typescriptreact.vim</code>:</p>\n<pre><code class=\"hljs plaintext\">if exists(&#x27;g:no_vim_conceal&#x27;) || !has(&#x27;conceal&#x27;) || &amp;enc != &#x27;utf-8&#x27;\n  finish\nendif\n\nsyntax match tsxCloseTag &quot;&lt;/.*&gt;&quot; conceal cchar=\nsetlocal conceallevel=1</code></pre>\n\n<p>Now any text matching <code>&lt;/.*&gt;</code> will be concealed and a diamond symbol be shown instead. However if we put the cursor on the specific line, we&#39;ll see the actual source.</p>\n<p>If you need more info about the <code>after</code> directory in vim (as used above) this <a href=\"https://vimhelp.org/options.txt.html#after%2ddirectory\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">vimhelp topic</a> and this <a href=\"https://vi.stackexchange.com/questions/4975/how-can-i-add-additional-syntax-highlighting-rules-in-my-local-vimrc\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">stackexchange thread</a> are good resources.</p>\n<p>If you are wondering how to identify the tag name for other syntax forms eg. the <code>function</code> keyword, this <a href=\"https://github.com/gerw/vim-HiLinkTrace\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">vim plugin</a> can provide you the complete trace of syntax highlight.</p>\n<p>In my setup, <code>:HLT</code> gives me the following trace for a closing tag:</p>\n<pre><code class=\"hljs plaintext\">typescriptBlock-&gt;typescriptParenExp-&gt;tsxRegion-&gt;tsxRegion-&gt;tsxRegion-&gt;tsxRegion-&gt;tsxRegion-&gt;tsxRegion-&gt;tsxCloseTag  HltTrace: tsxCloseTag-&gt;htmlTag-&gt;GruvboxBlue   fg&lt;109&gt; bg&lt;&gt;</code></pre>\n",
            "tags": [
                "vim"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/12/05/extending-exposed-with-custom-operators/",
            "url": "https://lorefnon.me/2021/12/05/extending-exposed-with-custom-operators/",
            "title": "Extending Exposed with new function expressions",
            "date_published": "2021-12-05T00:00:00.000Z",
            "content_html": "<p><a href=\"https://github.com/JetBrains/Exposed\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Exposed</a> is a nice ORM for Kotlin by <a href=\"https://github.com/Tapac\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Andrey Tarashevskiy</a> from <a href=\"https://www.jetbrains.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Jetbrains</a>. Though, not an offically supported product by Jetbrains it has a good following in the Kotlin community. </p>\n<p>I recently got involved in a project using Exposed and discovered that the set of database level functions that are mapped by Exposed is quite small. However, the library makes it easy to add support for the missing functions, which is what this post outlines. </p>\n<p>Let&#39;s say we want to support product of two columns. We can support this by extending the <code>ExpressionWithColumnType</code> class.</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Product</span>&lt;<span class=\"hljs-type\">T</span>&gt;</span>(\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> expr1: ExpressionWithColumnType&lt;T&gt;,\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> expr2: ExpressionWithColumnType&lt;T&gt;\n): ExpressionWithColumnType&lt;T&gt;() &#123;\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-keyword\">val</span> columnType: IColumnType\n        <span class=\"hljs-keyword\">get</span>() = expr1.columnType\n\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">toQueryBuilder</span><span class=\"hljs-params\">(queryBuilder: <span class=\"hljs-type\">QueryBuilder</span>)</span></span> &#123;\n        queryBuilder.append(<span class=\"hljs-string\">&quot;(&quot;</span>, expr1, <span class=\"hljs-string\">&quot;*&quot;</span>, expr2, <span class=\"hljs-string\">&quot;)&quot;</span>)\n    &#125;\n&#125;</code></pre>\n\n<p>This accepts two columns (Column class extends ExpressionWithColumnType too) of same type, and constructs the expression for multiplying these column values. </p>\n<p>While this class can be used directly, it is often convenient to also write an extension method that enables us to chain the operations similar to other exposed functions. </p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-type\">&lt;T&gt;</span> ExpressionWithColumnType<span class=\"hljs-type\">&lt;T&gt;</span>.<span class=\"hljs-title\">product</span><span class=\"hljs-params\">(expr: <span class=\"hljs-type\">ExpressionWithColumnType</span>&lt;<span class=\"hljs-type\">T</span>&gt;)</span></span> =\n    Product(<span class=\"hljs-keyword\">this</span>, expr)</code></pre>\n\n<p>So now, we can easily use this in our code as: </p>\n<pre><code class=\"hljs kotlin\">DesginationTable\n    .slice(\n        DesignationTable.name,\n        DesginationTable.employeeCount.product(DesginationTable.salary)\n    )\n    .groupBy(DesignationTable.name)\n    .toList()</code></pre>\n\n<p>It is usually also convenient to use an alias to retrieve aggregated values: </p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">data</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DesignationSalaryDTO</span></span>(\n    <span class=\"hljs-keyword\">val</span> name: String,\n    <span class=\"hljs-keyword\">val</span> totalSalary: <span class=\"hljs-built_in\">Double</span>\n)\n\n<span class=\"hljs-keyword\">val</span> totalSalary = DesginationTable.employeeCount.product(DesginationTable.salary).alias(<span class=\"hljs-string\">&quot;total_salary&quot;</span>)\n\n<span class=\"hljs-keyword\">val</span> salaryRow DesginationTable\n    .slice(\n        DesignationTable.name, \n        <span class=\"hljs-comment\">// We can use the alias in our slice</span>\n        totalSalary\n    )\n    .groupBy(DesignationTable.name)\n    .map &#123; resultRow -&gt;\n        <span class=\"hljs-comment\">// Map results to a DTO</span>\n        DesignationSalaryDTO(\n            name = DesignationTable.name,\n            <span class=\"hljs-comment\">// We can use the same alias when retrieving the column value</span>\n            totalSalary = resultRow[totalSalary]\n        )\n    &#125;</code></pre>\n\n<p>This illustrates how we can nicely add our extension functions for operations that the library does not support, and use them in pretty much the same way as built in expression composition functions. </p>\n",
            "tags": [
                "Database",
                "Exposed"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/12/15/mapping-between-domain-and-dtos-for-grpc/",
            "url": "https://lorefnon.me/2021/12/15/mapping-between-domain-and-dtos-for-grpc/",
            "title": "Mapping between Domain and DTO classes for gRPC APIs",
            "date_published": "2021-12-05T00:00:00.000Z",
            "content_html": "<p>In a <a href=\"/2021/09/04/bootstrapping-a-grpc-server-with-spring-boot-and-kotlin\">previous post</a> we briefly explored how to build a gRPC api backend with Kotlin. </p>\n<p>In particular, we saw that from the protobuf spec which defines our API, the <a href=\"https://grpc.io/docs/protoc-installation/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">protoc compiler</a> (along with language specific plugins) is able to generate classes for the language(s) in which our server (or client) is implemented. </p>\n<p>To exemplify for our case (a kotlin&#x2F;JVM backend), given a proto spec like this: </p>\n<pre><code class=\"hljs protobuf\"><span class=\"hljs-keyword\">message </span><span class=\"hljs-title class_\">User</span> &#123;\n  <span class=\"hljs-type\">int64</span> id = <span class=\"hljs-number\">1</span>;\n  <span class=\"hljs-type\">string</span> name = <span class=\"hljs-number\">2</span>;\n  <span class=\"hljs-type\">string</span> email = <span class=\"hljs-number\">3</span>;\n&#125;</code></pre>\n\n<p>The code generator generates an immutable User java class, and an associated builder, which we can invoke like this: </p>\n<pre><code class=\"hljs kotlin\">User\n    .newBuilder()\n    .setId(<span class=\"hljs-number\">1</span>)\n    .setName(<span class=\"hljs-string\">&quot;Lorefnon&quot;</span>)\n    .build()</code></pre>\n\n<p>We also get a set of kotlin extensions, which enable us to do the same thing through a more idiomatic kotlin builder: </p>\n<pre><code class=\"hljs kotlin\">user &#123;\n    id = <span class=\"hljs-number\">1</span>\n    name = <span class=\"hljs-string\">&quot;Lorefnon&quot;</span>\n&#125;</code></pre>\n\n<p>Note that in this post we mostly consider the official proto plugins for Java &amp; Kotlin (which are complementary) by Google. Generated code may substantially differ for other alternative implementations like <a href=\"https://github.com/marcoferrer/kroto-plus\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">kroto-plus</a> and <a href=\"https://github.com/streem/pbandk\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">pbandk</a>.</p>\n<p>These classes are primarily intended for deserializing from and serializing to the protobuf format. The conventional term in the JVM ecosystem for such classes, which are primarily intended to transport the data across API boundaries is DTO (Data Transfer Object).</p>\n<p>Now the question arises, what do we use in our business logic ?</p>\n<h2 id=\"Option-1-Using-the-generated-classes-in-core-business-logic-as-well\"><a href=\"#Option-1-Using-the-generated-classes-in-core-business-logic-as-well\" class=\"headerlink\" title=\"Option 1: Using the generated classes in core business logic as well.\"></a>Option 1: Using the generated classes in core business logic as well.</h2><p>There is nothing really preventing us from using the generated class in our business logic as well. </p>\n<p>However, we should be aware of some restrictions: </p>\n<ol>\n<li><p>Generated DTOs are final: </p>\n<p> This means that we can&#39;t inherit from these classes, can&#39;t extend them with internal fields (not part of the API) and can&#39;t add behaviors (methods) to them. </p>\n</li>\n<li><p>They are immutable:</p>\n<p> So whenever we need to get an updated entity, we will need to clone the entity with modifications.</p>\n</li>\n</ol>\n<p>Thus, using the DTOs as Domain classes as well works well primarily when the business logic is entirely implemented as functional services. </p>\n<p>However, if you need mutability or are not so happy with <a href=\"https://martinfowler.com/bliki/AnemicDomainModel.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">anaemic domain models</a>, we have a few options.</p>\n<h2 id=\"Option-2-Pass-around-the-builders\"><a href=\"#Option-2-Pass-around-the-builders\" class=\"headerlink\" title=\"Option 2: Pass around the builders\"></a>Option 2: Pass around the builders</h2><p>One thing that may not be obvious to developers used to conventional java builders, is that the builders generated from protobuf have both getters and setters. </p>\n<p>So when we need mutability, we can just use the builders and call build only once the object needs to be serialized. </p>\n<p>I recommend doing this only internally within a service class, and not have the builders be passed around across services. </p>\n<p>One reason for this is that in a method that receives a builder instance, we don&#39;t have any guarantee from the compiler that all non-optional values have been populated. </p>\n<h2 id=\"Option-3-Compose-over-the-builders\"><a href=\"#Option-3-Compose-over-the-builders\" class=\"headerlink\" title=\"Option 3: Compose over the builders\"></a>Option 3: Compose over the builders</h2><p>A class that composes over the builder can: </p>\n<ol>\n<li>Ensure that any consumer never receives a partially populated builder</li>\n<li>Add behavior to a builder class - I have found this to be particularly useful for things like computed values (like age derived from created_at) which logically belong in the entity class.</li>\n</ol>\n<p>While this would have been cumbersome &amp; boilerplate heavy in java, Kotlin&#39;s support for interface delegation comes in really handy here. </p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserBuilder</span> <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">constructor</span></span>(\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> internalBuilder: User.Builder\n): UserOrBuilder <span class=\"hljs-keyword\">by</span> internalBuilder &#123;\n\n    <span class=\"hljs-comment\">// To be used when constructing new objects</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">constructor</span>(\n        name: String,\n        email: String\n        <span class=\"hljs-comment\">// Other fields whose presence we want to enforce</span>\n    ): <span class=\"hljs-keyword\">this</span>(\n        User\n            .newBuilder()\n            .setName(name)\n            .setEmail(email)\n    )\n\n    <span class=\"hljs-comment\">// To be used when deserializing previously serialized entity </span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">constructor</span>(\n        inputStream: InputStream\n    ): <span class=\"hljs-keyword\">this</span>(\n        User.newBuilder().mergeFrom(inputStream)\n\n        <span class=\"hljs-comment\">// If we had successfully serialized, then we know that all mandatory fields will be present</span>\n        <span class=\"hljs-comment\">//</span>\n        <span class=\"hljs-comment\">// But we can add validations if we are consuming multiple generations of serialized entities</span>\n    )\n\n    <span class=\"hljs-comment\">// If needed, define similar constructors to consume ByteArray/ByteString</span>\n\n    <span class=\"hljs-comment\">// Define setters for fields for which you want to explicitly allow mutation</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">setName</span><span class=\"hljs-params\">(mail: <span class=\"hljs-type\">String</span>)</span></span> &#123;\n        internalBuilder.email = mail\n    &#125;\n&#125;</code></pre>\n\n<p>The UserOrBuilder is a generated interface which contains all the getters. By delegating to this interface through the builder, we can directly invoke all the setters directly on an instance of our <code>UserBuilder</code> class, and they&#39;ll be proxied to the underlying builder.</p>\n<p>By ensuring that our constructor accepts all mandatory parameters, our consumers are guaranteed to never receive partially populated builders. </p>\n<p>Also, we are explicit about which fields we want to allow mutation for. </p>\n<p>The only caveat with this approach is that it is quite a bit of boilerplate because a large set of fields have to enumerated over in the constructor. </p>\n<h2 id=\"Option-4-Use-a-mapping-library-like-MapStruct\"><a href=\"#Option-4-Use-a-mapping-library-like-MapStruct\" class=\"headerlink\" title=\"Option 4: Use a mapping library like MapStruct\"></a>Option 4: Use a mapping library like MapStruct</h2><p>MapStruct is a really nice model mapping library for java that has good support for Kotlin and protobuf style builders. </p>\n<p>One great feature of the library, as compared to many other similar model mapping libraries is that there is no reflection involved during mapping - which makes this library very performant in practice. </p>\n<p>Application developers need to define mapper interfaces, and at compile time MapStruct will generate mapper classes which convert between one type to another. </p>\n<p>With this library, we can define our domain classes as Kotlin (data) classes and have them mapped to&#x2F;from the API classes at the API service layer. </p>\n<p>Following are the primary dependencies we need: </p>\n<pre><code class=\"hljs kotlin\">implementation(<span class=\"hljs-string\">&quot;org.mapstruct:mapstruct:1.4.2.Final&quot;</span>)\nkapt(<span class=\"hljs-string\">&quot;org.mapstruct:mapstruct-processor:1.4.2.Final&quot;</span>)\nkapt(<span class=\"hljs-string\">&quot;no.entur.mapstruct.spi:protobuf-spi-impl:1.18&quot;</span>)</code></pre>\n\n<p>In a spring project, we&#39;d also want MapStruct to automatically annotate generated classes with <code>@Component</code> so that we can directly inject them in our services: </p>\n<pre><code class=\"hljs kotlin\">kapt &#123;\n    arguments &#123;\n        arg(<span class=\"hljs-string\">&quot;mapstruct.defaultComponentModel&quot;</span>, <span class=\"hljs-string\">&quot;spring&quot;</span>)\n    &#125;\n&#125;</code></pre>\n\n<p>Now, we can define a mapper abstract class or interface, which MapStruct will use to generate our Mappers: </p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-meta\">@Mapper(</span>\n<span class=\"hljs-meta\">    // We can not assign null to setters in protobuf builders</span>\n<span class=\"hljs-meta\">    nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE,</span>\n<span class=\"hljs-meta\">    nullValueCheckStrategy = NullValueCheckStrategy.ALWAYS,</span>\n<span class=\"hljs-meta\"></span>\n<span class=\"hljs-meta\">    // For collection members (repeated fields in protobuf)</span>, we should use \n    <span class=\"hljs-comment\">// the add* methods rather than set* methods</span>\n    collectionMappingStrategy = CollectionMappingStrategy.ADDER_PREFERRED\n)\n<span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DTOMapper</span> </span>&#123;\n    <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">mapUserFromPB</span><span class=\"hljs-params\">(source: <span class=\"hljs-type\">User</span>)</span></span>: UserEntity\n    <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">mapUserToPB</span><span class=\"hljs-params\">(source: <span class=\"hljs-type\">UserEntity</span>)</span></span>: User\n&#125;</code></pre>\n\n<p>Here <code>User</code> entity is the class generated from protobuf, and <code>UserEntity</code> is our internal domain class.</p>\n<p>For this particular example, this is all we need if our fields have the same name in both classes, and the generated classes and the domain classes use the same types. </p>\n<p>In real world applications, both of these will sometimes not be true. However, to handle these special cases we can configure MapStruct with custom mappings and specify shared type mappers.</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DTOMapper</span> </span>&#123;\n\n    <span class=\"hljs-comment\">// Custom mapping for field</span>\n    <span class=\"hljs-meta\">@Mappings(</span>\n<span class=\"hljs-meta\">        value = [</span>\n<span class=\"hljs-meta\">            Mapping(source = <span class=\"hljs-string\">&quot;mailAddress&quot;</span>, target = <span class=\"hljs-string\">&quot;email&quot;</span>)</span>\n        ]\n    )\n    <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">mapUserFromPB</span><span class=\"hljs-params\">(source: <span class=\"hljs-type\">User</span>)</span></span>: UserEntity\n\n    <span class=\"hljs-comment\">// Convert between types used in Domain classes and DTOs</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">map</span><span class=\"hljs-params\">(value: <span class=\"hljs-type\">Date</span>)</span></span> =\n        LocalDate.of(value.year, value.month, value.day)\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">map</span><span class=\"hljs-params\">(value: <span class=\"hljs-type\">LocalDate</span>)</span></span>: Date =\n        Date.newBuilder()\n            .setDay(value.dayOfMonth)\n            .setMonth(value.monthValue)\n            .setYear(value.year)\n            .build()\n&#125;</code></pre>\n\n<p>MapStruct <a href=\"https://mapstruct.org/documentation/installation/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">docs</a> cover all possible options in much more detail.</p>\n<p>In our RPC service implementations, we can inject our mappers and use them to transform inputs before delegating to internal classes, and after receiving the results from the internal classes. </p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-meta\">@GrpcService</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserRPCService</span></span>(\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> userRepo: UserRepository,\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> mapper: DTOMapper\n) : UserServiceGrpcKt.UserServiceCoroutineImplBase() &#123;\n\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUser</span><span class=\"hljs-params\">(request: <span class=\"hljs-type\">UserIdRequest</span>)</span></span>: User &#123;\n        <span class=\"hljs-keyword\">return</span> mapper.mapUserToPB(userRepo.getUser(request.id))\n    &#125;\n\n&#125;</code></pre>\n\n<p>This is the option with minimum boilerplate, but has the trade-off of needing additional heap allocations. However, it is usually an acceptable tradeoff when the types used in the DTOs often differ from the the types used in the domain classes or when we need multiple representations of the same domain class(es) in the API layer (with different set of fields).</p>\n",
            "tags": [
                "Kotlin",
                "Spring",
                "Spring-Boot",
                "gRPC"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/11/21/composable-and-refactorable-annotaiton-args-in-kotlin-with-const-val/",
            "url": "https://lorefnon.me/2021/11/21/composable-and-refactorable-annotaiton-args-in-kotlin-with-const-val/",
            "title": "Composable and Refactorable annotation arguments in Kotlin with const val",
            "date_published": "2021-11-21T00:00:00.000Z",
            "content_html": "<p>There are many libraries in JVM ecosystem that lean heavily on use of annotations. A pain point when dealing with string args passed to annotations is that they are hard to compose&#x2F;reuse.</p>\n<p>For example, here is a sample mybatis mapper:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Select\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">PersonMapper</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Select(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        select *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        from person where id = #{value}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &quot;&quot;&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">selectPersonById</span><span class=\"hljs-params\">(id: <span class=\"hljs-type\">Int</span>)</span></span>: Person\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Select(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        select *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        from person where email = #{value}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &quot;&quot;&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">selectPersonById</span><span class=\"hljs-params\">(email: <span class=\"hljs-type\">String</span>)</span></span>: Person\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>As written above, if we want to change the name of person table in future, we&#39;d have to resort to find&#x2F;replace across the project, which isn&#39;t great.</p>\n<p>In addition, a typo in the table name would be a runtime error as opposed to a compile time.</p>\n<p>Both of the above issues are easily solvable by using <code>const val</code> feature of Kotlin, for defining compile time constants.</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">val</span> PERSON_TABLE = <span class=\"hljs-string\">&quot;person&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">PersonMapper</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Select(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        select *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        from <span class=\"hljs-subst\">${PERSON_TABLE}</span> where id = #{value}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &quot;&quot;&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">selectPersonById</span><span class=\"hljs-params\">(id: <span class=\"hljs-type\">Int</span>)</span></span>: Person\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Select(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        select *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        from <span class=\"hljs-subst\">${PERSON_TABLE}</span> where email = #{value}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &quot;&quot;&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">selectPersonById</span><span class=\"hljs-params\">(email: <span class=\"hljs-type\">String</span>)</span></span>: Person\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr></table></code></pre>\n\n<p>String constants can simply be interpolated into the strings passed to annotations, and they can be changed in one place if need be.</p>\n<p>This also enables us to extract fragments and reuse them in multiple annotations, enabling reusability. In addition, if we follow the pattern consistently, IDE features like &quot;Find usages&quot; enable us to quickly find all the mappers which are accessing the user table.</p>\n<p>Another example here uses Retrofit library for creating declarative REST API clients:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">val</span> VERSION = <span class=\"hljs-string\">&quot;v1&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">val</span> USER_ENDPOINT = <span class=\"hljs-string\">&quot;/api/<span class=\"hljs-subst\">${VERSION}</span>/user&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">UserClient</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@GET(USER_ENDPOINT)</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserByEmail</span><span class=\"hljs-params\">(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-meta\">@Query(<span class=\"hljs-string\">&quot;email&quot;</span>)</span> email: <span class=\"hljs-type\">String</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span></span>: Call&lt;User&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@GET(USER_ENDPOINT)</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-meta\">@Query(<span class=\"hljs-string\">&quot;id&quot;</span>)</span> id: <span class=\"hljs-type\">String</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span></span>: Call&lt;User&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Now when we migrate to new version, we just need to change the version in one place. Also multiple functions targeting the same endpoint can refer to it through a shared constant, making the code DRY-er.</p>\n",
            "tags": [
                "Kotlin"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/11/20/efficient-multi-tiered-caches-with-redis/",
            "url": "https://lorefnon.me/2021/11/20/efficient-multi-tiered-caches-with-redis/",
            "title": "Simple and efficient multi-tiered caches with Redis & lua",
            "date_published": "2021-11-20T00:00:00.000Z",
            "content_html": "<p><a href=\"https://redis.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Redis</a> is one of the most popular in-memory stores currently. It has a minimal footprint, is blazing fast and has managed solutions available in most cloud platforms.</p>\n<p>However, people using redis as a cache often use it as a simple key-value store. It is not uncommon to see usages like <code>users:by-id:1</code> pointing to a serialized User entity with id 1, and <code>users:by-email:jon@example.com</code> pointing to a serialized User entity with a specific email. In case they are the same user, we end up storing the same entity twice, with different keys.</p>\n<p>In this post, we outline that it is rather straightforward to avoid this by having a secondary index for this. </p>\n<p>In above scenario, this translates to <code>users:by-email:*</code> being a secondary index, pointing to user id which can be looked up from primary index. So <code>GET users:by-email:joe@example.com</code> returns <code>1</code>, and then we can lookup user by <code>GET users:by-id:1</code>. This can help us reduce memory usage through deduplication, but the caveat is that we now need multiple lookups. </p>\n<p>However, these multiple lookups don&#39;t need to be multiple tcp roundtrips between the application and cache server. We can utilize lua script support to use the value of first lookup in second lookup within the same request.</p>\n<p>In practice, this looks something like this:</p>\n<pre><code class=\"hljs plaintext\">EVAL &quot;local user_id = redis.call(&#x27;GET&#x27;, KEYS[1]); if (user_id == false) then return false else return redis.call(&#x27;GET&#x27;, &#x27;users:by-id:&#x27; .. user_id); end&quot; 1 &#x27;users:by-email:joe@example.com1&#x27;</code></pre>\n\n<p>Here the first arg to eval is a lua script, here is a better formatted snippet: </p>\n<pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">local</span> user_id = redis.call(<span class=\"hljs-string\">&#x27;GET&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>]);\n\n<span class=\"hljs-keyword\">if</span> (user_id == <span class=\"hljs-literal\">false</span>) <span class=\"hljs-keyword\">then</span> <span class=\"hljs-comment\">-- GET returns false if primary lookup fails</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>           <span class=\"hljs-comment\">-- will translate to a nil reply from redis</span>\n<span class=\"hljs-keyword\">else</span> \n    <span class=\"hljs-keyword\">return</span> redis.call(<span class=\"hljs-string\">&#x27;GET&#x27;</span>, <span class=\"hljs-string\">&#x27;users:by-id:&#x27;</span> .. user_id); \n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The second arg is number of arguments to be passed to the script, and in this case the only arg is the secondary index key, which we access in the above script as <code>KEYS[1]</code>. Quick reminder that lua array indices start from 1 :)</p>\n<p>The redis guide has <a href=\"https://redis.io/commands/eval#conversion-between-lua-and-redis-data-types\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">more pointers</a> on the redis &lt;-&gt; Lua type conversions, which you might want to glance through before venturing deeper into lua scripting with redis.</p>\n<p>We can of-course extend this pattern to include multiple tiers, or more complex dependencies. At that point, it is worthwhile to also explore modules like <a href=\"https://oss.redis.com/redisgraph/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">RedisGraph</a> which provides a datamodel for PropertyGraphs and enables querying them through Cypher query language.</p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/09/04/bootstrapping-a-grpc-server-with-spring-boot-and-kotlin/",
            "url": "https://lorefnon.me/2021/09/04/bootstrapping-a-grpc-server-with-spring-boot-and-kotlin/",
            "title": "Bootstrapping a Kotlin gRPC service with Spring Boot",
            "date_published": "2021-09-04T00:00:00.000Z",
            "content_html": "<p>It has always been possible to build gRPC services in kotlin through java interop, but with the recently improved first class support for kotlin in the official gRPC&#x2F;protobuf libraries it is quite straightforward to build gRPC services in Kotlin which take advantage of kotlin native features like coroutines. In addition, the grpc-spring-boot-starter makes it really convenient for spring boot users to integrate gRPC.</p>\n<span id=\"more\"></span>\n\n<p>Note that while our services are using coroutines, we will not need webflux (although it is perfectly fine to use both of them together)</p>\n<p>This post is primarily a recipe for integrating these components to quickly get started with gRPC on spring boot.</p>\n<h1 id=\"Gradle-configuration\"><a href=\"#Gradle-configuration\" class=\"headerlink\" title=\"Gradle configuration:\"></a>Gradle configuration:</h1><p>First part is to configure our gradle configuration (<code>build.gradle.kts</code>) to use the protobuf and grpc codegen utilities.</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.google.protobuf.gradle.*\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">val</span> protobufVersion <span class=\"hljs-keyword\">by</span> extra(<span class=\"hljs-string\">&quot;3.17.3&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">val</span> protobufPluginVersion <span class=\"hljs-keyword\">by</span> extra(<span class=\"hljs-string\">&quot;0.8.14&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">val</span> grpcVersion <span class=\"hljs-keyword\">by</span> extra(<span class=\"hljs-string\">&quot;1.40.1&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">plugins {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    id(<span class=\"hljs-string\">&quot;org.springframework.boot&quot;</span>) version <span class=\"hljs-string\">&quot;2.5.4&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    id(<span class=\"hljs-string\">&quot;io.spring.dependency-management&quot;</span>) version <span class=\"hljs-string\">&quot;1.0.11.RELEASE&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    kotlin(<span class=\"hljs-string\">&quot;jvm&quot;</span>) version <span class=\"hljs-string\">&quot;1.5.21&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    kotlin(<span class=\"hljs-string\">&quot;plugin.spring&quot;</span>) version <span class=\"hljs-string\">&quot;1.5.21&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    id(<span class=\"hljs-string\">&quot;com.google.protobuf&quot;</span>) version <span class=\"hljs-string\">&quot;0.8.17&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">group = <span class=\"hljs-string\">&quot;com.example&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">version = <span class=\"hljs-string\">&quot;0.0.1-SNAPSHOT&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">java.sourceCompatibility = JavaVersion.VERSION_11\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">repositories {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    mavenCentral()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">dependencies {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-reflect&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlin:kotlin-stdlib-jdk8&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    testImplementation(<span class=\"hljs-string\">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;net.devh:grpc-server-spring-boot-starter:2.12.0.RELEASE&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;io.grpc:grpc-protobuf:<span class=\"hljs-subst\">${grpcVersion}</span>&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;io.grpc:grpc-stub:1.40.1&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;io.grpc:grpc-kotlin-stub:1.1.0&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    compileOnly(<span class=\"hljs-string\">&quot;jakarta.annotation:jakarta.annotation-api:1.3.5&quot;</span>) <span class=\"hljs-comment\">// Java 9+ compatibility - Do NOT update to 2.0.0</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;com.google.protobuf:protobuf-java:<span class=\"hljs-variable\">$protobufVersion</span>&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;net.devh:grpc-client-spring-boot-starter:2.12.0.RELEASE&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    implementation(<span class=\"hljs-string\">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.5.1&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">if</span> (JavaVersion.current().isJava9Compatible) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        implementation(<span class=\"hljs-string\">&quot;javax.annotation:javax.annotation-api:+&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">tasks.withType&lt;KotlinCompile&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    kotlinOptions {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        freeCompilerArgs = listOf(<span class=\"hljs-string\">&quot;-Xjsr305=strict&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        jvmTarget = <span class=\"hljs-string\">&quot;11&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">tasks.withType&lt;Test&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    useJUnitPlatform()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    testLogging.showStandardStreams = <span class=\"hljs-literal\">true</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">sourceSets {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    test {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        java.srcDirs.add(File(<span class=\"hljs-string\">&quot;src/test/kotlin&quot;</span>))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">protobuf {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    protoc {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        artifact = <span class=\"hljs-string\">&quot;com.google.protobuf:protoc:<span class=\"hljs-subst\">${protobufVersion}</span>&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    plugins {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        id(<span class=\"hljs-string\">&quot;grpc&quot;</span>) {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            artifact = <span class=\"hljs-string\">&quot;io.grpc:protoc-gen-grpc-java:<span class=\"hljs-subst\">${grpcVersion}</span>&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        id(<span class=\"hljs-string\">&quot;grpckt&quot;</span>) {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            artifact = <span class=\"hljs-string\">&quot;io.grpc:protoc-gen-grpc-kotlin:1.1.0:jdk7@jar&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    generateProtoTasks {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        ofSourceSet(<span class=\"hljs-string\">&quot;main&quot;</span>).forEach {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            task.builtins {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                java {}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                kotlin {}\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            it.plugins {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id(<span class=\"hljs-string\">&quot;kotlin&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id(<span class=\"hljs-string\">&quot;grpc&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id(<span class=\"hljs-string\">&quot;grpckt&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Note the use of the additional grpckt plugin for protoc along with the grpc plugin for java code-generation.</p>\n<p>Given, the above configuration, we can start defining our API schema in protobuf format.</p>\n<p>Let us start with a minimal example of <code>src/main/proto/demo.proto</code>:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">syntax = <span class=\"hljs-string\">&quot;proto3&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/wrappers.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/timestamp.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">service </span><span class=\"hljs-title class_\">UserService</span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-function\"><span class=\"hljs-keyword\">rpc</span> getUserById (google.protobuf.Int64Value) <span class=\"hljs-keyword\">returns</span> (User)</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">message </span><span class=\"hljs-title class_\">User</span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-type\">int64</span> id = <span class=\"hljs-number\">1</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-type\">string</span> name = <span class=\"hljs-number\">2</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr></table></code></pre>\n\n<p>We will look at the code generated for the above in a bit. But let us first look at how to implement this service in our kotlin backend. Our UserService has just one method for now which returns a user given it&#39;s id.</p>\n<p>Our <code>UserService.kt</code> implementing this RPC service looks something like this:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.google.protobuf.Int64Value\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> net.devh.boot.grpc.server.service.GrpcService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@GrpcService</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserService</span>: <span class=\"hljs-type\">UserServiceGrpcKt.UserServiceCoroutineImplBase</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(userId: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> Demo.User\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .newBuilder()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .setId(<span class=\"hljs-number\">1</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .setName(<span class=\"hljs-string\">&quot;Lorefnon&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>We have also configured the kotlin plugin for protobuf, which adds a couple of convenient extensions to the builders generated by the protobuf java plugin. So if we want, instead of using <code>Demo.User.newBuilder()</code> as in the above snippet, we could use a more kotlin-esque builder DSL:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">return</span> user {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  id = <span class=\"hljs-number\">1</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  name = <span class=\"hljs-string\">&quot;Lorefnon&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Our implementation derives from the <code>UserServiceGrpcKt.UserServiceCoroutineImplBase</code> which was generated for us. The generated functions use some protobuf specific types and we return a <code>User</code> instance constructed through the builder that was also generated for us.</p>\n<p>Overall our code loooks pretty readable, and we didn&#39;t have to write any mapping boilerplate.</p>\n<p>If we peek into the build directory, we can find all the code our code-generator generated for us:</p>\n<pre><code class=\"hljs plaintext\"> build/\n   classes/\n   extracted-include-protos/\n   extracted-protos/\n   generated/\n     source/proto/main/\n       grpc/com/example/grpcdemo/service/\n          UserServiceGrpc.java\n       grpckt/com/example/grpcdemo/service/\n          DemoGrpcKt.kt</code></pre>\n\n<p>The first thing we want to look at is the <code>UserServiceKt</code> where our base class we derived from resides:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-18\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">25 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.google.protobuf.Int64Value\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> com.example.grpcdemo.service.UserServiceGrpc.getServiceDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.CallOptions\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.CallOptions.DEFAULT\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Channel\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Metadata\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.MethodDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.ServerServiceDefinition\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.ServerServiceDefinition.builder\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.ServiceDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Status\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.Status.UNIMPLEMENTED\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.StatusException\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.AbstractCoroutineServerImpl\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.AbstractCoroutineStub\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ClientCalls.serverStreamingRpc\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ClientCalls.unaryRpc\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ServerCalls.serverStreamingServerMethodDefinition\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.ServerCalls.unaryServerMethodDefinition\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.grpc.kotlin.StubFor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.String\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.coroutines.CoroutineContext\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.coroutines.EmptyCoroutineContext\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.jvm.JvmOverloads\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlin.jvm.JvmStatic\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-18\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> kotlinx.coroutines.flow.Flow\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> * Holder for Kotlin coroutine-based client and server APIs for\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> * com.example.grpcdemo.service.UserService.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">object</span> UserServiceGrpcKt {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">val</span> SERVICE_NAME: String = UserServiceGrpc.SERVICE_NAME\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-meta\">@JvmStatic</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">val</span> serviceDescriptor: ServiceDescriptor\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">get</span>() = UserServiceGrpc.getServiceDescriptor()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">val</span> getUserByIdMethod: MethodDescriptor&lt;Int64Value, Demo.User&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@JvmStatic</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">get</span>() = UserServiceGrpc.getGetUserByIdMethod()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * A stub for issuing RPCs to a(n) com.example.grpcdemo.service.UserService service as\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * suspending coroutines.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-meta\">@StubFor(UserServiceGrpc::class)</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserServiceCoroutineStub</span> <span class=\"hljs-meta\">@JvmOverloads</span> <span class=\"hljs-keyword\">constructor</span></span>(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    channel: Channel,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    callOptions: CallOptions = DEFAULT\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  ) : AbstractCoroutineStub&lt;UserServiceCoroutineStub&gt;(channel, callOptions) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">build</span><span class=\"hljs-params\">(channel: <span class=\"hljs-type\">Channel</span>, callOptions: <span class=\"hljs-type\">CallOptions</span>)</span></span>: UserServiceCoroutineStub =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        UserServiceCoroutineStub(channel, callOptions)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * Executes this RPC and returns the response message, suspending until the RPC completes\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * with [`Status.OK`][Status].  If the RPC completes with another status, a corresponding\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * [StatusException] is thrown.  If this coroutine is cancelled, the RPC is also cancelled\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * with the corresponding exception as a cause.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * <span class=\"hljs-doctag\">@param</span> request The request message to send to the server.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * <span class=\"hljs-doctag\">@return</span> The single response from the server.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(request: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User = unaryRpc(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      channel,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      UserServiceGrpc.getGetUserByIdMethod(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      request,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      callOptions,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      Metadata()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * Skeletal implementation of the com.example.grpcdemo.service.UserService service based on\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   * Kotlin coroutines.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">   */</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserServiceCoroutineImplBase</span></span>(\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    coroutineContext: CoroutineContext = EmptyCoroutineContext\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">  ) : AbstractCoroutineServerImpl(coroutineContext) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * Returns the response to an RPC for com.example.grpcdemo.service.UserService.getUserById.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * If this method fails with a [StatusException], the RPC will fail with the corresponding\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * [Status].  If this method fails with a [java.util.concurrent.CancellationException], the RPC\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * will fail\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * with status `Status.CANCELLED`.  If this method fails for any other reason, the RPC will\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * fail with `Status.UNKNOWN` with the exception as a cause.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     *\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * <span class=\"hljs-doctag\">@param</span> request The request from the client.\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     */</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">open</span> <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(request: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User = <span class=\"hljs-keyword\">throw</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        StatusException(UNIMPLEMENTED.withDescription(<span class=\"hljs-string\">&quot;Method com.example.grpcdemo.service.UserService.getUserById is unimplemented&quot;</span>))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">bindService</span><span class=\"hljs-params\">()</span></span>: ServerServiceDefinition = builder(getServiceDescriptor())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      .addMethod(unaryServerMethodDefinition(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      context = <span class=\"hljs-keyword\">this</span>.context,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      descriptor = UserServiceGrpc.getGetUserByIdMethod(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      implementation = ::getUserById\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    ))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      .addMethod(serverStreamingServerMethodDefinition(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      context = <span class=\"hljs-keyword\">this</span>.context,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      descriptor = UserServiceGrpc.getListUsersMethod(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      implementation = ::listUsers\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )).build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>There isn&#39;t much rocket science here. The code looks much similar to what we would have written if we were implementing this boilerplate ourselves.</p>\n<p>In our previous example, we have used a unary call. gRPC also has good support for streaming.</p>\n<p>Before we conclude our post, let&#39;s quickly look at what implementing a stream returning endpoint looks like. We add a <code>listUsers</code> method to our <code>UserService</code> which returns a stream of <code>User</code>.</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">syntax = <span class=\"hljs-string\">&quot;proto3&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> com.example.grpcdemo.service;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/wrappers.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">&quot;google/protobuf/timestamp.proto&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">service </span><span class=\"hljs-title class_\">UserService</span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-function\"><span class=\"hljs-keyword\">rpc</span> getUserById (google.protobuf.Int64Value) <span class=\"hljs-keyword\">returns</span> (User)</span>;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-function\"><span class=\"hljs-keyword\">rpc</span> listUsers(ListUsersInput) <span class=\"hljs-keyword\">returns</span> (stream User)</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">message </span><span class=\"hljs-title class_\">ListUsersInput</span> {}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">message </span><span class=\"hljs-title class_\">User</span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-type\">int64</span> id = <span class=\"hljs-number\">1</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-type\">string</span> name = <span class=\"hljs-number\">2</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr></table></code></pre>\n\n<p>One weird gRPC oddity is that even though our function does not need an argument, it is required to accept an argument, and hence we have defined an empty message type.</p>\n<p>As you may expect, on the kotlin side our return value is a <a href=\"https://kotlinlang.org/docs/flow.html#sequences\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Flow</a> - enabling us to return a collection of values over time.</p>\n<p>In our simple example below, we simply return a list, converted to a flow through a convenient extension function from kotlinx.coroutines.</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@GrpcService</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserService</span>: <span class=\"hljs-type\">UserServiceGrpcKt.UserServiceCoroutineImplBase</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-19\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">5 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-keyword\">suspend</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(userId: <span class=\"hljs-type\">Int64Value</span>)</span></span>: Demo.User {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">            id = userId.value\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">            name = <span class=\"hljs-string\">&quot;Lorefnon&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">        }.build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-19\"><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">listUsers</span><span class=\"hljs-params\">(request: <span class=\"hljs-type\">Demo</span>.<span class=\"hljs-type\">ListUsersInput</span>)</span></span>: Flow&lt;Demo.User&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> listOf(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id = <span class=\"hljs-number\">10</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                name = <span class=\"hljs-string\">&quot;Harry&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }.build(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id = <span class=\"hljs-number\">20</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                name = <span class=\"hljs-string\">&quot;Hermione&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }.build(),\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            Demo.User.newBuilder().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                id = <span class=\"hljs-number\">20</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                name = <span class=\"hljs-string\">&quot;Ron&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }.build()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        ).asFlow()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Lastly, if you don&#39;t want to deal with coroutines, you don&#39;t need to. It is perfectly fine to still use the base classes generated for Java, in your kotlin code.</p>\n<p>In fact, it is also perfectly fine to use just the kotlin extensions for Protobuf DSL, while not using the <code>*CoroutineImplBase</code> classes for gRPC. The two have no dependency on each other.</p>\n<p>To illustrate this in our last example, we could have written:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@GrpcService</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserService</span>: <span class=\"hljs-type\">UserServiceGrpc.UserServiceImplBase</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getUserById</span><span class=\"hljs-params\">(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      userId: <span class=\"hljs-type\">Int64Value</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver: <span class=\"hljs-type\">StreamObserver</span>&lt;<span class=\"hljs-type\">User</span>&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span></span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver.onNext(user {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        id = userId.value\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        name = <span class=\"hljs-string\">&quot;Lorefnon&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      })\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver.onCompleted()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">listUsers</span><span class=\"hljs-params\">(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      request: <span class=\"hljs-type\">Demo</span>.<span class=\"hljs-type\">ListUsersInput</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver: <span class=\"hljs-type\">StreamObserver</span>&lt;<span class=\"hljs-type\">User</span>&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span></span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver.onNext(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        user {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">          id = <span class=\"hljs-number\">10</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">          name = <span class=\"hljs-string\">&quot;Harry&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      )\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver.onNext(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        user {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">          id = <span class=\"hljs-number\">20</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">          name = <span class=\"hljs-string\">&quot;Hermione&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      )\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver.onNext(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        user {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">          id = <span class=\"hljs-number\">20</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">          name = <span class=\"hljs-string\">&quot;Ron&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      )\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">      responseObserver.onFinish()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>As we are using <code>UserServiceGrpc.UserServiceImplBase</code> instead of <code>UserServiceGrpcKt.UserServiceCoroutineImplBase</code>, our functions are no longer suspending functions. Also instead of returning values, they accept a <code>responseObserver</code> which can be used to return one or more values.</p>\n<p>This brings us to the end of this short post. We explored how we can bootstrap a simple gRPC service using kotlin and spring boot, and handle unary calls and streaming. As next steps you are encouraged to explore the <a href=\"https://yidongnan.github.io/grpc-spring-boot-starter/en/server/getting-started.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">grpc-spring-boot-starter&#39;s introduction</a> and the <a href=\"https://grpc.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">gRPC official site</a> which provide detailed documentation on gRPC integrations.</p>\n",
            "tags": [
                "Kotlin",
                "Spring",
                "Spring-Boot",
                "gRPC"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/09/01/configuring-liquibase-with-gradle-kotlin-dsl/",
            "url": "https://lorefnon.me/2021/09/01/configuring-liquibase-with-gradle-kotlin-dsl/",
            "title": "Configuring Liquibase through Gradle Kotlin DSL",
            "date_published": "2021-09-01T00:00:00.000Z",
            "content_html": "<p>This post is a minimal recipe for configuring Liquibase runner through the Gradle kotlin DSL. This is mostly ported from the offical examples <a href=\"https://github.com/liquibase/liquibase-gradle-plugin#usage\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">here</a> written using the Gradle&#39;s Groovy DSL:</p>\n<p>We can specify our database properties in gradle.properties:</p>\n<pre><code class=\"hljs plaintext\">db_url=jdbc:mysql://172.17.0.2:3306/oms_dev\ndb_user=root\ndb_password=rootroot</code></pre>\n\n<p>And use them in our build.gradle.kts:</p>\n<pre><code class=\"hljs kotlin\">version = <span class=\"hljs-string\">&quot;1.0-SNAPSHOT&quot;</span>\n\nrepositories &#123;\n    mavenCentral()\n    jcenter()\n&#125;\n\nplugins &#123;\n    kotlin(<span class=\"hljs-string\">&quot;jvm&quot;</span>) version <span class=\"hljs-string\">&quot;1.5.21&quot;</span>\n    id(<span class=\"hljs-string\">&quot;org.liquibase.gradle&quot;</span>) version <span class=\"hljs-string\">&quot;2.0.3&quot;</span>\n&#125;\n\n<span class=\"hljs-comment\">// Liquibase plugin configuration</span>\nliquibase &#123;\n    activities.register(<span class=\"hljs-string\">&quot;main&quot;</span>) &#123;\n        <span class=\"hljs-keyword\">val</span> db_url <span class=\"hljs-keyword\">by</span> project.extra.properties\n        <span class=\"hljs-keyword\">val</span> db_user <span class=\"hljs-keyword\">by</span> project.extra.properties\n        <span class=\"hljs-keyword\">val</span> db_password <span class=\"hljs-keyword\">by</span> project.extra.properties\n\n        <span class=\"hljs-keyword\">this</span>.arguments = mapOf(\n            <span class=\"hljs-string\">&quot;logLevel&quot;</span> to <span class=\"hljs-string\">&quot;info&quot;</span>,\n            <span class=\"hljs-string\">&quot;changeLogFile&quot;</span> to <span class=\"hljs-string\">&quot;src/main/resources/db/changelog.yml&quot;</span>,\n            <span class=\"hljs-string\">&quot;url&quot;</span> to db_url,\n            <span class=\"hljs-string\">&quot;username&quot;</span> to db_user,\n            <span class=\"hljs-string\">&quot;password&quot;</span> to db_password,\n            <span class=\"hljs-string\">&quot;driver&quot;</span> to <span class=\"hljs-string\">&quot;com.mysql.cj.jdbc.Driver&quot;</span>\n        )\n    &#125;\n    runList = <span class=\"hljs-string\">&quot;main&quot;</span>\n&#125;\n\ndependencies &#123;\n    <span class=\"hljs-comment\">// Include database drivers to be used by liquibase</span>\n    liquibaseRuntime(<span class=\"hljs-string\">&quot;mysql:mysql-connector-java:8.0.26&quot;</span>)\n    liquibaseRuntime(<span class=\"hljs-string\">&quot;org.liquibase:liquibase-core:4.4.3&quot;</span>)\n    liquibaseRuntime(<span class=\"hljs-string\">&quot;org.yaml:snakeyaml:1.29&quot;</span>)\n&#125;</code></pre>\n",
            "tags": [
                "Kotlin",
                "Liquibase",
                "Gradle"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/08/07/Documenting-Your-Data-Model-With-Liquibase-and-Tbls/",
            "url": "https://lorefnon.me/2021/08/07/Documenting-Your-Data-Model-With-Liquibase-and-Tbls/",
            "title": "Documenting your data model with liquibase, tbls & jOOQ",
            "date_published": "2021-08-07T00:00:00.000Z",
            "content_html": "<p>Documenting a database schema is often an afterthought, even though it is really important esp. for onboarding new developers into the project.</p>\n<p>This post outlines a really straightforward approach I recently adopted for my projects using <a href=\"https://www.liquibase.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Liquibase</a>, <a href=\"https://github.com/k1LoW/tbls\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">tbls</a> &amp; <a href=\"https://jooq.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">jOOQ</a>.</p>\n<!-- more -->\n\n<h1 id=\"About-Liquibase\"><a href=\"#About-Liquibase\" class=\"headerlink\" title=\"About Liquibase\"></a>About Liquibase</h1><p>Liquibase is a great utility for managing database schema evolution. It has support for a great set of features like a YAML&#x2F;XML DSL that takes care of automatic rollbacks, support for parameter interpolation, and many more which are quite handy in enterprise contexts.</p>\n<p>Here is what the DSL looks like in YAML: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">changeSet:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">id:</span> <span class=\"hljs-number\">1</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">author:</span> <span class=\"hljs-string\">lorefnon</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">changes:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">createTable:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-attr\">tableName:</span> <span class=\"hljs-string\">approvals</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-attr\">remarks:</span> <span class=\"hljs-string\">Tracks</span> <span class=\"hljs-string\">inventory</span> <span class=\"hljs-string\">order</span> <span class=\"hljs-string\">approvals</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-attr\">columns:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">column:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">id</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">uuid</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">constraints:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-attr\">primaryKey:</span> <span class=\"hljs-literal\">true</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-attr\">nullable:</span> <span class=\"hljs-literal\">false</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-attr\">primaryKeyName:</span> <span class=\"hljs-string\">pk_approvals</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">column:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">action</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">varchar</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">constraints:</span> { <span class=\"hljs-attr\">nullable:</span> <span class=\"hljs-literal\">false</span> }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">column:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">approver_user_id</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">uuid</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">constraints:</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-attr\">foreignKeyName:</span> <span class=\"hljs-string\">fk_approvals__approver_user_id</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-attr\">referencedColumnNames:</span> <span class=\"hljs-string\">id</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-attr\">referencedTableName:</span> <span class=\"hljs-string\">users</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-attr\">onDelete:</span> <span class=\"hljs-string\">cascade</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-attr\">remarks:</span> <span class=\"hljs-string\">&gt;-</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-literal\">null</span> <span class=\"hljs-string\">value</span> <span class=\"hljs-string\">indicates</span> <span class=\"hljs-string\">that</span> <span class=\"hljs-string\">an</span> <span class=\"hljs-string\">approval</span> <span class=\"hljs-string\">was</span> <span class=\"hljs-string\">initiated</span> <span class=\"hljs-string\">but</span> <span class=\"hljs-string\">not</span> <span class=\"hljs-string\">approved</span> <span class=\"hljs-string\">yet</span>\n</td></tr></table></code></pre>\n\n<p>While liquibase is a JVM based utility, it works quite well in any web application. There is a nice CLI that you can integrate with any build pipeline without having to write Java code (though a programmatic API is also available for advanced integration).</p>\n<h1 id=\"Remarks-in-the-Changelog-DSL\"><a href=\"#Remarks-in-the-Changelog-DSL\" class=\"headerlink\" title=\"Remarks in the Changelog DSL\"></a>Remarks in the Changelog DSL</h1><p>While most of what is happening in the changelog fragment about is self-explanatory, the part we want to zoom into in this post are the remarks fields.</p>\n<p>Many modern databases allow storing comments about different database level objects in the database itself. For Postgres, the manual discusses the <a href=\"https://www.postgresql.org/docs/9.1/sql-comment.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">COMMENT command</a> in quite a bit of detail.</p>\n<p>As you may have guessed, the remarks in our changelog YAML above, get propagated as comments stored in the db.</p>\n<h1 id=\"About-tbls\"><a href=\"#About-tbls\" class=\"headerlink\" title=\"About tbls\"></a>About tbls</h1><p>tbls is a CLI friendly tool for documenting the database. </p>\n<p>It can infer the table schema, relationships between tables through foreign keys and generate nice looking markdown documentation. There README has an example of a <a href=\"https://raw.githubusercontent.com/k1LoW/tbls/master/img/doc.png\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">generated output</a>.</p>\n<p>Cool thing is along with the schema, it can also pick up the comments in the table, and they will get included in the generated doc as descriptions.</p>\n<h1 id=\"About-jOOQ\"><a href=\"#About-jOOQ\" class=\"headerlink\" title=\"About jOOQ\"></a>About jOOQ</h1><p>jOOQ is a type safe query builder for JVM which I have blogged about before. </p>\n<p>If your app is built upon java, kotlin or any other JVM language, you can use jOOQ to generate classes representing of your tables, enabling you to query the database without having to directly deal with JDBC&#x2F;SQL. It is a nice sweet spot between raw SQL and full-fledged JPA-style ORMs.</p>\n<p>Interesting thing is that if you use the jOOQ code generator, then your database level comments will be picked up by jOOQ and embedded as javadoc comments in the generated code. </p>\n<pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span>\n<span class=\"hljs-comment\"> * This class is generated by jOOQ.</span>\n<span class=\"hljs-comment\"> * Tracks inventory order approvals</span>\n<span class=\"hljs-comment\"> */</span>\n<span class=\"hljs-meta\">@Generated(</span>\n<span class=\"hljs-meta\">    value = &#123;</span>\n<span class=\"hljs-meta\">        &quot;https://www.jooq.org&quot;,</span>\n<span class=\"hljs-meta\">        &quot;jOOQ version:3.15.1&quot;</span>\n<span class=\"hljs-meta\">    &#125;</span>\n<span class=\"hljs-meta\">)</span>\n<span class=\"hljs-meta\">@SuppressWarnings(&#123; &quot;all&quot;, &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ApprovalsRecord</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">UpdatableRecordImpl</span>&lt;ApprovalsRecord&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Record4</span>&lt;UUID, String, UUID, UUID&gt;, IApproval &#123;\n    \n    <span class=\"hljs-comment\">// ...</span>\n\n    <span class=\"hljs-comment\">/**</span>\n<span class=\"hljs-comment\">     * Setter for &lt;code&gt;PUBLIC.APPROVALS.APPROVER_USER_ID&lt;/code&gt;. null value</span>\n<span class=\"hljs-comment\">     * indicates that an approval was initiated but not approved yet</span>\n<span class=\"hljs-comment\">     */</span>\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">setApproverUserId</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Nullable</span> UUID value)</span> &#123;\n        set(<span class=\"hljs-number\">2</span>, value);\n    &#125;\n\n    <span class=\"hljs-comment\">/**</span>\n<span class=\"hljs-comment\">     * Getter for &lt;code&gt;PUBLIC.APPROVALS.APPROVER_USER_ID&lt;/code&gt;. null value</span>\n<span class=\"hljs-comment\">     * indicates that an approval was initiated but not approved yet</span>\n<span class=\"hljs-comment\">     */</span>\n    <span class=\"hljs-meta\">@Nullable</span>\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> UUID <span class=\"hljs-title function_\">getApproverUserId</span><span class=\"hljs-params\">()</span> &#123;\n        <span class=\"hljs-keyword\">return</span> (UUID) get(<span class=\"hljs-number\">2</span>);\n    &#125;\n&#125;</code></pre>\n\n<p>This is really convenient, because now we have easy access to our data model documentation within our IDE as well as within any database explorer. And, liquibase &amp; jOOQ ensure that they never go out of sync.</p>\n",
            "tags": [
                "Liquibase",
                "tbls",
                "jOOQ"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/08/08/Vue-composition-api-and-type-safe-graphql-access/",
            "url": "https://lorefnon.me/2021/08/08/Vue-composition-api-and-type-safe-graphql-access/",
            "title": "Vue composition API and type-safe GraphQL access",
            "date_published": "2021-08-07T00:00:00.000Z",
            "content_html": "<h1 id=\"About-setup-script\"><a href=\"#About-setup-script\" class=\"headerlink\" title=\"About setup script\"></a>About setup script</h1><p>The <a href=\"https://v3.vuejs.org/guide/composition-api-introduction.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">vue composition API</a> is pretty cool, esp. with the recent addition of <a href=\"https://github.com/vuejs/rfcs/blob/master/active-rfcs/0040-script-setup.md\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">setup script support</a> in <a href=\"https://blog.vuejs.org/posts/vue-3.2.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Vue 3.2</a> which drastically reduces unnecessary boilerplate when most of the logic is present in the setup function of the component.</p>\n<p>From the announcement post:</p>\n<blockquote>\n<p><code>&lt;script setup&gt;</code> is a <strong>compile-time syntactic sugar</strong> that greatly improves the ergonomics when using Composition API inside SFCs.</p>\n</blockquote>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span>\n<span class=\"language-javascript\"><span class=\"hljs-keyword\">import</span> &#123; ref &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vue&#x27;</span></span>\n<span class=\"language-javascript\"></span>\n<span class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> color = <span class=\"hljs-title function_\">ref</span>(<span class=\"hljs-string\">&#x27;red&#x27;</span>)</span>\n<span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">&quot;color = color === &#x27;red&#x27; ? &#x27;green&#x27; : &#x27;red&#x27;&quot;</span>&gt;</span>\n    Color is: &#123;&#123; color &#125;&#125;\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span></code></pre>\n\n<h1 id=\"GraphQL-through-Composition-API\"><a href=\"#GraphQL-through-Composition-API\" class=\"headerlink\" title=\"GraphQL through Composition API\"></a>GraphQL through Composition API</h1><p>With <a href=\"https://v4.apollo.vuejs.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">vue-apollo-composable</a> we can use a composable API to access our GraphQL API which can take advantage of above support.</p>\n<p>Lastly, using <a href=\"https://www.graphql-code-generator.com/docs/presets/gql-tag-operations\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">gql-tag-operations-preset</a> we can ensure that we get type-safety while accessing resources over GraphQL.</p>\n<p>This combination works seamlessly and unlike previous codegen based approaches doesn&#39;t require us to manually import types or functions generated from graphql files.</p>\n<p>The rest of this post is primarily an overview of the involved configuration.</p>\n<h1 id=\"Dependencies\"><a href=\"#Dependencies\" class=\"headerlink\" title=\"Dependencies\"></a>Dependencies</h1><p>Currently, my preferred way to get started with Vue project is to scaffold it through vite (<code>yarn create vite</code>) which internally uses the really fast <a href=\"https://github.com/evanw/esbuild\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">esbuild</a> native transpiler.</p>\n<p>Other build tools may require minor adjustment around import aliasing.</p>\n<p>Here is what our package.json looks like:</p>\n<pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span>\n  <span class=\"hljs-attr\">&quot;scripts&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n    <span class=\"hljs-attr\">&quot;dev&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;build&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vue-tsc --noEmit &amp;&amp; vite build&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;serve&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;vite preview&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;codegen:graphql&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;yarn run graphql-codegen -c graphql-codegen.yaml&quot;</span>\n  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;dependencies&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n    <span class=\"hljs-attr\">&quot;@apollo/client&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^3.4.5&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@graphql-typed-document-node/core&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^3.1.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@vue/apollo-composable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.0.0-alpha.14&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;graphql&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^15.5.1&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;graphql-tag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^2.12.5&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;vue&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^3.0.5&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;vue-router&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;4&quot;</span>\n  <span class=\"hljs-punctuation\">&#125;</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">&quot;devDependencies&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n    <span class=\"hljs-attr\">&quot;@app/gql&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;link:./src/gql&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@graphql-codegen/cli&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^2.0.1&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@graphql-codegen/gql-tag-operations-preset&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^1.0.1&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@graphql-codegen/typescript-graphql-request&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.0.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@vitejs/plugin-vue&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^1.4.0&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;@vue/compiler-sfc&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^3.1.5&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;typescript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^4.3.5&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;vite&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^2.5.0-beta.1&quot;</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">&quot;vue-tsc&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;^0.2.2&quot;</span>\n  <span class=\"hljs-punctuation\">&#125;</span>\n<span class=\"hljs-punctuation\">&#125;</span></code></pre>\n\n<h1 id=\"Configuration-for-graphql-code-generator\"><a href=\"#Configuration-for-graphql-code-generator\" class=\"headerlink\" title=\"Configuration for graphql-code-generator\"></a>Configuration for graphql-code-generator</h1><p>We have a <code>codegen:graphql</code> script configured above, which we can use to generate types for our GraphQL accessors.</p>\n<p>Here is what our <code>graphql-codegen.yaml</code> looks like:</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">schema:</span> <span class=\"hljs-string\">./schema/schema.graphqls</span>\n<span class=\"hljs-attr\">documents:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x27;src/**/*.ts&#x27;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x27;src/**/*.vue&#x27;</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x27;!src/gql/**/*&#x27;</span>\n<span class=\"hljs-attr\">generates:</span>\n  <span class=\"hljs-string\">./src/schema/generated/graphql.d.ts:</span>\n    <span class=\"hljs-attr\">plugins:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">typescript</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">typescript-operations</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">typescript-graphql-request</span>\n  <span class=\"hljs-string\">./src/gql/:</span>\n    <span class=\"hljs-attr\">preset:</span> <span class=\"hljs-string\">gql-tag-operations-preset</span></code></pre>\n\n<p>From the docs for <a href=\"https://www.graphql-code-generator.com/docs/presets/gql-tag-operations\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">gql-tag-operations-preset</a>:</p>\n<blockquote>\n<p>This preset generates typings for your inline gql function usages, without having to manually specify import statements for the documents. All you need to do is import your gql function and run codegen in watch mode.</p>\n</blockquote>\n<p>Since <code>yarn run</code> forwards our arguments to the underlying scripts, to run the aforementioned watch mode, we can simply run:</p>\n<pre><code class=\"hljs sh\">yarn run codegen:graphql --watch</code></pre>\n\n<p>This will keep scanning our code for usage of graphql queries&#x2F;mutations and generate corresponding types.</p>\n<p>We will look at some examples below.</p>\n<h2 id=\"Import-aliasing\"><a href=\"#Import-aliasing\" class=\"headerlink\" title=\"Import aliasing:\"></a>Import aliasing:</h2><p>The last piece of setup we need to do is configuration for imports.</p>\n<p>This may get simplified in future, but as of this writing this needs to be done in both tsconfig.json (in case you are using typescript,  make typescript compiler &amp; editor tooling happy) and vite config (to make vite happy).</p>\n<p>In <code>tsconfig.json</code>:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-punctuation\">{</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">&quot;compilerOptions&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;target&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;esnext&quot;</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;module&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;esnext&quot;</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;moduleResolution&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;node&quot;</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;strict&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;jsx&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;preserve&quot;</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;sourceMap&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;resolveJsonModule&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;esModuleInterop&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;lib&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;esnext&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;dom&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">&quot;paths&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">      <span class=\"hljs-attr\">&quot;@app/gql&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;./src/gql&quot;</span><span class=\"hljs-punctuation\">]</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-punctuation\">}</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">&quot;include&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;src/**/*.ts&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.d.ts&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.tsx&quot;</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">&quot;src/**/*.vue&quot;</span><span class=\"hljs-punctuation\">]</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-punctuation\">}</span>\n</td></tr></table></code></pre>\n\n<p>In <code>vite.config.ts</code>:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> { defineConfig } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;vite&#x27;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> vue <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@vitejs/plugin-vue&#x27;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> { resolve } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;path&quot;</span>;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-comment\">// https://vitejs.dev/config/</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">defineConfig</span>({\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">plugins</span>: [\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-title function_\">vue</span>()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  ],\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  <span class=\"hljs-attr\">resolve</span>: {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-attr\">alias</span>: {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">      <span class=\"hljs-string\">&quot;@app/gql&quot;</span>: <span class=\"hljs-title function_\">resolve</span>(__dirname, <span class=\"hljs-string\">&quot;./src/gql&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">  }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">})\n</td></tr></table></code></pre>\n\n<p>What this enables us to do is to import a helper function from <code>@app/gql</code> which we will use to make graphql queries (or perform mutations).</p>\n<p>And the watcher will keep adding overloads to this helper for each of our usage.</p>\n<h1 id=\"Usage-in-application\"><a href=\"#Usage-in-application\" class=\"headerlink\" title=\"Usage in application\"></a>Usage in application</h1><p>Here is what a usage of this helper looks like in our component:</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">template</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;pug&quot;</span>&gt;</span>\ndiv(v-if=&quot;loading&quot;)\n  | Loading ...\ndiv(v-else)\n  div(v-if=&quot;result?.currentUser&quot;)\n    | Hello &#123;&#123; result.currentUser.name &#125;&#125;\n  div(v-else)\n    | Not logged in\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">template</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;ts&quot;</span> <span class=\"hljs-attr\">setup</span>&gt;</span><span class=\"language-javascript\"></span>\n<span class=\"language-javascript\"><span class=\"hljs-keyword\">import</span> &#123; gql &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@app/gql&quot;</span></span>\n<span class=\"language-javascript\"><span class=\"hljs-keyword\">import</span> &#123; useQuery &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@vue/apollo-composable&quot;</span></span>\n<span class=\"language-javascript\"></span>\n<span class=\"language-javascript\"><span class=\"hljs-keyword\">const</span> &#123; result, loading &#125; = <span class=\"hljs-title function_\">useQuery</span>(</span>\n<span class=\"language-javascript\">    <span class=\"hljs-title function_\">gql</span>(<span class=\"hljs-comment\">/* GraphQL */</span> <span class=\"hljs-string\">`</span></span>\n<span class=\"hljs-string\"><span class=\"language-javascript\">        query CurrentUserQuery &#123;</span></span>\n<span class=\"hljs-string\"><span class=\"language-javascript\">            currentUser &#123;</span></span>\n<span class=\"hljs-string\"><span class=\"language-javascript\">                name</span></span>\n<span class=\"hljs-string\"><span class=\"language-javascript\">            &#125;</span></span>\n<span class=\"hljs-string\"><span class=\"language-javascript\">        &#125;</span></span>\n<span class=\"hljs-string\"><span class=\"language-javascript\">    `</span>)</span>\n<span class=\"language-javascript\">)</span>\n<span class=\"language-javascript\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></code></pre>\n\n<p>Note that other than <code>gql</code> we didn&#39;t need to import anything else. And we may get a type error initially, it will quickly disappear once our watcher generates the necessary overloads, and our <code>result</code> and <code>loading</code> variables will be correctly typed as vue refs.</p>\n<p>The result&#39;s value type will be derived from our query and if we update the query, the type will auto-update too.</p>\n<p>And because these are reactive refs, we can directly use them in templates without needing any watchers or cleanup code.</p>\n<p>Lastly, if you are curious, here is what the overloads generated look like:</p>\n<pre><code class=\"hljs typescript\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> graphql <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./graphql&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> documents = &#123;\n    <span class=\"hljs-string\">&quot;query CurrentUserQuery &#123;...&#125;&quot;</span>: graphql.<span class=\"hljs-property\">CurrentUserQueryDocument</span>,\n&#125;;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">gql</span>(<span class=\"hljs-params\">source: <span class=\"hljs-string\">&quot;query CurrentUserQuery &#123;...&#125;&quot;</span></span>): (<span class=\"hljs-keyword\">typeof</span> documents)[<span class=\"hljs-string\">&quot;query CurrentUserQuery &#123;...&#125;&quot;</span>];\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">gql</span>(<span class=\"hljs-params\">source: <span class=\"hljs-built_in\">string</span></span>): <span class=\"hljs-built_in\">unknown</span>;\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">gql</span>(<span class=\"hljs-params\">source: <span class=\"hljs-built_in\">string</span></span>) &#123;\n  <span class=\"hljs-keyword\">return</span> (documents <span class=\"hljs-keyword\">as</span> <span class=\"hljs-built_in\">any</span>)[source] ?? &#123;&#125;;\n&#125;</code></pre>\n\n<p>Not quite pretty :), but usually you never have to peek into this file at all.</p>\n",
            "tags": [
                "Apollo",
                "GraphQL",
                "Vue",
                "TypeScript"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/08/03/Adapting-Jooq-To-Rails-DB-Naming-Conventions/",
            "url": "https://lorefnon.me/2021/08/03/Adapting-Jooq-To-Rails-DB-Naming-Conventions/",
            "title": "Adapting jOOQ code generator to Rails database naming conventions",
            "date_published": "2021-08-03T00:00:00.000Z",
            "content_html": "<p>I recently updated an application which was historically built using Ruby on Rails to <a href=\"https://spring.io/projects/spring-boot\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Spring boot</a> &amp; <a href=\"https://www.jooq.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">jOOQ</a>.</p>\n<p>The Rails convention is to use plural table names (eg. <code>users</code>) which are auto-mapped to models with singular names (eg. <code>User</code>).</p>\n<p>JOOQ doesn&#39;t do any automatic plural-&gt;singular conversion by default, so if we directly use code-generator we end up with pojos named like <code>class Users</code> and interfaces like <code>interface IUsers</code> which are not ideal because an instance here represents a single entity&#x2F;row and so should be named singular.</p>\n<p>Fortunately this is easy to address with a custom <code>NamingStrategy</code>:</p>\n<pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.example;\n\n<span class=\"hljs-keyword\">import</span> org.jibx.schema.codegen.extend.DefaultNameConverter;\n<span class=\"hljs-keyword\">import</span> org.jibx.schema.codegen.extend.NameConverter;\n<span class=\"hljs-keyword\">import</span> org.jooq.codegen.DefaultGeneratorStrategy;\n<span class=\"hljs-keyword\">import</span> org.jooq.meta.Definition;\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">NamingStrategy</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">DefaultGeneratorStrategy</span> &#123;\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">NameConverter</span> <span class=\"hljs-variable\">nameTools</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultNameConverter</span>();\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">getJavaClassName</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">final</span> Definition definition, <span class=\"hljs-keyword\">final</span> Mode mode)</span> &#123;\n        <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">javaClassName</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-built_in\">super</span>.getJavaClassName(definition, mode);\n\n        <span class=\"hljs-comment\">// Let&#x27;s retain the plural names for TableImpl clasess</span>\n        <span class=\"hljs-keyword\">if</span> (mode == Mode.DEFAULT) <span class=\"hljs-keyword\">return</span> javaClassName;\n\n        <span class=\"hljs-comment\">// Let&#x27;s use singular names for others</span>\n        <span class=\"hljs-keyword\">return</span> nameTools.depluralize(javaClassName);\n    &#125;\n\n&#125;</code></pre>\n\n<p>Support for custom <code>GeneratorStrategy</code> implementations in JooQ offers possibility of very low level customizations of how SQL layer names are translated to java&#x2F;kotlin layer.</p>\n<p>In our case, we simply use the depluralize utility from jibx to singularize our names.</p>\n<p>We can configure our JooQ configuration to use this naming strategy:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">&lt;configuration&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    &lt;jdbc&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;driver&gt;${db.driverClassName}&lt;/driver&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;url&gt;${db.url}&lt;/url&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;user&gt;${db.username}&lt;/user&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;password&gt;${db.password}&lt;/password&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    &lt;/jdbc&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    &lt;generator&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;name&gt;org.jooq.codegen.JavaGenerator&lt;/name&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;!-- Other configuration options --&gt;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;strategy&gt;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            &lt;name&gt;com.example.NamingStrategy&lt;/name&gt;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &lt;/strategy&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    &lt;/generator&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">&lt;/configuration&gt;\n</td></tr></table></code></pre>\n",
            "tags": [
                "Java",
                "JOOQ",
                "Ruby on Rails"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/08/03/Integrating-JooQ-With-Netflix-DGS/",
            "url": "https://lorefnon.me/2021/08/03/Integrating-JooQ-With-Netflix-DGS/",
            "title": "Integrating jOOQ with Netflix DGS",
            "date_published": "2021-08-03T00:00:00.000Z",
            "content_html": "<h1 id=\"About-jOOQ-and-DGS\"><a href=\"#About-jOOQ-and-DGS\" class=\"headerlink\" title=\"About jOOQ and DGS\"></a>About jOOQ and DGS</h1><p><a href=\"jooq.org/\">jOOQ</a> is a really versatile SQL builder for JVM which I have found myself using more and more recently. My workflow usually involves evolving the database schema through <a href=\"https://www.liquibase.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">liquibase</a>, after which jOOQ is used to generate record classes from the DB schema.</p>\n<p>This enables type safe database access and ensures that application level types are always in sync with database schema.</p>\n<p>I recently used jOOQ with <a href=\"https://netflix.github.io/dgs/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Netflix DGS</a> to build a <a href=\"https://graphql.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">GraphQL</a> API. Netflix DGS is a higher level abstraction over <a href=\"https://www.graphql-java.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">graphql-java</a> which makes it easy to rapidly build GraphQL APIs in a <a href=\"https://blog.logrocket.com/code-first-vs-schema-first-development-graphql/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">schema-first</a> manner.</p>\n<h1 id=\"Integration-issues\"><a href=\"#Integration-issues\" class=\"headerlink\" title=\"Integration issues\"></a>Integration issues</h1><p>One issue with using them together is that both of them provide code-generation support. DGS generates kotlin data classes (or POJOs for java) from GraphQL SDL where as jOOQ generates classes from database schema.</p>\n<p>The simplest thing to do is to retrieve data from the DB using jOOQ DSL, populate them into jOOQ generated record classes and then map them to DGS generated DTO classes when returning from our services.</p>\n<p>This is quite necessary for scenarios where there is substantial difference between the properties of our record classes (which usually mirror the table columns) and the fields in the exposed GraphQL types, and jOOQ does provide a <a href=\"https://www.jooq.org/doc/latest/manual/sql-execution/fetching/pojos-with-recordmapper-provider/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">record-mapping support</a> to make this kind of mapping simpler.</p>\n<p>However, in a vast majority of scenarios, our GraphQL type fields are either same as entity properties or are resolved through dedicated data fetchers (and hence do not need corresponding properties in DTO). So this object mapping step is wasteful and can be avoided.</p>\n<h1 id=\"GraphQL-java-amp-reflection\"><a href=\"#GraphQL-java-amp-reflection\" class=\"headerlink\" title=\"GraphQL java &amp; reflection\"></a>GraphQL java &amp; reflection</h1><p>Folks familiar with graphql-java may wonder why is this even a problem ?</p>\n<p>After all graphql-java is not aware of what classes are generated by DGS at all. It simply uses reflection to map instance properties to GrpahQL fields. So when there is sufficient overlap between the two, we can simply ditch the classes generated by DGS (or skip generating them by splitting up our graphql schema file) and just use the record classes generated by jOOQ.</p>\n<p>This does work fine. Even having some extraneous fields in record class which are not present in the GraphQL type is not a problem because GraphQL resolver will cherry-pick only the fields which are defined in schema.</p>\n<p>However this becomes a problem when we want to use some of the DTOs generated by DGS and not others.</p>\n<p>Consider following example (taken from <a href=\"https://relay.dev/graphql/connections.htm\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Relay docs</a>):</p>\n<pre><code class=\"hljs graphql\">&#123;\n  user &#123;\n    id\n    name\n    friends(first: 10, after: &quot;opaqueCursor&quot;) &#123;\n      edges &#123;\n        cursor\n        node &#123;\n          id\n          name\n        &#125;\n      &#125;\n      pageInfo &#123;\n        hasNextPage\n      &#125;\n    &#125;\n  &#125;\n&#125;</code></pre>\n\n<p>Our schema might look something like this:</p>\n<pre><code class=\"hljs graphql\">type User &#123;\n    id: ID!\n    name: String!\n    friends(first: Int, after: Cursor): UserConnection\n&#125;\n\nscalar Cursor\n\ntype UserConnection &#123;\n    pageInfo: PageInfo!\n    edges: [UserEdge!]\n&#125;\n\ntype UserEdge &#123;\n    cursor: Cursor!\n    node: User!\n&#125;</code></pre>\n\n<p>So now the generated data classes for <code>UserEdge</code> will be referencing the generated <code>User</code> class, and we won&#39;t be able to use it if are using a jOOQ generated <code>UsersRecord</code> instead of the <code>User</code> DTO.</p>\n<h1 id=\"typeMapping-to-rescue\"><a href=\"#typeMapping-to-rescue\" class=\"headerlink\" title=\"typeMapping to rescue\"></a>typeMapping to rescue</h1><p>Fortunately this is easy to address through support for <a href=\"https://netflix.github.io/dgs/generating-code-from-schema/#mapping-existing-types\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">typeMapping configuration</a> in DGS.</p>\n<p>We can configure jOOQ to use our record class for User instead of</p>\n<pre><code class=\"hljs groovy\">generateJava &#123;\n   typeMapping = [<span class=\"hljs-string\">&quot;User&quot;</span>: <span class=\"hljs-string\">&quot;org.jooq.generated.tables.records.UsersRecord&quot;</span>]\n&#125;</code></pre>\n\n<p>Problem solved. Now, wherever User type is needed, DGS generated DTOs will use our <code>UsersRecord</code> class. Of course, this works equally well if we want to use jOOQ generated POJOs&#x2F;interfaces or other classes defined in the application.</p>\n<h1 id=\"Caveats\"><a href=\"#Caveats\" class=\"headerlink\" title=\"Caveats\"></a>Caveats</h1><p>Only caveat here is that if the mapped class is not really structurally compatible with the the type defined in GraphQL schema, we will end up with a runtime error. Currently we don&#39;t have a statically verify this compatibility. However such bugs are easily caught in preliminary testing.</p>\n<h1 id=\"Alternatives\"><a href=\"#Alternatives\" class=\"headerlink\" title=\"Alternatives\"></a>Alternatives</h1><p>An alternative solution to address this would be to use an annotation driven approach. Annotation-heavy libraries are quite popular in the JVM ecosystem and we can use entity classes in our application which are annotated with both JPA annotations and GraphQL specific annotations (provided by <a href=\"https://github.com/leangen/graphql-spqr\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">graphql-spqr</a>, <a href=\"https://github.com/eclipse/microprofile-graphql\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">MP GraphQL</a> etc.)</p>\n<p>In this approach both the GraphQL schema and database schema can be derived from the corresponding set of annotations and we also have type safety.</p>\n<p>However I am currently not a proponent of this approach because I am not a big fan of the JPA spec., esp. the projection &amp; criteria APIs. In contrast, the jOOQ DSL is explicit, maps closely to SQL and enables me to spend more of my time in pure java&#x2F;kotlin code that I can easily step through in a debugger as opposed to an annotation based DSL.</p>\n<h1 id=\"In-praise-of-schema-first-development\"><a href=\"#In-praise-of-schema-first-development\" class=\"headerlink\" title=\"In praise of schema-first development\"></a>In praise of schema-first development</h1><p>Lastly, I prefer a schema first approach in larger teams because backend and frontend developers can agree upon the schema ahead of time and development can progress in parallel. Given a schema, it is for instance, straightforward to mock the server (and have the ui be built using that) while the real backend is being developed.</p>\n",
            "tags": [
                "Java",
                "JOOQ",
                "Ruby on Rails"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/03/26/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-III/",
            "url": "https://lorefnon.me/2021/03/26/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-III/",
            "title": "Building GraphQL APIs powered by Vert.x, jOOQ & Kotlin - III",
            "date_published": "2021-03-26T00:00:00.000Z",
            "content_html": "<p>This is the third post in our series of articles where we explore a JVM based stack comprising of Kotlin, Vert.X and jOOQ for development of GraphQL APIs.</p>\n<span id=\"more\"></span>\n\n<p>In the <a href=\"/2021/02/05/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-II/\">previous post</a> we integrated a dagger based DI system to simplify wiring up of components. In this post we will add some more GraphQL resolvers which connect to the database using the jooq based DAO layer.</p>\n<p>Before we do that, let&#39;s add an AppConfig component to read configuration from a properties file in a type safe manner so that our application becomes runtime configurable: </p>\n<p>Our configuration file (<code>src/resources/app-config.properties</code>) looks like this:</p>\n<pre><code class=\"hljs properties\"><span class=\"hljs-attr\">db.port</span> = <span class=\"hljs-string\">5432</span>\n<span class=\"hljs-attr\">db.host</span> = <span class=\"hljs-string\">localhost</span>\n<span class=\"hljs-attr\">db.database</span> = <span class=\"hljs-string\">jooq_graphql_sample</span>\n<span class=\"hljs-attr\">db.user</span> = <span class=\"hljs-string\">lorefnon</span></code></pre>\n\n<p>We will write an <code>AppConfigModule</code> which will make the parsed configuration available to other services through dagger.</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-9\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-9\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">3 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-9\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-9\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Provides\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-9\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> java.io.FileInputStream\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-9\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> java.util.*\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Module</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">AppConfigModule</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">provideAppConfig</span><span class=\"hljs-params\">()</span></span>: AppConfig {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">val</span> properties = Properties()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">// Enable application consumer to inject a properties file through environment variable</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">val</span> fsPropertiesPath = System.getenv()[<span class=\"hljs-string\">&quot;APP_CONFIG_PATH&quot;</span>]\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">val</span> propertiesStream = fsPropertiesPath\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            ?.let { FileInputStream(fsPropertiesPath) }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-comment\">// Otherwise use the one in class path</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            ?: javaClass.classLoader.getResourceAsStream(<span class=\"hljs-string\">&quot;app-config.properties&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        properties.load(propertiesStream)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> AppConfig(properties)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> * A type safe wrapper over the untyped Properties instance\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"> */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">AppConfig</span></span>(<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> properties: Properties) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> appPort <span class=\"hljs-keyword\">get</span>(): <span class=\"hljs-built_in\">Int</span> = properties.getProperty(<span class=\"hljs-string\">&quot;server.http.port&quot;</span>)?.toInt() ?: <span class=\"hljs-number\">8888</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> dbPort <span class=\"hljs-keyword\">get</span>(): <span class=\"hljs-built_in\">Int</span>? = properties.getProperty(<span class=\"hljs-string\">&quot;db.port&quot;</span>)?.toInt()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> dbHost <span class=\"hljs-keyword\">get</span>(): String = properties.getProperty(<span class=\"hljs-string\">&quot;db.host&quot;</span>)!!\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> dbName <span class=\"hljs-keyword\">get</span>(): String = properties.getProperty(<span class=\"hljs-string\">&quot;db.database&quot;</span>)!!\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> dbUser <span class=\"hljs-keyword\">get</span>(): String? = properties.getProperty(<span class=\"hljs-string\">&quot;db.user&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> dbPassword <span class=\"hljs-keyword\">get</span>(): String? = properties.getProperty(<span class=\"hljs-string\">&quot;db.password&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Let us add a <code>DBAccessModule</code> which uses this configuration to wire up database access: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-10\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">6 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Provides\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.pgclient.PgConnectOptions\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.pgclient.PgPool\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.sqlclient.PoolOptions\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.sqlclient.SqlClient\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-10\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Module</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DBAccessModule</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">/**\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     * Provides an database pool client powered by Vert.X asynchronous postgres driver\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">     */</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">providePGClient</span><span class=\"hljs-params\">(connectOptions: <span class=\"hljs-type\">PgConnectOptions</span>, poolOptions: <span class=\"hljs-type\">PoolOptions</span>)</span></span>: SqlClient =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        PgPool.pool(connectOptions, poolOptions)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">providePGPoolOptions</span><span class=\"hljs-params\">(config: <span class=\"hljs-type\">AppConfig</span>)</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        PoolOptions()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">providePGConnectOptions</span><span class=\"hljs-params\">(config: <span class=\"hljs-type\">AppConfig</span>)</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        PgConnectOptions()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                port = config.dbPort\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                host = config.dbHost\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                database = config.dbName\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                config.dbUser?.let { user = it }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                config.dbPassword?.let { password = it }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Thanks to jklingsporn&#39;s <code>ClassicReactiveVertxGenerator</code>, our DAO classes are compatible with the Vert.X postgres driver pool we configured above.</p>\n<p>So we can simply instantiate these DAO classes providing passing this postgres client to them. Let us write a module that instantiates our generated DAO classes: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-11\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">8 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Provides\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.core.Vertx\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.sqlclient.SqlClient\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.generated.tables.daos.UsersDao\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.jooq.Configuration\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.jooq.SQLDialect\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> org.jooq.impl.DefaultConfiguration\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-11\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Module</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DAOModule</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">provideJooQConfiguration</span><span class=\"hljs-params\">()</span></span>: Configuration =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        DefaultConfiguration().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            setSQLDialect(SQLDialect.POSTGRES)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">provideUsersDao</span><span class=\"hljs-params\">(jooqConfig: <span class=\"hljs-type\">Configuration</span>, sqlClient: <span class=\"hljs-type\">SqlClient</span>)</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        UsersDao(jooqConfig, sqlClient)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-comment\">// Expose other DAO classes here</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>We will also need to make our <code>MainVerticleComponent</code> aware of these modules: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-12\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">6 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Component\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.Router\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.sqlclient.SqlClient\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.generated.tables.daos.UsersDao\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.module.*\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-12\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Component(modules = [\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    AppConfigModule::class,\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    DBAccessModule::class,\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    DAOModule::class,\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    GraphQLModule::class,\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    RouterModule::class\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">])</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">MainVerticleComponent</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getRouter</span><span class=\"hljs-params\">()</span></span>: Router\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>And then inject these instances in <code>MainVerticle</code>: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainVerticle</span> : <span class=\"hljs-type\">AbstractVerticle</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> components <span class=\"hljs-keyword\">by</span> lazy {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        DaggerMainVerticleComponent\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .builder()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .appConfigModule(AppConfigModule())\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .dBAccessModule(DBAccessModule())\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .dAOModule(DAOModule())\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .graphQLModule(GraphQLModule())\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .routerModule(RouterModule(vertx))\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">start</span><span class=\"hljs-params\">(startPromise: <span class=\"hljs-type\">Promise</span>&lt;<span class=\"hljs-type\">Void</span>&gt;)</span></span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">val</span> appPort = component.getAppConfig().appPort\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        vertx\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .createHttpServer()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .requestHandler(component.getRouter())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .listen(appPort) { http -&gt;\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-13\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-13\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">5 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-13\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">if</span> (http.succeeded()) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-13\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    startPromise.complete()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-13\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    println(<span class=\"hljs-string\">&quot;HTTP server started on port <span class=\"hljs-variable\">$appPort</span>&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-13\"><td style=\"border:none\" class=\"hlcode-code-cell\">                } <span class=\"hljs-keyword\">else</span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-13\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    startPromise.fail(http.cause());\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-13\"><td style=\"border:none\" class=\"hlcode-code-cell\">                }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Our API still works, but obviously our <code>DBAccessModule</code> &amp; <code>DAOModule</code> are still unused. Let&#39;s address that. </p>\n<p>Here is the simplest <code>UserRegistrationService</code> implementation, that receives incoming credentials, and saves it in DB after hashing the password: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-14\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-14\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">4 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-14\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> at.favre.lib.crypto.bcrypt.BCrypt\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-14\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.core.Future\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-14\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.generated.tables.daos.UserDao\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-14\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.generated.tables.pojos.User\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-14\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Inject\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserRegistrationService</span> <span class=\"hljs-meta\">@Inject</span> <span class=\"hljs-keyword\">constructor</span></span>(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> userDao: UserDao,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> passwordEncryptionService: PasswordEncryptionService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">registerUser</span><span class=\"hljs-params\">(name: <span class=\"hljs-type\">String</span>, email: <span class=\"hljs-type\">String</span>, password: <span class=\"hljs-type\">String</span>)</span></span>: Future&lt;RegistrationResult&gt; {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">return</span> userDao.insert(User().apply {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-keyword\">this</span>.name = name\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-keyword\">this</span>.password = passwordEncryptionService.encrypt(password)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-keyword\">this</span>.email = email\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }).map { insertCount -&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            RegistrationResult(<span class=\"hljs-literal\">true</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }.otherwise { throwable -&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-keyword\">val</span> comments =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">if</span> (throwable.message?.contains(<span class=\"hljs-string\">&quot;violates unique constraint&quot;</span>) == <span class=\"hljs-literal\">true</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    listOf(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-string\">&quot;A user is already registered for this email/username&quot;</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-string\">&quot;Do you want to sign in instead ?&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    )\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">null</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            RegistrationResult(<span class=\"hljs-literal\">false</span>, comments)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">data</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RegistrationResult</span></span>(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> success: <span class=\"hljs-built_in\">Boolean</span>,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> comments: List&lt;String&gt;? = <span class=\"hljs-literal\">null</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">)\n</td></tr></table></code></pre>\n\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.service\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> at.favre.lib.crypto.bcrypt.BCrypt\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Inject\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">val</span> LOGARITHMIC_COST_FACTOR = <span class=\"hljs-number\">12</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PasswordEncryptionService</span> <span class=\"hljs-meta\">@Inject</span> <span class=\"hljs-keyword\">constructor</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">encrypt</span><span class=\"hljs-params\">(password: <span class=\"hljs-type\">String</span>)</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        BCrypt.withDefaults().hashToString(LOGARITHMIC_COST_FACTOR, password.toCharArray())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">verify</span><span class=\"hljs-params\">(password: <span class=\"hljs-type\">String</span>, encryptedPassword: <span class=\"hljs-type\">String</span>)</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        BCrypt.verifyer().verify(password.toCharArray(), encryptedPassword).verified\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>A production ready solution will also do email verification, time-limit number of signups from an IP, etc. but for our tutorial we will not go into the intricacies of user registration best practices. </p>\n<p>Our service, at this point, is a plain kotlin service that can be tested in isolation. It is not, however, GraphQL aware. </p>\n<p>We need to next expose this service through a resolver: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-15\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">9 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.RuntimeWiring.newRuntimeWiring\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaGenerator\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaParser\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Provides\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.TypeRuntimeWiring\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.service.UserRegistrationService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-15\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Module</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GraphQLModule</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">provideGraphQL</span><span class=\"hljs-params\">(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        userRegistrationService: <span class=\"hljs-type\">UserRegistrationService</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span></span> = GraphQLBuilder(\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        userRegistrationService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    ).build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">inner</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GraphQLBuilder</span></span>(\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> userRegistrationService: UserRegistrationService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    ) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">build</span><span class=\"hljs-params\">()</span></span>: GraphQL = GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .newGraphQL(buildExecutableSchema())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> rawSchema = <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            type Query {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                hello: String\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    \n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            type Mutation {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                registerUser(username: String!, email: String!, password: String!): RegistrationResult!\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    \n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            type RegistrationResult {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                success: Boolean!\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &quot;&quot;&quot;</span>.trimIndent()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildRuntimeWiring</span><span class=\"hljs-params\">()</span></span> = newRuntimeWiring()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .type(<span class=\"hljs-string\">&quot;Query&quot;</span>) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                it.dataFetcher(<span class=\"hljs-string\">&quot;hello&quot;</span>) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-string\">&quot;world&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .type(<span class=\"hljs-string\">&quot;Mutation&quot;</span>) {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                it.associateRegisterUserMutation()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">// Local extension method for graphql-java&#x27;s TypeRuntimeWiring Builder</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">// to associate the registerUser resolver</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> TypeRuntimeWiring.Builder.<span class=\"hljs-title\">associateRegisterUserMutation</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            dataFetcher(<span class=\"hljs-string\">&quot;registerUser&quot;</span>, VertxDataFetcher.create { env -&gt;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> username = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;username&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> email = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;email&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> password = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;password&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                userRegistrationService.registerUser(username, email, password)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            })\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildExecutableSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            SchemaGenerator().makeExecutableSchema(parseSchema(), buildRuntimeWiring())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">parseSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            SchemaParser().parse(rawSchema)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>We have updated our GraphQL schema SDL to include a <code>registerUser</code> mutation field and we have updated our runtime wiring to resolve this field through the <code>registerUser</code> method of <code>UserRegistrationService</code>. </p>\n<p>In an extension method (<code>associateRegisterUserMutation</code>), we are bridging the non-typesafe arguments API of GraphQL java to the type safe <code>UserRegistrationService.registerUser</code> arguments.</p>\n<p>One interesting thing to note here is the use of <code>VertxDataFetcher.create</code>. In case of our static resolver before (<code>Query.hello</code> field), we had passed a lambda to <code>TypeRuntimeWiring.Builder.dataFetcher</code>. This works perfectly fine for simple values or java objects. If our <code>userRegistrationService.registerUser</code> returned a <code>RegistrationResult</code> instance directly, we would not have to use <code>VertxDataFetcher.create</code>. \nBut what it actually returns is a Vert.X <code>Future</code> instance that resolves to a <code>RegistrationResult</code>. </p>\n<p>graphql-java library is not aware of this <code>Future</code> class. It does understand <code>java.util.concurrent.CompletionStage</code> (Read more about <a href=\"https://www.graphql-java.com/documentation/v15/execution/#asynchronous-execution\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">asynchronous execution</a> in graphql-java), but the <code>Future</code> being returned here is not <code>java.util.concurrent.CompletableFuture</code> (which implements <code>java.util.concurrent.Future</code> and <code>java.util.concurrent.CompletionStage</code>) but rather <code>io.vertx.core.Future</code>, which is used by the vert.x libraries. </p>\n<p>So we need to convert the vert.x future to a <code>CompletionStage</code>. We already have a <code>.toCompletionStage()</code> method in vert.x Futures for this, but the <code>VertxDataFetcher</code> fetcher is an added convenience on top of that which is <a href=\"https://vertx.io/docs/apidocs/io/vertx/core/Context.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Vert.x context</a> aware.</p>\n<p>We can now restart our service and try out our mutation through Altair, or other GraphQL Client:</p>\n<pre><code class=\"hljs graphql\">mutation &#123;\n  registerUser(\n    username: &quot;lorefnon&quot;, \n    email: &quot;lorefnon@gmail.com&quot;,\n    password: &quot;password&quot;\n  ) &#123;\n    success\n    comments\n  &#125;\n&#125;</code></pre>\n\n<p>If it&#39;s all wired up correctly, we should get a successful response:</p>\n<pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span>\n  <span class=\"hljs-attr\">&quot;data&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n    <span class=\"hljs-attr\">&quot;registerUser&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n      <span class=\"hljs-attr\">&quot;success&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;comments&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">null</span>\n    <span class=\"hljs-punctuation\">&#125;</span>\n  <span class=\"hljs-punctuation\">&#125;</span>\n<span class=\"hljs-punctuation\">&#125;</span></code></pre>\n\n<p>If we try to create another user with the same login, we should receive a clear error:</p>\n<pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span>\n  <span class=\"hljs-attr\">&quot;data&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n    <span class=\"hljs-attr\">&quot;registerUser&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n      <span class=\"hljs-attr\">&quot;success&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">false</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">&quot;comments&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n        <span class=\"hljs-string\">&quot;A user is already registered for this email/username&quot;</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-string\">&quot;Do you want to sign in instead ?&quot;</span>\n      <span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">&#125;</span>\n  <span class=\"hljs-punctuation\">&#125;</span>\n<span class=\"hljs-punctuation\">&#125;</span></code></pre>\n\n<p>We also need a mechanism to allow users to login. So let us add another mutation where we can pass in the credentials are retrieve a JWT token:</p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.service\n\n<span class=\"hljs-keyword\">import</span> io.vertx.core.Future\n<span class=\"hljs-keyword\">import</span> me.lorefnon.sample.generated.tables.daos.UserDao\n<span class=\"hljs-keyword\">import</span> javax.inject.Inject\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserLoginService</span> <span class=\"hljs-meta\">@Inject</span> <span class=\"hljs-keyword\">constructor</span></span>(\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> userDao: UserDao,\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> passwordEncryptionService: PasswordEncryptionService,\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> authTokenService: AuthTokenService\n) &#123;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">login</span><span class=\"hljs-params\">(name: <span class=\"hljs-type\">String</span>, password: <span class=\"hljs-type\">String</span>)</span></span>: Future&lt;String?&gt; =\n        userDao.findOneByName(name).map &#123;\n            it?.let &#123; user -&gt;\n                <span class=\"hljs-keyword\">if</span> (passwordEncryptionService.verify(password, user.password)) user\n                <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">null</span>\n            &#125;?.let &#123; user -&gt;\n                authTokenService.getToken(user.name)\n            &#125;\n        &#125;\n&#125;</code></pre>\n\n<p>Let&#39;s add that to our GraphQL module similar to the registration field: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-16\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">11 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.RuntimeWiring.newRuntimeWiring\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaGenerator\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaParser\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Provides\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.TypeRuntimeWiring\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.handler.graphql.schema.VertxDataFetcher\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.service.UserLoginService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.service.UserRegistrationService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-16\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Module</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GraphQLModule</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">provideGraphQL</span><span class=\"hljs-params\">(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        userRegistrationService: <span class=\"hljs-type\">UserRegistrationService</span>,\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        userLoginService: <span class=\"hljs-type\">UserLoginService</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    )</span></span> = GraphQLBuilder(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        userRegistrationService,\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        userLoginService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    ).build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">inner</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GraphQLBuilder</span></span>(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> userRegistrationService: UserRegistrationService,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> userLoginService: UserLoginService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    ) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">build</span><span class=\"hljs-params\">()</span></span>: GraphQL = GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .newGraphQL(buildExecutableSchema())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> rawSchema = <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            type Query {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                hello: String\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    \n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            type Mutation {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                registerUser(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    username: String!, \n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    email: String!, \n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    password: String!\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                ): RegistrationResult!\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                login(username: String!, password: String!): String\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    \n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-17\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">4 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">            type RegistrationResult {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">                success: Boolean!\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">                comments: [String]\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &quot;&quot;&quot;</span>.trimIndent()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildRuntimeWiring</span><span class=\"hljs-params\">()</span></span> = newRuntimeWiring()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .type(<span class=\"hljs-string\">&quot;Query&quot;</span>) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                it.dataFetcher(<span class=\"hljs-string\">&quot;hello&quot;</span>) { <span class=\"hljs-string\">&quot;world&quot;</span> }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .type(<span class=\"hljs-string\">&quot;Mutation&quot;</span>) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                it.associateRegisterUserMutation()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                it.associateLoginMutation()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-17\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">6 lines collapsed</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> TypeRuntimeWiring.Builder.<span class=\"hljs-title\">associateRegisterUserMutation</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">            dataFetcher(<span class=\"hljs-string\">&quot;registerUser&quot;</span>, VertxDataFetcher.create { env -&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> username = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;username&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> email = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;email&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> password = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;password&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">                userRegistrationService.registerUser(username, email, password)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-17\"><td style=\"border:none\" class=\"hlcode-code-cell\">            })\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> TypeRuntimeWiring.Builder.<span class=\"hljs-title\">associateLoginMutation</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            dataFetcher(<span class=\"hljs-string\">&quot;login&quot;</span>, VertxDataFetcher.create { env -&gt;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> username = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;username&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">val</span> password = env.getArgument&lt;String&gt;(<span class=\"hljs-string\">&quot;password&quot;</span>)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                userLoginService.login(username, password)\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            })\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildExecutableSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            SchemaGenerator().makeExecutableSchema(parseSchema(), buildRuntimeWiring())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">parseSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            SchemaParser().parse(rawSchema)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>An invocation of this API looks like this:</p>\n<pre><code class=\"hljs graphql\">mutation &#123;\n  login(username: &quot;lorefnon&quot;, password: &quot;password&quot;)\n&#125;</code></pre>\n\n<pre><code class=\"hljs json\"><span class=\"hljs-punctuation\">&#123;</span>\n  <span class=\"hljs-attr\">&quot;data&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">&#123;</span>\n    <span class=\"hljs-attr\">&quot;login&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJtZS5sb3JlZm5vbi5zYW1wbGUiLCJ1c2VyIjoibG9yZWZub24ifQ.vJNjffx0dMAqoORfXlf-dUF6cAhwMfTPLeZzxB632_k&quot;</span>\n  <span class=\"hljs-punctuation\">&#125;</span>\n<span class=\"hljs-punctuation\">&#125;</span></code></pre>\n\n<p>In the next post we will utilize this API to secure other fields in our GraphQL API.</p>\n",
            "tags": [
                "GraphQL",
                "Kotlin",
                "Vert.X",
                "Vert.X-Web",
                "Backend-development",
                "API-development"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/03/19/Using-apollo-batch-link-selectively/",
            "url": "https://lorefnon.me/2021/03/19/Using-apollo-batch-link-selectively/",
            "title": "Using Apollo Batch Link selectively",
            "date_published": "2021-03-19T00:00:00.000Z",
            "content_html": "<p>In a <a href=\"/2021/03/18/Using-apollo-file-link-and-batch-link-simultaneously/\">previous post</a> we have explored the concept of <a href=\"https://www.apollographql.com/docs/react/api/link/introduction/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Links</a> in Apollo and usage of <code>ApolloLink.split</code> for routing requests selectively towards one of multiple terminating links.</p>\n<p>This utility is also useful when we want to selectively batch our operations. </p>\n<p>The caveat with <a href=\"https://www.apollographql.com/docs/react/api/link/apollo-link-batch-http/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Apollo batch-link</a> is that, the entire batch is delivered only once the slowest operation in the batch completes.</p>\n<p>If we know ahead of time that some of our operations are expected to take longer time (We may at times be ok with that because they don&#39;t impact the user experience) then we can exclude them from batching.</p>\n<p>The link selector predicate we pass to ApolloLink.split can look at the operation name and decide whether to route the request to BatchLink or normal HttpLink.</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123;\n  <span class=\"hljs-title class_\">ApolloClient</span>,\n  <span class=\"hljs-title class_\">InMemoryCache</span>,\n  <span class=\"hljs-title class_\">ApolloLink</span>,\n  <span class=\"hljs-title class_\">Operation</span>,\n  <span class=\"hljs-title class_\">HttpLink</span>,\n&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@apollo/client&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> httpLink = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HttpLink</span>(&#123;\n  <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-string\">&quot;/graphql&quot;</span>\n  <span class=\"hljs-comment\">// ...Additional options</span>\n&#125;);\n\n<span class=\"hljs-keyword\">const</span> batchLink = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BatchHttpLink</span>(&#123;\n    <span class=\"hljs-attr\">batchInterval</span>: <span class=\"hljs-number\">250</span>\n&#125;);\n\n<span class=\"hljs-keyword\">const</span> operationBatchingBlacklist = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Set</span>&lt;string&gt;();\noperationBatchingBlacklist.<span class=\"hljs-title function_\">add</span>(<span class=\"hljs-string\">&quot;someExpensiveOperation&quot;</span>);\n\n<span class=\"hljs-keyword\">const</span> mediatorLink = <span class=\"hljs-title class_\">ApolloLink</span>.<span class=\"hljs-title function_\">split</span>(\n  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">shouldBatchRequests</span>(<span class=\"hljs-params\">&#123; operationName &#125;: Operation</span>) &#123;\n    <span class=\"hljs-keyword\">return</span> !operationBatchingBlacklist.<span class=\"hljs-title function_\">has</span>(operationName);\n  &#125;,\n  batchLink,\n  httpLink\n);\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> client = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ApolloClient</span>(&#123;\n  <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-string\">&#x27;/graphql&#x27;</span>,\n  <span class=\"hljs-attr\">link</span>: mediatorLink\n&#125;);</code></pre>\n",
            "tags": [
                "Apollo",
                "GraphQL"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/03/18/Using-apollo-file-link-and-batch-link-simultaneously/",
            "url": "https://lorefnon.me/2021/03/18/Using-apollo-file-link-and-batch-link-simultaneously/",
            "title": "Using Apollo Upload Link and Batch Link together",
            "date_published": "2021-03-18T00:00:00.000Z",
            "content_html": "<p>Apollo GraphQL client offers generic extensibility of the client-server interaction through a &quot;Link&quot; API. </p>\n<p>From the <a href=\"https://www.apollographql.com/docs/react/api/link/introduction/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official docs</a>, the high level idea is: </p>\n<blockquote>\n<p>The Apollo Link library helps you customize the flow of data between Apollo Client and your GraphQL server. You can define your client&#39;s network behavior as a chain of link objects that execute in a sequence</p>\n</blockquote>\n<p>This is conceptually pretty similar to middlewares in server-side routing libraries like express.</p>\n<p>Links enable us to extend the capabilities of the graphql client in interesting ways.</p>\n<p><a href=\"https://www.npmjs.com/package/apollo-upload-client\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">upload link</a> for example, uses an unofficial (but widely adopted among server implementation) <a href=\"https://github.com/jaydenseric/graphql-multipart-request-spec\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">extension</a> for integrating file uploads in GraphQL API. </p>\n<p><a href=\"https://www.apollographql.com/docs/react/api/link/apollo-link-batch-http/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Batch link</a> is another  very useful link which is able to transparently combine multiple GraphQL operations into a single HTTP request without any code-change on the side of API invoker component.</p>\n<p>However, the problem when using both of them in the same application, is that they are both terminating links. So we can not just add them both to our ApolloClient and call it a day. Whichever comes first, terminates the request and the other never gets executed.</p>\n<p>However, batch link is particularly useful primarily for queries, and upload link is useful for mutations. So we simply needs a mediator that reroutes the request to one of the two after looking at the incoming request. </p>\n<p>This is made very easy by <code>ApolloLink.split</code> function: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123;\n  <span class=\"hljs-title class_\">ApolloClient</span>,\n  <span class=\"hljs-title class_\">InMemoryCache</span>,\n  <span class=\"hljs-title class_\">ApolloLink</span>,\n  <span class=\"hljs-title class_\">Operation</span>,\n  <span class=\"hljs-title class_\">NextLink</span>,\n&#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;@apollo/client&#x27;</span>;\n\n<span class=\"hljs-keyword\">const</span> batchLink = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BatchHttpLink</span>(batchLinkOptions);\n\n<span class=\"hljs-keyword\">const</span> uploadLink = <span class=\"hljs-title function_\">createUploadLink</span>(uploadLinkOptions);\n\n<span class=\"hljs-comment\">// This split is needed because both batchLink and uploadLink are</span>\n<span class=\"hljs-comment\">// terminating links</span>\n<span class=\"hljs-comment\">//</span>\n<span class=\"hljs-keyword\">const</span> mediatorLink = <span class=\"hljs-title class_\">ApolloLink</span>.<span class=\"hljs-title function_\">split</span>(\n  hasFile,\n  batchLink,\n  uploadLink\n);</code></pre>\n\n<p>Here <code>hasFile</code> is a function that can return true&#x2F;false depending on which of the subsequent links is to be selected. </p>\n<p>A simple implementation of <code>hasFile</code> can look like: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">hasFile</span>(<span class=\"hljs-params\">operation</span>) &#123;\n    <span class=\"hljs-comment\">// A single GraphQL operation can comprise of a combination of multiple queries and mutation</span>\n    <span class=\"hljs-keyword\">if</span> (operation.<span class=\"hljs-property\">query</span>.<span class=\"hljs-property\">definitions</span>.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">it</span> =&gt;</span> it.<span class=\"hljs-property\">operation</span> === <span class=\"hljs-string\">&#x27;mutation&#x27;</span>)) &#123;\n        <span class=\"hljs-comment\">// Check if there is atleast one mutation present</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n    &#125;\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n&#125;</code></pre>\n\n<p>We have access to the complete operation object here, so we can also take a decision based on the name of the operation, variables we receive etc.</p>\n<p>Now, instead of passing either of these links to the ApolloClient options, we can pass the mediator link instead:</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> client = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ApolloClient</span>(&#123;\n  <span class=\"hljs-attr\">uri</span>: <span class=\"hljs-string\">&#x27;/graphql&#x27;</span>,\n  <span class=\"hljs-attr\">link</span>: mediatorLink,\n  <span class=\"hljs-comment\">// ... other options</span>\n&#125;);</code></pre>\n",
            "tags": [
                "Apollo",
                "GraphQL"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/02/05/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-II/",
            "url": "https://lorefnon.me/2021/02/05/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-II/",
            "title": "Building GraphQL APIs powered by Vert.x, Dagger, jOOQ & Kotlin - II",
            "date_published": "2021-02-06T00:00:00.000Z",
            "content_html": "<p>This continues from our <a href=\"/2021/02/01/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-I\">previous post</a> in a series of articles where we explore a JVM based stack comprising of Kotlin, Vert.X and jOOQ for development of GraphQL APIs.</p>\n<p>When we last left off, we had a simple GraphQL API with a single field in our <code>Query</code> type which was statically resolved. </p>\n<p>Before we go further, let&#39;s integrate a dependency injection system that simplies the task of wiring up our application components. In this post we&#39;ll use <a href=\"https://dagger.dev/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Dagger</a>. In contrast to many other popular DI&#x2F;IoC solutions, dagger operates through compile time code generation, reducing the reflection overhead causing startup delay.</p>\n<p>Feel free to skip this post, and checkout the <a href=\"/2021/03/26/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-III/\">next one in series</a> if you don&#39;t want to use Dagger.</p>\n<p>We will need to add dagger as a dependency as well as configure Kotlin&#39;s annotation processor <a href=\"https://kotlinlang.org/docs/kapt.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Kapt</a> to use dagger. </p>\n<p>In pom.xml: project &gt; dependencies</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.dagger<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>dagger<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.16<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr></table></code></pre>\n\n<p>Kapt configuration goes into the Kotlin maven-plugin&#39;s configuration section: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.jetbrains.kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>kotlin-maven-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${kotlin.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>kapt<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>kapt<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>src/main/kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>src/main/java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">annotationProcessorPaths</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">annotationProcessorPath</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.dagger<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>dagger-compiler<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.16<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">annotationProcessorPath</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">annotationProcessorPaths</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-5\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">23 lines collapsed (Other Execution Tags)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/main/kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/main/java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>test-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>test-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/test/kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/test/java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-5\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr></table></code></pre>\n\n<p>Let us move our GraphQL wiring to a Dagger module: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-6\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">11 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.RuntimeWiring.newRuntimeWiring\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaGenerator\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaParser\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Provides\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.TypeRuntimeWiring\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.handler.graphql.schema.VertxDataFetcher\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.service.UserLoginService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.service.UserRegistrationService\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-6\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Module</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GraphQLModule</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">provideGraphQL</span><span class=\"hljs-params\">()</span></span> = GraphQLBuilder().build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">inner</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GraphQLBuilder</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">build</span><span class=\"hljs-params\">()</span></span>: GraphQL = GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .newGraphQL(buildExecutableSchema())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> rawSchema = <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            type Query {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                hello: String\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        &quot;&quot;&quot;</span>.trimIndent()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildRuntimeWiring</span><span class=\"hljs-params\">()</span></span> = newRuntimeWiring()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .type(<span class=\"hljs-string\">&quot;Query&quot;</span>) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                it.dataFetcher(<span class=\"hljs-string\">&quot;hello&quot;</span>) { <span class=\"hljs-string\">&quot;world&quot;</span> }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildExecutableSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            SchemaGenerator().makeExecutableSchema(parseSchema(), buildRuntimeWiring())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">parseSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            SchemaParser().parse(rawSchema)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>When the dependencies are coming from our own project we will typically use <code>@Inject</code> annotation in the classes to be injected. </p>\n<p>However, when we are instantiating or configuring third party classes that we don&#39;t have control over we&#39;ll typically use <code>@Provides</code> annotation (as in the example above). These methods are conventionally named as <code>provide*</code> and are organized as what Dagger calls Modules (entirely unrelated to Java 9 modules developed as part of project Jigsaw). The <code>@Module</code> annotation marks our class as a Dagger Module.</p>\n<p>The utility of the inner class may not be obvious at this point, but it just makes it easier to better organize the runtime wiring where we need access to our other services. This will likely be more evident once we start integrating more features in our API.</p>\n<p>Our router integration can be moved to a Dagger module too: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample.module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-7\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">7 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Module\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Provides\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.core.Vertx\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.Router\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.handler.BodyHandler\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.handler.graphql.GraphQLHandler\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-7\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Module</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RouterModule</span></span>(<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">val</span> vertx: Vertx) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Provides</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">provideRouter</span><span class=\"hljs-params\">(graphQL: <span class=\"hljs-type\">GraphQL</span>)</span></span>: Router =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        Router.router(vertx).also { r -&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            r.route().handler(BodyHandler.create())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            r.post(<span class=\"hljs-string\">&quot;/graphql&quot;</span>).handler(\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                GraphQLHandler.create(graphQL)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            )\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>Note that both our Router and GraphQL instances are marked as <code>@Singleton</code> so dagger will only ever create a single instance of them and inject the same instance wherever needed.</p>\n<p>The last dagger specific boilerplate class that we need to write is a dagger <code>Component</code> that acts as a facade for the code that isn&#39;t wired up using dagger. This can be used to bootstrap our injector and  also makes dagger instantiated instances available to non dagger managed code.</p>\n<p>A dagger <code>Component</code> is typically written as an interface that will be implemented by Dagger at compile time: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-8\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">6 lines collapsed (Imports)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> dagger.Component\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.Router\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.sqlclient.SqlClient\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> javax.inject.Singleton\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-8\"><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.module.*\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Component(modules = [\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    GraphQLModule::class,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    RouterModule::class,\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">])</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">@Singleton</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">MainVerticleComponent</span> </span>{\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">getRouter</span><span class=\"hljs-params\">()</span></span>: Router\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>While we may have many services instantiated through dagger, we will not need to add accessors for all of them to the Component above. The only one we will need in our tutorial, is a the router accessor, which makes the router instance (which is created through dagger) available to our MainVerticle class (which is not created dagger).</p>\n<p>If we run <code>mvn compile</code>, dagger will generate a <code>DaggerMainVerticleComponent</code> that implements our <code>MainVerticleComponent</code> class.</p>\n<p>We can now use the companion Builder of this class to wire up the dependencies of our verticle: </p>\n<p>Let us update our <code>MainVerticle</code> to make use of the Dagger generated <code>MainVerticleComponent</code> implementation:</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">package</span> me.lorefnon.sample\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.core.AbstractVerticle\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.core.Promise\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> me.lorefnon.sample.module.*\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainVerticle</span> : <span class=\"hljs-type\">AbstractVerticle</span></span>() {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">val</span> component <span class=\"hljs-keyword\">by</span> lazy {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        DaggerMainVerticleComponent\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .builder()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .graphQLModule(GraphQLModule())\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .routerModule(RouterModule(vertx))\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .build()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">start</span><span class=\"hljs-params\">(startPromise: <span class=\"hljs-type\">Promise</span>&lt;<span class=\"hljs-type\">Void</span>&gt;)</span></span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        vertx\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .createHttpServer()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .requestHandler(component.getRouter())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            .listen(<span class=\"hljs-number\">8888</span>) { http -&gt;\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-keyword\">if</span> (http.succeeded()) {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    startPromise.complete()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    println(<span class=\"hljs-string\">&quot;HTTP server started on port 8888&quot;</span>)\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                } <span class=\"hljs-keyword\">else</span> {\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    startPromise.fail(http.cause());\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">}\n</td></tr></table></code></pre>\n\n<p>(<code>component</code> needs to be lazy because when class is instantiated vertx instance is not available)</p>\n<p>If we run <code>mvn compile exec:java</code> now, we will have the same API as before, but now with DI integrated.</p>\n<p>In the <a href=\"/2021/03/26/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-III/\">next part</a> of this series, we will look at integrating the Jooq geenrated DAOs into our GraphQL API.</p>\n",
            "tags": [
                "GraphQL",
                "Kotlin",
                "Vert.X",
                "Vert.X-Web",
                "Backend-development",
                "API-development"
            ]
        },
        {
            "id": "https://lorefnon.me/2021/02/01/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-I/",
            "url": "https://lorefnon.me/2021/02/01/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-I/",
            "title": "Building GraphQL APIs powered by Vert.x, Dagger, jOOQ & Kotlin - I",
            "date_published": "2021-02-01T00:00:00.000Z",
            "content_html": "<p>This is the first in a series of articles where we explore a JVM based stack comprising of Kotlin, Vert.X, Dagger and jOOQ for development of GraphQL APIs.</p>\n<h1 id=\"About-GraphQL\"><a href=\"#About-GraphQL\" class=\"headerlink\" title=\"About GraphQL\"></a>About GraphQL</h1><p>GraphQL is an application level query language which can, as of this writing, be implemented and consumed in most popular languages.</p>\n<p>Quoting from the <a href=\"https://graphql.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official site</a>: </p>\n<blockquote>\n<p>GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data. \nGraphQL provides a complete and understandable description of the data in your API, \ngives clients the power to ask for exactly what they need and nothing more, \nmakes it easier to evolve APIs over time, and enables powerful developer tools.</p>\n</blockquote>\n<p>If you are unfamiliar with GraphQL from a consumer perspective, \nit might be better to go through the <a href=\"https://graphql.org/learn/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official introduction</a> first. This post assumes user-level familiarity.</p>\n<h1 id=\"GraphQL-in-Java\"><a href=\"#GraphQL-in-Java\" class=\"headerlink\" title=\"GraphQL in Java\"></a>GraphQL in Java</h1><p>When it comes to JVM, <a href=\"http://graphql-java.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">graphql-java</a> is the most mature GraphQL implementation, \nand is what we use in this article. However, GraphQL java cares only about the execution of a GraphQL request given a \nschema and associated handlers. In a realistic application we&#39;d want to expose a GraphQL over an HTTP endpoint. \nSo, it is common to pair graphql-java with a web framework or HTTP handler. \nOur choice for the latter in the context of this post is Vert.x-Web.</p>\n<h1 id=\"About-Vert-X-amp-Vert-X-Web\"><a href=\"#About-Vert-X-amp-Vert-X-Web\" class=\"headerlink\" title=\"About Vert.X &amp; Vert.X-Web\"></a>About Vert.X &amp; Vert.X-Web</h1><p>Vert.X is a toolkit for building event-driven reactive services and Vert.X-web leverages the lower level toolkit for building web applications.</p>\n<p>From the <a href=\"https://vertx.io/docs/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official docs</a>: </p>\n<blockquote>\n<p><strong>Vert.x Core</strong></p>\n</blockquote>\n<blockquote>\n<p>The Vert.x core APIs contain the backbone for writing Vert.x applications and low-level support for HTTP, TCP, UDP, file system, \nasynchronous streams and many other building blocks. It is also used by many other components of Vert.x.</p>\n</blockquote>\n<blockquote>\n<p><strong>Vert.x Web</strong></p>\n</blockquote>\n<blockquote>\n<p>A tool-kit for writing sophisticated modern web applications and HTTP microservices.</p>\n</blockquote>\n<p>As we will see below, Vert.X and graphql-java work very well together because the graphql-java natively supports asynchronous \nexecution strategy which fits perfectly with the asynchronous event-driven style that Vert.X facilitates. </p>\n<h1 id=\"jOOQ-for-persistence\"><a href=\"#jOOQ-for-persistence\" class=\"headerlink\" title=\"jOOQ for persistence\"></a>jOOQ for persistence</h1><p>A real-world application would also need to persist its data, and for that our solution of choice here is <a href=\"https://www.jooq.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">jOOQ</a>, \na type-safe SQL builder for Java. </p>\n<p>jOOQ is commonly used in a database-first manner where the database is managed through DB centric tools and the DAO (Data Access Object) layer \nto interface with the database from application code is generated by introspecting the database.</p>\n<p>The generators which come with jOOQ don&#39;t support Vert.X out of the box, but the Vert.X core is very flexible and the \n<a href=\"https://github.com/jklingsporn/vertx-jooq\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">vertx-jooq project</a> provides code-generation support that bridges the two. </p>\n<h1 id=\"Dagger-for-dependency-injection\"><a href=\"#Dagger-for-dependency-injection\" class=\"headerlink\" title=\"Dagger for dependency injection\"></a>Dagger for dependency injection</h1><p>Vert.X itself is quite unopinionated regarding the organization of code and how services are integrated. It does not prescribe any specific dependency injection solution. However, from my experience of building backend applications, having a DI solution significantly helps towards testability of the application and reducing coupling among components.</p>\n<p>Our choice of DI framework is <a href=\"https://dagger.dev/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Dagger</a>. In contrast to many other popular DI&#x2F;IoC solutions, dagger operates through compile time code generation, reducing the reflection overhead causing startup delay. We will cover dagger specific aspects in <a href=\"/2021/02/05/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-II/\">second part</a> of this series, however for users unfamiliar with the concepts of DI, the official <a href=\"https://dagger.dev/users-guide\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">user documentation</a> and <a href=\"https://medium.com/@yostane/dependency-injection-with-dagger-2-inject-and-provides-ce21f7449ec5\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">this post</a> by Yassine Benabbas may be better starting points.</p>\n<h1 id=\"Why-this-particular-combination\"><a href=\"#Why-this-particular-combination\" class=\"headerlink\" title=\"Why this particular combination ?\"></a>Why this particular combination ?</h1><p>All four of these libraries, provide low-level control to the developer and don&#39;t impose superfluous \nhigh level abstractions or indirections that get in the way of performance or debuggability.</p>\n<p>So we end up with code that is easy to reason through, does not require us to jump through unnecessary indirections \nand does not require future maintainers to familiarize themselves with an onerous set of conventions \nbefore they can get productive with the stack.</p>\n<h1 id=\"About-Kotlin\"><a href=\"#About-Kotlin\" class=\"headerlink\" title=\"About Kotlin\"></a>About Kotlin</h1><p>Lastly, <a href=\"https://kotlinlang.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Kotlin</a> is a language from <a href=\"https://www.jetbrains.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">JetBrains</a> that targets (among other platforms) \nthe JVM and has excellent interop with Java. So even though all of the above libraries are written in java, \nwe will be able to use them in Kotlin without any additional wrappers and take advantage of the great tooling support by JetBrains. </p>\n<p>I am increasingly leaning towards towards Kotlin for most of my backend work because I find kotlin code to be a great blend of conciseness, \nreadability and type safety. Also, being a part of the wider JVM ecosystem, kotlin lends itself well to scalable performant applications. </p>\n<h1 id=\"Getting-our-feet-wet\"><a href=\"#Getting-our-feet-wet\" class=\"headerlink\" title=\"Getting our feet wet\"></a>Getting our feet wet</h1><p>The official site recommends using <a href=\"https://start.vertx.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">https://start.vertx.io/</a> as a means to bootstrap our application. This site provides a web \ninterface to generate the scaffold for a java or kotlin application using Vert.X. </p>\n<p>However, this generator doesn&#39;t completely address the needs for our chosen stack, because while we intend to write application \ncode in Kotlin, the vertx-jooq project generates java code for interfacing with the database and hence we&#39;d want our project \nto be able to compile both java and kotlin. </p>\n<p>Following pom.xml, modelled after the kotlin official recommendations for mixed maven projects, \nprovides us all we need to have a hybrid java &amp; kotlin project: </p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-meta\">&lt;?xml version=<span class=\"hljs-string\">&quot;1.0&quot;</span> encoding=<span class=\"hljs-string\">&quot;UTF-8&quot;</span>?&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">         <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">         <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modelVersion</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modelVersion</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>me.lorefnon<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.0.0-SNAPSHOT<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span>\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-1\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">18 lines collapsed (properties)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">kotlin.version</span>&gt;</span>1.4.21<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">kotlin.version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">kotlin.compiler.incremental</span>&gt;</span>true<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">kotlin.compiler.incremental</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">maven-shade-plugin.version</span>&gt;</span>3.2.4<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">maven-shade-plugin.version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">maven-surefire-plugin.version</span>&gt;</span>2.22.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">maven-surefire-plugin.version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exec-maven-plugin.version</span>&gt;</span>3.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exec-maven-plugin.version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">vertx.version</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">vertx.version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">junit-jupiter.version</span>&gt;</span>5.7.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">junit-jupiter.version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">main.verticle</span>&gt;</span>me.lorefnon.mastishka.MainVerticle<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">main.verticle</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">launcher.class</span>&gt;</span>io.vertx.core.Launcher<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">launcher.class</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">jjwt.version</span>&gt;</span>0.11.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">jjwt.version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">maven.compiler.source</span>&gt;</span>11<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">maven.compiler.source</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">maven.compiler.target</span>&gt;</span>11<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">maven.compiler.target</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">maven.compiler.release</span>&gt;</span>11<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">maven.compiler.release</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-1\"><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">kotlin.compiler.jvmTarget</span>&gt;</span>11<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">kotlin.compiler.jvmTarget</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencyManagement</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-stack-depchain<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${vertx.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>import<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencyManagement</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">&lt;!-- Vert.X related dependencies --&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-web-graphql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-web<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-pg-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-lang-kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-redis-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.vertx<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-junit5<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.junit.jupiter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>junit-jupiter-api<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${junit-jupiter.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.junit.jupiter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>junit-jupiter-engine<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${junit-jupiter.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">&lt;!-- Jooq related dependencies --&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.jooq<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>jooq<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.13.3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-comment\">&lt;!-- Library that provides Vert.X compatible code generation for jooq --&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.github.jklingsporn<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-jooq-classic-reactive<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>6.1.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#ffe1e7;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-comment\">&lt;!-- Configuration for building hybrid java+kotlin project --&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.jetbrains.kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>kotlin-maven-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${kotlin.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-2\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">23 lines collapsed (Execution tags)</span></div></td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/main/kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/main/java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>test-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>test-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/test/kotlin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sourceDir</span>&gt;</span>${project.basedir}/src/test/java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDir</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sourceDirs</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-2\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.8.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-3\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">21 lines collapsed (Execution tags)</span></div></td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>default-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">phase</span>&gt;</span>none<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">phase</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>default-testCompile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">phase</span>&gt;</span>none<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">phase</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>java-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">phase</span>&gt;</span>compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">phase</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>java-test-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">phase</span>&gt;</span>test-compile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">phase</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>testCompile<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line hlcode-line-fold hidden hlcode-line-highlight\" data-fold-id=\"hlcode-fold-3\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-comment\">&lt;!-- Configuration for running jooq-codegen-maven as part of build lifecycle to generate the DAO classes for type-safe DB access --&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.jooq<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>jooq-codegen-maven<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.13.3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>generate<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-comment\">&lt;!-- Our generator needs to connect to the database for inspecting the schema, so we need the postgres jdbc dependencies\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                   even though our application itself will use Vert.x reactive postgres driver instead of jdbc --&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.postgresql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>postgresql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>42.2.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.github.jklingsporn<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>vertx-jooq-generate<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>6.1.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-comment\">&lt;!-- Jooq generator configuration: format is the same as for the standalone code generator --&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-comment\">&lt;!-- JDBC connection parameters --&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">jdbc</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">driver</span>&gt;</span>org.postgresql.Driver<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">driver</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>jdbc:postgresql://localhost:5432/test_development<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">user</span>&gt;</span>lorefnon<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">user</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-comment\">&lt;!--&lt;password/&gt; --&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">jdbc</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-comment\">&lt;!-- Generator parameters --&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">generator</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>io.github.jklingsporn.vertx.jooq.generate.classic.ClassicReactiveVertxGenerator<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">database</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>org.jooq.meta.postgres.PostgresDatabase<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">includes</span>&gt;</span>.*<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">includes</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">inputSchema</span>&gt;</span>public<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">inputSchema</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">outputSchema</span>&gt;</span>public<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">outputSchema</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">unsignedTypes</span>&gt;</span>false<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">unsignedTypes</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">database</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">target</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">packageName</span>&gt;</span>me.lorefnon.test.generated<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">packageName</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">directory</span>&gt;</span>src/main/java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">directory</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">target</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">generate</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">interfaces</span>&gt;</span>true<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">interfaces</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">daos</span>&gt;</span>true<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">daos</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">fluentSetters</span>&gt;</span>true<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">fluentSetters</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">generate</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">strategy</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>io.github.jklingsporn.vertx.jooq.generate.VertxGeneratorStrategy<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">strategy</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">generator</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">              <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#dbffc3;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>maven-shade-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${maven-shade-plugin.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none\" class=\"hlcode-fold-collapsed\" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" colspan=\"1\"><div class=\"hlcode-fold-handle\" data-fold-id=\"hlcode-fold-4\"><svg height=\"21\" viewBox=\"0 0 21 21\" width=\"21\" xmlns=\"http://www.w3.org/2000/svg\">\n        <g fill=\"none\" fill-rule=\"evenodd\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" transform=\"translate(4 4)\">\n            <path d=\"m10.5.5h-8c-1.1045695 0-2 .8954305-2 2v8c0 1.1045695.8954305 2 2 2h8c1.1045695 0 2-.8954305 2-2v-8c0-1.1045695-.8954305-2-2-2z\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n            <path d=\"m6.5 3.5v6.056\"/>\n            <path d=\"m6.5 3.5v6\" transform=\"matrix(0 1 -1 0 13 0)\"/>\n        </g>\n    </svg><span class=\"hlcode-fold-text\">24 lines collapsed (Maven Shade Plugin Configuration)</span></div></td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">phase</span>&gt;</span>package<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">phase</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">goal</span>&gt;</span>shade<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goal</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">goals</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transformers</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transformer</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                        <span class=\"hljs-attr\">implementation</span>=<span class=\"hljs-string\">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">manifestEntries</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Main-Class</span>&gt;</span>${launcher.class}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Main-Class</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Main-Verticle</span>&gt;</span>${main.verticle}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Main-Verticle</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">manifestEntries</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">transformer</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transformer</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                                        <span class=\"hljs-attr\">implementation</span>=<span class=\"hljs-string\">&quot;org.apache.maven.plugins.shade.resource.ServicesResourceTransformer&quot;</span>/&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">transformers</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactSet</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactSet</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">outputFile</span>&gt;</span>${project.build.directory}/${project.artifactId}-${project.version}-fat.jar\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">outputFile</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">execution</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line hlcode-line-fold hidden \" data-fold-id=\"hlcode-fold-4\"><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">executions</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>maven-surefire-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${maven-surefire-plugin.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-comment\">&lt;!-- We can use mvn exec:java to run development server --&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.codehaus.mojo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>exec-maven-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${exec-maven-plugin.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-comment\">&lt;!-- Note that the main class is a Vert.X launcher class which will execute the verticles defined in \n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        our application --&gt;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mainClass</span>&gt;</span>io.vertx.core.Launcher<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mainClass</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">arguments</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">argument</span>&gt;</span>run<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">argument</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">argument</span>&gt;</span>${main.verticle}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">argument</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">arguments</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span>\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project</span>&gt;</span>\n</td></tr></table></code></pre>\n\n<p>With this in place, everytime we build our project, the jooq integration will generate the data access layer \nfor our database by inspecting the database. </p>\n<h1 id=\"Our-first-verticle\"><a href=\"#Our-first-verticle\" class=\"headerlink\" title=\"Our first verticle\"></a>Our first verticle</h1><p>The primary unit of deployment in Vert.X is a Verticle. <a href=\"https://vertx.io/docs/vertx-core/java/#_verticles\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">The docs</a> explain this in more detail: </p>\n<blockquote>\n<p>Verticles are chunks of code that get deployed and run by Vert.x. A Vert.x instance maintains N event loop threads (where N by default is core*2) by default</p>\n</blockquote>\n<blockquote>\n<p>You can think of a verticle as a bit like an actor in the <a href=\"https://en.wikipedia.org/wiki/Actor_model\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Actor Model</a>.</p>\n</blockquote>\n<blockquote>\n<p>An application would typically be composed of many verticle instances running in the same Vert.x instance at the same time. \nThe different verticle instances communicate with each other by sending messages on the <a href=\"https://vertx.io/docs/vertx-core/java/#event_bus\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">event bus</a>.</p>\n</blockquote>\n<p>So, this is what our first Verticle looks like: </p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">package</span> tech.lorefnon.test\n\n<span class=\"hljs-keyword\">import</span> io.vertx.core.AbstractVerticle\n<span class=\"hljs-keyword\">import</span> io.vertx.core.Promise\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MainVerticle</span> : <span class=\"hljs-type\">AbstractVerticle</span></span>() &#123;\n\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">start</span><span class=\"hljs-params\">(startPromise: <span class=\"hljs-type\">Promise</span>&lt;<span class=\"hljs-type\">Void</span>&gt;)</span></span> &#123;\n        <span class=\"hljs-keyword\">val</span> router = setupRouter(vertx) <span class=\"hljs-comment\">// More on this below</span>\n        vertx\n            .createHttpServer()\n            .requestHandler(router)\n            .listen(<span class=\"hljs-number\">8888</span>) &#123; http -&gt;\n                <span class=\"hljs-keyword\">if</span> (http.succeeded()) &#123;\n                    startPromise.complete()\n                    println(<span class=\"hljs-string\">&quot;HTTP server started on port 8888&quot;</span>)\n                &#125; <span class=\"hljs-keyword\">else</span> &#123;\n                    startPromise.fail(http.cause());\n                &#125;\n            &#125;\n    &#125;\n&#125;</code></pre>\n\n<p>Note that all our setup is explicit in the code and there is no hidden magic going on.</p>\n<p>Our <code>setupRouter</code> function will be responsible for bootstrapping the endpoints which handle the GraphQL requests: </p>\n<pre><code class=\"hljs kotlin\"><span class=\"hljs-keyword\">import</span> io.vertx.core.Vertx\n<span class=\"hljs-keyword\">import</span> io.vertx.ext.web.Router\n<span class=\"hljs-keyword\">import</span> io.vertx.ext.web.handler.BodyHandler\n<span class=\"hljs-keyword\">import</span> io.vertx.ext.web.handler.graphql.GraphQLHandler\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">setupRouter</span><span class=\"hljs-params\">(vertx: <span class=\"hljs-type\">Vertx</span>)</span></span> =\n    Router.router(vertx).also &#123; r -&gt;\n        r.route().handler(BodyHandler.create())\n        r.post(<span class=\"hljs-string\">&quot;/graphql&quot;</span>).handler(\n            GraphQLHandler.create(\n                setupGraphQL() <span class=\"hljs-comment\">// More on this below</span>\n            )\n        )\n    &#125;</code></pre>\n\n<p><code>BodyHandler</code> is needed to parse POST request body. </p>\n<p>Our <code>setupGraphQL</code> function is responsible for wiring up our GraphQL Schema and the resolvers</p>\n<pre><code class=\"hljs\"><table class=\"hlcode-table\"><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.execution.*\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.RuntimeWiring.newRuntimeWiring\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaGenerator\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> graphql.schema.idl.SchemaParser\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">import</span> io.vertx.ext.web.handler.graphql.schema.VertxDataFetcher\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">setupGraphQL</span><span class=\"hljs-params\">()</span></span> = GraphQL\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    .newGraphQL(buildExecutableSchema())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-keyword\">val</span> rawSchema = <span class=\"hljs-string\">&quot;&quot;&quot;\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    type Query {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        hello: String\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">&quot;&quot;&quot;</span>.trimIndent()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildRuntimeWiring</span><span class=\"hljs-params\">()</span></span> = newRuntimeWiring()\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    .type(<span class=\"hljs-string\">&quot;Query&quot;</span>) {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        it.dataFetcher(<span class=\"hljs-string\">&quot;hello&quot;</span>) {\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-comment\">// Here is the logic for resolving our hello field in Query type</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-comment\">//</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-comment\">// For now we just return a static string</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">            <span class=\"hljs-string\">&quot;world&quot;</span>\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">        }\n</td></tr><tr style=\"border:none;background:#fffacd;\" class=\"hlcode-line  hlcode-line-highlight\" ><td style=\"border:none\" class=\"hlcode-code-cell\">    }\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    .build()\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">buildExecutableSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    SchemaGenerator().makeExecutableSchema(parseSchema(), buildRuntimeWiring())\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">parseSchema</span><span class=\"hljs-params\">()</span></span> =\n</td></tr><tr style=\"border:none;\" class=\"hlcode-line  \" ><td style=\"border:none\" class=\"hlcode-code-cell\">    SchemaParser().parse(rawSchema)\n</td></tr></table></code></pre>\n\n<p>Our <code>rawSchema</code> variable contains our very minimal GraphQL schema (defined using <a href=\"https://www.digitalocean.com/community/tutorials/graphql-graphql-sdl\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">GraphQL SDL</a>)</p>\n<p>Our <code>buildRuntimeWiring</code> function specifies the resolvers (called <code>dataFetcher</code> in graphql-java terminology) for our dynamic GraphQL fields. </p>\n<p>Finally we combine the schema with the runtime wiring (set of resolvers associated with corresponding fields) to form an executable schema \nwhich the <code>GraphQLHandler</code> from <code>vertx-graphql</code> package can use to setup the HTTP endpoint which we have mapped to the <code>/graphql</code> route in our \n<code>setupRouter</code> function.</p>\n<p>As we saw in the pom.xml we have an exec:java goal defined. So we can use <code>mvn compile exec:java</code> to run our server. </p>\n<p>If we see following message in the server logs, that means we are all good and our server is up and running: </p>\n<pre><code class=\"hljs plaintext\">Feb 01, 2021 12:25:02 AM io.vertx.core.impl.launcher.commands.VertxIsolatedDeployer\nINFO: Succeeded in deploying verticle\nHTTP server started on port 8888</code></pre>\n\n<p>We can try out our API using a GraphQL client. I like using <a href=\"https://altair.sirmuel.design/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Altair</a>.</p>\n<p><img src=\"/images/2020-02-01/graphql-altair-hello-world.png\" alt=\"Altair\" loading=\"lazy\"></p>\n<p>So we see that our simple API works and our field (<code>hello</code>) is resolved through the dataFetcher we have defined.</p>\n<p>For now, our minimal resolver returns a simple static string. In the <a href=\"/2021/02/05/Building-GraphQL-APIs-powered-by-Vert-x-jOOQ-Kotlin-II/\">next post</a> we will integrate a basic DI setup using Dagger, and in the in the subsequent one we will setup a signup and signin mechanism where our resolvers will connect to the database for persisting data.</p>\n",
            "tags": [
                "GraphQL",
                "Kotlin",
                "Vert.X",
                "Vert.X-Web",
                "Backend-development",
                "API-development"
            ]
        },
        {
            "id": "https://lorefnon.me/2020/12/31/pairing-lit-html-with-stimulus/",
            "url": "https://lorefnon.me/2020/12/31/pairing-lit-html-with-stimulus/",
            "title": "Pairing lit-html with stimulus",
            "date_published": "2020-12-31T00:00:00.000Z",
            "content_html": "<p>After recent announcement of <a href=\"https://hotwire.dev/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Hotwire</a> I started looking at the basecamp frontend stack closely. While I see the appeal of <a href=\"https://turbo.hotwire.dev/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Turbo</a> &amp; Strada in the context of server-rendered applications, <a href=\"https://stimulus.hotwire.dev/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">stimulus</a> stands out in that it can be quite useful in a much wider range of applications. </p>\n<p>In this post, we look at pairing <a href=\"https://lit-html.polymer-project.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">lit-html</a> and stimulus for fun and profit. This is a somewhat unorthodox combination because lit-html is typically used with web-component libraries (like <a href=\"https://lit-element.polymer-project.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">lit-element</a>) and stimulus is commonly used in server-rendered applications, but we will touch upon our motivation for pairing them in a later part (Jump to the <a href=\"#advantages\">Advantages section</a> below if you wish).</p>\n<h2 id=\"A-cursory-look-at-lit-html\"><a href=\"#A-cursory-look-at-lit-html\" class=\"headerlink\" title=\"A cursory look at lit-html\"></a>A cursory look at lit-html</h2><p><a href=\"https://lit-html.polymer-project.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">lit-html</a> is an interesting HTML templating library from the polymer team which supports efficient rendering as well as re-rendering of those templates into the DOM. </p>\n<p>The last part is what makes it stand out from conventional text templating libraries like mustache, liquid etc. where to re-render a template we would usually wipe out the entire subtree and replace the innerHTML completely. </p>\n<p>It is also much less opinionated than libraries like <a href=\"https://reactjs.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">React</a>. Also, in contrast to React, it doesn&#39;t maintain a parallel in-memory representation of the entire DOM tree (virtual DOM) while still offering efficient replacement of the dynamic parts.</p>\n<h2 id=\"Using-stimulus-with-lit-html\"><a href=\"#Using-stimulus-with-lit-html\" class=\"headerlink\" title=\"Using stimulus with lit-html\"></a>Using stimulus with lit-html</h2><p>While we will get back to why we are doing this in a bit, it might be helpful to look at a code sample that illustrates lit-html and stimulus working together.</p>\n<p>We will start out with the simplest task planner possible.</p>\n<p>Our state, for now, is maintained in a simple JS array: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> tasks = [ \n    <span class=\"hljs-comment\">/* What our array will contain (eventually): </span>\n<span class=\"hljs-comment\">    &#123; </span>\n<span class=\"hljs-comment\">        id: 1, </span>\n<span class=\"hljs-comment\">        content: &quot;Wash clothes&quot;, </span>\n<span class=\"hljs-comment\">        done: false </span>\n<span class=\"hljs-comment\">    &#125; </span>\n<span class=\"hljs-comment\">    */</span> \n];</code></pre>\n\n<p>Now, we define some utility functions that render our tasks through lit-html: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-comment\">// Our top level template can delegate to other template renderers:</span>\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">appTemplate</span> = (<span class=\"hljs-params\">&#123; tasks &#125;</span>) =&gt; html`<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\">    </span><span class=\"hljs-subst\">$&#123;todoListTemplate(tasks)&#125;</span><span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>`</span>;</code></pre>\n\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">todoListTemplate</span> = (<span class=\"hljs-params\">tasks</span>) =&gt; html`<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> </span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> </span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Enter task here&quot;</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span>&gt;</span></span>\n<span class=\"language-xml\">    </span><span class=\"hljs-subst\">$&#123;tasks.map((task) =&gt; taskTemplate(task))&#125;</span><span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>`</span>;</code></pre>\n\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">taskTemplate</span> = (<span class=\"hljs-params\">task</span>) =&gt; html`<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">style</span>=</span></span><span class=\"hljs-subst\">$&#123;task.done ? <span class=\"hljs-string\">&quot;text-decoration: line-through&quot;</span> : <span class=\"hljs-string\">&quot;&quot;</span>&#125;</span><span class=\"language-xml\"><span class=\"hljs-tag\"></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;checkbox&quot;</span> ?<span class=\"hljs-attr\">checked</span>=</span></span><span class=\"hljs-subst\">$&#123;task.done&#125;</span><span class=\"language-xml\"><span class=\"hljs-tag\"> ? /&gt;</span></span>\n<span class=\"language-xml\">    </span><span class=\"hljs-subst\">$&#123;task.content&#125;</span><span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>`</span>;</code></pre>\n\n<p><em>(Our templates can make use of variables we passed to them and inject them into the rendered content as well as derive attributes&#x2F;styles etc. from these values).</em></p>\n<p>Note that we haven&#39;t done anything yet to make this interactive (handle user events). We will get to them in a bit (using stimulus).</p>\n<p>We can render the top level appTemplate renderer in a DOM node: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-title function_\">render</span>(<span class=\"hljs-title function_\">appTemplate</span>(&#123; tasks &#125;), <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">getElementById</span>(<span class=\"hljs-string\">&quot;app&quot;</span>));</code></pre>\n\n<p>At this point we will see an empty input box and nothing is gonna happen when we click on it.</p>\n<p><img src=\"/images/YWarVmaNy.png\" alt=\"image.png\" loading=\"lazy\"></p>\n<p>Now, let us make this interactive by adding stimulus:</p>\n<p>The primary abstraction offered by stimulus is the concept of <a href=\"https://stimulus.hotwire.dev/reference/controllers\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">controllers</a>. </p>\n<p>We define behavior in controllers, and associate them with markup through data attributes.</p>\n<p>So, if we have a TodoController we can associate it with our top level node through a <code>data-controller</code> attribute: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">appTemplate</span> = (<span class=\"hljs-params\">&#123; tasks &#125;</span>) =&gt; html`<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">data-controller</span>=<span class=\"hljs-string\">&quot;todo&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">    </span><span class=\"hljs-subst\">$&#123;todoListTemplate(tasks)&#125;</span><span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\">`</span>;</code></pre>\n\n<p><em>(This entire stringly-typed business is a bit icky if you are typescript aficionado, but bear with me for now).</em></p>\n<p>Once our controller has been attached, we can bind event handlers (methods in the controller) through more data attributes: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">todoListTemplate</span> = (<span class=\"hljs-params\">tasks</span>) =&gt; html`<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> </span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> </span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Enter task here&quot;</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">data-action</span>=<span class=\"hljs-string\">&quot;keydown-&gt;todo#handleKeyDown&quot;</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span>&gt;</span></span>\n<span class=\"language-xml\">    </span><span class=\"hljs-subst\">$&#123;tasks.map((task) =&gt; taskTemplate(task))&#125;</span><span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span>\n<span class=\"language-xml\">`</span>;</code></pre>\n\n<p>(<code>keydown</code> event will be handled by <code>handleKeyDown</code> method of  <code>TodoController</code>).</p>\n<p>Similarly, we can handle click action on the todo item to toggle done state of the task: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">taskTemplate</span> = (<span class=\"hljs-params\">task</span>) =&gt; html`<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">style</span>=</span></span><span class=\"hljs-subst\">$&#123;task.done ? <span class=\"hljs-string\">&quot;text-decoration: line-through&quot;</span> : <span class=\"hljs-string\">&quot;&quot;</span>&#125;</span><span class=\"language-xml\"><span class=\"hljs-tag\"></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">data-id</span>=</span></span><span class=\"hljs-subst\">$&#123;task.id&#125;</span><span class=\"language-xml\"><span class=\"hljs-tag\"></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">data-action</span>=<span class=\"hljs-string\">&quot;click-&gt;todo#toggleTask&quot;</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;checkbox&quot;</span> ?<span class=\"hljs-attr\">checked</span>=</span></span><span class=\"hljs-subst\">$&#123;task.done&#125;</span><span class=\"language-xml\"><span class=\"hljs-tag\"> ? /&gt;</span></span>\n<span class=\"language-xml\">    </span><span class=\"hljs-subst\">$&#123;task.content&#125;</span><span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span>\n<span class=\"language-xml\">`</span>;</code></pre>\n\n<p>So, now what does our controller look like: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Controller</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;stimulus&quot;</span>;\n\n<span class=\"hljs-comment\">// A simple counter to get new ids for every ids</span>\n<span class=\"hljs-comment\">//</span>\n<span class=\"hljs-comment\">// If you are actually syncing the todos to a server, you&#x27;d want to use a uuid generator</span>\n<span class=\"hljs-keyword\">let</span> counter = <span class=\"hljs-number\">0</span>;\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TodoController</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Controller</span> &#123;\n\n  <span class=\"hljs-comment\">// Event handlers which will be invoked by stimulus based on the data-action attributes</span>\n  <span class=\"hljs-title function_\">toggleTask</span>(<span class=\"hljs-params\">event</span>) &#123;\n    <span class=\"hljs-keyword\">const</span> taskId = event.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">dataset</span>.<span class=\"hljs-property\">id</span>;\n    tasks = tasks.<span class=\"hljs-title function_\">map</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">task</span>) =&gt;</span>\n      task.<span class=\"hljs-property\">id</span> == taskId \n          ? &#123; ...task, <span class=\"hljs-attr\">done</span>: !task.<span class=\"hljs-property\">done</span> &#125; \n          : task\n    );\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">rerender</span>();\n  &#125;\n\n  <span class=\"hljs-title function_\">handleKeyDown</span>(<span class=\"hljs-params\">event</span>) &#123;\n    <span class=\"hljs-keyword\">if</span> (event.<span class=\"hljs-property\">key</span> === <span class=\"hljs-string\">&quot;Enter&quot;</span>) &#123;\n      tasks.<span class=\"hljs-title function_\">push</span>(&#123;\n        <span class=\"hljs-attr\">id</span>: ++counter,\n        <span class=\"hljs-attr\">content</span>: event.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">value</span>,\n        <span class=\"hljs-attr\">done</span>: <span class=\"hljs-literal\">false</span>\n      &#125;);\n      <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">rerender</span>();\n    &#125;\n  &#125;\n\n  <span class=\"hljs-title function_\">rerender</span>(<span class=\"hljs-params\"></span>) &#123;\n    <span class=\"hljs-comment\">// this.element is the element to which we added the data-controller attribute</span>\n    <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-title function_\">todoListTemplate</span>(tasks), <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">element</span>);\n  &#125;\n&#125;</code></pre>\n\n<p>The <code>rerender</code> function is the only part that is lit-html aware and will takes care of re-rendering the template after the our tasks array has been updated. </p>\n<p>At this point our tasks array is a plain js array, so we don&#39;t have a mechanism to subscribe to it, so whenever we modify the array, we will need to call the rerender function ourselves (Not cool, but works).</p>\n<p>All that is left to do, is hooking up our controller into the <code>Application</code> singleton provided by stimulus: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; <span class=\"hljs-title class_\">Application</span> &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;stimulus&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> application = <span class=\"hljs-title class_\">Application</span>.<span class=\"hljs-title function_\">start</span>();\napplication.<span class=\"hljs-title function_\">register</span>(<span class=\"hljs-string\">&quot;todo&quot;</span>, <span class=\"hljs-title class_\">TodoController</span>); \n<span class=\"hljs-comment\">//                               ^ The name here (&quot;todo&quot;) should match </span>\n<span class=\"hljs-comment\">//                                  what we passed to the data-controller attribute</span></code></pre>\n\n<p><em>(If you are using webpack, there is a <a href=\"https://stimulus.hotwire.dev/handbook/installing\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">fancier way</a> to auto-register all controllers but that is besides the core focus of this article)</em>.</p>\n<p>Believe it or not, our todo list <strong>actually works</strong> now: </p>\n<p><img src=\"/images/SSRcYqSrf.png\" alt=\"image.png\" loading=\"lazy\"></p>\n<h2 id=\"Advantages\"><a href=\"#Advantages\" class=\"headerlink\" title=\"Advantages:\"></a>Advantages:</h2><p>If you are familiar with lit-html (or look into the docs) event handling through stimulus may seem unncessary. lit-html offers its own <a href=\"https://lit-html.polymer-project.org/guide/template-reference#event-listeners\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">event handling mechanism</a>. </p>\n<p>Nothing wrong with that approach, but note one thing: If you are server rendering your templates (look at the <a href=\"https://github.com/popeindustries/lit-html-server\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">lit-html-server</a> project) - you&#39;d need to load the templates <strong>atleast twice</strong>. Once the pre-rendered HTML and second the javascript representation that can be used for re-rendering. </p>\n<p>However, in our implementation, the controller that invokes rerender does not need the javascript representation until the rerender is actually called. So we can use dynamic imports &#x2F; code-splitting and load our template only when needed.</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-title function_\">rerender</span>(<span class=\"hljs-params\"></span>) &#123;\n  <span class=\"hljs-title function_\">import</span>(<span class=\"hljs-string\">&#x27;./todo-list-template&#x27;</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">template</span> =&gt;</span> \n    <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-title function_\">template</span>(tasks), <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">element</span>)\n  );\n&#125;</code></pre>\n\n<p>To emphasise, we can easily server-render our UI when using libraries like React, Angular etc. but if we need our components to be interactive on the client-side, we&#39;d need the JS code for the component (including the JS representation of our templates) before we can handle a single click. </p>\n<p><strong>This is not the case here:</strong> Given the controller-view separation, we need the controller to handle interactions on the client, but we need the view (template rendering functions) only when we need to actually update the content.</p>\n<p>This allows for more fine grained code-splitting and is not so easy to do with libraries like React. </p>\n<h2 id=\"Some-obligatory-cleanup\"><a href=\"#Some-obligatory-cleanup\" class=\"headerlink\" title=\"Some obligatory cleanup:\"></a>Some obligatory cleanup:</h2><p>Our list rendering strategy is not ideal here, and we should be using a <a href=\"https://lit-html.polymer-project.org/guide/template-reference#repeat\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">repeat directive</a> for rendering lists (The motivation is similar to why we need key attribute in react, the linked docs explain it in more detail):</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> &#123; repeat &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;lit-html/directives/repeat&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">todoListTemplate</span> = (<span class=\"hljs-params\">tasks</span>) =&gt; html`<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> </span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> </span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">&quot;Enter task here&quot;</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">    <span class=\"hljs-attr\">data-action</span>=<span class=\"hljs-string\">&quot;keydown-&gt;todo#handleKeyDown&quot;</span></span></span>\n<span class=\"hljs-tag\"><span class=\"language-xml\">  &gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span>&gt;</span></span>\n<span class=\"language-xml\">    </span><span class=\"hljs-subst\">$&#123;repeat(</span>\n<span class=\"hljs-subst\">      tasks,</span>\n<span class=\"hljs-subst\">      (task) =&gt; task.id, // Unique key <span class=\"hljs-keyword\">for</span> each task</span>\n<span class=\"hljs-subst\">      (task) =&gt; taskTemplate(task)</span>\n<span class=\"hljs-subst\">    )&#125;</span><span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span>\n<span class=\"language-xml\">`</span>;</code></pre>\n<h2 id=\"Making-things-reactive\"><a href=\"#Making-things-reactive\" class=\"headerlink\" title=\"Making things reactive:\"></a>Making things reactive:</h2><p>Calling rerender ourselves doesn&#39;t quite cut it in 2020 (almost 2021 :P) and in JS ecosystem we have a plethora of state-management micro-libraries. One that I particularly like is <a href=\"https://effector.dev/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Effector</a>, which is quite feature rich for a <a href=\"https://bundlephobia.com/result?p=effector@21.7.5\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">9.5k bundle</a>. </p>\n<p>Let&#39;s quickly see how our toy todo list will look like with some state management thrown in.</p>\n<p>Let&#39;s setup our store first (Effector&#39;s store follow a unidirectional data flow approach that you might be familiar from redux etc.): </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-comment\">// Create a store which will contain all our tasks</span>\n<span class=\"hljs-keyword\">const</span> tasksStore = <span class=\"hljs-title function_\">createStore</span>([]);\n\n<span class=\"hljs-comment\">// Create events:</span>\n<span class=\"hljs-comment\">//</span>\n<span class=\"hljs-comment\">// In effector terminology, events are both event dispatchers</span>\n<span class=\"hljs-comment\">// as well as event emitters</span>\n<span class=\"hljs-keyword\">const</span> addTask = <span class=\"hljs-title function_\">createEvent</span>();\n\n<span class=\"hljs-comment\">// So we can do something like:</span>\n<span class=\"hljs-comment\">// addTask(&#123; ... &#125;) to trigger this event</span>\n<span class=\"hljs-comment\">// and addTask.watch(() =&gt; &#123; ... &#125;) to subscribe to this event</span>\n\n<span class=\"hljs-keyword\">const</span> toggleTask = <span class=\"hljs-title function_\">createEvent</span>();\n\n<span class=\"hljs-comment\">// Configure our store to handle these events:</span>\n\ntasksStore.<span class=\"hljs-title function_\">on</span>(addTask, <span class=\"hljs-function\">(<span class=\"hljs-params\">tasks, task</span>) =&gt;</span> [...tasks, task]);\n\ntasksStore.<span class=\"hljs-title function_\">on</span>(toggleTask, <span class=\"hljs-function\">(<span class=\"hljs-params\">tasks, &#123; taskId &#125;</span>) =&gt;</span>\n  tasks.<span class=\"hljs-title function_\">map</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">task</span>) =&gt;</span>\n    task.<span class=\"hljs-property\">id</span> == taskId ? &#123; ...task, <span class=\"hljs-attr\">done</span>: !task.<span class=\"hljs-property\">done</span> &#125; : task\n  )\n);</code></pre>\n\n<p>Let&#39;s hook our controller to use that instead of the vanilla array: </p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TodoController</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">Controller</span> &#123;\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">context</span>) &#123;\n    <span class=\"hljs-variable language_\">super</span>(context);\n    <span class=\"hljs-comment\">// Whenever our store updates - rerender the template</span>\n    tasksStore.<span class=\"hljs-title function_\">watch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">tasks</span>) =&gt;</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">rerender</span>(tasks));\n  &#125;\n  <span class=\"hljs-title function_\">toggleTask</span>(<span class=\"hljs-params\">event</span>) &#123;\n    <span class=\"hljs-keyword\">const</span> taskId = event.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">dataset</span>.<span class=\"hljs-property\">id</span>;\n    <span class=\"hljs-title function_\">toggleTask</span>(&#123; taskId &#125;);\n  &#125;\n  <span class=\"hljs-title function_\">handleKeyDown</span>(<span class=\"hljs-params\">event</span>) &#123;\n    <span class=\"hljs-keyword\">if</span> (event.<span class=\"hljs-property\">key</span> === <span class=\"hljs-string\">&quot;Enter&quot;</span>) &#123;\n      <span class=\"hljs-title function_\">addTask</span>(&#123;\n        <span class=\"hljs-attr\">id</span>: ++counter,\n        <span class=\"hljs-attr\">content</span>: event.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">value</span>,\n        <span class=\"hljs-attr\">done</span>: <span class=\"hljs-literal\">false</span>\n      &#125;);\n    &#125;\n  &#125;\n  <span class=\"hljs-title function_\">rerender</span>(<span class=\"hljs-params\">tasks</span>) &#123;\n    <span class=\"hljs-title function_\">render</span>(<span class=\"hljs-title function_\">todoListTemplate</span>(tasks), <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">element</span>);\n  &#125;\n&#125;</code></pre>\n\n<p>The repeated calls to rerender are now gone, as we have configured our constructor to rerender the template whenever state updates. </p>\n<p>You can try out this implementation in the sandbox <a href=\"https://codesandbox.io/s/happy-fog-sfje3?file=/src/index.js:1562-2058\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">here</a>.</p>\n<h2 id=\"Caveats\"><a href=\"#Caveats\" class=\"headerlink\" title=\"Caveats:\"></a>Caveats:</h2><p>*No such thing as free lunch, yadda, yadda ... *</p>\n<p>If you see the snippet above, one interesting thing is how we didn&#39;t have to tell stimulus that the DOM has been updated (through lit-html) and it was still able to handle the events for newly added DOM nodes. You can add a task, and click on it to mark it as done. We didn&#39;t do anything to subscribe stimulus to lit-html. </p>\n<p>The reason it works is because stimulus subscribes to the DOM itself - through <a href=\"https://stimulus.hotwire.dev/reference/lifecycle-callbacks#order-and-timing\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">mutation observers</a>. So any DOM modification triggers a rescanning of the relevant subtrees so that stimulus can intercept the data attributes in newly added DOM nodes.</p>\n<p>This allows us the flexibility to server-render our templates, replace whole or parts of the page dynamically as we deem fit, without ever telling stimulus to re-traverse the DOM. </p>\n<p>This has an associated overhead (though it can be significant only if the DOM tree is complex and large subtree heads are frequently changing) but that can be eliminated if the UI framework completely controls the rendering lifecycle -  la React. </p>\n<p>So, &#39;tis important to evaluate your options logically and methodically. </p>\n",
            "tags": [
                "Lit-html",
                "Stimulus"
            ]
        },
        {
            "id": "https://lorefnon.me/2020/11/27/exploring-har-http-archive-logs-with-jq/",
            "url": "https://lorefnon.me/2020/11/27/exploring-har-http-archive-logs-with-jq/",
            "title": "Exporing HAR (HTTP Archive) logs with Jq",
            "date_published": "2020-11-27T00:00:00.000Z",
            "content_html": "<p><a href=\"https://stedolan.github.io/jq/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Jq</a> is a versatile utility for quickly exploring&#x2F;filtering&#x2F;transforming JSON on the command line. It is similar to grep&#x2F;sed&#x2F;awk utilities in that it is standalone, portable and composable. If you are not familiar with basics of jq yet, I recommend skimming through the well written <a href=\"https://stedolan.github.io/jq/manual\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official manual</a>.</p>\n<p>The HTTP Archive format, or HAR, is a JSON-formatted archive file format for logging of a web browser&#39;s interaction with a site (Source: <a href=\"https://en.wikipedia.org/wiki/HAR_(file_format)\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Wikipedia</a>. Both Chrome and Firefox provide a <a href=\"https://knowledge.vidyard.com/hc/en-us/articles/360009996213-Download-a-HAR-file-from-your-browser\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">convenient option</a> to download information about all the http requests when visiting a particular site as a HAR file which makes it a very useful format in practice.</p>\n<p>One simple way to analyze HAR files is to import them back into dev-tools and explore them manually. But for many common scenarios it is more efficient to analyze these files through CLI using a tool like jq to zero into the exact information we need.</p>\n<p>The rest of this post is basically a cheatsheet of one-liners for using jq to analyze HAR logs. It mostly covers scenarios that I have found useful in day-to-day exploration as a web developer.</p>\n<p>For the examples here I&#39;ll be using the HAR exported from twitter.com (I am <a href=\"https://twitter.com/lorefnon\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">@lorefnon</a> on twitter as well BTW).</p>\n<p>You may or may not have familiar with the structure of HAR file. Let&#39;s see how we can explore some JSON of unfamiliar structure.</p>\n<p>For starters, jq can be used a simple JSON formatter or syntax highligher.</p>\n<p>So something like this gives us properly formatted syntax highlighted json:</p>\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;.&#x27;</span> twitter.com.har</code></pre>\n\n<p>Or we can feed in json through STDIN which is quite useful with curl etc.:</p>\n<pre><code class=\"hljs sh\">$ <span class=\"hljs-built_in\">cat</span> twitter.com.har | jq <span class=\"hljs-string\">&#x27;.&#x27;</span></code></pre>\n\n<p>This essentially applies an identity filter (<code>.</code>) to input (incoming stream) that returns it unchanged, and lets jq pretty-prints the output.</p>\n<p>However, HAR files are often fairly large, and thus this is unweildy when you have several MBs of content.</p>\n<p>So let us just find out the top level keys to begin with:</p>\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;. | keys&#x27;</span> twitter.com.har\n\n[\n  <span class=\"hljs-string\">&quot;log&quot;</span>\n]</code></pre>\n\n<p>Pipe (|) similar to unix pipes is jq&#39;s syntax for forward application. In this case the output of identity filter to the <code>keys</code> builtin function which returns us an array of keys in the object.</p>\n<p>And now we can drill down from there and explore the subtree:</p>\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;.log | keys&#x27;</span> twitter.com.har\n\n[\n  <span class=\"hljs-string\">&quot;creator&quot;</span>,\n  <span class=\"hljs-string\">&quot;entries&quot;</span>,\n  <span class=\"hljs-string\">&quot;pages&quot;</span>,\n  <span class=\"hljs-string\">&quot;version&quot;</span>\n]</code></pre>\n\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;.log.pages[0] | keys&#x27;</span> twitter.com.har\n\n[\n  <span class=\"hljs-string\">&quot;id&quot;</span>,\n  <span class=\"hljs-string\">&quot;pageTimings&quot;</span>,\n  <span class=\"hljs-string\">&quot;startedDateTime&quot;</span>,\n  <span class=\"hljs-string\">&quot;title&quot;</span>\n]</code></pre>\n\n<p>We will not go into an exploration of the complete format. Besides interactive exploration through jq it may also be useful to consult the <a href=\"http://www.softwareishard.com/blog/har-12-spec/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">HAR specification</a> on how this file is structured.</p>\n<h2 id=\"Enumerating-accessed-resources\"><a href=\"#Enumerating-accessed-resources\" class=\"headerlink\" title=\"Enumerating accessed resources\"></a>Enumerating accessed resources</h2><p>As part of our exploration we&#39;d usually want to narrow down our selection by the HTTP resources which were accessed.</p>\n<p>We can find all the urls that were accessed as a part of this browsing session:</p>\n<pre><code class=\"hljs sh\">jq <span class=\"hljs-string\">&#x27;.log.entries[] | .request.url&#x27;</span> twitter.com.har\n\n<span class=\"hljs-string\">&quot;https://twitter.com/home&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/polyfills.18a65025.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/vendors~main.d0d6d775.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/i18n/en.96bbaf75.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/main.a3119725.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/ondemand.Dropdown.fa0fef85.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/sharedCore.c5e0a615.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/ondemand.Dropdown.fa0fef85.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/favicons/twitter.ico&quot;</span>\n...</code></pre>\n\n<p>We would often be interested in a subset of these resources. We can filter by HTTP method:</p>\n<pre><code class=\"hljs sh\">jq <span class=\"hljs-string\">&#x27;.log.entries[] | select(.request.method == &quot;GET&quot;) | .request.url&#x27;</span> twitter.com.har</code></pre>\n\n<p>(Note use of select function to select by a predicate)</p>\n<p>Or by extension:</p>\n<pre><code class=\"hljs sh\">jq <span class=\"hljs-string\">&#x27;.log.entries[] | select(.request.url | test(&quot;.js$&quot;)) | .request.url&#x27;</span> twitter.com.har</code></pre>\n\n<p>(Note use of <code>test</code> to create a predicate based on regular expression)</p>\n<p>A better alternative (for well behaved services anyways) for filtering with type of content is to filter by mime type:</p>\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;.log.entries[] | select(.response.content.mimeType == &quot;text/html&quot;) | .request.url&#x27;</span> twitter.com.har\n\n<span class=\"hljs-string\">&quot;https://twitter.com/home&quot;</span>\n\n$ jq <span class=\"hljs-string\">&#x27;.log.entries[] | select(.response.content.mimeType == &quot;application/javascript&quot;) | .request.url&#x27;</span> twitter.com.har\n\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/polyfills.18a65025.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/vendors~main.d0d6d775.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/i18n/en.96bbaf75.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/main.a3119725.js&quot;</span>\n<span class=\"hljs-string\">&quot;https://abs.twimg.com/responsive-web/client-web/ondemand.Dropdown.fa0fef85.js&quot;</span>\n..</code></pre>\n\n<p>If we want to get the first item, we can collect all the results into an array and apply the first filter on it</p>\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;[.log.entries[] | select(.request.url | test(&quot;home\\\\.json&quot;))] | first&#x27;</span> twitter.com.har  | less</code></pre>\n\n<p>(Note the use of <code>[...]</code> to collect the resultset into an array so that we can apply functions (in this case <code>first</code>) that operate on arrays).</p>\n<p>This gives us the first request to home.json</p>\n<h2 id=\"Exploring-response\"><a href=\"#Exploring-response\" class=\"headerlink\" title=\"Exploring response\"></a>Exploring response</h2><p>jq is useful primarily for json.</p>\n<p>So for services returning json we can just use jq to further explore the server response as well.</p>\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;[.log.entries[] | select(.request.url | test(&quot;home\\\\.json&quot;))] | first | .response.content.text&#x27;</span> twitter.com.har</code></pre>\n\n<p>However this gives us a string containing json, so before can apply further filters we&#39;ll have to unwrap this content.</p>\n<pre><code class=\"hljs sh\">$ jq <span class=\"hljs-string\">&#x27;[.log.entries[] | select(.request.url | test(&quot;home\\\\.json&quot;))] | first | .response.content.text | fromjson | .&#x27;</span> twitter.com.har</code></pre>\n\n<p>(Note the use of <code>fromjson</code> to extract the JSON content embedded in the string).</p>\n<p>But for other formats we can forward the result of jq to something else that deal with that format.</p>\n<p>So for instance, if you have <a href=\"https://github.com/sharkdp/bat\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">bat</a> installed, we can do something like this to get syntax highlighted HTML content.</p>\n<pre><code class=\"hljs sh\">$ jq -r <span class=\"hljs-string\">&#x27;[.log.entries[] | select(.response.content.mimeType == &quot;text/html&quot;) ] | first | .response.content.text | @base64d&#x27;</span> twitter.com.har  | bat</code></pre>\n\n<p>Remember our mention above about jq being composable ? jq fits in well with unix philosophy - doing one thing well and making it easy to use with other tools.</p>\n<p>Before we go further, a couple of things to note here:</p>\n<p>In case of twitter, the response from the server is base64 encoded. So we had to use <code>@base64d</code> to decode it. Also we had to pass the <code>-r</code> flag to jq to remove the quotes around the output so that the output is proper HTML.</p>\n<p>We can&#39;t however use the <code>@base64d</code> when the input is not utf8. But fortunately we have a base64 cli utility available for OS X (pre-installed) and most major linux variants which works well with arbitrary content including binary data.</p>\n<p>So we can save some images fetched during the HTTP session to a image files which can then be viewed through any image viewer:</p>\n<pre><code class=\"hljs sh\">$ jq -r <span class=\"hljs-string\">&#x27;[ .log.entries[] | select(.response.content.mimeType == &quot;image/png&quot;) ] | first | .response.content.text&#x27;</span> twitter.com.har | <span class=\"hljs-built_in\">base64</span> --decode &gt; file.png</code></pre>\n\n<p>You can now, for instance, use something like <a href=\"https://github.com/dmtrKovalenko/odiff\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">odiff</a> to compare images from multiple HAR archives and see if they have changed.</p>\n<p>Also, if you are using <a href=\"https://iterm2.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">iterm2</a> and have <a href=\"https://iterm2.com/documentation-images.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">imgcat</a> installed, we can display the images right in the terminal:</p>\n<pre><code class=\"hljs sh\">$ jq -r <span class=\"hljs-string\">&#x27;[ .log.entries[] | select(.response.content.mimeType == &quot;image/png&quot;) ] | first | .response.content.text&#x27;</span> twitter.com.har | <span class=\"hljs-built_in\">base64</span> --decode | imgcat</code></pre>\n\n\n<p><img src=\"/images/Uw4uhn_mK.png\" alt=\"image.png\" loading=\"lazy\"></p>\n<h2 id=\"Summarizing-stats\"><a href=\"#Summarizing-stats\" class=\"headerlink\" title=\"Summarizing stats\"></a>Summarizing stats</h2><p>If you are analyzing HAR files you probably care about size of the paylodas.</p>\n<p>Let&#39;s sort the responses by download size and take the top 10:</p>\n<pre><code class=\"hljs sh\">jq -r <span class=\"hljs-string\">&#x27;[.log.entries[]] | sort_by(.response.content.size) | reverse | .[0:10] | map([.request.url, .response.content.size])&#x27;</span> twitter.com.har</code></pre>\n\n<p>Couple of things here:</p>\n<ul>\n<li>Note the use of <code>sort_by</code> operator to sort results</li>\n<li>This function operates on arrays, so we constructed one using <code>[.log.entries[]]</code> similar to before.</li>\n<li>We use <code>reverse</code> to reverse the array and <code>.[0:10]</code> slice operator to take a slice of first 10 results</li>\n<li>Finally we are not interested in the whole data - just the size and url so we use <code>map</code> to map over the results and extract exactly what we needed.</li>\n</ul>\n<p>We can also generate a CSV from this resultset which you can then preview in your favorite spreadsheet software:</p>\n<pre><code class=\"hljs sh\">jq -r <span class=\"hljs-string\">&#x27;[.log.entries[]] | sort_by(.response.content.size) | reverse | .[0:10] | map([.request.url, .response.content.size]) | [&quot;url&quot;, &quot;size&quot;],  .[] | @csv&#x27;</span> twitter.com.har</code></pre>\n\n<p>Personally I prefer using <a href=\"https://github.com/johnkerl/miller\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">miller</a> for exploring tabular data but that is a topic for another post.</p>\n<p>One thing to note here is that in all of the above examples, we didn&#39;t (need to) use any variables, loops etc. We just applied functional transformations over a stream of json - resulting in succinct and easy to grok code.</p>\n<p>This is one of the things that makes jq such an elegant choice for this kind of work. We do have functions, variables, foreach etc. but for most simple use cases like the ones above we don&#39;t need them.</p>\n<p>This brings us to end of our post. Hope this serves as a quick reference for common one-liners when dealing with jq &amp; har files and points you to the right direction for use-cases not covered above.</p>\n",
            "tags": [
                "HAR",
                "Jq"
            ]
        },
        {
            "id": "https://lorefnon.me/2020/04/17/hash-based-routing-with-react-navi/",
            "url": "https://lorefnon.me/2020/04/17/hash-based-routing-with-react-navi/",
            "title": "Hash based routing with react-navi",
            "date_published": "2020-04-17T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p><a class=\"wp-editor-md-post-content-link\" href=\"https://frontarm.com/navi/\">Navi</a> is an simple and easy-to-use routing solution for React with good support for <a class=\"wp-editor-md-post-content-link\" href=\"https://reactjs.org/docs/concurrent-mode-suspense.html\">suspense</a> and asynchronous data-fetching.</p>\n<p>I generally prefer hash-based routing over push state based routing because it doesnt require any special handling on the server side and works well even with file urls &amp; electron apps. Also, working mostly with intranet applications, SEO is generally not a concern for me.</p>\n<p><span id=\"more-687\"></span></p>\n<p>Thanks to the underlying history library, it is relatively straightforward to use hash-routing with react-navi:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44573abf6514361846\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44573abf6514361846-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573abf6514361846-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573abf6514361846-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573abf6514361846-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573abf6514361846-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44573abf6514361846-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573abf6514361846-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">createHashHistory</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'history'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573abf6514361846-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573abf6514361846-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">history</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">createHashHistory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573abf6514361846-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0025 seconds] -->\n<p></p>\n<p>As the <a class=\"wp-editor-md-post-content-link\" href=\"https://frontarm.com/navi/en/#try-a-live-example\">example</a> in the home page illustrates, we can pass our routes to the <code>mount</code> function:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44573ac0a238133453\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac0a238133453-13\">13</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mount</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'navi'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">mount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hats 'n' Flamethrowers 'r' Us\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">getData</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">api</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fetchProducts</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">view</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Landing</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">'/product'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lazy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./product'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac0a238133453-13\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0020 seconds] -->\n<p></p>\n<p>However instead of passing these routes directly to the <code>&lt;Router&gt;</code> component, wed need to create a navigation that is configured to use our hash-based history.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44573ac11804906234\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac11804906234-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">createBrowserNavigation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'navi'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">navigation</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">createBrowserNavigation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">history</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">routes</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac11804906234-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>And then we can render the Router with this navigation:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44573ac17552680781\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44573ac17552680781-14\">14</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Router</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">View</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'react-navi'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-4\"><span class=\"crayon-v\">ReactDOM</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Router </span><span class=\"crayon-v\">navigation</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">navigation</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Layout</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Suspense </span><span class=\"crayon-v\">fallback</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">View</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-9\"><span class=\"crayon-c\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/S</span><span class=\"crayon-v\">uspense</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Layout</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Router</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'root'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-13\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44573ac17552680781-14\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<p>That is pretty much all thats needed</p>\n\n\n    ",
            "tags": [
                "React",
                "Routing"
            ]
        },
        {
            "id": "https://lorefnon.me/2020/02/02/conditionally-making-optional-properties-mandatory-in-typescript/",
            "url": "https://lorefnon.me/2020/02/02/conditionally-making-optional-properties-mandatory-in-typescript/",
            "title": "Conditionally making optional properties mandatory in typescript",
            "date_published": "2020-02-02T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>A common case in applications is to work with types where certain properties are nullable. However, it is also common to need derived types of these same types which are stricter around nullablity of properties.</p>\n<p>Lets imagine a note taking app: We have a <code>Notebook</code> type where <code>id</code> is nullable because unsaved notebooks havent been assigned an <code>id</code> yet. However after saving it, we know for a fact that a <code>Notebook</code> instance will have an <code>id</code> and ideally we shouldnt have to say <code>notebook.id!</code> in the rest of the application.</p>\n<p>So, in this post we will explore a generic way to derive types like <code>SavedNotebook</code> where certain properties are conditionally mapped to non-optional.</p>\n<p><span id=\"more-681\"></span></p>\n<p>TS comes with a <code>NonNullable</code> type, which essentially strips out <code>null</code> and <code>undefined</code> from any type.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce893c080196261\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce893c080196261-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce893c080196261-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce893c080196261-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce893c080196261-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce893c080196261-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce893c080196261-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">T1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">undefined</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce893c080196261-3\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">T2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NonNullable</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// string</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce893c080196261-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0042 seconds] -->\n<p></p>\n<p>We also have <a class=\"wp-editor-md-post-content-link\" href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html#mapped-types\">mapped types</a> that allow us to map over a type and programmatically derive the type for each key.</p>\n<p>So the following makes all values non-nullable:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce894c519604699\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce894c519604699-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce894c519604699-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce894c519604699-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce894c519604699-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce894c519604699-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce894c519604699-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce894c519604699-2\"><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SavedNotebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce894c519604699-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NonNullable</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce894c519604699-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce894c519604699-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>Now, we can use <a class=\"wp-editor-md-post-content-link\" href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html#conditional-types\">conditional types</a> to make only certain values non-nullable:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce8953823116233\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8953823116233-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8953823116233-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8953823116233-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8953823116233-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8953823116233-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8953823116233-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8953823116233-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce8953823116233-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8953823116233-2\"><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SavedNotebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8953823116233-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8953823116233-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NonNullable</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8953823116233-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8953823116233-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8953823116233-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>Or, a more generic implementation:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce8958257407111\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8958257407111-9\">9</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-2\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MandateProps</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">K</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">keyof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">TK </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">keyof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TK </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">K</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NonNullable</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">TK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">TK</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-8\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SavedNotebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MandateProps</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8958257407111-9\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0014 seconds] -->\n<p></p>\n<p>Our <code>SavedNotebook</code> type will effectively be:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce895d989196490\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce895d989196490-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce895d989196490-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce895d989196490-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce895d989196490-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce895d989196490-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce895d989196490-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce895d989196490-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce895d989196490-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce895d989196490-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce895d989196490-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce895d989196490-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce895d989196490-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">description</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce895d989196490-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce895d989196490-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>Looks good! Are we done then ? It turns out, not quite.</p>\n<p>Lets tweak our <code>Notebook</code> interface a bit:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce8962456978648\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8962456978648-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8962456978648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8962456978648-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8962456978648-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8962456978648-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8962456978648-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8962456978648-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce8962456978648-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8962456978648-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Notebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8962456978648-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8962456978648-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">name</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8962456978648-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">description</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8962456978648-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8962456978648-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n<p>We made the properties optional. Our <code>SavedNotebook</code> type will no longer evaluate to what we expect:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce8966800033072\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8966800033072-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8966800033072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8966800033072-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8966800033072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8966800033072-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8966800033072-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8966800033072-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce8966800033072-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8966800033072-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SavedNotebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8966800033072-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">undefined</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8966800033072-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">name</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">undefined</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8966800033072-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">description</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">undefined</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8966800033072-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8966800033072-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>What happened here ? Wasnt our <code>NonNullable</code> type supposed to take care of <em>both</em> <code>null</code> and <code>undefined</code> ?</p>\n<p>Well, it did, but it turns out typescript treats the following as different cases:</p>\n<ol>\n<li>Whether a key may (or may not) be present in an object type</li>\n<li>Whether the corresponding value may be <code>undefined</code>.</li>\n</ol>\n<p>Mapped types preserve the former, and so our <code>MandateProps</code> is not able to remove the <code>undefined</code> from <code>Notebook[\"id\"]</code>.</p>\n<p>So, what should be do if we do want to make that key mandatory as well ?</p>\n<p>Thankfully typescript allows us to suffix our key with <code>-?</code> while mapping over types to remove optionality.</p>\n<p>But doing that conditionally requires another workaround:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce896b987927910\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce896b987927910-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce896b987927910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce896b987927910-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce896b987927910-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce896b987927910-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce896b987927910-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce896b987927910-2\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MandateProps</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">K</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">keyof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Omit</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">K</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce896b987927910-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">MK </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NonNullable</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">MK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce896b987927910-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce896b987927910-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0012 seconds] -->\n<p></p>\n<p><code>Omit&lt;T, K&gt;</code> retains all the optional keys that we dont care about and gets rid of the keys that are assignable to <code>K</code>. Then we create another type for the keys which match <code>K</code>, and while mapping over them we make the keys not optional. Intersection of the both gives us a type where all keys that are assignable to <code>K</code> are mandatory.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce8971862497170\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8971862497170-9\">9</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SavedNotebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MandateProps</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-4\"><span class=\"crayon-c\">// ^ Is equivalent to:</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-6\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SavedNotebook</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Pick</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Notebook</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"description\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-8\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8971862497170-9\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p>This is pretty much what we want. <code>Omit</code> is internally implemented using <code>Pick</code> and typescript is being lazy about <code>Pick</code>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce8976911642548\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8976911642548-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8976911642548-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce8976911642548-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce8976911642548-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce8976911642548-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Omit</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">K</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Pick</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Exclude</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">keyof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce8976911642548-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba445ce897b353313842\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba445ce897b353313842-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce897b353313842-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba445ce897b353313842-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba445ce897b353313842-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba445ce897b353313842-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SavedNotebook</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// number</span></div><div class=\"crayon-line\" id=\"crayon-5fba445ce897b353313842-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0004 seconds] -->\n<p></p>\n<p>Voila.</p>\n\n\n\n",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/12/10/using-graphql-code-generator-with-authenticated-endpoints/",
            "url": "https://lorefnon.me/2019/12/10/using-graphql-code-generator-with-authenticated-endpoints/",
            "title": "Using graphql-code-generator with authenticated endpoints",
            "date_published": "2019-12-10T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>Dotan Simhas <a class=\"wp-editor-md-post-content-link\" href=\"https://github.com/dotansimha/graphql-code-generator\">graphql-code-generator</a> is a really useful utility to generate integration code from GraphQL APIs for multiple languages.</p>\n<p>As outlined in <a class=\"wp-editor-md-post-content-link\" href=\"https://graphql-code-generator.com/docs/getting-started/codegen-config\">their docs</a>, using the graphql-codegen cli with static config is straightforward:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44630470f051302050\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44630470f051302050-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630470f051302050-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630470f051302050-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44630470f051302050-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44630470f051302050-2\"><span class=\"crayon-v\">graphql</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">codegen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">config</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">yml</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630470f051302050-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0024 seconds] -->\n<p></p>\n<p>This post outlines how to use the code-generator CLI when the API is authenticated.</p>\n<p><span id=\"more-646\"></span></p>\n<p>graphql-codegen uses <a class=\"wp-editor-md-post-content-link\" href=\"https://www.npmjs.com/package/cosmiconfig\">cosmiconfig</a> for loading the configuration. Thanks to cosmiconfig, this configuration can be a dynamic module instead of a static yaml/json file.</p>\n<p>So we can have arbitrary logic inside the module. For instance if our graphql API is protected by HTTP basic auth, we can prompt the user for credentials and send them as a header:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44630471b536280973\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-39\">39</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5fba44630471b536280973-41\">41</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prompts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"prompts\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">promptCredentials</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">prompts</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Enter username\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'password'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Enter password\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-15\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">promptCredentials</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-17\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">overwrite</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">schema</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"http://localhost:9000/graphql\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Authorization</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"Basic \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Buffer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"base64\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">documents</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"components/**/*.graphql\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">generates</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"api/graphql.tsx\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">plugins</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"typescript\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"typescript-operations\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44630471b536280973-41\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0039 seconds] -->\n<p></p>\n<p></p>\n<p>So the next time we run <code>graphql-codegen --config ./path/to/config.js</code> we will be prompted for password.</p>\n<p>You can, of course, also do things like keep the credentials in an uncommitted file and then read them in the config file.</p>\n\n\n    ",
            "tags": [
                "GraphQL"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/11/07/typesafe-tuple-hierarchies-in-typescript/",
            "url": "https://lorefnon.me/2019/11/07/typesafe-tuple-hierarchies-in-typescript/",
            "title": "Type-safe tuple hierarchies in TypeScript",
            "date_published": "2019-11-07T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>I have a love-hate relationship with type safety. Type Checkers can be  amazingly powerful tools when they work and yet can be frustrating every now and then when you hit some unsupported edge case.</p>\n<p>Thankfully more and more of these corners are getting eliminated with the hard work that the typescript team has been putting in.</p>\n<p>One such case that was a PITA was support (or lack thereof) for recursive types in TypeScript.</p>\n<p><span id=\"more-638\"></span></p>\n<p>Lets say you despise XML/JSX and want to express User interface composition as a composition of tuples.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf48879040309\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf48879040309-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf48879040309-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf48879040309-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf48879040309-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf48879040309-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf48879040309-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf48879040309-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf48879040309-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ui</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf48879040309-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"container\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf48879040309-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf48879040309-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf48879040309-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0043 seconds] -->\n<p></p>\n<p>if you are coming from any of lisp-family languages you are probably already habituated to s-expressions for composing interfaces. <a href=\"https://github.com/weavejester/hiccup\">Hiccup</a>, for instance, is a cool<br>\ntemplating language that utilizes s-expressions for consize boilerplate-free template composition.</p>\n<p>So, now, how do we make this type safe.</p>\n<p>Lets try the obvious approach:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf6e735348334\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf6e735348334-16\">16</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-2\"><span class=\"crayon-c\">// Registry of tags and supported attributes</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-3\"><span class=\"crayon-c\">// Simplified for brevity</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-4\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementAttrs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"span\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-13\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-15\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf6e735348334-16\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0019 seconds] -->\n<p></p>\n<p>Until the last stable version of typescript this would have failed because recursive type aliases were not well supported. So wed be greeted with an error:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf76968424678\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf76968424678-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf76968424678-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf76968424678-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf76968424678-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">lt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"span\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"span\"</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">gt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">any</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf76968424678-2\"><span class=\"crayon-e\">Type </span><span class=\"crayon-i\">alias</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ElementTuple'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">circularly </span><span class=\"crayon-e\">references </span><span class=\"crayon-v\">itself</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf76968424678-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>Hmm let us see if we can use utilize the typical trick of using interfaces to work around this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf7c211814569\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf7c211814569-18\">18</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementAttrs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"span\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-11\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-13\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf7c211814569-18\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0022 seconds] -->\n<p></p>\n<p>This indeed seems to work:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf81046550299\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf81046550299-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf81046550299-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf81046550299-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf81046550299-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf81046550299-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf81046550299-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> t1:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf81046550299-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> t2:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"di\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf81046550299-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>TS complains that the second assignment is not valid because:</p>\n<blockquote><p>\n  Type di is not assignable to type div | span.\n</p></blockquote>\n<p>There is a caveat though:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf88200281863\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf88200281863-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf88200281863-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf88200281863-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf88200281863-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf88200281863-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> t1:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"junk\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf88200281863-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>This passes too !</p>\n<p>Why doesnt TypeScript complain ? Because our interface just cares about 0|1|2 indexes. If our tuple has other irrelevant things at other indexes, it doesnt matter  it still satisfies the ElementTuple interface.</p>\n<p>This is a problem for us if we want to support a variable arity tuples for convenience:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf8e227778586\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf8e227778586-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf8e227778586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf8e227778586-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf8e227778586-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf8e227778586-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf8e227778586-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf8e227778586-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf8e227778586-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf8e227778586-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Attributes can be skipped if not needed</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf8e227778586-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf8e227778586-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Both attributes and children skipped</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf8e227778586-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf8e227778586-6\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf8e227778586-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>In such cases, typescripts inference can fallback to type that matches some index and ignore the other indexes (having erroneous values). This can compromise with type safety:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf93566686331\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf93566686331-31\">31</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element1Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-6\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-11\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementChildren2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-15\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-16\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element3Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-21\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-22\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element1Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementChildren2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element3Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-27\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-28\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> t:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bar\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf93566686331-31\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0044 seconds] -->\n<p></p>\n<p>This passes without hiccups ! Why does TypeScript allow random attributes for a div ? Because the nested array cant match the <code>ElementAttrs2Tuple</code> but can match <code>Element1Tuple</code> so TS doesnt complain.</p>\n<p>Lets see, if we can do something to restrict the other index positions:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf99905042116\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf99905042116-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element3Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Exclude</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf99905042116-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0031 seconds] -->\n<p></p>\n<p>Nope. This doesnt work because:</p>\n<blockquote><p>\n  An index signature parameter type cannot be a type alias.\n</p></blockquote>\n<p>Fortunately, there is a simpler solution to this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467baf9e773358317\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467baf9e773358317-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Element3Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementAttrs</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467baf9e773358317-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0023 seconds] -->\n<p></p>\n<p>We really just need care about the last position. Because an attempt to create an array literal with anything at index 3 will fail to match Element3Tuple (including undefined, null etc.) So the array size has to match exactly 3.</p>\n<p>We can extend this to the other tuple definitions:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467bafa3489130101\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafa3489130101-34\">34</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element1Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-7\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-13\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementChildren2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-19\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Element2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementChildren2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-23\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element3Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-28\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-29\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-30\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element1Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element2Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Element3Tuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafa3489130101-34\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0084 seconds] -->\n<p></p>\n<p>Note that the trailing <code>never</code> property has to always be optional otherwise we will end up with a type that is impossible to match.</p>\n<p>The element tuple that we have now is very close to what we wanted. Go ahead, try it out in the <a href=\"http://www.typescriptlang.org/play/?ts=3.6.3&amp;ssl=48&amp;ssc=25&amp;pln=45&amp;pc=1#code/JYOwLgpgTgZghgYwgAgKIBsIFsLgIJhhQDOyA3sgLABQydyARACbABuDAXOTfb8sEwD8XYkVABzHvQC+AGil0GxAA5wQnbrT50Bw5KKgSFyaTVPUaYAJ7KUGbLjAAVOOOQBeZAGsIVgPYwaJg4+IQkANw0NKCQsIh2wY4AjE4ArsqYADxOyBAAHpAgTKT2Ic6uHkEO4C7iAHyavADaAAwAulxOkVp0TUlteiAQrNDd5tHg0PBIVWUERMQATGkZENm5BbjFs461laW7rg1kxq0dyF2n-VwHoQtNTm3dzYsDXEMjUGNR1DFT8TtwABhAAWwHQTCguGW6SyOXyhW2t3Kbk8yNqx1O7U6z3ofXO6NhECaT1Or0Gw1GZh+1lsgLAMNW6wRWxKiRqFTR7JRDXcxgAPvT5iRGXC6gL6aDwZDoSsxd0JrFpglqmAAMxytbwzZFNmqvZc-VHRp47EXXG9a5CsLEB6knrIJqvG7czUki2OtVvZAfKnUcbUWkqsqa5k6pGuzn0jEeCXIlJE7Lih2C5GirXJ3ip7kaxNOZM0BB+ECiZBgF36omxh1NZhsBiyR3GZp19iNigCLgMABGcCgDBMjaaze0jtbDDak8n4SAA\">playground</a>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467bafab482024145\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafab482024145-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafab482024145-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafab482024145-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafab482024145-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafab482024145-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467bafab482024145-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> t:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafab482024145-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafab482024145-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bar\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafab482024145-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"div\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafab482024145-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<p>While this may be cool if you like fiddling around the edges of type systems, we have to admit that though we worked around the limitations of typescript, what we ended up with is neither elegant nor intuitive.</p>\n<p>However, with TypeScript 3.7, these workarounds are no longer needed ! Recursive types are fully supported now. This means, we can simply do:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4467bafb2135116150\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafb2135116150-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafb2135116150-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafb2135116150-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafb2135116150-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafb2135116150-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafb2135116150-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4467bafb2135116150-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4467bafb2135116150-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4467bafb2135116150-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafb2135116150-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafb2135116150-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafb2135116150-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafb2135116150-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementAttrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ElementTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4467bafb2135116150-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0045 seconds] -->\n<p></p>\n<p>Cool, consize and minimal. Works <a href=\"http://www.typescriptlang.org/play/?ssl=21&amp;ssc=25&amp;pln=1&amp;pc=1#code/JYOwLgpgTgZghgYwgAgKIBsIFsLgIJhhQDOyA3sgLABQydyARACbABuDAXOTfb8sEwD8XYkVABzHvQC+AGil0GxAA5wQnbrT50Bw5KKgSFyaTVPUaYAJ7KUGbLjAAVOOOQBeZAGsIVgPYwaJg4+IQkANw0ljZ2wY5OAK7KmAA8TsgQAB6QIEyk9iHOrh5BDuAu4gB8HsYAPsgA2k4AunWNTrKlhQRExE3NrVp09U2dBfFJmA0DbaNdjj0k-WNx5ZMQ082RFtQIfiCiyGBc42vJKO7GDcxsDJ0NxrzXLOydFAJcDABGcFAMJvdHtpGjd2ANweEgA\">too</a> !</p>\n\n\n    ",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/08/18/deriving-interfaces-from-classes-in-typescript/",
            "url": "https://lorefnon.me/2019/08/18/deriving-interfaces-from-classes-in-typescript/",
            "title": "Deriving interfaces from classes in TypeScript",
            "date_published": "2019-08-18T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>Most object oriented programming languages encourage the pattern of <a class=\"wp-editor-md-post-content-link\" href=\"https://tuhrig.de/programming-to-an-interface/\">Programming to an interface</a>. TypeScript supports this of course, you can create one or more interfaces, and then define classes (or factories) that generate instances of this interface.</p>\n<p>However, as the linked article above points out, programming to an interface is sometimes overused when the programmer anticipates the possibility of multiple concrete implementations in future although there may exist just one at the time of implementation.</p>\n<p>But, until these multiple implementations are actually required, these single-implementation interfaces continue to increase maintenance overhead, because every time we need to introduce a new member, we need to modify two places. Sure, the tooling helps with this but it still not ideal.</p>\n<p>Also, relying on just the concrete implementation is not ideal because TypeScript compiler service doesnt yet have a good mechanism to bulk-replace all usage of a concrete implementation with the corresponding interface should we need multiple implementations in future.</p>\n<p>So, in this post we explore two features of typescript that may help us with this.<br>\n<span id=\"more-622\"></span></p>\n<h1>Interfaces derived from classes</h1>\n<p>A lesser known feature of TypeScript is that interfaces can be derived from classes.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4468f1d79369408977\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d79369408977-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d79369408977-2\">2</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4468f1d79369408977-1\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SyncBackend</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FSSyncBackend</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d79369408977-2\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0026 seconds] -->\n<p></p>\n<p>It may seem like a no-brainer that this is a solution for our use case. But there is an important caveat: All private/protected members of the implementation are exposed in the derived interface.</p>\n<p>If you are surprised by this, you wouldnt be alone. I found it highly counter-intuitive when I encountered it first, but the rationale behind this is explained in the <a class=\"wp-editor-md-post-content-link\" href=\"https://www.typescriptlang.org/docs/handbook/interfaces.html\">official docs</a>:</p>\n<blockquote><p>\n  When an interface type extends a class type it inherits the members of the class but not their implementations. It is as if the interface had declared all of the members of the class without providing an implementation. Interfaces inherit even the private and protected members of a base class. This means that when you create an interface that extends a class with private or protected members, that interface type can only be implemented by that class or a subclass of it.</p>\n<p>  This is useful when you have a large inheritance hierarchy, but want to specify that your code works with only subclasses that have certain properties. The subclasses dont have to be related besides inheriting from the base class.\n</p></blockquote>\n<p>So, that is all good, but if we want just the public members, what do we do ?<br>\nThankfully a simple solution exists:</p>\n<h1>Using Mapped types</h1>\n<p>We can use <a class=\"wp-editor-md-post-content-link\" href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-1.html\">mapped types</a> derived from public members of a type.</p>\n<p>Since a class definition is implicitly a type definition, this works well for classes too:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4468f1d87855263947\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d87855263947-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d87855263947-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d87855263947-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d87855263947-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4468f1d87855263947-1\"><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SyncBackend</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d87855263947-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">K</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">FSSyncBackend</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FSSyncBackend</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">K</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d87855263947-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d87855263947-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>Now <code>SyncBackend</code> type will have only public members of <code>FSSyncBackend</code> class.</p>\n<p>While for most uses this solves our purpose, but if we strictly need an interface &amp; not an alias (perhaps to improve type error messages), we can simply define an interface that extends from this alias:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4468f1d8b787760405\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d8b787760405-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d8b787760405-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d8b787760405-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d8b787760405-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d8b787760405-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4468f1d8b787760405-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4468f1d8b787760405-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SyncBackend</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d8b787760405-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">K</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">FSSyncBackend</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FSSyncBackend</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">K</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d8b787760405-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d8b787760405-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d8b787760405-5\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SyncBackend</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SyncBackend</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4468f1d8b787760405-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>Eventually if we do need multiple implementations, we can choose to either have an explicitly defined interface or keep one implementation as the canonical implementation, derive the interface from it and make the other implementations comply to that.</p>\n<p>I usually resort to the latter when the other implementations are not for public consumption and exist just for stubbing in test cases.</p>\n<p>If multiple implementations are actually exposed then the former solution (explicitly defined interface) helps with separating the API documentation of the interface from the documentation of individual implementations.</p>\n\n\n    ",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/08/15/dealing-with-circular-type-references-in-mobx-state-tree/",
            "url": "https://lorefnon.me/2019/08/15/dealing-with-circular-type-references-in-mobx-state-tree/",
            "title": "Dealing with circular type references in Mobx-state-tree",
            "date_published": "2019-08-15T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>A frequently occuring issue when creating interrelated MST models, is that of circular type references.</p>\n<p>Usually we dont dont have to explicitly define interfaces for our models, because they can be inferred for us through the APIs exposed by MST. However, when defining models that depend on each other, this falls short because TypeScripts type-inference is not good enough to circular dependencies.</p>\n<p>For example, lets say we have a note taking application with <code>Snippet</code> and <code>Annotation</code> models. A <code>Snippet</code> can have many <code>Annotation</code>s and every <code>Annotation</code> belongs to exactly one <code>Snippet</code>.</p>\n<p>Our first stab might be something like this:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9a9679920934\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9a9679920934-23\">23</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-2\"><span class=\"crayon-c\">// models/Snippet.ts</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-4\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">types </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mobx-state-tree\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-5\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">v4 </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">uuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"uuid\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-6\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Annotation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./Annotation\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-8\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Snippet\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optional</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-11\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-13\"><span class=\"crayon-c\">// models/Annotation.ts</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-15\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">types </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mobx-state-tree\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-16\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">v4 </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">uuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"uuid\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-17\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./Snippet\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-19\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Annotation\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optional</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">snippet</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reference</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-22\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9a9679920934-23\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0073 seconds] -->\n<p></p>\n<p>However, this will not work out well because of the aforementioned issue with circular dependency, and we will get following error:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9bd558713277\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9bd558713277-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9bd558713277-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9bd558713277-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9bd558713277-1\"><span class=\"crayon-s\">'Snippet'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implicitly </span><span class=\"crayon-e\">has </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'any'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">because </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">have</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type </span><span class=\"crayon-e\">annotation </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">referenced </span><span class=\"crayon-e\">directly </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">indirectly </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">its </span><span class=\"crayon-e\">own </span><span class=\"crayon-v\">initializer</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9bd558713277-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9bd558713277-3\"><span class=\"crayon-s\">'Annotation'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implicitly </span><span class=\"crayon-e\">has </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'any'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">because </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">have</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type </span><span class=\"crayon-e\">annotation </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">referenced </span><span class=\"crayon-e\">directly </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">indirectly </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">its </span><span class=\"crayon-e\">own </span><span class=\"crayon-v\">initializer</span><span class=\"crayon-sy\">.</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0014 seconds] -->\n<p></p>\n<p>We would want to resolve this, but at the same time, use the automatic inference as much as possible so we dont have to define the entire model type ourselves.</p>\n<p>MST allows us to define our models in multiple stages:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9c3787886264\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c3787886264-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c3787886264-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c3787886264-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c3787886264-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c3787886264-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c3787886264-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c3787886264-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c3787886264-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Snippet\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c3787886264-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optional</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c3787886264-3\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c3787886264-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c3787886264-5\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1.props</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c3787886264-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c3787886264-7\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0019 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>This split is not arbitrary. While we havent quite solved the problem yet, but we note that for <code>Snippet$1</code> our model types can be inferred as there are no circular references there.</p>\n<p>The idea is to augment the inferred type of <code>Snippet$1</code> model with a manual specification of types of attributes which cause circular reference.</p>\n<p>Before we start on that, lets take a step back and reflect on following two facts we can leverage:</p>\n<ol>\n<li>TypeScript interfaces can have circular references. While inferred types and type aliases are eager resolved (atleast as of this writing), interfaces can have mutual dependencies.<p></p>\n</li>\n<li>\n<p>The type of an MST model is <code>IType&lt;ISnapshotInType, ISnapshotOutType, IInstanceType&gt;</code> where:</p>\n<ol>\n<li><code>ISnapshotInType</code> is what we can pass to <code>Model.create</code>.</li>\n<li><code>ISnapshotOutType</code> is what we get back in <code>onSnapshot</code> hook.</li>\n<li><code>IInstanceType</code> is the type of the model instances.</li>\n</ol>\n</li>\n</ol>\n<p>So for our case, if we were not using MST, we would have defined an <code>ISnippet</code> interface something like:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9c9118492127\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c9118492127-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c9118492127-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c9118492127-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9c9118492127-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c9118492127-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c9118492127-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c9118492127-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9c9118492127-4\"><span class=\"crayon-sy\">&#125;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>We can still do that, but the idea of this post is to avoid duplication of type definitions as much as possible because in real applications we would have many more attributes, and we wouldnt want to keep them in sync across MST models and manually defined instance types.</p>\n<p>If you are wondering why <code>ISnapshotInType</code> and <code>ISnapshotOutType</code> can be different, the answer is right there above. Our model has id as an optional attribute with a factory function for supplying default values. So in our <code>ISnapshotInType</code> for Snippet (lets call it <code>ISnippetSnapshotIn</code>), id will be optional, but in the outgoing snapshot type it will always be present.</p>\n<p>MST also supports <a class=\"wp-editor-md-post-content-link\" href=\"https://github.com/mobxjs/mobx-state-tree#lifecycle-hooks-for-typesmodel\">pre-process and post-process hooks</a> and when using them our incoming and outgoing snapshot types will often diverge.</p>\n<p>MST also allows us to extract<sup><a href=\"#extract-types\" id=\"extract-types-back\">[1]</a></sup> out the Snapshot types and Instance types for cases where inference is possible.</p>\n<p>So <code>Instance&lt;typeof Snippet$1&gt;</code> gives us the Instance type of <code>Snippet$1</code> model which is basically <code>&#123; id: string &#125;</code>.<br>\nSimilarly we can extract out <code>SnapshotIn&lt;typeof Snippet$1&gt;</code> and <code>SnapshotOut&lt;typeof Snippet$1&gt;</code> which are the incoming and outgoing snapshot types respectively.</p>\n<p>So, armed with above insights, lets us augment the extracted types from <code>Snippet$1</code> with the additional attributes we need for our <code>Snippet</code> model:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9cf416703410\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9cf416703410-21\">21</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Snippet\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optional</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-3\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-5\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Instance</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotation</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-7\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-9\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippetSnapshotIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotIn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationSnapshotIn</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-11\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-13\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippetSnapshotOut</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotOut</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationSnapshotOut</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-15\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-17\"><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ISnippetRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ISnippetSnapshotIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ISnippetSnapshotOut</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ISnippet</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-19\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> Snippet:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ISnippetRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1.props</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9cf416703410-21\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0041 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>Similarly, for <code>Annotation</code>:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9d5863581117\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9d5863581117-21\">21</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Annotation\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optional</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-3\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-5\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotation</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Instance</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Annotation</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">snippet</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ISnippet</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-7\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-9\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotationSnapshotIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotIn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Annotation</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">snippet</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReferenceIdentifier</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-11\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-13\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotationSnapshotOut</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotOut</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Annotation</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">snippet</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReferenceIdentifier</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-15\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-17\"><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">IAnnotationRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">IAnnotationSnapshotIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationSnapshotOut</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotation</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-19\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> Annotation:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1.props</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">snippet</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reference</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9d5863581117-21\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0033 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>This solves our problem and we can conclude here, but I wanted to take this opportunity to highlight a potential caveat with the above implementation.</p>\n<p>Lets say we decide to add a <code>title</code> field to our <code>Snippet</code> model, and we accidentally add it to <code>Snippet</code>:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9db958078312\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9db958078312-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9db958078312-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9db958078312-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9db958078312-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9db958078312-1\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> Snippet:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ISnippetRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1.props</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9db958078312-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9db958078312-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9db958078312-4\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>Because we arent using the inferred type from <code>Snippet</code> and we havent manually updated the types of <code>ISnippet</code>, <code>ISnippetSnapshotIn</code> and <code>ISnippetSnapshotOut</code>, we will run into an error when we try to create a snippet with a title:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9e0705144719\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9e0705144719-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9e0705144719-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">&#123;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"foo\"</span><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>Above code fails with:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9e5319533974\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9e5319533974-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9e5319533974-2\">2</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9e5319533974-1\"><span class=\"crayon-e\">Argument </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&#123; title: string; &#125;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assignable </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parameter </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ISnippetSnapshotIn'</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9e5319533974-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">literal </span><span class=\"crayon-e\">may </span><span class=\"crayon-e\">only </span><span class=\"crayon-e\">specify </span><span class=\"crayon-e\">known </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'title'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">exist </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ISnippetSnapshotIn'</span><span class=\"crayon-sy\">.</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p>So, yeah we have type-safety and the type-error points us to the correct direction but we got that error only after we tried to instantiate <code>Snippet</code> with a title and nothing before then.</p>\n<p>One might wonder what if we could make such a mistake impossible to make in the first place.</p>\n<p>The solution, as <a class=\"wp-editor-md-post-content-link\" href=\"https://stackoverflow.com/questions/47124309/how-to-declaratively-enforce-compatibility-of-types\">suggested</a> by SO user <a class=\"wp-editor-md-post-content-link\" href=\"https://stackoverflow.com/users/2887218/jcalz\">jcalz</a> is through witness types which exist solely to check compatibility of types:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9ea404796817\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ea404796817-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ea404796817-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ea404796817-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ea404796817-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ea404796817-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ExtendsWitness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">U</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">U</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ea404796817-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>Now to take advantage of the <code>ExtendsWitness</code> we can update our <code>Snippet</code> model such that instead of specifying the type of <code>Snippet</code> we just explicitly substitute the parts causing circular dependency with <code>any</code>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9ef551857959\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ef551857959-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ef551857959-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ef551857959-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ef551857959-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ef551857959-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ef551857959-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ef551857959-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ef551857959-2\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1.props</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ef551857959-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ef551857959-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ef551857959-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ef551857959-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p>We dont have a type error because the function passed to <code>t.late</code> explicitly returns <code>any</code>.</p>\n<p>Now, lets define witness types for the types extracted from <code>Snippet</code> (which is possible because our use of <code>any</code> has eliminated the circular dependency issue):</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9f4092753155\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9f4092753155-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9f4092753155-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9f4092753155-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9f4092753155-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9f4092753155-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9f4092753155-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">_ISnippetSnapshotInWitness</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExtendsWitness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ISnippetSnapshotIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SnapshotIn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9f4092753155-3\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">_ISnippetSnapshotOutWitness</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExtendsWitness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ISnippetSnapshotOut</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SnapshotOut</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9f4092753155-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>Our compiler will now start complaining about that title:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9f9320088353\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9f9320088353-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9f9320088353-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9f9320088353-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9f9320088353-1\"><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ISnippetSnapshotOut'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">satisfy </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">constraint</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ModelSnapshotType&lt;{ id: IOptionalIType&lt;ISimpleType&lt;string&gt;, [undefined]&gt;; } &amp; { annotations: IArrayType&lt;any&gt;; title: ISimpleType&lt;string&gt;; }&gt;'</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9f9320088353-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9f9320088353-3\"><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ISnippetSnapshotOut'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">satisfy </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">constraint</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ModelSnapshotType&lt;{ id: IOptionalIType&lt;ISimpleType&lt;string&gt;, [undefined]&gt;; } &amp; { annotations: IArrayType&lt;any&gt;; title: ISimpleType&lt;string&gt;; }&gt;'</span><span class=\"crayon-sy\">.</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>Note that the order of types here is important, because <code>ExtendsWitness&lt;SnapshotIn&lt;typeof Snippet&gt;, ISnippetSnapshotIn&gt;</code> will happily pass. We need to ensure that what we are extracting after any-substitution remains a subtype of what we are declaring as our final type.</p>\n<p>The reported errors will go away when we move our title from <code>Snippet</code> to <code>Snippet$1</code>:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3b9ff939225499\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3b9ff939225499-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Snippet\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optional</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-4\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-6\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1.props</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3b9ff939225499-8\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0018 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>If we define a similar witness type for <code>ISnippet</code> we will encounter another error:</p>\n<p><code>type _ISnippetWitness = ExtendsWitness<isnippet, instance<typeof=\"\" snippet=\"\">&gt;;</isnippet,></code></p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3ba04228311725\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba04228311725-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba04228311725-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba04228311725-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba04228311725-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba04228311725-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3ba04228311725-1\"><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ISnippet'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">satisfy </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">constraint</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ModelInstanceTypeProps&lt;&#123; id: IOptionalIType&lt;ISimpleType&lt;string&gt;, [undefined]&gt;; title: ISimpleType&lt;string&gt;; &#125; &amp; &#123; annotations: IArrayType&lt;any&gt;; &#125;&gt; &amp; IStateTreeNode&lt;IModelType&lt;&#123; id: IOptionalIType&lt;ISimpleType&lt;string&gt;, [...]&gt;; title: ISimpleType&lt;...&gt;; &#125; &amp; &#123; ...; &#125;, &#123;&#125;, _NotCustomized, _NotCustomized&gt;&gt;'</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba04228311725-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ISnippet'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assignable </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ModelInstanceTypeProps&lt;&#123; id: IOptionalIType&lt;ISimpleType&lt;string&gt;, [undefined]&gt;; title: ISimpleType&lt;string&gt;; &#125; &amp; &#123; annotations: IArrayType&lt;any&gt;; &#125;&gt;'</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba04228311725-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">Types </span><span class=\"crayon-e\">of </span><span class=\"crayon-m\">property</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'annotations'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">are </span><span class=\"crayon-v\">incompatible</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba04228311725-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'IAnnotation[]'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assignable </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'IMSTArray&lt;any&gt; &amp; IStateTreeNode&lt;IArrayType&lt;any&gt;&gt;'</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba04228311725-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'IAnnotation[]'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">missing </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">following </span><span class=\"crayon-e\">properties </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'IMSTArray&lt;any&gt;'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spliceWithArray</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">observe</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">intercept</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">clear</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">more</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2344</span><span class=\"crayon-sy\">]</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0020 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>This happens because our manually defined instance type <code>ISnippet</code> uses a plain array where in the instance we would actually have an <code>IMSTArray</code> which <a class=\"wp-editor-md-post-content-link\" href=\"https://en.wikipedia.org/wiki/Duck_typing\">quacks like</a> an array, but is also MST aware (handles references, snapshot types etc.) and obsevervable.</p>\n<p>So we can update our <code>ISnippet</code> implementation to use an <code>IMSTArray</code>:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3ba0b862130930\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba0b862130930-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba0b862130930-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba0b862130930-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3ba0b862130930-1\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Instance</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba0b862130930-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IMSTArray</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">IAnnotationRunType</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba0b862130930-3\"><span class=\"crayon-sy\">&#125;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>So the witnesses potentially safeguards against hard(-er) to debug errors at invocation sites by identifying them close to the definition site itself.</p>\n<p>However, when we added witness types we removed our augmented type annotation from Snippet (<code>export const Snippet: ISnippetRunType = ...</code> to <code>export const Snippet = ...</code>). While this enabled us to add witnesses for the types derived from <code>Snippet</code>, these derived types have strictly less information than <code>ISnippetRunType</code> and so when exporting we would want to export a model of type <code>ISnippetRunType</code>:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3ba10153273011\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba10153273011-23\">23</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-1\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Instance</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IMSTArray</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">IAnnotationRunType</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-3\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-5\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippetSnapshotIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotIn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationSnapshotIn</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-7\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-9\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippetSnapshotOut</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotOut</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationSnapshotOut</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-11\"><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-13\"><span class=\"crayon-e\">export </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippetRunType </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ISnippetSnapshotIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ISnippetSnapshotOut</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ISnippet</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-15\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1.props</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">annotations</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-17\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-19\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">_ISnippetSnapshotInWitness</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExtendsWitness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ISnippetSnapshotIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SnapshotIn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-20\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">_ISnippetSnapshotOutWitness</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExtendsWitness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ISnippetSnapshotOut</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SnapshotOut</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-21\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">_ISnippetWitness</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExtendsWitness</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ISnippet</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Instance</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba10153273011-23\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> Snippet:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ISnippetRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0039 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>Note that we have also replaced the previous type alias (ISnippetRunType) with an interface which we can use as the return types of <code>t.late</code> (because interfaces can have cyclic dependencies).</p>\n<p>We could do exactly the same thing for <code>Annotation.ts</code>, but we can do better.</p>\n<p>We can further take advantage of the fact that interfaces can have cyclic-dependencies to reduce the boilerplate in <code>Annotation.ts</code> to the extent that we wont even need the intermediate type <code>Annotation$1</code>:</p>\n<p><code></code></p><code>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba446a3ba17417090421\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba446a3ba17417090421-12\">12</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-1\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Annotation</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Annotation\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optional</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">snippet</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reference</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">late</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ISnippetRunType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Snippet</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-4\"><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-6\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotation</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Instance</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Annotation</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#125;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-8\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotationSnapshotIn</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotIn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Annotation</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-10\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotationSnapshotOut</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SnapshotOut</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Annotation</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#125;</span></div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-11\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba446a3ba17417090421-12\"><span class=\"crayon-e\">export </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotationRunType </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">IAnnotationSnapshotIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IAnnotationSnapshotOut</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IAnnotation</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#123;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">&#125;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0055 seconds] -->\n<p></p>\n</code><p><code></code></p>\n<p>Obviously we cant do this for both <code>Snippet</code> and <code>Annotation</code> because TypeScript will not allow us to define a type such that its definition will use itself.</p>\n<p>So with this, we are finally done .</p>\n<hr>\n<p><sup><a href=\"#extract-types-back\" id=\"extract-types\">[1]</a></sup> My <a class=\"wp-editor-md-post-content-link\" href=\"/2018/07/18/unwrapping-composite-types-in-typescript/\">post on unwrapping composite types</a> goes into more detail around TypeScript features that enable us to extract out types of members of a composite type.</p>\n<p>PS: Youd note that we had to write quite a bit of boilerplate to ensure type-safety. I am writing an inline code-generator called <a class=\"wp-editor-md-post-content-link\" href=\"https://github.com/lorefnon/InGenR\">InGenR</a> that helps with automating this kind of thing using code-generation. If this interests you Id be more than happy to receive feedback and contributions.</p>\n\n\n    ",
            "tags": [
                "Typescript",
                "MobX",
                "MobX-State-Tree"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/08/11/enforcing-runtime-validations-at-compile-time-in-typescript/",
            "url": "https://lorefnon.me/2019/08/11/enforcing-runtime-validations-at-compile-time-in-typescript/",
            "title": "Enforcing runtime validations at compile time in TypeScript",
            "date_published": "2019-08-11T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>The title may sound something like an oxymoron, so perhaps some clarification is needed.</p>\n<p>I freqently deal with operations against databases. When I mention that I increasingly prefer using a functional style, in particular, using a query builder directly as opposed to an ORM  one of the primary concerns brought up by people is that ORMs can ensure that data validations are performed for every operation that performs a mutation against the data source.</p>\n<p>This post is not much of a rant against ORMs. It is a practical outline of how we can utilize types to ensure (at compile time) that our data access layer only allows validated data. Even if the actual validation happens at runtime.</p>\n<p><span id=\"more-582\"></span></p>\n<p>Lets say we have a <code>User</code> type:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471174ce777419878\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471174ce777419878-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174ce777419878-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174ce777419878-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174ce777419878-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174ce777419878-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174ce777419878-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471174ce777419878-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174ce777419878-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174ce777419878-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174ce777419878-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">email</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174ce777419878-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174ce777419878-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0027 seconds] -->\n<p></p>\n<p>Now assume that we have a function <code>enrollUser</code> where we only want to allow valid users. If our function takes a <code>User</code> object:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471174da405233932\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471174da405233932-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174da405233932-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174da405233932-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174da405233932-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174da405233932-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471174da405233932-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174da405233932-2\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">enrollUser</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174da405233932-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... enrollment logic</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174da405233932-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174da405233932-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>In the above, it is possible for this function to be called with either a valid or an invalid user and it is up to consumers invoking this function to ensure that this is called after validating, which can be error prone in larger applications.</p>\n<p>So, lets try to enforce at the type level that this function will only consume valid users. We can do something like:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471174de983989256\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471174de983989256-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174de983989256-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174de983989256-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174de983989256-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174de983989256-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174de983989256-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174de983989256-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471174de983989256-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174de983989256-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Valid</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_isValid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174de983989256-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174de983989256-4\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">enrollUser</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Valid</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">User</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174de983989256-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... enrollment logic</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174de983989256-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174de983989256-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p>Now, our validator functions will have to tell the compiler that a user is indeed valid:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471174e2193180767\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e2193180767-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e2193180767-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e2193180767-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e2193180767-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e2193180767-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e2193180767-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e2193180767-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471174e2193180767-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174e2193180767-2\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validateUser</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Valid</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">User</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e2193180767-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">match</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">^</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">S</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">S</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">$</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e2193180767-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// (Don't use that regex in real applications).</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e2193180767-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e2193180767-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e2193180767-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0014 seconds] -->\n<p></p>\n<p><code>validateUser</code> here acts as <a class=\"wp-editor-md-post-content-link\" href=\"https://basarat.gitbooks.io/typescript/docs/types/typeGuard.html\">type-guard</a> telling the compiler if the user complies to <code>Valid&lt;User&gt;</code> type.</p>\n<p>So, now if we try to invoke enrollUser with a user that has not been validated we will get an error:</p>\n<p><img src=\"/wp-content/uploads/2019/08/enrolluser.png\" alt=\"\"></p>\n<p>But if we validate it first, the error goes away:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471174e5655426667\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e5655426667-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e5655426667-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e5655426667-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e5655426667-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e5655426667-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471174e5655426667-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174e5655426667-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">validateUser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e5655426667-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">enrollUser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e5655426667-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e5655426667-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>There is one caveat with this approach though:</p>\n<p>Our type-guard is lying to the compiler and the compiler believes that lie unconditionally:</p>\n<p><img src=\"/wp-content/uploads/2019/08/userisvalidproperty.png\" alt=\"\"></p>\n<p>Here TypeScript is telling us that we have an <code>_isValid</code> property in user but that is not exactly true, because that property will not be present at runtime. So if someone comes to rely on a runtime check on that property, the check will fail at runtime. So effectively we have traded possibility of one runtime fault for another.</p>\n<p>We can do a couple of things to prevent this. The obvious one is to actually have a <code>_isValid</code> property in the object. Or to wrap the type of objects being validated (so that the primary record type can be directly serialized):</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471174e8354605648\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174e8354605648-9\">9</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Validated</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TTarget</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TValid</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TTarget</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">isValid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TValid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-7\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Valid</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TTarget</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Validated</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TTarget</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-8\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Invalid</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TTarget</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Validated</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TTarget</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174e8354605648-9\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0015 seconds] -->\n<p></p>\n<p>However, ff we dont want any runtime overhead at all, instead of a string property we can use a <a class=\"wp-editor-md-post-content-link\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol\">symbol</a>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471174eb758520154\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471174eb758520154-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174eb758520154-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174eb758520154-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174eb758520154-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471174eb758520154-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471174eb758520154-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174eb758520154-2\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> isValid:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unique </span><span class=\"crayon-v\">symbol</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174eb758520154-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471174eb758520154-4\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Valid</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">isValid</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471174eb758520154-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>The benefit of using a symbol is that, as long as this symbol is not exported from the containing module or namespace, it will not be possible to use it at runtime. <a class=\"wp-editor-md-post-content-link\" href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-7.html\">TypeScript 2.7 release announcements</a> go into more details on type level treatment of unique symbols.</p>\n<p>No other symbol (even if they have the same name) will be equal to this symbol. This will hold true even if <code>Symbol</code> is polyfilled.</p>\n<p><img src=\"/wp-content/uploads/2019/08/symbolduplicate.png\" alt=\"\"></p>\n<p>TypeScript autocompletion will not show this as a completion candidate, eliminating the possibility of accidental usage:</p>\n<p><img src=\"/wp-content/uploads/2019/08/symbolcompletions.png\" alt=\"\"></p>\n\n\n    ",
            "tags": [
                "Typescript",
                "io-ts"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/05/02/using-boxing-to-prevent-distribution-of-conditional-types/",
            "url": "https://lorefnon.me/2019/05/02/using-boxing-to-prevent-distribution-of-conditional-types/",
            "title": "Using Boxing to prevent distribution of conditional types",
            "date_published": "2019-05-02T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>TypeScript <a class=\"wp-editor-md-post-content-link\" href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#conditional-types\">conditional types</a> have an interesting property that they can distribute over union types. As explained better by the <a class=\"wp-editor-md-post-content-link\" href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#distributive-conditional-types\">official docs</a>:</p>\n<blockquote><p>\n  Conditional types in which the checked type is a naked type parameter are called distributive conditional types. Distributive conditional types are automatically distributed over union types during instantiation. For example, an instantiation of <code>T extends U ? X : Y</code> with the type argument <code>A | B | C</code> for <code>T</code> is resolved as <code>(A extends U ? X : Y) | (B extends U ? X : Y) | (C extends U ? X : Y)</code>.\n</p></blockquote>\n<p>While I understand the rationale behind this behavior, this can sometimes lead to somewhat non-intuitive outcomes in real-world scenarios:</p>\n<p><span id=\"more-570\"></span></p>\n<p>For example, let us consider following usage:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471ef19e550077826\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef19e550077826-35\">35</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TBase</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TKeys</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">_base</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TBase</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">_keys</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TKeys</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-8\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DeferredKeySelection</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">SetBase</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TSelection</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TBase</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TSelection </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">TKeys</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TBase</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TKeys</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TBase</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-15\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">AddKey</span><span class=\"crayon-o\">&lt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">TSelection</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">TKey </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TSelection </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">TBase</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">TKeys</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TBase</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TKeys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TKey</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Augment</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TBase</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TKey </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AddKey</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">SetBase</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TBase</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TKey</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-24\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-25\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Resolve</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TSelection</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TSelection </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">Keys</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Keys </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Pick</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">Base</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">any</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSelection</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-33\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-34\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef19e550077826-35\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0059 seconds] -->\n<p></p>\n<p>It was <a class=\"wp-editor-md-post-content-link\" href=\"https://github.com/tgriesser/knex/pull/3168\">written</a> to model a fluent API (of <a class=\"wp-editor-md-post-content-link\" href=\"https://knexjs.org/\">Knex query builder</a>) where the base type of a partial could be available later, for example:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471ef1ab318307946\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1ab318307946-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1ab318307946-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1ab318307946-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1ab318307946-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471ef1ab318307946-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1ab318307946-2\"><span class=\"crayon-e\">await </span><span class=\"crayon-v\">knex</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">User</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"users\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Resolves to Pick&lt;User, \"id\" | \"name\"&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1ab318307946-3\"><span class=\"crayon-e\">await </span><span class=\"crayon-v\">knex</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">from</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">User</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"users\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Resolves to Pick&lt;User, \"id\" | \"name\"&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1ab318307946-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>Note that we cant just use <code>Pick</code> directly in selects return value because it is possible that the base type (User above) hasnt been provided yet.</p>\n<p>So, instead we use a container type for bookkeeping and use <code>DeferredKeySelection.Resolve</code> to resolve it  basically deferring the Pick operation till the <a class=\"wp-editor-md-post-content-link\" href=\"https://github.com/tgriesser/knex/blob/cc109c4cadb06e6ed6909fe6dd2002398bf67eab/types/index.d.ts#L934-L936\">termination of the fluent chain</a>. If this pattern of using an identically named interface and namespace pair seems strange, checkout my <a class=\"wp-editor-md-post-content-link\" href=\"/2018/11/30/simplifying-generics-heavy-typescript-code-using-container-interfaces-extractor-types-and-companion-namespaces/\">previous post</a> on the topic.</p>\n<p>However, if we try to use it, we will notice something strange:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471ef1af088739162\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1af088739162-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1af088739162-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1af088739162-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1af088739162-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471ef1af088739162-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1af088739162-2\"><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Resolve</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">User</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1af088739162-3\"><span class=\"crayon-c\">// Pick&lt;User, \"id\"&gt; | Pick&lt;User, \"age\"&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1af088739162-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>We might have expected the resolved type (<code>T</code>) to be <code>Pick&lt;User, \"id\" | \"age\"&gt;</code> here but of course that is not the case because of the distributive behavior of conditional types mentioned above.</p>\n<p>Fortunately the solution is very simple, we can box the first type parameter of conditional so it is no longer a simple union type:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4471ef1b3266345075\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4471ef1b3266345075-13\">13</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-2\"><span class=\"crayon-c\">// A container type to wrap the value in an object</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-3\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Boxed</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-5\"><span class=\"crayon-c\">// Later:</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-6\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ResolveSingle</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">TSelection</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TSelection </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DeferredKeySelection</span><span class=\"crayon-o\">&lt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">infer</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Keys</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-9\"><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Base</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Boxed</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Keys</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Boxed</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">Base</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Pick</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keyof </span><span class=\"crayon-v\">Base</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span></div><div class=\"crayon-line\" id=\"crayon-5fba4471ef1b3266345075-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSelection</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0021 seconds] -->\n<p></p>\n<p></p>\n<p>Now our Resolve function behaves as we would expect.</p>\n<p>(PS. The container types here have no runtime overhead because we never any values/instances of these types. They are just used for type-level book-keeping).</p>\n\n\n    ",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/03/24/using-comlink-with-typescript-and-worker-loader/",
            "url": "https://lorefnon.me/2019/03/24/using-comlink-with-typescript-and-worker-loader/",
            "title": "Using comlink with typescript and worker-loader",
            "date_published": "2019-03-24T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p><a href=\"https://github.com/webpack-contrib/worker-loader\">worker-loader</a> and <a href=\"https://github.com/GoogleChromeLabs/comlink\">comlink</a> are two solution which make web-workers a joy to use. This short post summarizes how to make them play well with each other in a typescript codebase.</p>\n<p><span id=\"more-548\"></span></p>\n<h2>What is comlink ?</h2>\n<p>Comlink is a Google project that implements a proxy based RPC mechanism to invoke methods on objects present in web-workers.</p>\n<p>Being proxy based, most of the times invocation is fairly transparent and the outcome is a lot easier to read than if we were using postMessage and MessagePort APIs directly. Internally of-course comlink use the same APIs under the hood.</p>\n<p>Comlinks <a href=\"https://github.com/GoogleChromeLabs/comlink/blob/master/README.md\">README</a> already outlines the usage adequately and also David East has <a href=\"https://davidea.st/articles/comlink-simple-web-worker\">written</a> a great introduction to Comlink here, so this post will mostly focus on usage with typescript.</p>\n<h2>Worker loader</h2>\n<p>worker-loader is a webpack plugin that makes it trivial to use webworkers with webpack. When you are using webpack, youd usually want to have hash appended file paths for <a href=\"https://webpack.js.org/guides/caching/\">long term caching</a> and worker-loader removes the need to refer to a manifest to derive the file path to be used for passing to Worker constructor.</p>\n<p>With worker-loader installed, we can simply do:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b380fab472108539\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fab472108539-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fab472108539-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fab472108539-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b380fab472108539-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fab472108539-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">ExpensiveProcessor </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"worker-loader!../core/expensive-processor.worker\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fab472108539-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0023 seconds] -->\n<p></p>\n<p>And it will create a separate webpack chunk, and generate a facade class instantiating which gives us the worker instance. This worker instance happens to be what <a href=\"https://github.com/GoogleChromeLabs/comlink#comlinkproxyendpoint\">Comlink.proxy</a> expects, so we can just pass it on.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b380fba197430070\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fba197430070-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-2\"><span class=\"crayon-c\">// expensive-processor.worker.ts</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExpensiveProcessor</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* ... async methods here ... */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-7\"><span class=\"crayon-v\">Comlink</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">expose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ExpensiveProcessor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fba197430070-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b380fbe773217982\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fbe773217982-9\">9</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-2\"><span class=\"crayon-c\">// main.ts</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">ExpensiveProcessor </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"worker-loader!../core/expensive-processor.worker\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-6\"><span class=\"crayon-c\">// Later inside an async function:</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-7\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ProcessorFacade</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Comlink</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExpensiveProcessor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-8\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">processor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ProcessorFacade</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fbe773217982-9\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<h2>Typescript integration</h2>\n<p>The last piece here is to make typescript play well. Because as of now, typescript has no way to figure out the type of the imported ExpensiveProcessor because the code generated by webpack doesnt go through the type checker.</p>\n<p>The first step is to declare an <a href=\"https://www.typescriptlang.org/docs/handbook/modules.html#ambient-modules\">ambient module</a> having a <a href=\"https://www.typescriptlang.org/docs/handbook/modules.html#wildcard-module-declarations\">wildcard declaration</a> for all worker-loader related imports so that worker-loader imports are identified as Worker implementations.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b380fc2143634162\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc2143634162-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-2\"><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"worker-loader!*\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebpackWorker</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">constructor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">export </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WebpackWorker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc2143634162-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0013 seconds] -->\n<p></p>\n<p>The second step is to pass a type parameter to Comlink.proxy:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b380fc5795232898\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc5795232898-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc5795232898-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc5795232898-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc5795232898-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b380fc5795232898-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc5795232898-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ProcessorFacade</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Comlink</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">proxy</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Promise</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">IProcessorFacade</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExpensiveProcessor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc5795232898-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">processor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ProcessorFacade</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc5795232898-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>Here <code>IProcessorFacade</code> is an interface implemented by ExpensiveProcessor that defines a subset of the public API that plays well with <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\">structured cloning</a>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b380fc8612717809\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b380fc8612717809-13\">13</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-2\"><span class=\"crayon-c\">// expensive-processor.worker.ts</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-3\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IProcessorFacade</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* ... Methods whose arguments are either compatible with structured-cloning or have been wrapped in </span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-5\"><span class=\"crayon-c\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Comlink.proxyValue ... */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-8\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExpensiveProcessor</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IProcessorFacade</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* ... async methods here ... */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-11\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-12\"><span class=\"crayon-v\">Comlink</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">expose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ExpensiveProcessor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b380fc8612717809-13\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>Of course, this generics based implementation is not exactly type safe even though it eliminates all type errors.</p>\n<p>The reason is that there is nothing stopping us from exposing something that doesnt implement <code>IProcessorFacade</code> but until the typescripts <a href=\"https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API\">compile time transformation API</a> gets well supported by all ts ecosystem tooling, the only practical solution is to use a lint rule based on file name conventions if this is a concern.</p>\n\n\n    ",
            "tags": [
                "Typescript",
                "Comlink",
                "Web-workers"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/03/16/using-theme-specific-keybindings-in-vscode-to-improve-productivity/",
            "url": "https://lorefnon.me/2019/03/16/using-theme-specific-keybindings-in-vscode-to-improve-productivity/",
            "title": "Using theme specific keybindings in VSCode to improve productivity",
            "date_published": "2019-03-16T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>I have been using VSCode as my primary editor for a couple of months. However it has been a recurring pain point for me that we have to switch back and forth between the arrow keys and primary rows when editing code. This post outlines a somewhat non-conventional approach for this by abusing the <a href=\"https://code.visualstudio.com/docs/getstarted/keybindings#_when-clause-contexts\">when clause</a> of vscode keybinding configuration.</p>\n<p><span id=\"more-540\"></span></p>\n<h1>Prior state of the art</h1>\n<p>The most popular solution for this seems to be the vscode vim plugin, and I tried adapting to it despite not being a vim user. While I got comfortable with the primary vim keybindings in a week or so of continued used, I continued getting the feeling that it was not really well integrated with VSCode.</p>\n<p>Along with general performance issues and lagginess, the biggest problem for me was that often when navigating and editing rapidly the keystrokes would be applied out of order. This really breaks the flow when rapidly typing and after a month of usage I started looking out for an alternative.</p>\n<p>Turns out a very simple alternative is to simulate modal editing through VSCode themes.</p>\n<h1>Theme specific keybindings</h1>\n<p>While I liked vims modal editing, not being a longtime vim user, I kept longing for a visual indication when switching modes. A trivial solution here is to just use different vscode themes along with the <a href=\"https://marketplace.visualstudio.com/items?itemName=hoovercj.vscode-settings-cycler\">settings cycler</a> extension.</p>\n<p>With this extension enabled, we can have a single command to switch between two themes:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44e1e9ef1691877010\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9ef1691877010-20\">20</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-2\"><span class=\"crayon-c\">// kebindings.json</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+;\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"settings.cycle\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"editorTextFocus\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"args\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"colorTheme\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// must be unique</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"overrideWorkspaceSettings\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"values\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"workbench.colorTheme\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Default Dark+\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"workbench.colorTheme\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Monokai\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9ef1691877010-20\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0035 seconds] -->\n<p></p>\n<p>Now, we can define keybindings that are active only in a specific theme using the <a href=\"https://code.visualstudio.com/docs/getstarted/keybindings#_when-clause-contexts\">when clause</a>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44e1e9f06188649610\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f06188649610-22\">22</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"k\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorUp\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"j\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorDown\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"h\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorLeft\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"l\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorRight\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f06188649610-22\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0019 seconds] -->\n<p></p>\n<p>This is somewhat verbose because VSCode only allows json for configuration (which I think is a bad idea), but nevertheless it gets the job done.</p>\n<p>Now, when we press <code>ctrl+;</code> and switch to <code>Monokai</code> theme, we can use h,j,k,l as our arrow keys.</p>\n<p>We can of course extend this further and define more keybindings for selection, jumping to start/end etc.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44e1e9f0d257557031\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-39\">39</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-41\">41</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-43\">43</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-45\">45</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-47\">47</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-49\">49</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-51\">51</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-53\">53</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-55\">55</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-57\">57</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-59\">59</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-61\">61</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-63\">63</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-65\">65</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-67\">67</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-69\">69</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-71\">71</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-73\">73</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-75\">75</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-77\">77</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-79\">79</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-81\">81</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-83\">83</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-85\">85</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-87\">87</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-89\">89</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-91\">91</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-93\">93</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-95\">95</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-97\">97</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-99\">99</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-101\">101</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-103\">103</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-105\">105</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-107\">107</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-109\">109</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-111\">111</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-113\">113</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-115\">115</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-117\">117</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-119\">119</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-121\">121</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f0d257557031-122\">122</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"k\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorUp\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"j\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorDown\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"h\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorLeft\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"l\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorRight\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+k\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorUpSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+j\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorDownSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+h\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorLeftSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-36\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+l\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorRightSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-41\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-42\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"i\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorPageUp\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-46\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-47\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"m\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorPageDown\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-51\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-52\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"alt+h\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-54\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorHome\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-55\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-56\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-57\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-58\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"alt+l\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-59\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorEnd\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-60\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-61\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-62\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-63\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+i\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-64\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorPageUpSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-65\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-66\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-67\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-68\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+k\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-69\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorPageDownSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-70\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-71\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-72\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-73\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"alt+shift+h\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-74\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorHomeSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-75\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-76\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-77\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-78\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"alt+shift+l\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-79\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorEndSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-80\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-81\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-82\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-83\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+i\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-84\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorTop\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-85\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-86\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-87\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-88\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+m\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-89\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorBottom\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-90\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-91\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-92\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-93\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+h\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-94\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorWordLeft\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-95\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-96\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-97\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-98\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+l\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-99\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorWordRight\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-100\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-101\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-102\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-103\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+shift+i\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-104\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorTopSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-105\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-106\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-107\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-108\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+shift+m\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-109\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorBottomSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-110\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-111\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-112\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-113\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+shift+h\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-114\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorWordLeftSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-115\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-116\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-117\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-118\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ctrl+shift+l\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-119\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursorWordRightSelect\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-120\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-121\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f0d257557031-122\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0118 seconds] -->\n<p></p>\n<p>Once arrow keys were no longer needed for primary navigation, I have been using them for switching focus across editors in different split panels and moving the editor around between split frames (a common but infrequent operation).</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44e1e9f15383477974\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-39\">39</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-41\">41</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e1e9f15383477974-42\">42</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+up\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.moveEditorToAboveGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+down\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.moveEditorToBelowGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+right\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.moveEditorToRightGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shift+left\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.moveEditorToLeftGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-22\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"down\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.focusBelowGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-26\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-27\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"up\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.focusAboveGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-31\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"right\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.focusRightGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-36\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-37\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"key\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"left\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"workbench.action.focusLeftGroup\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"when\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"config.workbench.colorTheme == 'Monokai'\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-41\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e1e9f15383477974-42\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0032 seconds] -->\n<p></p>\n<p>This has worked out quite well for me so far.</p>\n\n\n    ",
            "tags": [
                "VSCode"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/01/20/exposing-the-type-of-a-typescript-class-while-hiding-the-implementation/",
            "url": "https://lorefnon.me/2019/01/20/exposing-the-type-of-a-typescript-class-while-hiding-the-implementation/",
            "title": "Exposing the type of a typescript class while hiding the implementation",
            "date_published": "2019-01-20T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>When we define a typescript class, we are actually defining two things, a constructor function, and a type. The instances constructed using the constructor defined by a class will have the type of the class.</p>\n<p>One might wonder, if it is possible, say from a library, to expose only the type of the class and not the actual type constructor. The goal here may be to prevent direct instantiation of the class, or prevent consumers from monkeying around with the prototype chain of the constructor.</p>\n<p><span id=\"more-536\"></span></p>\n<p>Of course, direct instantiation can be prevented using private constructors, but that is only if the consumers are using typescript. A consumer using plain javascript, or who is liberal with use of <code>any</code> is more than welcome to instatiate the class directly.</p>\n<p>One obvious approach is that we could define an interface, make our class implement the interface and expose just the interface.</p>\n<p>This works, but requires quite a bit of extra effort and duplication of signatures (assuming that interface is being created just for this purpose only).</p>\n<p>But, what if we could just strip out the run time entity (constructor function) of a class definition, and just retain the type of the class. This is indeed possible and very easy to do.</p>\n<p>We can just make an interface which extends a class (and doesnt add anything extra).</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b559193905619872\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b559193905619872-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b559193905619872-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b559193905619872-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b559193905619872-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b559193905619872-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b559193905619872-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PersonImpl</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b559193905619872-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b559193905619872-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b559193905619872-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b559193905619872-5\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PersonImpl</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<p>Exporting this interface provides our typescript consumers access to the type of the class, but doesnt provide anyone access to the constructor function or the prototype chain.</p>\n<p>If we are not ever exposing any instance of this class, and the class is for internal use only, we are pretty much done here.</p>\n<p>However, in case we are exposing instances of this class, then we are not finished, because, any instance of the class also facilitates access to the constructor through the constructor property (which can be overriden) and the prototype chain can be accessed through <code>Object.getPrototypeOf</code> or the controversial (and legacy <code>__proto__</code> property.</p>\n<p>The safest way to completely hide the implementation of prototype chain while exposing the instances is to wrap the instances in a Proxy that delegates method access and property access to the underlying target instance.</p>\n\n\n    ",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2019/01/12/using-an-svg-grid-background-for-aligning-elements-in-web-page/",
            "url": "https://lorefnon.me/2019/01/12/using-an-svg-grid-background-for-aligning-elements-in-web-page/",
            "title": "Using an SVG grid background for aligning elements in web page",
            "date_published": "2019-01-12T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>One of the recurring annoyances when designing websites is ensuring alignment of elements on a web page.</p>\n<p>Most design applications have the provision of an overlay grid. With very little effort we can add a simple grid to any web page and use it to ensure alignment of elements.</p>\n<p><span id=\"more-527\"></span></p>\n<p>As illustrated in this <a href=\"https://codepen.io/pigabo/pen/eAiLF?editors=1000\">codepen</a> we can create a grid using a few lines of SVG:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a68f338674592984\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f338674592984-12\">12</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-r\">&lt;svg </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xmlns</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.w3.org/2000/svg\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-2\"><span class=\"crayon-i\">&nbsp;&nbsp; </span><span class=\"crayon-r\">&lt;defs&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-3\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;pattern </span><span class=\"crayon-e\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"smallGrid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">patternUnits</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"userSpaceOnUse\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-4\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;path </span><span class=\"crayon-e\">d</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"M 10 0 L 0 0 0 10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"none\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"gray\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke-width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"0.5\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-5\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/pattern&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-6\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;pattern </span><span class=\"crayon-e\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"grid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">patternUnits</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"userSpaceOnUse\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-7\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;rect </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"url(#smallGrid)\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-8\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;path </span><span class=\"crayon-e\">d</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"M 100 0 L 0 0 0 100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"none\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"gray\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke-width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-9\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/pattern&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-10\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/defs&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-11\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;rect </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"url(#grid)\"</span><span class=\"crayon-r\"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f338674592984-12\"><span class=\"crayon-i\">&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/svg&gt;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0021 seconds] -->\n<p></p>\n<p>We can use an extension like <a href=\"https://userstyles.org/\">stylish</a> and save this snippet to apply the above css grid as a background image to html.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a68f34c380762038\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f34c380762038-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f34c380762038-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f34c380762038-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f34c380762038-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f34c380762038-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f34c380762038-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a68f34c380762038-1\"><span class=\"crayon-k\">html.grid-backdrop-enabled </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f34c380762038-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">background</span><span class=\"crayon-sy\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiPjwvcmVjdD4KICA8L3N2Zz4=\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f34c380762038-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f34c380762038-4\"><span class=\"crayon-k\">html.grid-backdrop-enabled body </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f34c380762038-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">opacity</span><span class=\"crayon-sy\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">0.8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f34c380762038-6\"><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n<p>So now whenever we activate this style and add grid-backdrop-enabled to html, the grid will show up as a backdrop against the transparent body and we can use it to check for alignment issues.</p>\n<p><img src=\"/wp-content/uploads/2019/01/grid-backdrop.png\" alt=\"\"></p>\n<p>We can always adjust the SVG to tweak the appearance of the grid. Here is a slightly adapted one which highlights 5px, 10px, 50px and 100px boundaries with different colors:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a68f352926673531\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a68f352926673531-20\">20</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-r\">&lt;svg </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xmlns</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.w3.org/2000/svg\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-2\"><span class=\"crayon-i\">&nbsp;&nbsp; </span><span class=\"crayon-r\">&lt;defs&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-3\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;pattern </span><span class=\"crayon-e\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"smallGrid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"5\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"5\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">patternUnits</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"userSpaceOnUse\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-4\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;path </span><span class=\"crayon-e\">d</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"M 10 0 L 0 0 0 10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"none\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"gray\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke-width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-5\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/pattern&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-6\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;pattern </span><span class=\"crayon-e\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"medSmallGrid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">patternUnits</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"userSpaceOnUse\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-7\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;rect </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"url(#smallGrid)\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-8\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;path </span><span class=\"crayon-e\">d</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"M 10 0 L 0 0 0 10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"none\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"black\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke-width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-r\"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-9\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/pattern&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-10\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;pattern </span><span class=\"crayon-e\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"medLargeGrid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"50\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"50\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">patternUnits</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"userSpaceOnUse\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-11\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;rect </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"url(#medSmallGrid)\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-12\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;path </span><span class=\"crayon-e\">d</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"M 10 0 L 0 0 0 10\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"none\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"violet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke-width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-r\"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-13\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/pattern&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-14\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;pattern </span><span class=\"crayon-e\">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"largeGrid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">patternUnits</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"userSpaceOnUse\"</span><span class=\"crayon-r\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-15\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;rect </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"url(#medLargeGrid)\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-16\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;path </span><span class=\"crayon-e\">d</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"M 100 0 L 0 0 0 100\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"none\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"red\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stroke-width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-r\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-17\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/pattern&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-18\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/defs&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-19\"><span class=\"crayon-i\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;rect </span><span class=\"crayon-e\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"100%\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fill</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"url(#largeGrid)\"</span><span class=\"crayon-r\"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a68f352926673531-20\"><span class=\"crayon-i\">&nbsp;&nbsp;</span><span class=\"crayon-r\">&lt;/svg&gt;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0039 seconds] -->\n<p></p>\n\n\n    ",
            "tags": [
                "Frontend",
                "SVG"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/11/30/simplifying-generics-heavy-typescript-code-using-container-interfaces-extractor-types-and-companion-namespaces/",
            "url": "https://lorefnon.me/2018/11/30/simplifying-generics-heavy-typescript-code-using-container-interfaces-extractor-types-and-companion-namespaces/",
            "title": "Simplifying generics-heavy typescript code using Container Interfaces, Extractor Types and Companion Namespaces",
            "date_published": "2018-11-30T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>Writing generics-heavy code code in Typescript can sometimes be arduous, especially because typescript doesnt facilitate <a href=\"https://en.wikipedia.org/wiki/Kind_(type_theory)\">higher kinded types</a> at language level.</p>\n<p>So, a function that accepts multiple arguments of generic types often has to accept type parameters of all these generic types in order to retain type safety:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307ba276703523\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ba276703523-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307ba276703523-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">W3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0020 seconds] -->\n<p></p>\n<p>This can get cumbersome fast, especially when the parameterized types have constraints on the type parameters because now these constraints also have to be replicated:</p>\n<p><span id=\"more-508\"></span></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307ca064617820\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ca064617820-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ca064617820-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ca064617820-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ca064617820-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ca064617820-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307ca064617820-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T1 </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T5</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ca064617820-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">t1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ca064617820-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ca064617820-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ca064617820-5\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T1 </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T5</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">W3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0021 seconds] -->\n<p></p>\n<p>If the constraint <code>T1 extends T4, T5</code> is not replicated over to <code>func</code> it will result in a compilation error. The above example illustrates a function, but of course the same idea carries over to consumer interfaces etc. as well.</p>\n<p>This is a chore when the combination of the same types (here T1, T2, T3) with identical type constraints have to be used in multiple places.</p>\n<p>With the introduction of conditional types in <a href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html\">typescript@2.8</a> we now have the ability to <a href=\"/2018/07/18/unwrapping-composite-types-in-typescript/\">extract out</a> generic type parameters from parameterized types. We can use this to our advantage to reduce the redundancy in scenarios like above by defining <strong>Container Types</strong>.</p>\n<p>These container types are not intended to be used by themsevles. So although in some cases container types may coincide with application domain types, often we would not have any objects of these types in runtime.</p>\n<p>Example:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307ce686289998\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307ce686289998-11\">11</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">T1 </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T4</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">T2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">T3</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-5\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// These variables are present just so to prevent the tooling</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// from nagging us to remove unused types</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_t1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T2</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-9\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_t2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_t3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T3</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307ce686289998-11\"><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<p>Now we can define an unparameterized derived type which we can use instead of the three type parameters:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307d1545186339\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307d1545186339-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307d1545186339-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FuncParamsU </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>We would usually want this to be the minimally lax type that satisfies all the constraints. For example, in above case we could use <code>any</code> as the first type parameter but we used <code>T4</code> (assuming <code>T4</code> is some concrete type) for better type safety.</p>\n<p>But now, we need to extract the member types from <code>FuncParamsU</code> for using them in places where the member types are expected.</p>\n<p>Conditional types to the rescue:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307d4745960612\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307d4745960612-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307d4745960612-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307d4745960612-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307d4745960612-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">FuncParamsT1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParamsU</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">T1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307d4745960612-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">FuncParamsT2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParamsU</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">T2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307d4745960612-3\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">FuncParamsT3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParamsU</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">T3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0026 seconds] -->\n<p></p>\n<p>These <strong>Extractor Types</strong> (sometimes called <strong>Type Operators</strong> in a more generic contexts) serve to pull out specific generic parameters from the <strong>Container Type</strong>.</p>\n<p>Now we can redefine our func function as follows:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307d7604243649\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307d7604243649-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307d7604243649-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParamsU</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">FuncParamsT1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">FuncParamsT2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">W3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">FuncParamsT3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>This has become somewhat longer, but is more advantageous in that if we need to modify one of the involved constraints, we would have to modify only the FuncParams interface.</p>\n<p>Note that when we need to use FuncParams, we also need to pull in all these extractor types.</p>\n<p>Another helpful pattern here is to define a <strong>Companion Namespace</strong> for every <strong>Container Type</strong> which contains all the associated type operators:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307da420181365\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307da420181365-19\">19</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-1\"><span class=\"crayon-c\">// FuncParams.ts</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-2\"><span class=\"crayon-e\">export </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">T1 </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T4</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">T2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">T3</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-6\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// These variables are present just so to prevent the tooling</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// from nagging us to remove unused types</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_t1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T2</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-10\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_t2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_t3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T3</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-13\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-14\"><span class=\"crayon-e\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FuncParams</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">export </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Zilch </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">T1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Zilch</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">T1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">T2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Zilch</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">T2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">export </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">T3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Zilch</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">infer </span><span class=\"crayon-v\">T3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">never</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307da420181365-19\"><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0040 seconds] -->\n<p></p>\n<p>The use of the same name for the <strong>Container Interface</strong> and its <strong>Companion Namespace</strong> is purely a matter of convention, but it helpful for logical correlation that <code>FuncParams.T1</code> is the extractor type to pull out <code>T1</code> from <code>FuncParams&lt;T1, T2, T3&gt;</code>.</p>\n<p>Another side benefit is that only a single import is required to import the Container Type as well as the Companion Namespace.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307de090800839\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307de090800839-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307de090800839-1\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./FuncParams\"</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Imports both FuncParams interface as well as FuncParams namespace</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0004 seconds] -->\n<p></p>\n<p>So now our <code>func</code> implementation can be:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d3307e0033263312\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307e0033263312-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307e0033263312-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307e0033263312-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307e0033263312-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307e0033263312-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d3307e0033263312-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d3307e0033263312-1\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./FuncParams\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307e0033263312-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d3307e0033263312-3\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Zilch</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307e0033263312-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">p1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307e0033263312-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">p2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d3307e0033263312-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">FuncParams</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">T3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0014 seconds] -->\n<p></p>\n\n\n    ",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/09/23/using-google-diff-match-patch-with-automerge-text/",
            "url": "https://lorefnon.me/2018/09/23/using-google-diff-match-patch-with-automerge-text/",
            "title": "Integrating Google diff-match-patch with AutoMerge.Text",
            "date_published": "2018-09-23T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>This post outlines the use of Googles <a href=\"https://github.com/google/diff-match-patch/wiki/Language:-JavaScript\">diff-match-patch library</a> to generate patches that can be translated to operations against an <a href=\"https://github.com/automerge/automerge#text-editing-support\">AutoMerge.Text</a> <a href=\"https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type\">CRDT</a> for situations when deriving the operations directly from user interactions is cumbersome.<br>\n<span id=\"more-469\"></span></p>\n<blockquote><p>\n  <a href=\"https://github.com/automerge/automerge\">Automerge</a> is a so-called Conflict-Free Replicated Data Type (CRDT), which allows concurrent changes on different devices to be merged automatically without requiring any central server.\n</p></blockquote>\n<p></p>\n<blockquote><p>\n  <a href=\"https://github.com/automerge/automerge#text-editing-support\">Automerge.Text</a> provides experimental support for collaborative text editing. Under the hood, text is represented as a list of characters, which is edited by inserting or deleting individual characters. Compared to using a regular JavaScript array, Automerge.Text offers better performance.\n</p></blockquote>\n<p>However, using the AutoMerge.Text API directly is somewhat cumbersome in practice:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba447e7f3ce267270330\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3ce267270330-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3ce267270330-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3ce267270330-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3ce267270330-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3ce267270330-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3ce267270330-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba447e7f3ce267270330-1\"><span class=\"crayon-v\">newDoc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Automerge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">change</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentDoc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3ce267270330-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Automerge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3ce267270330-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insertAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'h'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'e'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'l'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'l'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'o'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3ce267270330-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">deleteAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3ce267270330-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insertAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'H'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3ce267270330-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0026 seconds] -->\n<p></p>\n<p>It is of course possible to track every keypress in a text field and translate them to insert/delete operations, but this requires handling of a lot of corner cases like selection tracking, handling clipboard paste etc.</p>\n<p>Many javascript text editor components (eg. Quill, Draft etc.) provide deltas in the change events and we can translate them into AutoMerge operations.</p>\n<p>An alternative to the above is using Googles diff-match-patch library to compute patches that represent the change between the source document and changed document, and we can easily translate these patches to changes in AutoMerge Text data structure.</p>\n<p>This comes in particularly handly when we dont have control over the editor component, and deriving change deltas from user interactions is not very straightforward.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba447e7f3e1141648705\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-39\">39</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-41\">41</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-43\">43</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-45\">45</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-47\">47</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-49\">49</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-51\">51</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-53\">53</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-55\">55</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-57\">57</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-59\">59</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-61\">61</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5fba447e7f3e1141648705-63\">63</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">DiffMatchPatch </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"diff-match-patch\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">AutoMerge </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"automerge\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-4\"><span class=\"crayon-c\">// Typically we would get the changedText after some interactions in our UI components:</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sourceText</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"The angel shall fall\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-6\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">changedText</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Lucifer shall rise\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-8\"><span class=\"crayon-c\">// Initialize AutoMerge wrapper document</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-9\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AutoMerge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-11\"><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AutoMerge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">change</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AutoMerge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insertAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sourceText</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-14\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-15\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-16\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DiffMatchPatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-17\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-18\"><span class=\"crayon-c\">// Compute the diff:</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-19\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dmp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">diff_main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sourceText</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changedText</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-20\"><span class=\"crayon-c\">// diff is simply an array of binary tuples representing the change</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-21\"><span class=\"crayon-c\">// [[-1,\"The ang\"],[1,\"Lucif\"],[0,\"e\"],[-1,\"l\"],[1,\"r\"],[0,\" shall \"],[-1,\"fall\"],[1,\"rise\"]]</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-23\"><span class=\"crayon-c\">// This cleans up the diff so that the diff is more human friendly.</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-24\"><span class=\"crayon-v\">dmp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">diff_cleanupSemantic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">diff</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-25\"><span class=\"crayon-c\">// [[-1,\"The angel\"],[1,\"Lucifer\"],[0,\" shall \"],[-1,\"fall\"],[1,\"rise\"]]</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-27\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">patches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dmp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">patch_make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sourceText</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">diff</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-28\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-29\"><span class=\"crayon-c\">// A patch object wraps the diffs along with some change metadata:</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-30\"><span class=\"crayon-c\">//</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-31\"><span class=\"crayon-c\">// [{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-32\"><span class=\"crayon-c\">//&nbsp;&nbsp; \"diffs\":[[-1,\"The angel\"],[1,\"Lucifer\"],[0,\" shall \"],[-1,\"fall\"], [1,\"rise\"]],</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-33\"><span class=\"crayon-c\">//&nbsp;&nbsp; \"start1\":0,</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-34\"><span class=\"crayon-c\">//&nbsp;&nbsp; \"start2\":0,</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-35\"><span class=\"crayon-c\">//&nbsp;&nbsp; \"length1\":20,</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-36\"><span class=\"crayon-c\">//&nbsp;&nbsp; \"length2\":18</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-37\"><span class=\"crayon-c\">// }]</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-38\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-39\"><span class=\"crayon-c\">// We can use the patch to derive the changedText from the sourceText</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-40\"><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dmp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">patch_apply</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">patches</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sourceText</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// \"Lucifer shall rise\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-41\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-42\"><span class=\"crayon-c\">// Now we translate these patches to operations against AutoMerge.Text instance:</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-43\"><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AutoMerge</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">change</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">doc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-44\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">patches</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">patch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">patch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">start1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">patch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">diffs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changeText</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Insertion</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insertAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">changeText</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// No Change</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changeText</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-52\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-53\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Deletion</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-54\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changeText</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-55\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">deleteAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-57\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-58\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-59\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-60\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-61\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-62\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba447e7f3e1141648705-63\"><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// \"Lucifer shall rise\"</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0121 seconds] -->\n<p></p>\n\n\n    ",
            "tags": [
                "Frontend",
                "Automerge",
                "CRDT"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/08/20/uploading-files-to-mongodb-gridfs-via-apollo-powered-graphql-api/",
            "url": "https://lorefnon.me/2018/08/20/uploading-files-to-mongodb-gridfs-via-apollo-powered-graphql-api/",
            "title": "Uploading files to MongoDB GridFS via Apollo powered GraphQL API",
            "date_published": "2018-08-20T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>GraphQL multi-part request spec outlines a specification for multipart form requests in GraphQL. <a href=\"https://github.com/jaydenseric\">Jayden Seric</a>, the author of the spec, has also authored two libraries <a href=\"https://github.com/jaydenseric/apollo-upload-client\">apollo-upload-client</a> and <a href=\"https://github.com/jaydenseric/apollo-upload-server\">apollo-upload-server</a> which makes it effortless to integrate file uploads in Apollo Server.</p>\n<p><a href=\"https://docs.mongodb.com/manual/core/gridfs/\">GridFS</a> is a simple file system abstraction on top of MongoDB. This facilitates storage of large files (beyond BSON document size limit) in mongo database.</p>\n<p>This post outlines the minimal integration required to save the files uploaded through the GraphQL API to GridFS.</p>\n<p><span id=\"more-364\"></span></p>\n<p>We will use Koa as the HTTP server but the approach is applicable to any Apollo supported backend.</p>\n<p>The <a href=\"https://npm.im/apollo-server-koa\">Apollo-koa integration library</a> comes built in with apollo-upload-server, so if we initialize our Apollo server and configure it use koa server, it will automatically configure body parser and enable file uploads.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f824925651077\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f824925651077-21\">21</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">Koa </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ApolloServer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gql</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-server-koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graphQLServer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApolloServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">typeDefs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Described below</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">resolvers</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Query</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... add queries here</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">Mutation</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">addFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Described below</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... add other mutations here</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-17\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-18\"><span class=\"crayon-v\">graphQLServer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">applyMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-19\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-20\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f824925651077-21\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0045 seconds] -->\n<p></p>\n<p>Apollo server <a href=\"https://github.com/apollographql/apollo-server/blob/fa6c973f3685fceea905acf259824005e0e0ffe2/packages/apollo-server-core/src/index.ts#L46-L47\">exports</a> an Upload scalar type which we can use in our typedefs:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f832588453116\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f832588453116-17\">17</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gql</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-server-koa\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">typeDefs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gql</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">filename</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Mutation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">uploadFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Upload</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">File</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-16\"><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f832588453116-17\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0017 seconds] -->\n<p></p>\n<p>Now our add file resolver is ready to accept the incoming file stream and can pass it on to GridFS:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f835312978293\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f835312978293-16\">16</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">mongodb </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mongodb\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-4\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addFile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_parent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bucket</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mongodb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GridFSBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_db</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bucket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">openUploadStream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">await </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Promise</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">stream</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pipe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"error\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">on</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"finish\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uploadStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mimetype</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-15\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f835312978293-16\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0030 seconds] -->\n<p></p>\n<p>In order to facilitate uploading of files from the client, we need to configure Apollo client to use an upload link:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f839458028925\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f839458028925-31\">31</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-2\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloProvider</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react-apollo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-client\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-4\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">InMemoryCache</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-cache-inmemory\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-5\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">HttpLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link-http\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-6\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">onError</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link-error\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-7\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ApolloLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-link\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-8\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">createUploadLink</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apollo-upload-client\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-10\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApolloClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">link</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ApolloLink</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Report errors to console in a user friendly format</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">onError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">networkError</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">graphQLErrors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">locations</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">GraphQL </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Message</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Location</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">locations</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">networkError</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Network </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">networkError</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-23\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">createUploadLink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">uri</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">APP_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/graphql\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">credentials</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"same-origin\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-28\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-29\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">cache</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InMemoryCache</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-30\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f839458028925-31\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0055 seconds] -->\n<p></p>\n<p>Note that using http link is no longer required, and any configuration options that could be passed to http link can be passed to <code>createUploadLink</code>. In fact, if http link is used before <code>createUploadLink</code> file uploads wont work at all because http link is a terminal link and the upload link added after would not be used.</p>\n<p>Now we can upload files to our GraphQL endpoint using <code>Mutation</code> component.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44b95f83c771609500\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44b95f83c771609500-32\">32</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">gql </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"graphql-tag\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Mutation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react-apollo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UPLOAD_FILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gql</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">mutation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Upload</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">uploadFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">_id</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-9\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">filename</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-12\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-13\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-14\"><span class=\"crayon-e\">export </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-15\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">ApolloProvider </span><span class=\"crayon-v\">client</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Mutation </span><span class=\"crayon-v\">mutation</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">UPLOAD_FILE</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">mutate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">input</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-19\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"file\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">required</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-21\"><span class=\"crayon-e\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">onChange</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">event</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">files</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">mutate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">variables</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-28\"><span class=\"crayon-c\">&nbsp;&nbsp;&nbsp;&nbsp;)}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-29\"><span class=\"crayon-c\">&nbsp;&nbsp;&lt;/M</span><span class=\"crayon-v\">utation</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-30\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ApolloProvider</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-31\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44b95f83c771609500-32\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0031 seconds] -->\n<p></p>\n<p>This concludes our server side as well as client side setup involved in connecting a file input field to mongodb gridfs.</p>\n\n\n    ",
            "tags": [
                "Apollo",
                "GraphQL",
                "MongoDB"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/08/18/integrating-next-js-apollo-server-and-koa/",
            "url": "https://lorefnon.me/2018/08/18/integrating-next-js-apollo-server-and-koa/",
            "title": "Integrating Next.js, Apollo Server and Koa",
            "date_published": "2018-08-18T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>It is fairly straightforward to add a GraphQL API powered by <a href=\"https://www.apollographql.com/docs/apollo-server/\" target=\"_blank\" rel=\"noreferrer noopener\">Apollo Server</a> to a <a href=\"http://nextjs.org/\" target=\"_blank\" rel=\"noreferrer noopener\">Next.js</a> application through a <a href=\"https://koajs.com/\" target=\"_blank\" rel=\"noreferrer noopener\">koa</a> middleware.</p>\n<p>The abbreviated snippet below summarizes the setup along with the libraries involved:</p>\n<p><span id=\"more-325\"></span><br>\n<script src=\"https://gist.github.com/lorefnon/65b50deebef37228416331234885cde6.js\"></script></p>\n\n\n    ",
            "tags": [
                "Next.js",
                "Koa",
                "Apollo"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/07/18/unwrapping-composite-types-in-typescript/",
            "url": "https://lorefnon.me/2018/07/18/unwrapping-composite-types-in-typescript/",
            "title": "Unwrapping composite types in Typescript",
            "date_published": "2018-07-18T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>One of the interesting aspects in Typescript is that it is easy to extract out individual types from composite types.</p>\n<p><span id=\"more-313\"></span> </p>\n<p>In case of Array, Tuple and Object types, this is really simple, as the type extraction syntax mimic member access syntax.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc53005203051\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc53005203051-14\">14</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-6\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">PersonName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Person</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// string</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-8\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">StrNumTuple</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-10\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">StrNumTuple0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StrNumTuple</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// string</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-11\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-12\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">NumArr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-13\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc53005203051-14\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">NumArrMember</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NumArr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// number</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0020 seconds] -->\n<p></p>\n<p>The object access syntax works for interfaces too, which is quite intuitive:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc60097321365\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc60097321365-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc60097321365-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc60097321365-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc60097321365-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc60097321365-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc60097321365-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc60097321365-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc60097321365-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc60097321365-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc60097321365-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc60097321365-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc60097321365-6\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">PersonName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Person</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// string</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0017 seconds] -->\n<p></p>\n<p>However, more interesting is that, we can extract types from generics and functions too.</p>\n<p>Let us say we have the following Dictionary type</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc63825027321\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc63825027321-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc63825027321-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc63825027321-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc63825027321-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc63825027321-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc63825027321-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dictionary</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc63825027321-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc63825027321-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc63825027321-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc63825027321-5\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">StrDict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dictionary</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&gt;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>To extract <code>T</code> from <code>StrDict</code>, we can use the above member property approach:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc67932639042\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc67932639042-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc67932639042-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">StrDictMember</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StrDict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// string</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n<p>However, another alternative here is to use typescripts <code>infer</code> keyword along with <a href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html\">conditional types</a>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc6a842913670\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc6a842913670-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc6a842913670-2\">2</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc6a842913670-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">DictMember</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dictionary</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">infer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">V</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">V</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">never</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc6a842913670-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">StrDictMember</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DictMember</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">StrDict</span><span class=\"crayon-o\">&gt;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>The conditional type <a href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html\">introduced</a> in Typescript 2.8 allows us to arrive at different types based on some conditions. The condition here being a type compatibility constraint.</p>\n<p>Not that even though <code>extends</code> keyword is used, this does not necessarily enforce an inheritance relationship, but rather checks for <a href=\"https://www.typescriptlang.org/docs/handbook/type-compatibility.html\">structural compatibility</a>.</p>\n<p><code>infer</code> introduces a <i>type variable</i> here, which can be later collected in the type the conditional type <i>resolves</i> to.</p>\n<p>This can be used to collect types from arbitrary generic types using typescripts inference algorithm.</p>\n<p>The same appraoch can be used to extract types from functions too. For example, following type (borrowed from typescripts <a href=\"https://github.com/Microsoft/TypeScript/blob/d2f6f6a0a48ef5a218eed1bc0e44236f2f5cbc30/lib/lib.es5.d.ts#L1411\">collection</a> of built in types), allows us to extract the return value of function.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc6d849182383\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc6d849182383-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc6d849182383-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ReturnType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">infer</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0020 seconds] -->\n<p></p>\n<p>The analogous approach can be used for arguments too:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc70102394537\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc70102394537-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc70102394537-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc70102394537-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc70102394537-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc70102394537-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Fn1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc70102394537-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ArgType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">infer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">U</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">U</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc70102394537-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc70102394537-4\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Fn1Arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArgType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Fn1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// number</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0023 seconds] -->\n<p></p>\n<p>Things get somewhat more interesting, if we want to extract the tuple type of <strong>all the arguments</strong>.</p>\n<p>Typescript 3.0-rc <a href=\"https://blogs.msdn.microsoft.com/typescript/2018/07/12/announcing-typescript-3-0-rc/#tuples-and-parameters\">introduces</a> support for extracting and spreading parameter lists with tuples. So using <code>typescript@next</code> we can do something like:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc73338060731\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc73338060731-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc73338060731-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc73338060731-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc73338060731-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc73338060731-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc73338060731-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">VariadicFn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc73338060731-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ArgsType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">VariadicFn</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">infer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc73338060731-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc73338060731-4\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Fn2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc73338060731-5\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Fn2Args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArgsType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Fn2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// [number, string]</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0031 seconds] -->\n<p></p>\n<p>It may be tempting to do something like: </p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc76115805678\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc76115805678-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc76115805678-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">ArgsType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">infer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">U</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">any</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">U</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">never</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">&nbsp;&nbsp;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<p>This will not work as expected, because <code>U</code> now has to satisfy the type at every position.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d01dc79788373604\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc79788373604-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d01dc79788373604-2\">2</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d01dc79788373604-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Fn2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d01dc79788373604-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">Fn2Args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArgsType</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Fn2</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// (number &amp; string)[]</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n\n\n    ",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/07/14/getting-productive-with-selection-and-navigation-in-emacs/",
            "url": "https://lorefnon.me/2018/07/14/getting-productive-with-selection-and-navigation-in-emacs/",
            "title": "Getting productive with selection and navigation in Emacs",
            "date_published": "2018-07-14T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>This post is intended to primarily benefit people coming from other, so called modern editors to Emacs. Emacs veterans are likely to find most of the tips here very elementary.</p>\n<p>I have observed that many programmers habituated to newer editors have many implicit assumptions about editing workflows which simply dont hold true within Emacs environment and this prevents them from being productive to the fullest extent.</p>\n<p>This post primarily focusses on how getting familiar with the concept of <code>marks</code> and <code>regions</code> in Emacs can result in productive workflows. These concepts, coupled with a few extensions can enable much more pleasurable code-editing workflows not easily achievable in more prevalent modern editors.</p>\n<p><span id=\"more-265\"></span></p>\n<h2>Marks and the Mark Ring</h2>\n<p>Perhaps among the first things which we learn when dipping toes into Emacs is that <code>C-spc</code> is the keybinding used to select region.</p>\n<p>We start a selection with <code>C-spc</code>, navigate to the the end of what we want to select, and then trigger a command to do something with the selection eg. Cut using <code>C-w</code>, Copy using <code>M-w</code> etc.<a id=\"footnote-1-src\" href=\"#footnote-1\"><sup>[1]</sup></a></p>\n<p>While the above explanation usually suffices to get people started with elementary usage, the <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Setting-Mark.html\">concept of marks</a> gets lost in the process.</p>\n<p><code>C-spc</code> (or more accurately <code>set-mark-command</code> which this is key is bound to by default) actually does two things:</p>\n<ul>\n<li>Marks the current position of cursor (called <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Point.html\">point</a>)</li>\n<li>Activates the region between mark and point</li>\n</ul>\n<p>Once point has been marked, moving the point by inserting text, navigating etc. changes the active region. This active region, between the point and the mark, is what we see as highlighted. <a id=\"footnote-2-src\" href=\"#footnote-2\"><sup>[2]</sup></a>.</p>\n<p>While this is <i>superficially</i> similar to how selections behave in most other GUI applications, there are some important differences:</p>\n<h3>Commands can operate on invisible regions</h3>\n<p>A region is highlighted (visible) when it is active. But commands like kill (cut), kill-ring-save (copy) etc. operate on regions and dont care whether or not the region is active. This can be surprising and may appear to be a bug when a <code>C-w</code> copies away a large chunk of text even if there is no visible selection on screen.</p>\n<p>While it is <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://emacs.stackexchange.com/questions/2701/only-allow-kill-ring-save-if-there-is-highlighted-text\">possible</a> to make Emacs behave like other prevalent editors in this respect, I find the Emacs behavior slightly better.</p>\n<p>This is because we can set the mark, continue typing, and then once done use <code>C-w</code> to copy the current region. This is useful when we know beforehand that we are going to need what we are typing later, eg. multiple class/interface names which have partially shared names by conventions. We thereby save on the extra navigation that would otherwise be required after typing.</p>\n<p>Lets say we want to write the following (typescript) code:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44809186f423153030\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44809186f423153030-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809186f423153030-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809186f423153030-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809186f423153030-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809186f423153030-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809186f423153030-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809186f423153030-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44809186f423153030-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809186f423153030-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">extens </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Component</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">FooProps</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44809186f423153030-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44809186f423153030-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809186f423153030-5\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FooProps</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44809186f423153030-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44809186f423153030-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0040 seconds] -->\n<p></p>\n<p>We see that there is quite a bit of redundancy in the names. We can utilize the above trick when typing to easily having to retype anything.</p>\n<p><img loading=\"lazy\" src=\"/wp-content/uploads/2018/07/emacs-1.gif\" alt=\"\" width=\"644\" height=\"242\" class=\"alignnone size-full wp-image-290\"></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44809187d774674551\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly=\"\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 15px !important; line-height: 20px !important;\">class\n      ^ C-spc =&gt; Activate mark\n\nclass Foo\n          ^ M-w =&gt; Foo has now been killed (copied)\n\nclass Foo extends React.Component&lt;\n                                  ^ C-spc =&gt; Activate mark\n\nclass Foo extends React.Component&lt;\n                                  ^ C-y =&gt; Yank (paste) Foo\n\nclass Foo extends React.Component&lt;FooProps\n                                          ^ M-w =&gt; FooProps has now been killed (copied)\n\nclass Foo extends React.Component&lt;FooProps&gt;\n\n// Later\n\ninterface\n           ^ C-y =&gt; Yank FooProps\n\ninterface FooProps {}</textarea></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809187d774674551-23\">23</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-1\">class</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-2\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ C-spc =&gt; Activate mark</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-4\">class Foo</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-5\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ M-w =&gt; Foo has now been killed (copied)</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-7\">class Foo extends React.Component&lt;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-8\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ C-spc =&gt; Activate mark</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-10\">class Foo extends React.Component&lt;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-11\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ C-y =&gt; Yank (paste) Foo</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-13\">class Foo extends React.Component&lt;FooProps</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-14\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ M-w =&gt; FooProps has now been killed (copied)</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-15\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-16\">class Foo extends React.Component&lt;FooProps&gt;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-17\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-18\">// Later</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-19\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-20\">interface</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-21\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^ C-y =&gt; Yank FooProps</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809187d774674551-23\">interface FooProps {}</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n<h3>Marks are useful by themselves: for navigation</h3>\n<p>This is perhaps the <strong>least intuitive</strong> part. Typing <code>C-u C-spc</code> jumps to a mark. So frequently it is useful to set a mark <i>without</i> needing a selection. Emacs keeps a buffer local history of marks in a <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Mark-Ring.html\">mark ring</a>.</p>\n<p>We can use <code>C-spc C-spc</code> to mark a point without activating a region.</p>\n<p>I personally prefer a slightly more old-school approach where I have <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.emacswiki.org/emacs/TransientMarkMode\">transient-mark-mode</a> disabled by default.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba448091881829369365\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba448091881829369365-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091881829369365-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091881829369365-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba448091881829369365-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091881829369365-2\">(setq deactivate-mark nil)</div><div class=\"crayon-line\" id=\"crayon-5fba448091881829369365-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0002 seconds] -->\n<p></p>\n<p>In this configuration, the regions are not visible by default, and <code>C-spc</code> just sets the mark and does not activate a region.</p>\n<p>It is occassionally convenient to highlight the region which will be selected, and for these cases we can can press <code>C-spc C-spc</code>. The double invocation temporarily activates the transient mark mode and active regions become visible.</p>\n<h3>Helm integration</h3>\n<p>Helm is a sophisticated completion system that vastly overhauls the development workflow in Emacs. This tutorial does not focus on helm, an <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://tuhdo.github.io/helm-intro.html\">excellent one</a> has already been written by Tuh Do. Helm requires some getting used to, but once habituated, its somewhat unconventional out-of-order matching system gets the job done a lot faster than other prevalent prefix-based or fuzzy-matching completion systems.</p>\n<p>Helm provides a command <code>helm-mark-ring</code> which shows all active marks in current buffer, and makes it easy to quickly jump to them. There is an analogous command <code>helm-all-mark-rings</code> which shows all marks across buffers.</p>\n<p><img loading=\"lazy\" src=\"/wp-content/uploads/2018/07/Screenshot-from-2018-07-09-01-56-23-1.png\" alt=\"\" width=\"1079\" height=\"459\" class=\"alignnone size-full wp-image-276\" srcset=\"/wp-content/uploads/2018/07/Screenshot-from-2018-07-09-01-56-23-1.png 1079w, /wp-content/uploads/2018/07/Screenshot-from-2018-07-09-01-56-23-1-300x128.png 300w, /wp-content/uploads/2018/07/Screenshot-from-2018-07-09-01-56-23-1-768x327.png 768w, /wp-content/uploads/2018/07/Screenshot-from-2018-07-09-01-56-23-1-1024x436.png 1024w\" sizes=\"(max-width: 1079px) 100vw, 1079px\"></p>\n<p>While marks are useful for a small number of recent locations, when we are exploring large projects, it is useful to tag points with a name, which are easy to remember and get back to. This is easily done by <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Bookmarks.html\">bookmarks</a>.</p>\n<p>Not surprisingly helm provides a way to browse bookmarks too.</p>\n<p><img loading=\"lazy\" src=\"/wp-content/uploads/2018/07/Screenshot-from-2018-07-09-02-00-10-e1531511960485.png\" alt=\"\" width=\"378\" height=\"229\" class=\"alignnone size-full wp-image-272\" srcset=\"/wp-content/uploads/2018/07/Screenshot-from-2018-07-09-02-00-10-e1531511960485.png 378w, /wp-content/uploads/2018/07/Screenshot-from-2018-07-09-02-00-10-e1531511960485-300x182.png 300w\" sizes=\"(max-width: 378px) 100vw, 378px\"></p>\n<p>The bookmark will by default take the name from current region (useful for bookmarking definition sites of symbols in code), or if a region is not active, the current file name.</p>\n<p>It is also possible to save points to <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Position-Registers.html\">registers</a> and access them later, but I dont find myself using them much. Unlike registers, bookmarks are persistend over sessions, and can have descriptive names  both of which I find desirable when working with larger projects.</p>\n<h2> More on regions</h2>\n<p>Now that we know about marks, let us focus a bit on regions. As we mentioned above, a region is the area between point and a mark.</p>\n<p>Regions allow us to perform operations on a selection of text. Like the bookmark-set command described above, many commands have special support for active regions when it makes sense to simplify workflow in the context.</p>\n<p>Browsing Emacs documentation every once in a while is guaranteed to be a rewarding experience.</p>\n<h3>Expanding selections</h3>\n<p>In modern editors, we usually select a region by mouse or by use shift+arrow keys and if we realize later that the starting of selection was wrong, maybe we left out a character or a word, woops ! We have to start again.</p>\n<p>In Emacs this is not the case.</p>\n<p>Once we have a region, between a point and mark, we can use <code>C-x C-x</code> to exchange the point and the mark. The relevant command is appropriately called exchange-point-and-mark.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba448091886145300849\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba448091886145300849-39\">39</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-2\">Lorem ipsum dolor sit amet</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-3\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ Cursor</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-6\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-7\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-8\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-9\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-10\">Lorem ipsum dolor sit amet</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-11\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ C-spc</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-13\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-14\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-15\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ----region--|</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-16\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-17\">Lorem ipsum dolor sit amet</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-18\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; move&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-19\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; forward -&gt;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-21\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-23\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-24\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ----region--|</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-25\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-26\">Lorem ipsum dolor sit amet</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-27\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-28\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C-x C-x</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-29\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-30\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-31\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-32\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mark</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-33\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ----region--|</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-34\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-35\">Lorem ipsum dolor sit amet</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-36\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-37\">&nbsp;&nbsp;&nbsp;&nbsp; Point and mark interchanged</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-38\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba448091886145300849-39\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>Note that we still effectively have the same region. Exchanging point and mark allows us to grow (or shrink) the region from either ends.</p>\n<h2>Expanding and narrowing selections</h2>\n<p>Why navigation and selection usually coupled, navigation is not always the best option to expand selection.</p>\n<p>Magnar Sveen has written a very useful package <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/magnars/expand-region.el\">expand-region</a> which allows us to create a region from the point and expand it by semantic units.</p>\n<p>So first invocation selects a word, and then the next invocation expands the region to a symbol, further to a string, further to the string wrapped in quotes and so on to encompass the whole line and finally the whole buffer.</p>\n<h2>Rectangular selections</h2>\n<p>Emacs also provides a somewhat unique feature for selecting two dimensional <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/Rectangles.html\">rectangles</a> of code. This is useful when working with tabular data, log files etc. as well as when creating ascii art.</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.gnu.org/software/emacs/manual/html_node/emacs/CUA-Bindings.html\">CUA bindings</a> come with an enhanced rectangle mode which I prefer over the above.</p>\n<p><img loading=\"lazy\" src=\"/wp-content/uploads/2018/07/Screenshot-from-2018-07-09-02-55-30.png\" alt=\"\" width=\"543\" height=\"107\" class=\"alignnone size-full wp-image-273\" srcset=\"/wp-content/uploads/2018/07/Screenshot-from-2018-07-09-02-55-30.png 543w, /wp-content/uploads/2018/07/Screenshot-from-2018-07-09-02-55-30-300x59.png 300w\" sizes=\"(max-width: 543px) 100vw, 543px\"></p>\n<p>One great feature here, is the ability to cycle through the corners and expand the rectangles in all directions</p>\n<p><img loading=\"lazy\" src=\"/wp-content/uploads/2018/07/emacs-2.gif\" alt=\"\" width=\"936\" height=\"535\" class=\"alignnone size-full wp-image-299\"></p>\n<h2> Other navigation tips</h2>\n<h3>Jumping to locations of recent changes</h3>\n<p>It is often useful to jump to the location where a change was recently made. The appropriately named <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.emacswiki.org/emacs/GotoLastChange\">GotoLastChange extension</a> is a very useful one that allows us to travel along the locations of edits.</p>\n<h2>Incremental search for navigation</h2>\n<p>Incremental search (<code>C-s</code>) of emacs is really helpful quick navigation. isearch-forward and its regex powered companion isearch-companion-forward quickly become the goto utilities for navigating through large code files.</p>\n<h3>ISearch and Marks</h3>\n<p>When you start an incremental search, as you type, your cursor will move to the tail end of the next (best) prefix-match.</p>\n<p>When you complete the search with enter, the point where the search started is marked. This makes it possible to quickly jump back to the point from where we originally started entering the isearch query.</p>\n<p>A common error is to assume that the isearch match is an active region. <strong>It is not.</strong> As should be obvious from the statement above, the region at the point of completion of search, is from the point where started the isearch to the point where the search finished.</p>\n<p>It is, however, frequently useful to have the matched content as the region, which can be accomplished by marking the head of the current match. This can be done by using <code>C-r</code> to jump to head of current match.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44809188c566014432\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-39\">39</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-41\">41</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-43\">43</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-45\">45</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-47\">47</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-49\">49</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-51\">51</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-53\">53</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-55\">55</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-57\">57</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-59\">59</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-61\">61</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-63\">63</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-65\">65</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-67\">67</div><div class=\"crayon-num\" data-line=\"crayon-5fba44809188c566014432-68\">68</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-1\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-2\">^ </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-3\">Original cursor position</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-6\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-7\">^ </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-8\">C-s =&gt; Initiate isearch</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-10\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Head end of match</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-11\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;Tail end of match</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-12\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-13\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-14\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- type \"comp\" --&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-15\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-16\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-17\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-18\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^ C-r (Without dismissing the search)</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-19\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-20\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-21\">Mark</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-22\">|</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-23\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-24\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ (point moves to head of match)</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-25\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-26\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-27\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-28\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ C-spc</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-29\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-30\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-31\">Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-32\">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-33\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-34\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-35\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-36\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-37\">Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-38\">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-39\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-40\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ C-s C-s</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-41\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-42\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-43\">Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-44\">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-45\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-46\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^ Point moves to tail end of search</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-47\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-48\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-49\">Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-50\">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-51\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-52\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^ C-u C-spc</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-53\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-54\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-55\">Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-56\">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-57\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-58\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ (point -&gt; mark)</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-59\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-60\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-61\">Mark&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-62\">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-63\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-64\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^ C-u C-spc</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-65\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-66\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-67\">class SomeClass extends React.Component {</div><div class=\"crayon-line\" id=\"crayon-5fba44809188c566014432-68\">^ (point -&gt; mark)</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0017 seconds] -->\n<p></p>\n<p>In addition to incremental-search, I have found a few other utilities very helpful for navigating through projects:</p>\n<h3>Helm-swoop</h3>\n<p><a href=\"https://github.com/ShingoFukuyama/helm-swoop\" target=\"_blank\" rel=\"noopener noreferrer\">Helm swoop</a> provides an efficient way to find matches across files. It provides a helm friendly way to rapidly jump to a matching line anywhere in the entire project.</p>\n<p>An example from their <a href=\"https://github.com/ShingoFukuyama/helm-swoop\" target=\"_blank\" rel=\"noopener noreferrer\">home page</a>:</p>\n<p><img src=\"https://raw.githubusercontent.com/ShingoFukuyama/images/master/helm-swoop.gif\"></p>\n<h3>Avy</h3>\n<p><a href=\"https://github.com/abo-abo/avy\" target=\"_blank\" rel=\"noopener noreferrer\">Avy</a> provides a novel approach that requires fewer keystrokes than an isearch for jumping to a specific location that is already visible. Usually within three keystrokes we can jump to any location in the visible area of the buffer.</p>\n<p><img loading=\"lazy\" src=\"/wp-content/uploads/2018/07/emacs-3.gif\" alt=\"\" width=\"936\" height=\"535\" class=\"alignnone size-full wp-image-300\"></p>\n<h2>Navigating to punctuation</h2>\n<p>In programming contexts it is often useful to navigation to punctuation markers close by. Prolific blogger Xah Lee has shared <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"http://ergoemacs.org/emacs/emacs_jump_to_punctuations.html\">some snippets</a> of elisp for achieving the same.</p>\n<h2>Multiple cursors</h2>\n<p>A feature common now a days in many editors is the support for multiple cursors. It is useful to do things like editing the same text occurring multiple times simultaneously.</p>\n<p><img src=\"https://i.stack.imgur.com/TLZpd.gif\"></p>\n<p>If you are really fond of multi-cursor style editing, Magnar once again has you covered with <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/magnars/multiple-cursors.el\">multiple-cursors</a>.</p>\n<p>I usually prefer a more conventional approach, where we can record an edit action as a macro, and then quickly apply in multiple positions.</p>\n<p>Emacs Wiki has a <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.emacswiki.org/emacs/KeyboardMacros\">good overview</a> on usage of macros.</p>\n<p>The advantage over the multiple-cursor approach in that it is much more powerful and composable with any of the navigation patterns described above.</p>\n<p>For instance, once a macro has been recorded, it is trivial to use <code>avy</code> to jump to the end of the third word starting with a, and then apply the macro there.</p>\n<p>The disadvantage of course is that it requires slightly more keystrokes, but often the flexibility is worth it.</p>\n<p>Another utility I occasionally use is <a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/wence-/elisp/blob/master/multi-region.el\">multi-region</a> which makes it very easy to mark multiple regions of text and then run a command scoped to each region.</p>\n<h2> Further resources</h2>\n<p>Of course, Emacs is famously a self-documenting editor. So <code>M-x help-with-tutorial</code> and <code>M-x help</code> are the definitive resources for learning Emacs.</p>\n<p>In addition, following are some great resources I have frequently found useful:</p>\n<ul>\n<li><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"http://pragmaticemacs.com/\">Pragmatic Emacs</a></li>\n<li><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.emacswiki.org/\">Emacs Wiki</a></li>\n<li><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.masteringemacs.org/\">Mastering Emacs</a></li>\n</ul>\n<hr>\n<p><a id=\"footnote-1\" href=\"#footnote-1-src\"><sup>[1]</sup></a> If this notations is still unfamiliar, refer <a href=\"https://www.emacswiki.org/emacs/EmacsKeyNotation\">Emacs key notation</a>.<br>\n<a id=\"footnote-2\" href=\"#footnote-2-src\"><sup>[2]</sup></a> This assumes that <a href=\"https://www.emacswiki.org/emacs/TransientMarkMode\">Transient Mark Mode</a> is enabled. This is true in the default configuration of newer versions of emacs.</p>\n\n\n    ",
            "tags": [
                "Emacs"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/06/09/javascript-async-await-with-arbitrary-thenables/",
            "url": "https://lorefnon.me/2018/06/09/javascript-async-await-with-arbitrary-thenables/",
            "title": "Javascript Async/Await with arbitrary Thenables",
            "date_published": "2018-06-09T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>Usage of C# inspired <code>async/await</code> syntax (Now a <a href=\"https://github.com/tc39/proposals/blob/master/finished-proposals.md\" target=\"_blank\">stage 4 proposal</a>) is now fairly mainstream in javascript, and native support is available in major browsers and Node.</p>\n<p>Most of the times we <code>await</code> on promises (typically returned from async functions), however, it is relatively less well known that <code>await</code> works on arbitrary thenables. By thenables we mean any object with a <code>then</code> function member.</p>\n<p>This post covers this usage, and explores some scenarios where it can be interesting.</p>\n<p><span id=\"more-252\"></span></p>\n<h2>Using thenables to represent lazy computations</h2>\n<p>Promises are used to represent output of an operation which has been initiated but may not have yet completed. So by the time we have a promise, the operation it represents has already begun and using await keyword we can (effectively) wait for it to complete.</p>\n<p>Thenables can be useful to represent a computation that is yet to begin. For example:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051aef694301312\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051aef694301312-11\">11</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">then</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Started Then'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">setTimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Finishing Task'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">resolve</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051aef694301312-11\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0049 seconds] -->\n<p></p>\n<p>It would be obvious here, that calling <code>fn</code> does not actually initiate an asynchronous operation, but simply returns an object  a thenable.</p>\n<p>However, given that <code>await</code> syntax implicitly calls <code>then</code>, we can simply <code>await</code> on the returned thenable exactly in the same way we could have awaited on a promise, but unlike the latter, in this case, calling await will actually initiate the execution of our asynchronous operation.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051afd651445880\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051afd651445880-10\">10</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-2\"><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">experimental</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">repl</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">await</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-3\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* Function above */</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-4\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-5\"><span class=\"crayon-e\">Started </span><span class=\"crayon-st\">Then</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-6\"><span class=\"crayon-e\">Finishing </span><span class=\"crayon-e\">Task</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-7\"><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-8\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">_</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-9\"><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051afd651445880-10\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p>Libraries like <a href=\"http://mongoosejs.com/\" target=\"_blank\">Mongoose</a> (A popular ODM for mongodb) utilize this behavior and implement the thenable protocol in their <a href=\"https://github.com/Automattic/mongoose/blob/master/lib/query.js#L3143\" target=\"_blank\">Query class</a>.</p>\n<p>This enables us to <code>await</code> on fluent query builder chains.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b01870047597\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b01870047597-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b01870047597-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b01870047597-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b01870047597-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b01870047597-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b01870047597-2\"><span class=\"crayon-e\">await </span><span class=\"crayon-v\">Person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'lorefnon'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b01870047597-3\"><span class=\"crayon-e\">await </span><span class=\"crayon-v\">Person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'lorefnon'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'age'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">gt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b01870047597-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<h3>Caveats</h3>\n<p>Even though being a thenable enables Query to quack like a promise in this case, an important distinction is that calling then multiple times will trigger multiple calls to the database (unlike a promise which is guaranteed to resolve or reject exactly once).</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b04749275254\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b04749275254-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b04749275254-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b04749275254-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b04749275254-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b04749275254-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b04749275254-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b04749275254-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b04749275254-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">thenable</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'lorefnon'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b04749275254-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">thenable</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// triggers database query</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b04749275254-4\"><span class=\"crayon-c\">// After some lines</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b04749275254-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">thenable</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// triggers another database query</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b04749275254-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>If this behavior is undesirable, then we can <a href=\"https://github.com/lodash/lodash/blob/4.17.10/lodash.js#L10539\" target=\"_blank\">memoize</a> our then function.</p>\n<p>Also, note that our <code>fn</code> function above could not be an async function.</p>\n<p>An async function is guaranteed to return a promise, and returning a thenable in async function, will cause its then to be invoked.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b07702009001\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b07702009001-18\">18</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">asycn</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">then</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Starting Task'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ....</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-9\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">promise</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Without await</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-10\"><span class=\"crayon-e\">Starting </span><span class=\"crayon-v\">Task</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-11\"><span class=\"crayon-c\">// ...</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-13\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">promise</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-14\"><span class=\"crayon-e\">Promise</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">pending</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b07702009001-18\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<h2>Stubbing/Spying</h2>\n<p>Since we know that await implicitly calls promises, we can safely spy on then of a promise in test cases. Or stub async methods to return spied thenables.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b0a860841833\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0a860841833-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0a860841833-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0a860841833-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0a860841833-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0a860841833-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0a860841833-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0a860841833-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b0a860841833-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0a860841833-2\"><span class=\"crayon-v\">sinon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">apiClient</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'makeRequest'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">returns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0a860841833-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">then</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sinon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">spy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resolve</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0a860841833-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Dummy Response'</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0a860841833-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0a860841833-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0a860841833-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p>Since sinons stub/spy functions track invocations, we can later find if makeRequest was invoked as well as whether our (pseudo) promises returned were actually awaited upon.</p>\n<h2>Dynamic imports and Thenable modules</h2>\n<p>ES6 modules can export a then method which will be called when these modules are dynamically imported:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b0d585804715\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b0d585804715-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-2\"><span class=\"crayon-c\">// importee.mjs</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-4\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Running Task'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">resolve</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b0d585804715-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b10211716304\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b10211716304-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b10211716304-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b10211716304-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b10211716304-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b10211716304-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b10211716304-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b10211716304-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b10211716304-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b10211716304-2\"><span class=\"crayon-c\">// importer.mjs</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b10211716304-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b10211716304-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">async</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b10211716304-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'resolved =&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">import</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'./importee'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b10211716304-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b10211716304-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b12392719844\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b12392719844-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b12392719844-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b12392719844-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b12392719844-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b12392719844-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b12392719844-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b12392719844-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b12392719844-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">experimental</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">modules </span><span class=\"crayon-v\">importer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mjs</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b12392719844-3\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">25619</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExperimentalWarning</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">ESM </span><span class=\"crayon-e\">module </span><span class=\"crayon-e\">loader </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">experimental</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b12392719844-4\"><span class=\"crayon-e\">Running </span><span class=\"crayon-e\">Task</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b12392719844-5\"><span class=\"crayon-v\">resolved</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b12392719844-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>Note that static imports are not asynchronous and dont cause thenables to be executed:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b15466922518\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b15466922518-10\">10</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-2\"><span class=\"crayon-c\">// importee.mjs</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-4\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"foo\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-6\"><span class=\"crayon-e\">export </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Running Task'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">resolve</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-9\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b15466922518-10\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b18426522605\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b18426522605-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b18426522605-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b18426522605-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b18426522605-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b18426522605-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b18426522605-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b18426522605-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b18426522605-2\"><span class=\"crayon-c\">// importer.mjs</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b18426522605-3\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./importee\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b18426522605-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b18426522605-5\"><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'foo =&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b18426522605-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b1a362248770\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1a362248770-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1a362248770-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1a362248770-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1a362248770-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1a362248770-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b1a362248770-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1a362248770-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">experimental</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">modules </span><span class=\"crayon-v\">importer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mjs</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1a362248770-3\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">25619</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExperimentalWarning</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">The </span><span class=\"crayon-e\">ESM </span><span class=\"crayon-e\">module </span><span class=\"crayon-e\">loader </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">experimental</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1a362248770-4\"><span class=\"crayon-v\">foo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">foo</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1a362248770-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<h2>Chaining of thenables</h2>\n<p>Similar to promises, thenables can be chained:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b1d808928575\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b1d808928575-9\">9</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-2\"><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">experimental</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">repl</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">await</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-3\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">thenable</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">r</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">r</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">r</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-4\"><span class=\"crayon-v\">undefined</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-5\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">thenable</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-6\"><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-7\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">_</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-8\"><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b1d808928575-9\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<h2>Usage with Proxies</h2>\n<p>Dynamic interception of then invocations through proxies works exactly the way wed expect:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44c051b20469144398\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44c051b20469144398-12\">12</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">thenable</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">get</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prop</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'then'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resolve</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resolve</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-8\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-10\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">thenable</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-11\"><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5fba44c051b20469144398-12\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0016 seconds] -->\n<p></p>\n<h2>Closure</h2>\n<p>While implicit resolution of thenables opens up some interesting opportunities, it can also lead to unexpected/surprising behavior if we are not aware of it.</p>\n\n\n    ",
            "tags": [
                "Javascript",
                "Frontend"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/06/02/exposing-slots-in-layout-containers-through-shared-refs-in-react/",
            "url": "https://lorefnon.me/2018/06/02/exposing-slots-in-layout-containers-through-shared-refs-in-react/",
            "title": "Exposing slots in layout containers through shared refs in React",
            "date_published": "2018-06-02T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>React refs are generally considered an anti-pattern as their usage typically encourages patterns which go against declarative compositon and top down flow of data.</p>\n<p>This post explores a somewhat uncommon use case where refs can be used to expose layout slots in parent components to nested components.</p>\n<p><span id=\"more-242\"></span></p>\n<p>The newly introduced <a href=\"https://reactjs.org/docs/refs-and-the-dom.html#creating-refs\" target=\"_blank\">React.createRef</a> function makes it particularly convenient to create refs in parent components, and pass them down as props to other components.</p>\n<p>While building business applications, I find it convenient to create reusable layout container components (eg. Header + Top Menu + Sidebar) and share them across different LOB applications.</p>\n<p>While this is uncommon, I have occasionally encountered use cases which may benefit from a component being able to render sub-parts of itself somewhere-else in the layout structure, without the consumer of the component having to take care of rendering multiple components in different locations in the tree.</p>\n<p>For example, let us say we are creating a <code>DataTable</code> component. When we click on a row, we open a drawer and render a form inside for editing the item represented by the row. Later, we decide that we would also want the flexibility to show this form outside the component in a sidebar exposed by a layout container, if available.</p>\n<p>We could handle this by rendering the sidebar as a part of the <code>DataTable</code> component itself, but that is not suitable if the sidebar may contain other components too which are unrelated to our DataTable.</p>\n<p>We could also expose this drawer as a separate component, and both our <code>DataTable</code> component as well as the <code>RowDetailsForm</code> component could be connected to a shared store, and rendered in independent locations in the component hierarchy, but this obviously requires more work on the part of consumer, and requires us to expose our internal state management concerns to outside world.</p>\n<p>The third solution, which we discuss here, is to use shared refs.</p>\n<p>The consumer component can create a ref and share it with both the layout container component and the presenter component.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a7a43ff960456084\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a43ff960456084-12\">12</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Component</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">sidebarRef</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createRef</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">LayoutContainer </span><span class=\"crayon-v\">sidebarRef</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sidebarRef</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Panel </span><span class=\"crayon-v\">slotRef</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sidebarRef</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">LayoutContainer</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a43ff960456084-12\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0034 seconds] -->\n<p></p>\n<p>Now, our container component can use this <code>sidebarRef</code> to designate a slot which can be populated by the nested presenter:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a7a4411198396424\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4411198396424-14\">14</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LayoutContainer </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Component</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-r\">ref</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sidebarRef</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-12\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4411198396424-14\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0015 seconds] -->\n<p></p>\n<p>And our presenter component can use this shared <code>sidebarRef</code> as a <code>Portal</code> target. Portal here is the <a href=\"https://react-bootstrap.github.io/react-overlays/#portals\" target=\"_blank\">Portal component</a> available from <a href=\"https://github.com/react-bootstrap/react-overlays\" target=\"_blank\">react-overlays</a> package, which is essentially a declarative wrapper over <a href=\"https://reactjs.org/docs/portals.html\" target=\"_blank\">ReactDOM.createPortal</a> API.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a7a4432339310845\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4432339310845-15\">15</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Panel </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Component</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">getSlot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">slotRef</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Fragment</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Body </span><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Portal </span><span class=\"crayon-v\">container</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">getSlot</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Slot </span><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Portal</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Fragment</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-13\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4432339310845-15\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0019 seconds] -->\n<p></p>\n<p>In case you are wondering how this works during initial render, before the sidebarRef.current is available, the <a href=\"https://github.com/react-bootstrap/react-overlays/blob/master/src/Portal.js\" target=\"_blank\">Portal component</a> implementation can be illuminating:</p>\n<p>Abbreviated source is below:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a7a4439253066833\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-39\">39</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-41\">41</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-43\">43</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-45\">45</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-47\">47</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-49\">49</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-51\">51</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-53\">53</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4439253066833-55\">55</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Portal </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Component</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">componentWillMount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">canUseDom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">container</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">container</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'function'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">container</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-13\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">container</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ReactDOM</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findDOMNode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">container</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// The container is a React component that has not yet been rendered.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Don't set the container node yet.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-19\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setContainer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">container</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-21\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-22\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-23\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">componentDidMount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_portalContainerNode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setContainer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">container</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">forceUpdate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">onRendered</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">onRendered</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">onRendered</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-30\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-31\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-32\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">componentWillReceiveProps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextProps</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextProps</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">container</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">container</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setContainer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextProps</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">container</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-36\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-37\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-38\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">componentWillUnmount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_portalContainerNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-40\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-41\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-42\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">setContainer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">container</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_portalContainerNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContainer</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">container</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ownerDocument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-46\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-47\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-48\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">_portalContainerNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">ReactDOM</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createPortal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_portalContainerNode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-52\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-53\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-54\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4439253066833-55\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0057 seconds] -->\n<p></p>\n<p>The render safely handles the scenario when the target container is not available yet, and in <code>componentDidMount</code> lifecycle hook, once the target is available, we set <code>this._portalContainerNode</code> and trigger a re-render.</p>\n<p>This approach also makes it trivial to fallback to a local node if the consumer hasnt supplied us with a <code>sidebarRef</code>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44a7a4440605757798\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4440605757798-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4440605757798-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44a7a4440605757798-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44a7a4440605757798-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4440605757798-2\"><span class=\"crayon-v\">getSlot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">slotRef</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">localSlotRef</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">current</span></div><div class=\"crayon-line\" id=\"crayon-5fba44a7a4440605757798-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>Note that things like event bubbling will work identially in both scenarios even if the component is rendered out of the DOM hierarchy of parent. Reacts synthetic event implementation is aware of portals and events are propagated through portal boundaries to parent components.</p>\n\n\n    ",
            "tags": [
                "React",
                "Frontend"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/05/13/reasonml-vs-typescript-first-impressions/",
            "url": "https://lorefnon.me/2018/05/13/reasonml-vs-typescript-first-impressions/",
            "title": "ReasonML vs TypeScript  First impressions",
            "date_published": "2018-05-13T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>This post summarizes preliminary observations while comparing <a target=\"_blank\" href=\"https://reasonml.github.io/\">ReasonML</a> and <a target=\"_blank\" href=\"https://www.typescriptlang.org/\">TypeScript</a> during selection of a reasonably (pun-intended) type safe language for frontend development. The observations here are somewhat biased in favor of experienced javascript developers and focusses primarily on frontend development workflow and does not take into account the (primary) native backend of Reason.</p>\n<p>While this post primarily compares Reason and TypeScript, much of what is outlined about TypeScript equally applies to <a target=\"_blank\" href=\"https://flow.org/\">flow</a> as well.</p>\n<p><span id=\"more-173\"></span></p>\n<h2>Compatibility with ECMAScript semantics</h2>\n<p>TypeScript was designed from ground up to be a javascript superset. So all javascript experience naturally carries over to TypeScript.</p>\n<p>Reason is an <a target=\"_blank\" href=\"https://ocaml.org/\">OCaml</a> dialect. A different language that has nothing to do with ECMAScript. period.</p>\n<p>This gets slightly blurred because of Reason teams efforts to bring in some javascript inspired syntax sugar to OCaml. So lists look like javascript arrays, records look like javascript objects, functions look like javascript arrow functions, spread syntax looks the same etc. But these syntactic similarities are very much skin deep and while they may aid in muscle memory, one has to keep in mind while writing any non-trivial code that Reason is a different language with very different semantics. We will revisit these semantic differences at multiple places in the later sections of this post.</p>\n<p>However it is worth highlighting that most of the ReasonML best practices also map to best practices in Modern javascript. The official documentation elaborates on this in the <a href=\"https://reasonml.github.io/docs/en/what-and-why.html\" target=\"_blank\">What &amp; Why</a> section that explains the motivation behind the ReasonML.</p>\n<p>When we say that we are comparing TypeScript with Reason in this post, we are <em>actually</em> comparing TypeScript with the combination of <a target=\"_blank\" href=\"https://ocaml.org/\">OCaml</a> (The underlying language which provides the type system) + <a target=\"_blank\" href=\"https://bucklescript.github.io/\">BuckleScript</a> (The OCaml -&gt; Javascript compiler, a fork of the primary OCaml compiler) + <a target=\"_blank\" href=\"https://reasonml.github.io/\">Reason</a> (The javascript inspired dialect for OCaml  implemented as a frontend for the OCaml compiler).</p>\n<h2>Type safety</h2>\n<p>TypeScript is intentionally <a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Gradual_typing\">gradually-typed</a>. TypeScript compiler supports various levels of strictness which can be <a target=\"_blank\" href=\"https://www.typescriptlang.org/docs/handbook/compiler-options.html\">configured</a> through the tsconfig.json file.</p>\n<p>In loose mode, TypeScript can be freely intermixed with untyped javascript and the compiler will do a best-effort to detect as many type violations as it can, and embrace all untyped data as <a target=\"_blank\" href=\"https://www.typescriptlang.org/docs/handbook/basic-types.html#any\">any</a> type which is simply not type-checked.</p>\n<p>For example given the following definition:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f594871222478\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f594871222478-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f594871222478-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f594871222478-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f594871222478-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f594871222478-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f594871222478-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0026 seconds] -->\n<p></p>\n<p>Compiler infers the type of fn as follows:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5a1844137640\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a1844137640-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a1844137640-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a1844137640-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5a1844137640-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a1844137640-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> fn:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">any</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a1844137640-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>So all that the TypeScript compiler knows about fn is that it is a function and that it takes two arguments. There is no type safety around the parameters, so the compiler will happily accept a usage like:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5a5704502907\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a5704502907-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a5704502907-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a5704502907-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5a5704502907-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a5704502907-2\"><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a5704502907-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0004 seconds] -->\n<p></p>\n<p>We also see that <code>any</code> is <strong>contagious</strong>. Given that the parameters are untyped, any results that depend on these parameters also has <code>any</code> type.</p>\n<p>In strict mode, the compiler will warn when variables end up with <code>any</code> type implicitly. But still, the developer has enough flexibility to explicitly use <code>any</code> whenever they see fit.</p>\n<p>There is also a <a target=\"_blank\" href=\"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-6.html#suppress-errors-in-ts-files-using--ts-ignore-comments\"><code>@ts-ignore</code></a> pragma which simply disables type checking for annotated sections of code.</p>\n<p>This can be somewhat advantageous wrt. interoperability because many prevalent javascript usage patterns can not be easily type-checked by the compiler and typescript intends to be a javascript superset so it has to accomodate for all kinds of dynamic and stringly typed APIs.</p>\n<p>Example from <a target=\"_blank\" href=\"https://lodash.com/\">lodash library</a>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5a8729342567\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a8729342567-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a8729342567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a8729342567-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a8729342567-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a8729342567-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a8729342567-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5a8729342567-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5a8729342567-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a8729342567-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'b'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'c'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a8729342567-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a8729342567-4\"><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a[0].b.c'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a8729342567-5\"><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a8729342567-6\"><span class=\"crayon-c\">// =&gt; 4</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5a8729342567-7\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0012 seconds] -->\n<p></p>\n<p>If we look at the <a target=\"_blank\" href=\"https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/lodash/common/object.d.ts#L3110-L3124\">type definition</a> for <code>set</code>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5ab765923154\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ab765923154-17\">17</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-2\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-3\"><span class=\"crayon-c\"> * Sets the value at path of object. If a portion of path doesnt exist its created. Arrays are created for</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-4\"><span class=\"crayon-c\"> * missing index properties while objects are created for all other missing properties. Use _.setWith to</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-5\"><span class=\"crayon-c\"> * customize path creation.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-6\"><span class=\"crayon-c\"> *</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-7\"><span class=\"crayon-c\"> * @param object The object to modify.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-8\"><span class=\"crayon-c\"> * @param path The path of the property to set.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-9\"><span class=\"crayon-c\"> * @param value The value to set.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-10\"><span class=\"crayon-c\"> * @return Returns object.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-11\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-12\"><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">object</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PropertyPath</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">any</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-16\"><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ab765923154-17\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>TypeScript will not make an attempt to validate that after setting the value, whether or not the resultant object still complies with the interface <code>T</code> and will just <i>assume</i> that it will.</p>\n<p>OCaml was designed to be a strongly typed language from the get go, and does not allow these kind of leeways. The type system is intentionally <a target=\"_blank\" href=\"http://papl.cs.brown.edu/2014/safety-soundness.html\">sound</a> and type coverage is <strong>guaranteed</strong> to be 100%.</p>\n<p>For interop, BuckleScript compiler supports typed externals which act as type hints for the compiler and are erased afterwards. Examples from <a target=\"_blank\" href=\"https://bucklescript.github.io/docs/en/bind-to-global-values.html\">BuckleScript docs</a>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5af992797728\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5af992797728-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5af992797728-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5af992797728-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5af992797728-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5af992797728-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">bs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">external </span><span class=\"crayon-r\">clearTimeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5af992797728-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>As a last-resort escape hatch <a target=\"_blank\" href=\"https://bucklescript.github.io/docs/en/embed-raw-javascript.html\">embedding raw untyped javasacript</a> is also possible.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5b2479451320\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b2479451320-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b2479451320-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b2479451320-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b2479451320-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b2479451320-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5b2479451320-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b2479451320-2\"><span class=\"crayon-v\">Js</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"this is reason\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b2479451320-3\"><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">bs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">raw</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'here is a string from javascript'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b2479451320-4\"><span class=\"crayon-v\">Js</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" back in reason land\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* ++ is the operator for string concat */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b2479451320-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p>The type of <code>x</code> here is akin to <code>any</code> in typescript which unifies with everything, and is highly discouraged.</p>\n<p>It is recommended that whenever javascript values are pulled in from the unsafe world, they are explicitly typed at the interop boundaries so that type safety is not compromised.</p>\n<p>TypeScript also supports a zero-commitment opt-in type checking through <a target=\"_blank\" href=\"https://github.com/Microsoft/TypeScript/wiki/JSDoc-support-in-JavaScript\">type annotations in comments</a>.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5b5051085456\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b5051085456-19\">19</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-3\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-4\"><span class=\"crayon-c\"> * @typedef {Object} CustomType - Declares a type named 'CustomType'</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-5\"><span class=\"crayon-c\"> * @property {string} prop1 - a string property of CustomType</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-6\"><span class=\"crayon-c\"> * @property {number} prop2 - a number property of CustomType</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-7\"><span class=\"crayon-c\"> * @prop {number} [prop5=10] - an optional number property of CustomType with default value</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-8\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-10\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-11\"><span class=\"crayon-c\"> * @param {CustomType} p1- A string param declared using TS-style</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-12\"><span class=\"crayon-c\"> * @param {string}&nbsp;&nbsp;p2 - A string argument.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-13\"><span class=\"crayon-c\"> * @param {string=} p3 - Optional argument</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-14\"><span class=\"crayon-c\"> * @return {string}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-15\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-16\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-17\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">// TODO</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-18\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b5051085456-19\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>This is advantageous for large javascript projects to ease gradual migration to typescript. And also when a compilation step is not desirable.<br>\nHowever, as with all solutions which abuse comments for purposes other than commenting, this is prone to human errors eg. typos in your type declarations may end up getting ignored by the compiler etc.</p>\n<p>In contrast, Reason enthusiasts take the stance that you really value type safety and so are willing to make the commitment and opt into an entirely different language.</p>\n<h2>Type inference</h2>\n<p>OCaml is quite famous for its <a target=\"_blank\" href=\"http://www.cs.cornell.edu/courses/cs3110/2011fa/supplemental/lec26-type-inference/type-inference.htm\">sophisticated type inference</a>, and is much better at this than typescript. When starting out, type inference in Reason can feel almost magical.</p>\n<p>In the code below:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5b9862564727\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5b9862564727-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-7\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">printName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Js</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5b9862564727-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<p></p>\n<p>The printName function can infer the type of p based on its usage within the function body.</p>\n<p><img loading=\"lazy\" class=\"alignnone size-full wp-image-195\" src=\"/wp-content/uploads/2018/05/Screenshot-from-2018-05-14-00-56-29.png\" alt=\"\" width=\"417\" height=\"164\" srcset=\"/wp-content/uploads/2018/05/Screenshot-from-2018-05-14-00-56-29.png 417w, /wp-content/uploads/2018/05/Screenshot-from-2018-05-14-00-56-29-300x118.png 300w\" sizes=\"(max-width: 417px) 100vw, 417px\"></p>\n<p>In contrast, TypeScript infers all untyped function arguments as <code>any</code>.</p>\n<p>Inference can be nice, but in case of type mismatch, the errors can sometimes be misleading wrt. whether the error is at call site or the definition site.</p>\n<p>In last year or so, there has not been a single occurance where I have encountered a TypeScript error and have not been able to comprehend within 5 mins what the error exactly is.</p>\n<h2>Type directed emit</h2>\n<p>One of the primary design decisions of typescript is to avoid type directed emit. From <a target=\"_blank\" href=\"https://github.com/Microsoft/TypeScript/wiki/TypeScript-Design-Goals\">Non-goals section</a>:</p>\n<blockquote><p>[TS will not] Add or rely on run-time type information in programs, or emit different code based on the results of the type system. Instead, encourage programming patterns that do not require run-time metadata.</p></blockquote>\n<p>The consequence of this is that the generated javascript is fairly close to handwritten idiomatic javascript. This also has advantage in that opting out of TypeScript is relatively easy.</p>\n<p>Reason (or rather BuckleScript) has no such qualms. A lot of optimization efforts have gone into BuckleScript to fully utilize the type system and take advantage of compilers intelligence to generate tiny compilation outputs.</p>\n<p>In contrast TypeScript explicitly states that aggressive optimization is <strong>not</strong> one of compilers goals. From the Non-goals section in the roadmap:</p>\n<blockquote><p>[TS will not] Aggressively optimize the runtime performance of programs. Instead, emit idiomatic JavaScript code that plays well with the performance characteristics of runtime platforms.</p></blockquote>\n<p>It is to be noted though, that statically analyzable code can often be better optimized by the JIT compiler or optimizers like <a target=\"_blank\" href=\"http://lisperator.net/uglifyjs/\">UglifyJS</a> or <a target=\"_blank\" href=\"https://developers.google.com/closure/compiler/\">Google Closure</a>.</p>\n<p>An example of reasons optimization can be seen in how it implements records:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5bd697202119\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5bd697202119-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-7\"><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"john\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5bd697202119-8\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0010 seconds] -->\n<p></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5c0005012912\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c0005012912-13\">13</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-2\"><span class=\"crayon-c\">// Generated by BUCKLESCRIPT VERSION 3.0.1, PLEASE EDIT WITH CARE</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-3\"><span class=\"crayon-s\">'use strict'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-5\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-6\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* record */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">/* age */</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-c\">/* name */</span><span class=\"crayon-s\">\"john\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-9\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-11\"><span class=\"crayon-v\">exports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-12\"><span class=\"crayon-c\">/* No side effect */</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c0005012912-13\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>One might have expected the person type to be represented as a javascript class, but the compiler optimizes away the record type entirely and leaves behind a compact array.</p>\n<p>The negative side of this is that there it is that scope of runtime reflection is severly limited. Runtime reflection is typically not idiomatic in OCaml. The metaprogramming section below touches upon some of the alternatives.</p>\n<h2>Functional Programming</h2>\n<p>Javascript has many functional features, primary among them is support for <a target=\"_blank\" href=\"https://www.sitepoint.com/higher-order-functions-javascript/\">higher order functions</a>. These features carry over seamlessly in TypeScript. TypeScripts type system handles higher order functions etc. quite well, but besides that it does little on top to encourage functional programming.</p>\n<p>There are many <a target=\"_blank\" href=\"https://hackernoon.com/functional-programming-in-javascript-is-an-antipattern-58526819f21e\">caveats</a> of functional programming in javascript, primary among them is that the built-in data structures are not really designed with immutability in mind.</p>\n<p>Adopting immutability in javascript boils down to one of these two options:</p>\n<ol>\n<li>We can use helper libraries to operate on native data structures without mutations. This often requires unnecessary cloning though, and is, in general, not particularly efficient.<p></p>\n</li>\n<li>\n<p>We can use something like <a target=\"_blank\" href=\"https://facebook.github.io/immutable-js/\">ImmutableJS</a>, but most libraries accept native arrays and objects, in such cases cost of coverting to and from and immutable can add up significantly.</p>\n</li>\n</ol>\n<p>Also, while functional composition is possible, the language could certainly benefit from more syntax sugar to make operations on functions as succinct as operations on primitives.</p>\n<p>Reason has been designed with functional programming at its core. Though it has some <a target=\"_blank\" href=\"https://realworldocaml.org/v1/en/html/objects.html\">object oriented features</a>, it is primarily a functional language.</p>\n<p>Primary built-in data structures are immutable, so it can be expected that all reason libraries play well with them. This includes lists, records, tuples etc. Remember that we said above that Reasons built in data structures may quack like Javascript but have different semantics ?</p>\n<p>BuckleScript has a number of optimizations in place to make operations on immutable entities performant.</p>\n<p>Mutability is <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/mutation.html\">opt in</a> and explicit (through usage of ref cells).</p>\n<p>A few primary features of ReasonML that aid in functional programming are highlighted below. The <a target=\"_blank\" href=\"http://2ality.com/2017/12/functions-reasonml.html#the-reverse-application-operator\">2ality blog</a> by Axel Rauschmayer already introduces them very well, so I will defer to that post for elaborations.</p>\n<h3>Curried functions</h3>\n<p>Reason functions are <a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Currying\">curried</a> by default. While this may seem weird to javascript developers (or developers from object oriented language backgrounds), this is really common in functional world, and partial application is quite common in practice. Hugh Jackson has written a <a target=\"_blank\" href=\"https://hughfdjackson.com/javascript/why-curry-helps/\">great post</a> on the advantages of currying.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5c5834576184\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c5834576184-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c5834576184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c5834576184-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c5834576184-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c5834576184-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5c5834576184-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c5834576184-2\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">incrementAgeBy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c5834576184-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c5834576184-4\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">incrementAgeBy1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c5834576184-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>FP enthusiasts have long advocated for currying in javascript and libraries like <a target=\"_blank\" href=\"/2018/05/13/reasonml-vs-typescript-first-impressions/ramdajs.com\">Ramda</a> have embraced it throughout their API.</p>\n<p>BuckleScript optimizes curried functions to prevent unnecessary use of closures wherever possible:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5c8005060712\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5c8005060712-10\">10</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-7\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">incrementAgeBy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-9\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">incrementAgeBy1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5c8005060712-10\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0014 seconds] -->\n<p></p>\n<p>Compiles to:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5cb919574988\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5cb919574988-12\">12</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-2\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* record */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* age */</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-c\">/* age */</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* name */</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-c\">/* name */</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-9\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5cb919574988-12\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0013 seconds] -->\n<p></p>\n<p>So when <code>incrementAgeBy</code> is called with two arguments there is no overhead.</p>\n<p>Side effect of implicit currying is that, in Reason we dont have functions with <a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Variadic_function\">variadic arguments</a>, which is very common in javascript.<br>\nTypeScript supports variadic arguments of same type, but the only way to handle heterogenous variadic arguments is through any.</p>\n<p>It is a common practice among libraries to handle few arities with generic types and falling back to <code>any</code> for higher index arities.</p>\n<p>Example from <a target=\"_blank\" href=\"https://unpkg.com/mobx-state-tree@2.0.5/dist/utils.d.ts\">MobX state tree</a></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5ce219092526\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ce219092526-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ce219092526-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ce219092526-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ce219092526-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ce219092526-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ce219092526-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5ce219092526-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ce219092526-2\"><span class=\"crayon-e\">export </span><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">extend</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ce219092526-3\"><span class=\"crayon-e\">export </span><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">extend</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ce219092526-4\"><span class=\"crayon-e\">export </span><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">extend</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ce219092526-5\"><span class=\"crayon-e\">export </span><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ce219092526-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0031 seconds] -->\n<p></p>\n<p>Currying also encourages data-last signatures where the primary subject of the operation is the last argument.</p>\n<p>For cases, where is this is not adequate, Reason also supports <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/function.html#labeled-arguments\">labeled arguments</a>. Labeled arguments also aid towards readability and while a similar thing can be emulated in javascript through object arguments and destructuring, in case of labeled arguments there is no overhead of an additional object allocation.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5d2164405679\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d2164405679-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d2164405679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d2164405679-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d2164405679-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d2164405679-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5d2164405679-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d2164405679-2\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">incrementAgeBy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d2164405679-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d2164405679-4\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">incrementAgeBy1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d2164405679-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0011 seconds] -->\n<p></p>\n<p>Compiles to:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5d4407389347\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d4407389347-12\">12</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-2\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* record */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* age */</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-c\">/* age */</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* name */</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-c\">/* name */</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-9\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">incrementAgeBy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">param</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d4407389347-12\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0014 seconds] -->\n<p></p>\n<h3>Operators as functions.</h3>\n<p>Unlike javascript and typescript, OCaml offers <a target=\"_blank\" href=\"http://2ality.com/2017/12/functions-reasonml.html#operators\">custom operators</a>. Operators are essentially functions with syntax sugar for infix/prefix usage.</p>\n<p>When misused this can make code a <b>lot</b> more difficult to grok, but for commonly used patterns it can help towards reducing unnecessary verbosity in code. This can also aid towards embedded <a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Domain-specific_language\">DSL</a>s.</p>\n<h3>Pipe Operator</h3>\n<p>ReasonML supports a pipe operator for <a target=\"_blank\" href=\"http://2ality.com/2017/12/functions-reasonml.html#the-reverse-application-operator\">reverse application</a> of functions.</p>\n<p>Example from the linked post from 2ality blog:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5d8189347180\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d8189347180-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d8189347180-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d8189347180-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d8189347180-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5d8189347180-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5d8189347180-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d8189347180-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d8189347180-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d8189347180-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compare</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5d8189347180-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0013 seconds] -->\n<p></p>\n<p>This makes chaining of operations very easy to grok and helps with functional data transformation pipelines. As should be obvious from the example above, reverse application naturally fits in with support for punning and currying.</p>\n<p>There are currently two <a target=\"_blank\" href=\"https://github.com/tc39/proposal-pipeline-operator/wiki\">competing proposals</a> for incorporation of pipe operator in javascript and respective champions are currently debating whether to make this more similar to flow or hack. TypeScript support for this is nowhere to be seen yet.</p>\n<h3>Pattern Matching</h3>\n<p><a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/pattern-matching.html\">Pattern Matching</a> is the crown jewel of ML. It is amazingly flexible, widely used and results in very clean code. This also goes hand in hand with <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/destructuring.html\">destructuring support</a>. It is not a coincidence that the single most prominent code example in Reason home page illustrates pattern matching:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5db404443103\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5db404443103-11\">11</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-2\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">schoolPerson</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Teacher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Director</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Student</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-4\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">greeting</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stranger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-5\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stranger</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Teacher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hey professor!\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Director</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello director.\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Student</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Richard\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Still here Ricky?\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Student</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">anyOtherName</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hey, \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">anyOtherName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5db404443103-11\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0018 seconds] -->\n<p></p>\n<p>If you have ever used convoluted nested if-else conditionals and have wondered if there could be a better construct, which could support a lower boilerplate unified syntax for branching based on type of the subject, or a member of a collection, or a property of a record  well that is what pattern matching is, and it is available in all its glory in ReasonML right now.</p>\n<p>As is to be expected, there is also <a target=\"_blank\" href=\"https://github.com/tc39/proposal-pattern-matching\">a proposal</a> for incorporating pattern matching in javascript. Once again, given the stage 0 status, TypeScript support is nowhere to be seen yet.</p>\n<p>Pattern matching and algebraic data types go <a href=\"https://haifengl.wordpress.com/2014/07/07/ocaml-algebraic-data-types/\" target=\"_blank\">hand in hand</a>.</p>\n<h2>Asynchronous Programming</h2>\n<p>It is fairly easy to use callbacks and promises when interoperating with javascript code. BuckleScript already provides bindings to <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/promise.html\">javascript promises</a>.</p>\n<p>TypeScript has had, for a long time, first class support for ES7 <a target=\"_blank\" href=\"https://javascript.info/async-await\">async/await keywords</a>. There have been <a target=\"_blank\" href=\"https://jaredforsyth.com/posts/building-async-await-in-reason/\">some attempts</a> to rebuild similar support in Reason in Reason, but as the author has highlighted in the linked post, the flexibility of javascript promises makes exact emulation of async/await difficult to play well with Reasons strict typesystem.</p>\n<p>The good news is that since all Javascript async APIs use promises as the foundational abstractions, interop through Promises is quite easy.</p>\n<h2>The various flavors of object types</h2>\n<p>Typescript embraces <a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Structural_type_system\">structural typing</a> which is a natural fit for interoperating with a dynamic language. Jamie Kyle has provided a <a target=\"_blank\" href=\"https://medium.com/@thejameskyle/type-systems-structural-vs-nominal-typing-explained-56511dd969f4\">good introduction</a> on the differences between Structural and Nominal type systems.</p>\n<p>TypeScripts interfaces are amazingly flexible and easy to understand. Along with <a target=\"_blank\" href=\"http://www.typescriptlang.org/docs/handbook/advanced-types.html\">Union and Intersection</a> types, they offer a wide berth for modelling polymorphic behavior. And they can be used to model almost all statically analysable usage patterns in javascript.</p>\n<p>In contrast, in Reason we have Records (<a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Nominal_type_system\">nominally typed</a>), Objects (structurally typed) and BuckleScripts wrapped Objects which have different semantics.</p>\n<p>While records are much faster implementation wise, they are rigidly typed: The types have to be declared beforehand and there is little support for deriving record types from other record types. The differences and subtly different syntax of these can be very confusing when starting out. We have already seen usage of Records in previous parts of this article and observed that BuckleScript compiles them away to compact arrays.</p>\n<p>So now the question arises, what if you really need a javascript object ? What if we want to have methods with a shared context (this in javascript) ?</p>\n<p>That is where the object type comes into picture. Before we get into them, let us try to identify two common usage patterns around objects in javascript :</p>\n<h3>Objects as Maps vs Objects as Records</h3>\n<p>In javascript, the enormous flexibility of objects have lent them to be used as both dictionaries (A collection of arbitrary key to value mappings) as well as Records (Mapping from fixed set of keys to values of priorly known types).</p>\n<p>TypeScript handles the former case through interfaces having a <a target=\"_blank\" href=\"http://www.typescriptlang.org/docs/handbook/advanced-types.html#index-types-and-string-index-signatures\">string index signature:</a></p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5e1191156502\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e1191156502-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e1191156502-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e1191156502-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e1191156502-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e1191156502-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5e1191156502-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e1191156502-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Map</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e1191156502-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e1191156502-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e1191156502-5\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>and the latter case through explicitly typed interface properties:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5e3413977136\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e3413977136-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e3413977136-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e3413977136-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e3413977136-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e3413977136-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e3413977136-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5e3413977136-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e3413977136-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e3413977136-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e3413977136-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e3413977136-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e3413977136-6\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>It is easily possible and common to mix and match these two usage patterns.</p>\n<p>BuckleScript strives to clearly distinguish between these two usage patterns. For dictionary style usage, <a target=\"_blank\" href=\"https://bucklescript.github.io/docs/en/object.html#object-as-hash-map\">JS.Dict</a> is preferred. And for Record style usage BuckleScript provides a wrapper to be used in conjuction with Object types.</p>\n<h2>ReasonML Object Type</h2>\n<p>To see an example of object types, let us look an a translated example of stack object type from <a target=\"_blank\" href=\"https://realworldocaml.org/v1/en/html/objects.html#ocaml-objects\">Real world OCaml</a>:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5e6607917240\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5e6607917240-15\">15</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-1\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">stack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">init</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">val </span><span class=\"crayon-i\">mutable</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">pub </span><span class=\"crayon-v\">pop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tl</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tl</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">Some</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">None</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">pub </span><span class=\"crayon-v\">push</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-11\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-13\"><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-14\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5e6607917240-15\"><span class=\"crayon-v\">s</span><span class=\"crayon-o\">#</span><span class=\"crayon-v\">pop</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0023 seconds] -->\n<p></p>\n<p>Note that we didnt have to declare the type of the return value of stack beforehand. Objects are less rigidly typed in this regard wrt. records.</p>\n<p>If we look at the inferred type of <code>s</code>, there is something interesting to be observed:</p>\n<p><img loading=\"lazy\" class=\"alignnone size-full wp-image-196\" src=\"/wp-content/uploads/2018/05/Screenshot-from-2018-05-14-01-23-57.png\" alt=\"\" width=\"663\" height=\"71\" srcset=\"/wp-content/uploads/2018/05/Screenshot-from-2018-05-14-01-23-57.png 663w, /wp-content/uploads/2018/05/Screenshot-from-2018-05-14-01-23-57-300x32.png 300w\" sizes=\"(max-width: 663px) 100vw, 663px\"></p>\n<p>No, the dot after the curly brace is not an error and that is how Reason distinguishes between Record Type and Object Types. Dont you love the syntax already ?</p>\n<p>The compiled output for this might be very surprising:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5ea108400493\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-39\">39</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-41\">41</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-43\">43</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-45\">45</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-47\">47</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-49\">49</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-51\">51</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-53\">53</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-55\">55</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-57\">57</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-59\">59</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-61\">61</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-63\">63</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-65\">65</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-67\">67</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-69\">69</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-71\">71</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-73\">73</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5ea108400493-75\">75</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-1\"><span class=\"crayon-c\">// Generated by BUCKLESCRIPT VERSION 3.0.1, PLEASE EDIT WITH CARE</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-2\"><span class=\"crayon-s\">'use strict'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-3\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-4\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Curry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"stdlib/curry\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-5\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Caml_oo_curry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"stdlib/caml_oo_curry\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-6\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CamlinternalOO</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"stdlib/camlinternalOO\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-8\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shared</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"push\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-s\">\"pop\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-11\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-12\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-13\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_tables</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-14\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-15\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-16\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-17\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-18\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-19\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">class_tables</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CamlinternalOO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create_table</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">shared</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ids</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CamlinternalOO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new_methods_variables</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shared</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"v\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">push</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ids</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ids</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ids</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">CamlinternalOO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_methods</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* array */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">pop</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* Some */</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* None */</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">push</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* :: */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">hd</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-42\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-43\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* () */</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-44\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-45\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-46\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">env_init</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-47\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CamlinternalOO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create_object_opt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-48\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-49\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-50\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-51\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">CamlinternalOO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">init_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-52\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">class_tables</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">env_init</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-53\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-54\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Curry</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">class_tables</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-55\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-56\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">init</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-57\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-58\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-59\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-60\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-c\">/* :: */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-61\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-62\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* :: */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-63\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-64\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* :: */</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-65\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-66\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">/* [] */</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-67\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-68\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-69\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-70\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-71\"><span class=\"crayon-v\">Caml_oo_curry</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5594513</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-72\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-73\"><span class=\"crayon-v\">exports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stack</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-74\"><span class=\"crayon-v\">exports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5ea108400493-75\"><span class=\"crayon-c\">/* s Not a pure module */</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0116 seconds] -->\n<p></p>\n<p>What has happened here is that Object Orientation in OCaml follows very different semantics than javascripts prototypal inheritance, and BuckleScript by default uses an implementation that is faithful to native OCaml semantics.</p>\n<p>However most of the time, when in javascript world, we would want to use javascript objects, and for that BuckleScript provides a <a target=\"_blank\" href=\"https://bucklescript.github.io/docs/en/object.html#object-as-record\">wrapped object type</a>&nbsp;which compile to javascript objects.</p>\n<p>While the linked BuckleScript docs cover wrapped object type in detail, I want to highlight the syntax sugar provided by Reason to sweeten the usage of BuckleScripts wrapped object type :</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5f0782598292\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f0782598292-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f0782598292-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f0782598292-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5f0782598292-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f0782598292-2\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">jane</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f0782598292-3\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p></p>\n<p>The above is a valid code and compiles to exactly what youd expect:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5f3007452079\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f3007452079-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f3007452079-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f3007452079-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f3007452079-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f3007452079-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5f3007452079-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jane</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f3007452079-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f3007452079-3\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f3007452079-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f3007452079-5\"><span class=\"crayon-v\">exports</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jane</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jane</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0006 seconds] -->\n<p></p>\n<p>Note that unlike JavaScript/TypeScript, the quotes here are significant (Otherwise it would be treated as a Record). Remember I noted above that syntactic similarities are only skin deep ?</p>\n<p>If we want this object to be explicitly typed, we can specify the object type as follows:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5f6101334644\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f6101334644-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f6101334644-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f6101334644-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f6101334644-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5f6101334644-5\">5</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5f6101334644-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Js</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">t</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f6101334644-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f6101334644-3\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f6101334644-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5f6101334644-5\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">jane</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p></p>\n<p>At this point I guess the <code>&#123;.</code> seems quite intuitive. No ? Oh well </p>\n<p>When it is at all not possible to fit usage of objects into one of the above two usage patterns, there is also support for a more <a target=\"_blank\" href=\"https://bucklescript.github.io/docs/en/object.html#object-as-dynamic-record\">dynamic usage pattern</a> which is generally discouraged.</p>\n<h2>Modules</h2>\n<p>ES6 Modules are very different from how most languages implement module systems. For the most part, I am a big fan of the one-to-one correlation between modules and files.</p>\n<p>I am also a big fan of explicit imports in ES6 as they make it very easy to follow through logic when doing code reviews in github.</p>\n<p>The typescript tooling is so good at this point, that I rarely have to write imports by hand. I can, in almost 100% cases, rely on typescript language server to identify and inject imports in source files and I heavily rely on tools for most of my refactoring.</p>\n<p>Reason/OCaml modules are much much different and in <i>some</i> ways more advanced.</p>\n<p>Modules are identified and referenced by names and not by relative paths to modules.</p>\n<p>While every file implicitly does define its own module, files can have many explicitly defined modules as well.</p>\n<p>In case of implicitly defined modules, the module name is derived from the name of the module. The location of the file in the filesystem hierarchy is insignificant and files can be moved around without needing any refactoring. This implies that verbose file names are quite common.</p>\n<p>As <a target=\"_blank\" href=\"https://blog.janestreet.com/better-namespaces-through-module-aliases/\">explained</a> by Yaron Minskey :</p>\n<blockquote><p>In particular OCaml has no good way of organizing modules into packages. One sign of the problem is that you cant build an executable that has two modules with the same module name. This is a pretty awkward restriction, and it gets unworkable pretty fast as your codebase gets bigger</p></blockquote>\n<p>The post linked above recommends using module aliases as a namespacing alternative.</p>\n<p>OCaml is fairly unique in its support of <a target=\"_blank\" href=\"https://www.cs.cornell.edu/courses/cs3110/2017fa/l/08-functors/notes.html\">parameterized modules or Functors</a> which can significantly aid in type-safe code reuse and can serve as foundation for sophisticated abstractions. Fuctors is a fairly large topic in itself and deserves a dedicated post in this blog, which will follow in near future.</p>\n<p>As the <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/module.html\">official documentation</a> explains:</p>\n<blockquote><p>Modules and functors are at a different layer of language than the rest. </p></blockquote>\n<p>Explicit modules are somewhat akin to TypeScript namespaces, but support for module parameterization does not have a direct equally powerful analogue in TypeScript.</p>\n<h2>Meta programming</h2>\n<p>The work around <a target=\"_blank\" href=\"http://ocamllabs.io/doc/ppx.html\">ppx</a> is arguably one of the most interesting aspects of the OCaml ecosystem.</p>\n<p>Quoting from the linked site:</p>\n<blockquote><p>The PPX language feature provides a new API for syntactic extensions in OCaml. PPX uses attributes to allow type-driven code generation, extension nodes for custom constructs and quoted strings for insertion of code fragments in unrelated syntax</p></blockquote>\n<p>TypeScript has a <a target=\"_blank\" href=\"https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API#creating-and-printing-a-typescript-ast\">compiler API</a> to support similar use cases which facilitates programmatic AST traversal and manipulation. However, as of this writing, this is marked as experimental and is not as mature.</p>\n<p>TypeScript also has experimental support for exposing design time type information at runtime through <a target=\"_blank\" href=\"http://blog.wolksoftware.com/decorators-metadata-reflection-in-typescript-from-novice-to-expert-part-4\">metadata reflection</a> which facilitates runtime metaproramming.</p>\n<h2>JSX</h2>\n<p>Given that Reason is by facebook, it is no surprise that their love of embedded XML-ish DSL carries over (from <a target=\"_blank\" href=\"https://reactjs.org/docs/introducing-jsx.html\">JSX</a>, <a target=\"_blank\" href=\"https://www.facebook.com/notes/facebook-engineering/xhp-a-new-way-to-write-php/294003943919/\">XHP</a> etc.) and thus Reason is blessed with a similar dedicated <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/jsx.html\">syntax sugar</a>.</p>\n<p>There are <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/jsx.html#departures-from-js-jsx\">subtle differences</a> from what happens in javascript, esp. punning, but overall the superfluous verbosity of the XML inspired DSL disgusts me in either languages, so not much to add here.</p>\n<h2>Interop</h2>\n<p>Bucklescript has a <a target=\"_blank\" href=\"https://bucklescript.github.io/docs/en/interop-overview.html\">dedicated section</a> on Interop which covers most use cases. But the tl;dr is that while unlike TypeScript not all javascript dynamic usage patterns can be expressed directly in OCaml. But through BuckleScripts embedded javascript support it is possible to drop down to untyped javascript and wrap such usages and expose them in a type safe manner.</p>\n<p>Bucklescripts interop support is somewhere between Elms <a target=\"_blank\" href=\"https://guide.elm-lang.org/interop/javascript.html\">port system</a> (which is the most tedious of all interop solutions I have encountered) and TypeScript which is happy to let you intermix untyped and typed javascript code.</p>\n<p>However this also implies that Bucklescript cant make strong guarantees about <a target=\"_blank\" href=\"https://www.infoq.com/news/2017/05/elm-zero-runtime-exception\">zero runtime errors</a> as Elm can. Of course, TypeScripts unsound type system has never had any such guarantees and nor is this planned as per their Roadmap.</p>\n<h2>Caveats around esoteric syntax</h2>\n<p>Javascript is well know to have many <a target=\"_blank\" href=\"https://medium.com/dailyjs/the-why-behind-the-wat-an-explanation-of-javascripts-weird-type-system-83b92879a8db\">warts</a> around its weak typing.</p>\n<p>OCamls type system may be safe and sound, but it has its own set of quirks. Many of these bizarre syntax rules have been <a target=\"_blank\" href=\"https://reasonml.github.io/docs/en/comparison-to-ocaml.html\">unified</a> by Reasons syntax sugar. However some of them are very fundamentally rooted into the type system.</p>\n<p>We have already seen the <em>interesting </em>use of operators and quoting in objects above.&nbsp;One such quirk that is most commonly visible is that (as mentioned above) operators are just functions and functions dont have method overloading so we must use different operators when operating on different types.</p>\n<p>For example we need different operators when doing operations on float and integers:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f5fc209261541\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5fc209261541-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5fc209261541-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5fc209261541-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f5fc209261541-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f5fc209261541-1\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44837f5fc209261541-2\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">dist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5fc209261541-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">sqrt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f5fc209261541-4\">&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p><code>*.</code>, <code>+.</code> are float multiplication and addition operators respectively.</p>\n<p>Adhoc polymorphism and typed languages have had a love hate relationship. Sophisticated type systems like Haskell handle them through features like Type Classes. Dynamic languages, well, have never had any problem with them because type safety is not a concern. OCaml does not have either of these so ad-hoc polymorphism is something of a pain point, which may be addressed in <a target=\"_blank\" href=\"https://discuss.ocaml.org/t/modular-implicits/144\">future</a>.</p>\n<p>The 2ality blog points out an <em>interesting</em> workaround for this by locally overriding the operators by opening a module that aliases the float operators:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44837f600642736645\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44837f600642736645-8\">8</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-1\"><span class=\"crayon-e\">module </span><span class=\"crayon-v\">FloatOps</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-e\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-5\"><span class=\"crayon-e\">let </span><span class=\"crayon-v\">dist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-6\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">FloatOps</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">sqrt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44837f600642736645-8\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0015 seconds] -->\n<p></p>\n<p>So while TypeScript (being a superset) carries over the warts of javascript,&nbsp; ReasonML also brings in its own set of syntactic eccentricities from its OCaml lineage, some of which may be quite obscure and non-intuitive&nbsp;for frontend developers.</p>\n<h2>Ecosystem</h2>\n<p>Many libraries for frontend development are being written in TypeScript and for many more (varying quality of) type definitions are available in the <a target=\"_blank\" href=\"https://github.com/DefinitelyTyped/DefinitelyTyped\">Definitively Typed repository</a>.</p>\n<p>There is a similar initiative <a target=\"_blank\" href=\"https://github.com/rrdelaney/ReasonablyTyped\">Reasonably Typed</a> for Reason, but that is not yet as comprehensive as TypeScript.</p>\n<hr>\n<h2>Summary</h2>\n<p>This brings us to the end of this post. I hope that this post helps you evaluate the different set of trade offs around which TypeScript and Reason have been designed around and make an informed decision when faced with a choice.</p>\n<p>My familiarity with Reason is still very nascent, so please feel free to comment about anything I might have missed out or got wrong.</p>\n<h3>Key Takeaways</h3>\n<ul>\n<li>For experienced javascript developers, Reasons learning curve may be quite steep given it is a different language with many different semantics. TypeScript in contrast has a comparatively shallow learning curve being a javascript superset.</li>\n<li>Deeply integrated features like pattern matching, currying, destructuring and custom operators make functional programming a much more pleasant experience than TypeScript</li>\n<li>Reason embraces immutability and while mutability is generally discouraged, it can be explicitly opted in.</li>\n<li>In contrast to TypeScript, Reasons type system is sound and more strict and has much better type inference. However type inference can be a double edged sword wrt. readability of error messages</li>\n<li>While Reason has a strict and sound type system, BuckleScript provides many escape hatches to ease interoperability with untyped javascript code.</li>\n<li>Unlike TypeScript, Reason embraces type directed emit, and in many cases effectively levarges the information type system has to aggressively optimize the generated code</li>\n<li>There are some dynamic usage patterns which have no direct analogues in Reason, and in these cases interop can get tricky.</li>\n</ul>\n<h2>References:</h2>\n<ol>\n<li><a target=\"_blank\" href=\"https://reasonml.github.io/\">Reason Official Site</a> maintained by Facebook Team</li>\n<li><a target=\"_blank\" href=\"https://haifengl.wordpress.com/2014/07/08/ocaml-polymorphism/\">OCaml: Polymorphism</a> by Haifeng Li</li>\n<li><a target=\"_blank\" href=\"http://reasonmlhub.com/exploring-reasonml/\">Exploring ReasonML</a> by Axel Rauschmayer</li>\n<li><a target=\"_blank\" href=\"https://realworldocaml.org/\">Real World Ocaml</a> by Anil Madhavapeddy, Jason Hickey and Yaron Minsky.</li>\n<li><a target=\"_blank\" href=\"https://haifengl.wordpress.com/category/programming/ocaml/\">Posts on OCaml</a> by Haifeng Li</li>\n</ol>\n\n\n    ",
            "tags": [
                "Typescript",
                "ReasonML"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/03/25/typescript-and-validations-at-runtime-boundaries/",
            "url": "https://lorefnon.me/2018/03/25/typescript-and-validations-at-runtime-boundaries/",
            "title": "Typescript and validations at runtime boundaries",
            "date_published": "2018-03-25T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>Typescript team has <a href=\"https://github.com/Microsoft/TypeScript/issues/1573#issuecomment-68374376\">explicitly stated</a> that they dont intend to extend typescripts static type checking to the runtime.</p>\n<p><a href=\"https://github.com/Microsoft/TypeScript/wiki/TypeScript-Design-Goals\">Typescript Design Goals</a> lists the following in the section on Non-goals:</p>\n<blockquote><p>Add or rely on run-time type information in programs, or emit different code based on the results of the type system. Instead, encourage programming patterns that do not require run-time metadata.</p></blockquote>\n<p>While on one hand this design goal is advantageous in that the output generated by typescript is very close to what hand written javascript would have looked like. And the runtime cost of typescript remains close to zero, therefore adoption of typescript does not alter performance characteristics of an application.</p>\n<p>However, this also implies that for cases when static typing cannot help us we need to separately write validators using a validation library (eg. <a href=\"https://github.com/hapijs/joi\">Joi</a>) which has to be kept in sync with the typescript types.</p>\n<p>This post outlines an approach to eliminate this redundancy using the <a href=\"https://github.com/gcanti/io-ts\">io-ts</a> library by <a href=\"https://gcanti.github.io/about.html\">Giulio Canti</a>. This approach has also been adopted by some other libraries like <a href=\"https://github.com/mobxjs/mobx-state-tree\">MobX State Tree</a> and <a href=\"https://github.com/pelotom/runtypes\">Runtypes</a>.</p>\n<p><span id=\"more-150\"></span></p>\n<h2>Runtime Boundaries</h2>\n<p>Runtime boundaries are cases where some untyped data from sources only available at runtime enters into our application. Examples include reading a JSON or CSV file from disk, getting a JSON payload from an HTTP request in a controller etc.</p>\n<p>In these scenarios, the data source is not available when the compiler is compiling the code, therefore the compiler can not guarantee the type correctness of the data structures we consume. For such a guarantee to exist, it would be needed to write a validator that validates the incoming data structures at runtime.</p>\n<p>It may be argued that if we have end-to-end control over our applications lifecycle then we could have ensured that any data source we are reading from at runtime would have ostensibly been generated by type safe code and therefore runtime validations would be unnecessary, however in many practical scenarios this is not the case. We need to fetch data from external APIs, user edited configuration files etc. which are outside the realm of the types defined in our application.</p>\n<p>Similar concerns are also applicable when the whole of the codebase is not yet using a type checker or we are writing a library which we would like to be usable by both javascript and typescript users. However, if the user is not using typescript (or cant be trusted to not use escape hatches like <code>any</code> or <code>@ts-ignore</code>), we can no longer make assumptions about the interface contracts and when these assumptions fail the error messages can be quite obtuse at times.</p>\n<p>So it is better to have strict validations at the boundaries when untyped data is coerced to typed data structures, so that the rest of our code can make strong assumptions about the type guarantees and can take advantage of a static type checker.</p>\n<h2>Runtime Types</h2>\n<p>io-ts introduces the concept of a runtime type (an instance of the<a href=\"https://github.com/gcanti/io-ts/blob/master/src/index.ts#L43\">&nbsp;Type class</a>) which represents a runtime validator for a typescript (static) type.</p>\n<blockquote><p>A value of type&nbsp;<code>Type&lt;A, O, I&gt;</code>&nbsp;(called runtime type) is the runtime representation of the static type&nbsp;<code>A</code>.</p></blockquote>\n<p>In practice, most of the times we would not be instantiating or subclassing Type class directly. Rather we would use many of the Type instances exposed by the library (or helper libraries like <a href=\"https://github.com/gcanti/io-ts-types\">io-ts-types</a>) and take advantage of composability of type instances.</p>\n<p>For example, io-ts exposes a string type, which we can use as follows:</p>\n<div>\n<!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4486e13c3515322799\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13c3515322799-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13c3515322799-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13c3515322799-3\">3</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4486e13c3515322799-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13c3515322799-2\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validationResult</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"lorefnon\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13c3515322799-3\"><span class=\"crayon-v\">validationResult</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// ==&gt; true</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0017 seconds] -->\n<br>\nWe can combine these types through combinators to build composite types which represent entities like domain models, request payloads etc. in our applications. For example:<p></p>\n</div>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4486e13da803934028\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13da803934028-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13da803934028-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13da803934028-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13da803934028-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4486e13da803934028-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13da803934028-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13da803934028-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">number</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13da803934028-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p></p>\n<p>Person is an instance of <a href=\"https://github.com/gcanti/io-ts/blob/master/src/index.ts#L452\">InterfaceType</a> class:</p>\n<p><img loading=\"lazy\" class=\"alignnone size-full wp-image-153\" src=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-15-45-05.png\" alt=\"\" width=\"576\" height=\"195\" srcset=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-15-45-05.png 576w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-15-45-05-300x102.png 300w\" sizes=\"(max-width: 576px) 100vw, 576px\"></p>\n<div>So this is conceptually equivalent of defining something like:</div>\n<div>\n<!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4486e13e4339670789\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13e4339670789-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13e4339670789-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13e4339670789-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13e4339670789-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4486e13e4339670789-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13e4339670789-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13e4339670789-3\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13e4339670789-4\"><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0009 seconds] -->\n<br>\nhad we written the same thing as a static type.<p></p>\n</div>\n<p>The advantage of using io-ts to define the runtime type is that we can validate the type at runtime, and we can also <a href=\"https://github.com/gcanti/io-ts#typescript-integration\">extract</a> the corresponding static type, so we dont have to define it twice.</p>\n<p><img loading=\"lazy\" class=\"alignnone size-full wp-image-154\" src=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-15-50-00.png\" alt=\"\" width=\"380\" height=\"74\" srcset=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-15-50-00.png 380w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-15-50-00-300x58.png 300w\" sizes=\"(max-width: 380px) 100vw, 380px\"></p>\n<div><a href=\"https://github.com/gcanti/io-ts/blob/master/src/index.ts#L29\">t.TypeOf</a>&nbsp;is a simple helper type to extract the static type which the runtime type represents.</div>\n<div></div>\n<div>As the type hint tooltip illustrates this is exactly the same as the interface above, except we didnt have to write it ourselves.</div>\n<div></div>\n<div>The library is quite unopinionated about what we do with the extracted type. The suggested approach is to use an Error Reporter to handle failures in a manner which makes sense in the specific context. We will consider some other contexts later in this post, but the most common usage is to throw an exception if the runtime type validation fails.</div>\n<div></div>\n<div>\n<!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4486e13eb591316359\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13eb591316359-11\">11</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-1\"><span class=\"crayon-e\">type </span><span class=\"crayon-v\">IPerson</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TypeOf</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Person</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-3\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requestPayload</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Lorefnon\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"30\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-4\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-5\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validationResult</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">requestPayload</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-6\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-7\"><span class=\"crayon-c\">// Throws if the value is not typecompliant</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-8\"><span class=\"crayon-c\">// No-op otherwise</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-9\"><span class=\"crayon-v\">ThrowReporter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">report</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">validationResult</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e13eb591316359-11\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> person:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IPerson</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validationResult</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0029 seconds] -->\n<br>\nThis will now fail with a validation error:<p></p>\n</div>\n<p><img loading=\"lazy\" class=\"alignnone size-full wp-image-159\" src=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-37-04.png\" alt=\"\" width=\"919\" height=\"173\" srcset=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-37-04.png 919w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-37-04-300x56.png 300w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-37-04-768x145.png 768w\" sizes=\"(max-width: 919px) 100vw, 919px\"></p>\n<div>We can use the extracted static just like any other typescript type:</div>\n<div></div>\n<div>&nbsp;<img loading=\"lazy\" class=\"alignnone size-full wp-image-156\" src=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-21-42.png\" alt=\"\" width=\"821\" height=\"308\" srcset=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-21-42.png 821w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-21-42-300x113.png 300w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-21-42-768x288.png 768w\" sizes=\"(max-width: 821px) 100vw, 821px\"></div>\n<div></div>\n<div>However because typescript compiler aggressively flattens type aliases, the error messages can sometimes become unwieldy for large complex types. Note that the error tooltip above does not contain the name IPerson.</div>\n<div></div>\n<div>A simple solution is to define an interface which extends from the generated type:</div>\n<div>\n<div>\n<p><img loading=\"lazy\" class=\"alignnone size-full wp-image-157\" src=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-35.png\" alt=\"\" width=\"843\" height=\"308\" srcset=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-35.png 843w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-35-300x110.png 300w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-35-768x281.png 768w\" sizes=\"(max-width: 843px) 100vw, 843px\"></p>\n</div>\n<p>This can be extended to compositions:</p>\n</div>\n<div><img loading=\"lazy\" class=\"alignnone size-full wp-image-158\" src=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-59.png\" alt=\"\" width=\"837\" height=\"600\" srcset=\"/wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-59.png 837w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-59-300x215.png 300w, /wp-content/uploads/2018/03/Screenshot-from-2018-03-25-16-29-59-768x551.png 768w\" sizes=\"(max-width: 837px) 100vw, 837px\"></div>\n<div></div>\n<h2><span style=\"font-family: 'Libre Baskerville', serif; font-style: italic;\">Encoding/Decoding</span></h2>\n<p>We noted above that we used the decode method when performing a type validation at runtime.</p>\n<p>When dealing with untyped data obtained at runtime boundaries we often also have to deal with serialization/deserialization and converting the raw data (structure) to a hierarchy of instances of typescript classes relevant to business logic.</p>\n<p>To handle these concerns, the Type class implements of Encoder and Decoder interfaces.</p>\n<blockquote><p>A &nbsp;runtime type can</p>\n<ul>\n<li>decode inputs of type&nbsp;<code>I</code>&nbsp;(through&nbsp;<code>decode</code>)</li>\n<li>encode outputs of type&nbsp;<code>O</code>&nbsp;(through&nbsp;<code>encode</code>)</li>\n<li>be used as a custom type guard (through&nbsp;<code>is</code>)</li>\n</ul>\n</blockquote>\n<p>In a wide number of cases (eg. the examples above) our output type will be same as the static type which the runtime type represents.</p>\n<p>An example where having a separate output type can be useful can be seen in the <a href=\"https://github.com/gcanti/io-ts-types/blob/master/src/Date/DateFromISOString.ts\">DateFromISOStringType</a> where the output type can be an ISO formatted String.</p>\n<p>So we can, for instance, use this runtime type to decode request payloads where the date string is represented as an ISO formatted string. While decoding, this will be converted to a date instance. And when encoding output (eg. when sending response back to client) this will be serialized to a string as per the&nbsp;ISO&nbsp;8601 extended&nbsp;format.</p>\n<p>In this case, this circumvents the limitation of a date type not being supported by json but in general, this strategy can be extended to do things like auto instantiation of Model classes in our application from request payload.</p>\n<h2>Integrations</h2>\n<p>A <a href=\"https://github.com/gcanti/prop-types-ts\">react integration library</a> has been made available by the author of io-ts. This is similar to how prop-types in react used to work, but takes advantage of the more sophisticated runtime type system of io-ts.</p>\n<p>Given the simplicity of the core library and flexibility of error reports, it is also quite easy to integrate the reporters in other contexts.</p>\n<h3>Example : Express middleware</h3>\n<p>We had previously discussed the Throw Reporter for error handling.</p>\n<p>In web applications, we would typically want to reject requests with an appropriate HTTP code on validation failures. This is easily achieved by wrapping the io-ts PathReporter as a middleware. The example below illustrates an express middleware, but besides the middleware signature there is nothing express specific here.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4486e13f5802843459\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e13f5802843459-35\">35</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validationMiddleware</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reqType</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">any</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">express</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reqType</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">report</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PathReporter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">report</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-i\">res</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">406</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">success</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">errors</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">report</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-15\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-16\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">'/:requestId'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-e\">validationMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">params</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Ensure that requestId is 4 digit long</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">requestId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">refinement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">query</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Ensure that requestType query parameter</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// is either order or dispatch</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">requestType</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">union</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">literal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"order\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">literal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"dispatch\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">success</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e13f5802843459-35\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0093 seconds] -->\n<p></p>\n<h2>Limitations</h2>\n<p>The author of io-ts has highlighted some corner cases and workarounds for them in the README.</p>\n<p>These are typically situations where typescript compilers inference support is not good enough (yet) eg. recursively defined types. The solution is basically to write <a href=\"https://github.com/gcanti/io-ts#recursive-types\">helper types</a> manually.</p>\n<h2>Comparision with other solutions</h2>\n<h3>Dart/JS++</h3>\n<p>Languages like <a href=\"https://www.dartlang.org/\">Dart</a> and <a href=\"https://www.onux.com/jspp/\">JS++</a> have runtime type systems. While both are very interesting, and in my opinion superior type systems (esp. given that Darts type system is now <a href=\"https://www.dartlang.org/guides/language/sound-dart#sound-type-system\">strict and&nbsp;&nbsp;sound</a>, unlike Typescript which considers neither of these to be a design goal), they are not practical solutions for many of the cases I have to deal with.</p>\n<p>In case of JS++ the community adoption is simply too small (as of yet) and in case of Dart there is a significant interop overhead and dart bindings for many libraries are not available yet. Adopting Dart almost implies adopting an another ecosystem.</p>\n<h3>ts-runtime</h3>\n<p>A very interesting attempt has been made by Fabian Pirklbauer in the&nbsp;<a href=\"https://github.com/fabiandev/ts-runtime\">ts-runtime</a>&nbsp;project to extend typescripts typesystem to runtime through AST transformations. This is a fairly complex and ambitious endeavour and this is reflected in the&nbsp;<a href=\"https://github.com/fabiandev/ts-runtime#limitations\">numerous corner cases</a> that author has highlighted in the documentation. Even if this were production ready (which it is currently not) Id be sceptical of adopting this unless this were to be officially supported by typescript team.</p>\n<p>I dont find the complexity (of extending the entire type system transparently to runtime) warranted because typically we would want these validations specifically at runtime boundaries and for the rest of the code static type checking would naturally suffice.</p>\n<h3>typescript-is</h3>\n<p>Wouter van Heeswijks typescript-is takes the opposite approach to io-ts and generates runtime types from static types. It is philosophically similar to ts-runtime but limits itself in scope by handling primitives and interfaces.</p>\n<p>Type guards are generated using <a href=\"https://github.com/Microsoft/TypeScript/wiki/Using-the-Compiler-API#a-simple-transform-function\">typescript transformers</a>. This is an interesting approach, and while it requires some configuration during the build step it is quite simple to use.</p>\n<p>Unlike io-ts you give up control over the runtime type, so things like custom encoding/decoding logic etc. have to be handled at a separate layer. I find that to be an acceptable compromise in most scenarios.</p>\n<p>Also, the runtime overhead of this library is much less compared other runtime type implementations here, because it compiles down to a simple chain of if-else statements:</p>\n<p>Taking an example from README:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4486e1403853465711\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e1403853465711-14\">14</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-1\"><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'typescript-is'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-2\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-3\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyInterface</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">someObject</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">without</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-7\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-8\"><span class=\"crayon-m\">const</span><span class=\"crayon-v\"> foreignObject:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">someObject</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'obtained from the wild'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">without</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'type safety'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-9\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-10\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">is</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">MyInterface</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foreignObject</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Call expression returns true</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">someObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foreignObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">someObject</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// type: string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">without</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foreignObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">without</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// type: string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e1403853465711-14\"><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0036 seconds] -->\n<p></p>\n<p>The if condition in the snippet above compiles down to:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba4486e140d289422725\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba4486e140d289422725-15\">15</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"object\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">!</span><span class=\"crayon-t\">Array</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"someObject\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"someObject\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"without\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-r\">typeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"without\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foreignObject</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-11\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Call expression returns true</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">someObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foreignObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">someObject</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// type: string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">without</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foreignObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">without</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// type: string</span></div><div class=\"crayon-line\" id=\"crayon-5fba4486e140d289422725-15\"><span class=\"crayon-sy\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0033 seconds] -->\n<p></p>\n<p>The cost is obviously that the generated code is bloated with repetitive assertion logic. The project may benefit from some facility to extract the assertion logic into reusable validators.</p>\n<h3>typescript-json-schema</h3>\n<p>This project takes a somewhat different route and generates <a href=\"https://json-schema.org/\">JSON schema</a> from typescript sources. The idea of encoding validation logic as json has never appealed to me, but if are working with other systems that already have good support JSON schema (eg. MongoDB) then this may be a good choice.</p>\n<p>However, io-ts is strictly more powerful than validating against a generated JSON schema because we have much more control over the runtime types.</p>\n<h3>Runtypes</h3>\n<p>Tom Crocketts <a href=\"https://github.com/pelotom/runtypes\">runtypes</a> project is very similar to io-ts in that it uses the same concept of Runtime Types. However it does not deal with encoding/decoding values and hence the resultant API is somewhat simpler than io-ts.</p>\n<p>However, there are some <a href=\"https://github.com/pelotom/runtypes/issues/42\">known issues</a> around handling of mapped types which have already been <a href=\"https://github.com/gcanti/io-ts/pull/144\">addressed</a> in io-ts.</p>\n\n\n    ",
            "tags": [
                "Typescript"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/03/16/a-vagrantdocker-based-workflow-for-clojure-web-development/",
            "url": "https://lorefnon.me/2018/03/16/a-vagrantdocker-based-workflow-for-clojure-web-development/",
            "title": "A Vagrant+Docker based workflow for clojure web development",
            "date_published": "2018-03-16T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>This post outlines a container based development workflow using Vagrant and Docker.</p>\n<p>Many common docker tutorials (eg. the official <a href=\"https://nodejs.org/en/docs/guides/nodejs-docker-webapp/\" target=\"_blank\" rel=\"noopener\">node tutorial</a>) suggest a workflow where projects source is copied onto the image, which is then built and run through docker. This approach is not really practical for clojure development as normal clojure programming leans heavily on rapid prototyping and REPL driven development.</p>\n<p>The setup below utilizes <a href=\"https://www.vagrantup.com/\">Vagrant</a> and <a href=\"https://docs.docker.com/storage/volumes/\">docker volumes</a> to setup a development environment which ensures reproducibility and container isolation while retaining the short feedback cycle which clojure developers take pride in.</p>\n<p><span id=\"more-135\"></span></p>\n<p>Our tiny <a href=\"https://www.vagrantup.com/docs/vagrantfile/\">Vagrantfile</a> looks something like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b42362678289\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b42362678289-21\">21</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-1\"><span class=\"crayon-v\">Vagrant</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">configure</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">config</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">define</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"pedestal-dev\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">primary</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">true</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">provider</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"docker\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"clojure:lein-2.8.1-alpine\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">create_args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"--user=#{Process.uid}:#{Process.gid}\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"--workdir=/app/pedestal_demo\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"HOME\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"_JAVA_OPTIONS\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-Duser.home=/home\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-k\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"9000:9000\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-s\">\"8080:8080\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">synced</span><span class=\"crayon-sy\">_</span>folder<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/app/pedestal_demo\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">synced</span><span class=\"crayon-sy\">_</span>folder<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./.docker_home\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-20\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b42362678289-21\"><span class=\"crayon-st\">end</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0033 seconds] -->\n<p>A <a href=\"https://www.vagrantup.com/docs/multi-machine/\" target=\"_blank\" rel=\"noopener\">multi-machine setup</a> makes it easy for us to later add additional services like databases etc. in the same Vagrant file and manage and run them together.</p>\n<p>The current directory is the project directory which will be mounted as <code>/app/pedestal_home</code>. The <code>synced_folder</code> terminology is slightly confusing in this context, but as Vagrant docker provider <a href=\"https://www.vagrantup.com/docs/docker/basics.html\" target=\"_blank\" rel=\"noopener\">documentation</a> clarifies:</p>\n<blockquote><p>When using Docker, Vagrant automatically converts synced folders and networking options into Docker volumes and forwarded ports</p></blockquote>\n<p>Using the docker-run command we can run arbitrary commands within the docker container.</p>\n<p>For example: We can use <code>lein new</code> to scaffold our pedestal application:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b50805539175\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b50805539175-13\">13</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-1\">&gt; $ vagrant docker-run pedestal-dev -- lein new pedestal-service pedestal_demo :to-dir .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-2\">==&gt; pedestal-dev: Creating the container...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-3\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp; Name: pedestal_demo_pedestal-dev_1521227442_1521227442&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-4\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp;Image: clojure:lein-2.8.1-alpine&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-5\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp;&nbsp;&nbsp;Cmd: lein new pedestal-service pedestal_demo :to-dir .&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-6\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Volume: /home/lorefnon/workspace/pedestal_demo:/app/pedestal_demo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-7\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Volume: /home/lorefnon/workspace/pedestal_demo/.docker_home:/home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-8\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-9\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Container is starting. Output will stream in below...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-10\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-11\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Retrieving pedestal-service/lein-template/0.5.3/lein-template-0.5.3.pom from clojars&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-12\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Retrieving pedestal-service/lein-template/0.5.3/lein-template-0.5.3.jar from clojars&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b50805539175-13\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Generating a pedestal-service application called pedestal_demo.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0007 seconds] -->\n<p>This directory structure will be populated directly in the host, and can be edited by an editor (<a href=\"https://www.gnu.org/software/emacs/\">Emacs</a>, obviously) installed in the host operating system</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b55300550442\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b55300550442-35\">35</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-1\">&gt; $ tree . -a -I \".git|.vagrant\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-2\">.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-3\"> Capstanfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-4\"> config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-5\">&nbsp;&nbsp;  logback.xml&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-6\"> Dockerfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-7\"> .docker_home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-8\">&nbsp;&nbsp;  .gitkeep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-9\">&nbsp;&nbsp;  .lein&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-10\">&nbsp;&nbsp;  .m2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-11\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  repository&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-12\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pedestal-service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-13\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  lein-template&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-14\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  0.5.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-15\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  lein-template-0.5.3.jar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-16\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  lein-template-0.5.3.jar.sha1&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-17\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  lein-template-0.5.3.pom&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-18\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  lein-template-0.5.3.pom.sha1&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-19\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  _remote.repositories&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-20\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  maven-metadata-clojars.xml&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-21\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  maven-metadata-clojars.xml.sha1&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-22\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  resolver-status.properties&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-23\"> .gitignore&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-24\"> project.clj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-25\"> README.md&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-26\"> src&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-27\">&nbsp;&nbsp;  pedestal_demo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-28\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  server.clj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-29\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  service.clj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-30\"> test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-31\">&nbsp;&nbsp;  pedestal_demo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-32\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  service_test.clj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-33\"> Vagrantfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-34\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b55300550442-35\">12 directories, 19 files&nbsp;&nbsp;&nbsp;&nbsp; </div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0019 seconds] -->\n<p>Not that we are passing current users UID and GID in the Vagrantfile through the <code>--user</code> argument (All <a href=\"https://www.vagrantup.com/docs/docker/configuration.html#create_args\" target=\"_blank\" rel=\"noopener\">create_args</a> are passed directly to docker).</p>\n<p>If this was not done, files would be owned by root (docker daemon always runs as root). <a href=\"https://twitter.com/mccode\">Marc Campbell</a> has written a good <a href=\"https://medium.com/@mccode/understanding-how-uid-and-gid-work-in-docker-containers-c37a01d01cf\" target=\"_blank\" rel=\"noopener\">post</a> on how uid and gid work in docker containers.</p>\n<p>Also in environment of host we set:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b5a145834156\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b5a145834156-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b5a145834156-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b5a145834156-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b5a145834156-4\">4</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b5a145834156-1\"><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b5a145834156-2\"><span class=\"crayon-s\">\"HOME\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"without docker/home\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b5a145834156-3\"><span class=\"crayon-s\">\"_JAVA_OPTIONS\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-Duser.home=/home\"</span></div><div class=\"crayon-line\" id=\"crayon-5fba44d483b5a145834156-4\"><span class=\"crayon-k\">}</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0005 seconds] -->\n<p>Dockers default <code>HOME</code> env variable defaults to <code>/</code>, which leiningen wouldnt have write permission to.<br>\nI had not expected to be required to set the <code>_JAVA_OPTIONS</code> but in its absence Maven dependencies are installed in <code>?/.m2/repo</code> (Yes, a directory named <code>?</code>), presumably because there is no user with specified UID in container context.</p>\n<p>Also we dont want dependencies to be downloaded for each container run, so having them in a synced folder <code>.docker_home</code> is useful:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b5d514819086\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b5d514819086-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b5d514819086-1\"><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">synced</span><span class=\"crayon-sy\">_</span>folder<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./.docker_home\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home\"</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0004 seconds] -->\n<p>Thanks to the line above, all our maven dependencies are downloaded in <code>.docker_home/.m2/repository</code> as seen in the tree above.</p>\n<p>Also note that we have set our workdir through a create_arg to the project folder which allows us to run lein directory without having to cd into that directory first (Dockers workdir defaults to <code>/</code>).</p>\n<p>We can invoke lein in a similar fashion to run <a href=\"https://github.com/clojure/tools.nrepl\">nrepl</a>:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b60291576527\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b60291576527-10\">10</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-1\">&gt; $ vagrant docker-run pedestal-dev -- lein repl :headless :host 0.0.0.0 :port 9000</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-2\">==&gt; pedestal-dev: Creating the container...</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-3\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp; Name: pedestal_demo_pedestal-dev_1521148041_1521148041</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-4\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp;Image: clojure:lein-2.8.1-alpine</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-5\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:&nbsp;&nbsp;&nbsp;&nbsp;Cmd: bash -c cd /app ; lein repl :headless :host 0.0.0.0 :port 9000</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-6\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Volume: /home/lorefnon/workspace/pedestal_demo:/app</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-7\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-8\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: Container is starting. Output will stream in below...</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-9\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev:</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b60291576527-10\">&nbsp;&nbsp;&nbsp;&nbsp;pedestal-dev: nREPL server started on port 9000 on host 0.0.0.0 - nrepl://0.0.0.0:9000</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0003 seconds] -->\n<p>We can use <a href=\"https://docs.docker.com/engine/reference/commandline/ps/\">docker ps</a> and <a href=\"https://docs.docker.com/engine/reference/commandline/inspect/\">docker inspect</a> to find the container ID and IP address of the container respectively.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b63995262845\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b63995262845-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b63995262845-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b63995262845-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b63995262845-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b63995262845-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b63995262845-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b63995262845-7\">7</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b63995262845-1\">lorefnon@ubuntu ~/workspace/pedestal_demo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b63995262845-2\">&gt; $ docker ps&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b63995262845-3\">CONTAINER ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NAMES&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b63995262845-4\">99681a4c6ad0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clojure:lein-2.8.1-alpine&nbsp;&nbsp; \"lein repl :headless\"&nbsp;&nbsp; 2 minutes ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Up 2 minutes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pedestal_demo_pedestal-dev_1521227897_1521227897&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b63995262845-5\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b63995262845-6\">lorefnon@ubuntu ~/workspace/pedestal_demo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44d483b63995262845-7\">&gt; $ docker inspect 99681a4c6ad0</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0008 seconds] -->\n<p><code>docker inspect</code> outputs a large JSON object, so tools like <a href=\"https://stedolan.github.io/jq/\">jq</a> come in handy:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b67734327368\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b67734327368-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b67734327368-2\">2</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b67734327368-1\">&gt; $ docker inspect 99681a4c6ad0 | jq .[0].NetworkSettings.Networks.bridge.IPAddress </div><div class=\"crayon-line\" id=\"crayon-5fba44d483b67734327368-2\">\"172.17.0.2\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0002 seconds] -->\n<p>Now, assuming we have <a href=\"https://github.com/clojure-emacs/cider\">cider</a> installed in emacs, we can invoke: <code>M-x cider-connect</code> and in the prompt that follows enter above IP address, and <code>9000</code> as the port.</p>\n<p>This is the port on which we have asked nrepl to bind to, and our Vagrant file maps this port to the same port in host machine.</p>\n<p>We should now have direct access to nREPL running on docker within our editor running on host.</p>\n<p>To conclude, it should be obvious at this point that we can also run our web server in a similar way:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44d483b6a840682122\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44d483b6a840682122-1\">1</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44d483b6a840682122-1\">$ vagrant docker-run pedestal-dev -- lein run-dev</div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0001 seconds] -->\n<p>After this we should be able to visit the containers mapped IP address in our browser running in host.</p>\n<p>It is not a coincidence that the default port on which pedestal server is configured to listen to, is also configured to be mapped in our Vagrantfile.</p>\n<p>Note that we dont assume that the application is actually deployed as a docker container. There is nothing stopping us from building the application as an <a href=\"https://imagej.net/Uber-JAR\">uberjar</a> (within docker) and running it through any JVM compatible deployment solution.</p>\n\n\n    ",
            "tags": [
                "Vagrant",
                "Clojure",
                "Hashicorp"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/02/04/redux-loop-a-better-solution-for-managing-asynchronous-operations-in-redux/",
            "url": "https://lorefnon.me/2018/02/04/redux-loop-a-better-solution-for-managing-asynchronous-operations-in-redux/",
            "title": "Redux-loop: A better solution for managing asynchronous operations in redux",
            "date_published": "2018-02-04T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p>The lack of support for asynchronous operations in redux core has spawned a whole ecosystems for managing <em><strong>side-effects</strong></em>&nbsp;<sup><a id=\"side-effects-footer-link-back\" href=\"#side-effects-footer-link\">[1]</a></sup> in Redux.</p>\n<p>This post argues that the <a href=\"https://github.com/redux-loop/redux-loop\">redux-loop</a>&nbsp;library (1.5 k  as of this writing) is a much better solution for this job than other more popular alternatives like <a href=\"https://github.com/redux-saga/redux-saga\">redux-sagas</a> (11.8 k&nbsp;) and <a href=\"https://github.com/gaearon/redux-thunk\">redux-thunk</a> (7.8 k&nbsp;).</p>\n<p>As has always been prevalent in frontend ecosystem, popularity&nbsp; does not necessarily translate to better suitability.</p>\n<p><span id=\"more-113\"></span></p>\n<h1>What is redux-loop ?</h1>\n<p>Redux loop essentially exposes a <a href=\"https://github.com/reactjs/redux/blob/master/docs/Glossary.md#store-enhancer\">store enhancer</a>.</p>\n<p>Normally our reducers would take in the current state and action and return an updated state.</p>\n<p>For example:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44e6bd90c383944409\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd90c383944409-11\">11</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reducer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">action</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ADD_TODO'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// Derive new state from current state</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">isDone</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">// ... Other Cases</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-10\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd90c383944409-11\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0018 seconds] -->\n<p></p>\n<p>Redux encourages reducers to be pure functions and strongly discourages side-effects from <strong>being run from within reducers</strong> to <a href=\"https://hashnode.com/post/how-do-you-explain-the-term-predictable-state-container-in-simple-words-ciizdac5300wege53dogz8aqk\">ensure predictability</a>.</p>\n<p>When redux-loops enhancer is installed, our reducer could also return a <em><strong>loop</strong></em>.</p>\n<p>While it is a somewhat confusing name, a loop, in this context, is a combination of two things:</p>\n<ol>\n<li>An updated state (which is what you would have normally returned), and</li>\n<li>A command (A plain object which describes an asynchronous operation to be executed).</li>\n</ol>\n<p>A command describes what asynchronous operation is to be run <strong>after</strong> this dispatch cycle. For example:</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44e6bd921466673431\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-9\">9</div><div class=\"crayon-num crayon-marked-num crayon-top\" data-line=\"crayon-5fba44e6bd921466673431-10\">10</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-11\">11</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-12\">12</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-13\">13</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-14\">14</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-15\">15</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-16\">16</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-17\">17</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-18\">18</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-19\">19</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-20\">20</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-21\">21</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-22\">22</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-23\">23</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-24\">24</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-25\">25</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-26\">26</div><div class=\"crayon-num crayon-marked-num\" data-line=\"crayon-5fba44e6bd921466673431-27\">27</div><div class=\"crayon-num crayon-marked-num crayon-bottom\" data-line=\"crayon-5fba44e6bd921466673431-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd921466673431-31\">31</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-1\"><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reducer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">action</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'TODO/CREATE'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// 1. Derive new state from updated State</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextState</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-7\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">isDone</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-9\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-marked-line crayon-top\" id=\"crayon-5fba44e6bd921466673431-10\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-11\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// 2. Describe what is to be done next through a command:</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Cmd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-13\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">createTask</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// An async function which takes the arguments below and returns a promise</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-c\">// Arguments to saveTask</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">successActionCreator</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Action which will be dispatched when the operation is successful</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TODO/CREATE/SUCCESS\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">payload</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">task</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-19\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">failActionCreator</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">&nbsp;&nbsp; </span><span class=\"crayon-c\">// Action which will be dispatched when the operation is complete</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TODO/CREATE/FAILURE\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">payload</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">error</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-25\">&nbsp;</div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// 3. Combine both in a loop:</span></div><div class=\"crayon-line crayon-marked-line\" id=\"crayon-5fba44e6bd921466673431-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextState</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextOperation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-marked-line crayon-bottom\" id=\"crayon-5fba44e6bd921466673431-28\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// ... Other Cases</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd921466673431-31\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0038 seconds] -->\n<p></p>\n<p>While it may not be obvious looking at the example above, our <strong>reducer is still a pure function</strong>.</p>\n<p>The Command that we return as a part of the loop in just an object describing an operation. Even though the API is called <code>Cmd.run</code>, it does not actually run the asynchronous operation from within the reducer. Redux-loop executes the operation (described by the cmd) once the dispatch cycle is over.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44e6bd929710407303\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num crayon-marked-num crayon-top crayon-bottom\" data-line=\"crayon-5fba44e6bd929710407303-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-7\">7</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-9\">9</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-11\">11</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-13\">13</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-15\">15</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-17\">17</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-19\">19</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-21\">21</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-23\">23</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-25\">25</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-27\">27</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-29\">29</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-31\">31</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-33\">33</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-35\">35</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-37\">37</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5fba44e6bd929710407303-39\">39</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line crayon-marked-line crayon-top crayon-bottom\" id=\"crayon-5fba44e6bd929710407303-1\">s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Component&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Store&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;redux-loop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-2\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-3\">User -----------------------&gt; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-4\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-5\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Click on \"Add Todo\"&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-6\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+-----------&gt;||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-7\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| onClick&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-8\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +------------------------&gt; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-9\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | disatch({&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-10\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; type: \"TODO/CREATE\",&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-11\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reducer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-12\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | })&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-13\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+--------------&gt; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-14\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-15\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-16\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-17\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&lt;--------------+--------------&gt; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-18\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;Apply&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; render&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ||&nbsp;&nbsp; nextState&nbsp;&nbsp;&nbsp;&nbsp; next&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;createTask&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-19\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;diff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ||&lt;------------------------+|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Operation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(async operation)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-20\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +-----------&gt; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-21\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;promise&nbsp;&nbsp;| |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-22\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | &lt;---------+ |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-23\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;dispatch({&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-24\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;type: \"TODO/CREATE/SUCCESS\", | &lt;-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-25\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;fulfill&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-26\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;})&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-27\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&lt;-------------------------------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-28\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-29\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reducer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-30\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+|------------&gt; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-31\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-32\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-33\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;-----------+ +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-34\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp; nextState&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-35\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; render&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-36\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;Apply&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&lt;------------------------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-37\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;diff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-38\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &lt;-----------+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class=\"crayon-line\" id=\"crayon-5fba44e6bd929710407303-39\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0044 seconds] -->\n<p></p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p>Interested readers are encouraged to explore the redux-loop documentation for advanced aspects. The rest of the post below compares redux-loop with prevalent alternatives.</p>\n<h1>A comparision with the alternatives</h1>\n<p>If you are writing a redux application today, it is likely that to manage asynchronous operations you are using either redux-thunks or redux-sagas, which are the most popular solutions in this space.</p>\n<p>I believe redux-loop is a better alternative to both of them.</p>\n<p>Redux-thunk encourages handling your asynchronous operations in action creators. The action creators can return thunks which can dispatch other actions when the operation has completed or when it fails.</p>\n<blockquote><p>Redux Thunk&nbsp;<a href=\"https://github.com/reactjs/redux/blob/master/docs/advanced/Middleware.md\">middleware</a>&nbsp;allows you to write action creators that return a function instead of an action. The thunk can be used to delay the dispatch of an action, or to dispatch only if a certain condition is met. The inner function receives the store methods&nbsp;<code>dispatch</code>&nbsp;and&nbsp;<code>getState</code>&nbsp;as parameters.</p></blockquote>\n<p>redux-sagas allows us to define long running generators in the application which can intercept arbitrary actions and perform asynchronous actions based on them.</p>\n<blockquote><p>The mental model is that a saga is like a separate thread in your application thats solely responsible for side effects.&nbsp;<code>redux-saga</code>&nbsp;is a redux middleware, which means this thread can be started, paused and cancelled from the main application with normal redux actions, it has access to the full redux application state and it can dispatch redux actions as well.</p></blockquote>\n<h2>Coherent mental model</h2>\n<p>With redux-loop, when you are exploring your application codebase (or trying to debug a behavior) and trying to deduce what will happen due to an action dispatch, the starting point of investigation is always the reducer irrespective of whether the action corresponds to a synchronous operation or asynchronous.</p>\n<p>As the authors have explained this in the README:</p>\n<blockquote><p>With&nbsp;<code>redux-loop</code>, the <strong>reducer doesnt just decide what happens&nbsp;<em>now</em>&nbsp;due to a particular action, it decides what happens&nbsp;<em>next</em>.</strong> All of the behavior of your application can be traced through one place, and that behavior can be easily broken apart and composed back together.</p></blockquote>\n<p><strong>This is not the case with either thunks or sagas.</strong></p>\n<p>In case of thunks, to investigate the impact of an action, along with all reducers which handle the action, we also need to go to each action creator which may have dispatched this action and investigate the thunks which they return.</p>\n<p>In case of sagas, along with all reducers, we need to investigate each saga which may have intercepted the action.</p>\n<p>In this regard it feels like a natural extension of the Redux API as opposed to a solution bolted on top of redux pretending that asynchronous operations are fundamentally different from synchronous operations.</p>\n<h2>Dispatch is decoupled from handling of operation</h2>\n<p>With redux-thunks, <strong>we dont have a way to intercept actions when we dont have control over the dispatch site.&nbsp;</strong></p>\n<p>Being able to intercept actions without modifying the dispatch site is handy in multiple scenarios. Let us say we want to show a loader when&nbsp;any asynchronous operation is in progress.</p>\n<p>We can implement this using redux-loop without all the action creators being aware of this. A single reducer can intercept all actions suffixed with <code>_PENDING</code>&nbsp;and <code>_COMPLETE</code>&nbsp;and use them to update the progress bar state in redux.</p>\n<p>Redux-sagas is capable of such interception, but debugging sagas can be quite difficult owning to the fact that sagas can spawn other sagas during their lifetime, so investigation of the impact of an action requires knowledge of what all sagas were running at the point of dispatch.</p>\n<h2>Time variant local state outside redux</h2>\n<p>This is essentially an extension of the above argument. Because sagas are long running, they make it very easy (and even encourage) to have local implicit state within the sagas which is not in the redux store and can not be investigated through redux-dev-tools. Based on this implicit time variant state encapsulated within local scopes of long running generators, sagas can do different things when same action is dispatched and in large complex applications this can be difficult to reason about.</p>\n<p>I believe it is much better to encode all these transient states of various asynchronous operation, which are in progress, within the redux store so that the store remains the primary source of truth in the application. It is much easier to reason about the behavior of application when the outcome of an action is directly deducible from store state and action.</p>\n<p>Can the same approach be adopted while using sagas ? Sure. But for a vast majority of use cases, redux-sagas flexibility  especially the ability to arbitrarily fork and join sagas  is an undesirable footgun which can make post-mortem debugging a whole lot more complex.</p>\n<p>While it is likely that tooling efforts like <a href=\"https://github.com/redux-saga/redux-saga-devtools\">redux-saga-devtools&nbsp;</a>will help alleviate many of the debugging headaches associated with sagas, but I still prefer to treat the redux store as the singular state machine driving the application.</p>\n<hr>\n<p><sup><a id=\"side-effects-footer-link\" href=\"#side-effects-footer-link-back\">[1]</a></sup>&nbsp;I explicitly avoid the usage of the term <strong>side-effect&nbsp;</strong>because it seems to imply that these operations are something of lesser importance where as, in reality, for most applications, these side effects are the reasons these applications exist.</p>\n<p>In frontend application asynchrony is so prevalent that management of asynchronous flow of control is often the single most important thing in the application.</p>\n\n\n    ",
            "tags": [
                "Javascript",
                "Redux",
                "Redux-loop",
                "Frontend"
            ]
        },
        {
            "id": "https://lorefnon.me/2018/01/28/using-helm-to-select-tide-completion-candidates/",
            "url": "https://lorefnon.me/2018/01/28/using-helm-to-select-tide-completion-candidates/",
            "title": "Using helm to select tide completion candidates",
            "date_published": "2018-01-28T00:00:00.000Z",
            "content_html": "<link rel=\"stylesheet\" href=\"/css/crayon.min.css\" >\n<link rel=\"stylesheet\" href=\"/css/crayon-flatui-light.css\" >\n\n\n\n\t<p><a href=\"https://github.com/ananthakumaran/tide\">Tide</a> (TypeScript Interactive Development Environment for Emacs) uses a custom <a href=\"https://github.com/ananthakumaran/tide/blob/master/tide-lv.el\">hydra-derived popup menu</a> for prompting the user to select candidates when there are many completion options available.</p>\n<p>However, this is jarring when the rest of your emacs environment is configured to use <a href=\"https://github.com/emacs-helm/helm\">helm</a> as the completion engine.</p>\n<p>Fortunately, this is easy to fix by overriding the <code>tide-popup-select-item</code> implementation to use a custom helm source derived from the completion list.</p>\n<p><span id=\"more-101\"></span></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\n\n\t\t<div id=\"crayon-5fba44f01e7f6640911890\" class=\"crayon-syntax crayon-theme-flatui-light crayon-font-inconsolata crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 15px !important; line-height: 20px !important;\">\n\t\t\n\t\t\t<div class=\"crayon-plain-wrap\"></div>\n\t\t\t<div class=\"crayon-main\" style=\"\">\n\t\t\t\t<table class=\"crayon-table\">\n\t\t\t\t\t<tbody><tr class=\"crayon-row\">\n\t\t\t\t<td class=\"crayon-nums\" data-settings=\"hide\">\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 15px !important; line-height: 20px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5fba44f01e7f6640911890-1\">1</div><div class=\"crayon-num\" data-line=\"crayon-5fba44f01e7f6640911890-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5fba44f01e7f6640911890-3\">3</div><div class=\"crayon-num\" data-line=\"crayon-5fba44f01e7f6640911890-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5fba44f01e7f6640911890-5\">5</div><div class=\"crayon-num\" data-line=\"crayon-5fba44f01e7f6640911890-6\">6</div></div>\n\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 15px !important; line-height: 20px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5fba44f01e7f6640911890-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-r\">defun</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tide-popup-select-item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">prompt</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">list</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44f01e7f6640911890-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">helm</span></div><div class=\"crayon-line\" id=\"crayon-5fba44f01e7f6640911890-3\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">sources</span></div><div class=\"crayon-line\" id=\"crayon-5fba44f01e7f6640911890-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">helm-build-sync-source</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">prompt</span></div><div class=\"crayon-line\" id=\"crayon-5fba44f01e7f6640911890-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">candidates</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">list</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-5fba44f01e7f6640911890-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*Tide Completion Candidates*\"</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody></table>\n\t\t\t</div>\n\t\t</div>\n<!-- [Format Time: 0.0017 seconds] -->\n<p><img loading=\"lazy\" class=\"alignnone size-full wp-image-102\" src=\"/wp-content/uploads/2018/01/tide-helm.gif\" alt=\"\" width=\"499\" height=\"725\"></p>\n<hr>\n<p>As far as auto-completion is concerned, since tide configures a company-backend, it is possible to directly use <a href=\"https://github.com/Sodel-the-Vociferous/helm-company\">helm-company</a> to use helm for selecting auto-completion candidates.</p>\n\n\n    ",
            "tags": [
                "Emacs",
                "Helm"
            ]
        },
        {
            "id": "https://lorefnon.me/2016/12/03/on-webpack-and-source-map-integration.html",
            "url": "https://lorefnon.me/2016/12/03/on-webpack-and-source-map-integration.html",
            "title": "On Webpack and Source Map integration",
            "date_published": "2016-12-03T00:00:00.000Z",
            "content_html": "<p>Webpack is the forerunner in the javascript module bundling space. One of the important aspects that plays a key role in debuggability of javascript applications is source map integration - so we can debug the original source code  after transpilation.</p>\n\n<p>Webpack has a <code>devtool</code> option which (just like everything in webpack) supports a variety of choices which can be beffudling even though the official documentation has a <a href=\"https://webpack.github.io/docs/configuration.html#devtool\">dedicated section</a> on it.</p>\n\n<p>Our primary focus would be on a babel transpiled project, though sourcemaps can be effectively used with many other compile-to-js languages like dart, coffeescript, opal(ruby) etc, as well as languages which target css.</p>\n\n<hr>\n\n<p>Before we delve into different supported <code>devtool</code> options, let us briefly look into how a webpack generated file typically looks like.</p>\n\n<a class=\"header-link\" href=\"#webpack-bootstrapper\"><h1 id=\"webpack-bootstrapper\">Webpack bootstrapper</h1></a>\n\n<p>A typical bundle generated by webpack file is essentially an IIFE that is passed an array of compiled modules.</p>\n<div class=\"highlight\"><pre><code class=\"javascript language-javascript\" data-lang=\"javascript\"><span class=\"p\">(</span><span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">modules</span><span class=\"p\">)</span> <span class=\"p\">&#123;</span>\n  <span class=\"p\">...</span> <span class=\"nx\">bootstrapper</span> <span class=\"nx\">goes</span> <span class=\"nx\">here</span>\n<span class=\"p\">&#125;)([</span>\n  <span class=\"p\">...</span> <span class=\"nx\">modules</span> <span class=\"nx\">go</span> <span class=\"nx\">here</span>\n<span class=\"p\">])</span>\n</code></pre></div>\n<p>The bootstrapper basically defines a minimal dependency loader <code>__webpack_require__</code> which is injected into each module . The entry module (modules[0]) is invoked first and uses <code>__webpack_require__</code> to load other dependencies (if any). Irrespective of whether the original source code used commonjs/amd/ES6 imports, they all are transpiled to use <code>__webpack_require__</code>.</p>\n\n<a class=\"header-link\" href=\"#different-devtool-options-\"><h1 id=\"different-devtool-options-\">Different devtool options:</h1></a>\n\n<p>The documentation mentions following options as valid values for the devtool config, and outlines their characteristics in a helpful table:</p>\n\n<div class=\"table-wrapper\"><table>\n<thead>\n<tr>\n<th>devtool</th>\n<th>build speed</th>\n<th>rebuild speed</th>\n<th>production supported</th>\n<th>quality</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>eval</td>\n<td>+++</td>\n<td>+++</td>\n<td>no</td>\n<td>generated code</td>\n</tr>\n<tr>\n<td>cheap-eval-source-map</td>\n<td>+</td>\n<td>++</td>\n<td>no</td>\n<td>transformed code (lines only)</td>\n</tr>\n<tr>\n<td>cheap-source-map</td>\n<td>+</td>\n<td>o</td>\n<td>yes</td>\n<td>transformed code (lines only)</td>\n</tr>\n<tr>\n<td>cheap-module-eval-source-map</td>\n<td>o</td>\n<td>++</td>\n<td>no</td>\n<td>original source (lines only)</td>\n</tr>\n<tr>\n<td>cheap-module-source-map</td>\n<td>o</td>\n<td>-</td>\n<td>yes</td>\n<td>original source (lines only)</td>\n</tr>\n<tr>\n<td>eval-source-map</td>\n<td></td>\n<td>+</td>\n<td>no</td>\n<td>original source</td>\n</tr>\n<tr>\n<td>source-map</td>\n<td></td>\n<td></td>\n<td>yes</td>\n<td>original source</td>\n</tr>\n</tbody>\n</table></div>\n\n<p>The different dev-tools option provides different levels of ease of debuggability. We start with the most basic one:</p>\n\n<a class=\"header-link\" href=\"#eval\"><h2 id=\"eval\">eval</h2></a>\n\n<p>| Each module is executed with eval and //@ sourceURL.</p>\n\n<p>With eval each module entry in the modules array looks something like this:</p>\n<div class=\"highlight\"><pre><code class=\"js language-js\" data-lang=\"js\"><span class=\"nb\">eval</span><span class=\"p\">(</span><span class=\"s2\">\"'use strict';...generated code of index.js...//# sourceURL=webpack:///./index.js?\"</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>In this mode the only mapping we have is at file level so exceptions point to the right file in the source code, but not to the right line number of original source code. But while debugging we are not really debugging the original code that we wrote.</p>\n\n<p>It is not really a great choice for compiled code. It is possible to deal with it for languages which are semantically similar to ES2015 like coffeescript or basic babel compilation without async/await transforms (which result in significant restructuring of code) because it is easy to mentally map the compiled source to original code, but it is advisable that we look into the other options below for easier debuggability.</p>\n\n<p>It is to be noted that the line numbers in exception stack traces not only don't match with original code before babel transpilation, it might also not match with the babel transpiled code because of webpack specific transformations that happen before bundle generation. So we can not reliable depend on our editor plugins' babel transpile output to get the line numbers from exceptions.</p>\n\n<p>However, there is one advantage: During debugging, it is easy to copy a part of the source code from the sources panel at any point, tweak it a bit and evaluate it in the javascript console. While this feature is often taken for granted by developers habituated to vanilla javascript, we loose this in most of the other alternatives below.</p>\n\n<p>Because of its simplicity the generation time is quite fast (in fact fastest among all the options below) and does not significantly add to the size of generated bundle.</p>\n\n<p>However, it should not be used in production because eval potentially <a href=\"https://stackoverflow.com/questions/86513/why-is-using-the-javascript-eval-function-a-bad-idea\">disables</a> multiple performance optimizations that javascript engines perform.</p>\n\n<a class=\"header-link\" href=\"#cheap-eval-source-map\"><h2 id=\"cheap-eval-source-map\">cheap-eval-source-map</h2></a>\n\n<p>The above table mentions the quality as \"transformed code (lines code)\". What this means is that the code visible in browser devtools is the code <em>after</em> being transformed by babel (or other loaders) but before final stage webpack specific transformations, which transforms the require statements to use <code>__webpack_require__</code>, injects errors for missing modules etc.</p>\n\n<p>In this mode each module entry in the modules array looks something like this:</p>\n<div class=\"highlight\"><pre><code class=\"js language-js\" data-lang=\"js\"><span class=\"nb\">eval</span><span class=\"p\">(</span><span class=\"s2\">\"'use strict';...generated code of index.js ...//# sourceMappingURL=data:application/json;charset=utf-8;base64,...base 64 encoded string of sourcemap...\"</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>The last part is a base64 encoded string of a JSON source map similar to the following:</p>\n<div class=\"highlight\"><pre><code class=\"json language-json\" data-lang=\"json\"><span class=\"p\">&#123;</span>\n  <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"mi\">3</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"file\"</span><span class=\"p\">:</span> <span class=\"s2\">\"0.js\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"sources\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"s2\">\"webpack:///./index.js?8920\"</span>\n  <span class=\"p\">],</span>\n  <span class=\"nt\">\"sourcesContent\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"s2\">\"'use strict';\\n\\nvar _react = require('react');\\n\\nvar _react2 = _interopRequireDefault(_react);\\n\\nvar _reactDom = require('react-dom');\\n\\nfunction _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;\\n\\ndebugger;\\n\\n(0, _reactDom.render)(_react2.default.createElement(\\n  'div',\\n  null,\\n  'Hello world'\\n), document.getElementById('root'));\\n\\n\\n//////////////////\\n// WEBPACK FOOTER\\n// ./index.js\\n// module id = 0\\n// module chunks = 0\"</span>\n  <span class=\"p\">],</span>\n  <span class=\"nt\">\"mappings\"</span><span class=\"p\">:</span> <span class=\"s2\">\"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"sourceRoot\"</span><span class=\"p\">:</span> <span class=\"s2\">\"\"</span>\n<span class=\"p\">&#125;</span>\n</code></pre></div>\n<p>The code in <code>sourcesContent</code> is the source code after babel transformation, so we <em>can</em> use editor plugin's babel transformation preview (or for that matter babel cli) to get lines reported in exceptions.</p>\n\n<p>Besides the above, the advantages and disadvantages are mostly the same as <code>eval</code> and is basically only useful if the code being webpacked is vanilla javascript which is loaded through webpack. For debugging original source code before babel transpilation, other options are outlined below.</p>\n\n<p>This should also not be used in production because of not only the eval related issues highlighted above, but also because generated code is separately embedded in the code which increases the size of bundle significantly. For production usage it is desirable that the source map be saved as separate files which are loaded on demand during debugging sessions.</p>\n\n<p>While typically line numbers would not match with the original source code if loaders (like babel) are used for transformation, however babel has a option <code>retainLines</code> which will result in output structured in such a way that line numbers of transpiled code match original source line numbers. This obviously does not retain the column numbers.</p>\n\n<p>In the example below we see a simple example of original and babel-transpiled code with retainLines=true</p>\n<div class=\"highlight\"><pre><code class=\"js language-js\" data-lang=\"js\"><span class=\"kr\">import</span> <span class=\"nx\">React</span> <span class=\"nx\">from</span> <span class=\"s1\">'react'</span><span class=\"p\">;</span>\n<span class=\"kr\">import</span> <span class=\"p\">&#123;</span><span class=\"nx\">render</span><span class=\"p\">&#125;</span> <span class=\"nx\">from</span> <span class=\"s1\">'react-dom'</span><span class=\"p\">;</span>\n\n<span class=\"nx\">render</span><span class=\"p\">(</span>\n  <span class=\"o\">&lt;</span><span class=\"nx\">div</span><span class=\"o\">&gt;</span>\n    <span class=\"nx\">Hello</span> <span class=\"nx\">world</span>\n  <span class=\"o\">&lt;</span><span class=\"err\">/div&gt;,</span>\n  <span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">getElementById</span><span class=\"p\">(</span><span class=\"s1\">'root'</span><span class=\"p\">)</span>\n<span class=\"p\">);</span>\n</code></pre></div>\n<div class=\"highlight\"><pre><code class=\"js language-js\" data-lang=\"js\"><span class=\"s1\">'use strict'</span><span class=\"p\">;</span><span class=\"kd\">var</span> <span class=\"nx\">_react</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">'react'</span><span class=\"p\">);</span><span class=\"kd\">var</span> <span class=\"nx\">_react2</span> <span class=\"o\">=</span> <span class=\"nx\">_interopRequireDefault</span><span class=\"p\">(</span><span class=\"nx\">_react</span><span class=\"p\">);</span>\n<span class=\"kd\">var</span> <span class=\"nx\">_reactDom</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">'react-dom'</span><span class=\"p\">);</span><span class=\"kd\">function</span> <span class=\"nx\">_interopRequireDefault</span><span class=\"p\">(</span><span class=\"nx\">obj</span><span class=\"p\">)</span> <span class=\"p\">&#123;</span><span class=\"k\">return</span> <span class=\"nx\">obj</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">obj</span><span class=\"p\">.</span><span class=\"nx\">__esModule</span> <span class=\"o\">?</span> <span class=\"nx\">obj</span> <span class=\"o\">:</span> <span class=\"p\">&#123;</span> <span class=\"k\">default</span><span class=\"o\">:</span> <span class=\"nx\">obj</span> <span class=\"p\">&#125;;&#125;</span>\n\n<span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"nx\">_reactDom</span><span class=\"p\">.</span><span class=\"nx\">render</span><span class=\"p\">)(</span>\n<span class=\"nx\">_react2</span><span class=\"p\">.</span><span class=\"k\">default</span><span class=\"p\">.</span><span class=\"nx\">createElement</span><span class=\"p\">(</span><span class=\"s1\">'div'</span><span class=\"p\">,</span> <span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"s1\">'Hello world'</span><span class=\"p\">),</span>\n\n\n<span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">getElementById</span><span class=\"p\">(</span><span class=\"s1\">'root'</span><span class=\"p\">));</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#cheap-source-map\"><h2 id=\"cheap-source-map\">cheap-source-map</h2></a>\n\n<p>In this case <code>eval</code> is no longer used. And a single source map file is generated which is referred in the generated bundle through a line in the end like:</p>\n<div class=\"highlight\"><pre><code class=\"js language-js\" data-lang=\"js\"><span class=\"c1\">//# sourceMappingURL=bundle.js.map</span>\n</code></pre></div>\n<p>The code visible in browser dev-tools is still babel-transpiled code, like the case with <code>cheap-eval-source-map</code>.</p>\n\n<a class=\"header-link\" href=\"#cheap-module-eval-source-map\"><h2 id=\"cheap-module-eval-source-map\">cheap-module-eval-source-map</h2></a>\n\n<p>As mentioned in the name this uses <code>eval</code> but the source is the actual source code before babel transpilation. Though we get line level mapping, individual expressions are not mapped to expressions in the original source.</p>\n\n<p>However because of the same reasons as cheap-eval-source-map (eval usage, source map embedded in generated bundle leading to increased size) it is not suitable for production usage.</p>\n\n<a class=\"header-link\" href=\"#cheap-module-source-map\"><h2 id=\"cheap-module-source-map\">cheap-module-source-map</h2></a>\n\n<p>This is an evolution over the above in that we get rid of eval and move source maps to separate files making it sutable for production usage.</p>\n\n<a class=\"header-link\" href=\"#eval-source-map\"><h3 id=\"eval-source-map\">eval-source-map</h3></a>\n\n<p>This maps to not only lines of original source code, but also columns. It does, however, use eval making it suitable only for development.</p>\n\n<p>The detailed source map generation results in an execution time penalty during bundling as well as larger source maps.</p>\n\n<a class=\"header-link\" href=\"#source-map\"><h2 id=\"source-map\">source-map</h2></a>\n\n<p>This has column level mapping to original source code, does not use eval and is suitable for production. This is the best option for production usage, even though build times are slower than above options.</p>\n\n<hr>\n\n<p>For the simple example above the sizes of different bundles and source maps are summarized below:</p>\n\n<div class=\"table-wrapper\"><table>\n  <tr>\n    <th>File</th>\n<th>Size</th>\n<th>Time taken for initial bundling</th>\n  </tr>\n  <tr>\n    <td> bundle.eval.js</td>\n<td>760K</td>\n<td> 1603ms</td>\n  </tr>\n  <tr>\n    <td> bundle.cheap-eval-source-map.js </td>\n<td>1.9M</td>\n<td>1888ms</td>\n  </tr>\n  <tr>\n    <td>bundle.cheap-source-map.js</td>\n<td>723K</td>\n<td rowspan=\"2\"> 1724ms</td>\n  </tr>\n  <tr>\n    <td>bundle.cheap-source-map.js.map</td>\n<td>841K</td>\n  </tr>\n  <tr>\n    <td>bundle.cheap-module-eval-source-map.js</td>\n<td>1.9M</td>\n<td>1870ms</td>\n  </tr>\n  <tr>\n    <td>bundle.cheap-module-source-map.js</td>\n<td>723K</td>\n<td rowspan=\"2\">1756ms</td>\n  </tr>\n  <tr>\n    <td>bundle.cheap-module-source-map.js.map</td>\n<td>841K</td>\n  </tr>\n  <tr>\n    <td>bundle.eval-source-map.js</td>\n<td>1.9M</td>\n<td>2127ms</td>\n  </tr>\n  <tr>\n    <td>bundle.source-map.js</td>\n<td>725K</td>\n<td rowspan=\"2\">2197ms</td>\n  </tr>\n  <tr>\n    <td>bundle.source-map.js.map</td>\n<td>844K</td>\n  </tr>\n</table></div>\n\n<p>Given this is a small file with very few dependencies, the webpack bundling times are not representative of real world use cases.</p>\n\n<p>It is recommended to use separate webpack configurations for production and development. In development, when dealing with mostly well formatted source code <code>cheap-module-eval-source-map</code> is usually adequate where as in production it is good to have <code>source-map</code> as the devtool config.</p>\n\n<a class=\"header-link\" href=\"#selective-source-map-generation\"><h1 id=\"selective-source-map-generation\">Selective source map generation</h1></a>\n\n<p>Webpack provides a <a href=\"https://webpack.github.io/docs/list-of-plugins.html#sourcemapdevtoolplugin\"><code>SourceMapDevToolPlugin</code></a> for greater control over which files source maps should be generated for.</p>\n\n<p>For instance, using this plugin we can specify a regular expression for filtering all the files for which source maps should be generated.</p>\n\n<a class=\"header-link\" href=\"#about-pragma-styles\"><h1 id=\"about-pragma-styles\">About pragma styles</h1></a>\n\n<p>The devtool configuration string can be prefixed with <code>#</code> or <code>@</code> to force a specific a pragma style. The latter is now deprecated by browser vendors. The reasoning behind this has been summarized by html5rocks:</p>\n\n<blockquote>\n<p>Previously the comment pragma was <code>//@</code> but due to some issues with that and <a href=\"https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-issues\">IE conditional compilation</a> comments the <a href=\"https://groups.google.com/forum/#!topic/mozilla.dev.js-sourcemap/4uo7Z5nTfUY\">decision was made</a> to change it to <code>//#</code>. Currently Chrome Canary, WebKit Nightly and Firefox 24+ support the new comment pragma. This syntax change also affects sourceURL.</p>\n</blockquote>\n\n<p>Changing the prefix to <code>@</code> can help with debugging in older browsers</p>\n\n",
            "tags": []
        },
        {
            "id": "https://lorefnon.me/2016/11/26/reducing-bem-boilerplate-through-haml-extensions.html",
            "url": "https://lorefnon.me/2016/11/26/reducing-bem-boilerplate-through-haml-extensions.html",
            "title": "Reducing BEM boilerplate through HAML extensions",
            "date_published": "2016-11-26T00:00:00.000Z",
            "content_html": "<p><a href=\"http://getbem.com/introduction/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">BEM</a> is a nice pattern with the primary caveat being having to repetitively specify long class name prefixes in html.</p>\n<p>In Sass this problem is significantly alleviated because the parent operator <code>&amp;</code> allows for extending of parent class name:</p>\n<pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.Button</span> &#123;\n  &amp;__label &#123;\n    &amp;<span class=\"hljs-attr\">--primary</span> &#123;\n      <span class=\"hljs-attribute\">font-weight</span>: bold\n    &#125;\n  &#125;\n  &amp;__icon &#123;\n    <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0.5</span>;\n  &#125;\n&#125;</code></pre>\n\n<p>compiles to:</p>\n<pre><code class=\"hljs css\"><span class=\"hljs-selector-class\">.Button__label--primary</span> &#123;\n  <span class=\"hljs-attribute\">font-weight</span>: bold;\n&#125;\n<span class=\"hljs-selector-class\">.Button__icon</span> &#123;\n  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0.5</span>;\n&#125;</code></pre>\n\n<p>But usage in HTML is quite verbose:</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">label</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;Button__label Button__label--primary&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">label</span>&gt;</span></code></pre>\n\n<p>Fortunately, if we are using <a href=\"http://haml.info/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">HAML</a>, then we can extend the HAML parser to reduce some of this verbosity. HAML has a method <code>Haml::Parser.parse_class_and_id</code> to expand expressions like <code>.hello.world#some-id</code>. We can monkey-patch this method to make it bem aware.</p>\n<pre><code class=\"hljs ruby\">Haml::Parser.class_eval <span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-keyword\">class</span> &lt;&lt; <span class=\"hljs-variable language_\">self</span>\n\n    <span class=\"hljs-variable constant_\">CLASS_KEY</span> = <span class=\"hljs-string\">&#x27;class&#x27;</span>.freeze\n    <span class=\"hljs-variable constant_\">ID_KEY</span> = <span class=\"hljs-string\">&#x27;id&#x27;</span>.freeze\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_class_and_id</span>(<span class=\"hljs-params\">list</span>)\n      attributes = &#123;&#125;\n      <span class=\"hljs-keyword\">return</span> attributes <span class=\"hljs-keyword\">if</span> list.empty?\n\n      list.scan(<span class=\"hljs-regexp\">/([#.])([-:_a-zA-Z0-9]+)/</span>) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">type, property</span>|\n        <span class=\"hljs-keyword\">case</span> type\n        <span class=\"hljs-keyword\">when</span> <span class=\"hljs-string\">&#x27;.&#x27;</span>\n          <span class=\"hljs-keyword\">if</span> attributes[<span class=\"hljs-variable constant_\">CLASS_KEY</span>]\n            attributes[<span class=\"hljs-variable constant_\">CLASS_KEY</span>] += <span class=\"hljs-string\">&quot; &quot;</span>\n          <span class=\"hljs-keyword\">else</span>\n            attributes[<span class=\"hljs-variable constant_\">CLASS_KEY</span>] = <span class=\"hljs-string\">&quot;&quot;</span>\n          <span class=\"hljs-keyword\">end</span>\n          <span class=\"hljs-keyword\">if</span> match = property.match(<span class=\"hljs-regexp\">/^bem:(.*)$/</span>)\n            property = expand_bem_class match[<span class=\"hljs-number\">1</span>]\n          <span class=\"hljs-keyword\">end</span>\n          attributes[<span class=\"hljs-variable constant_\">CLASS_KEY</span>] += property\n        <span class=\"hljs-keyword\">when</span> <span class=\"hljs-string\">&#x27;#&#x27;</span>\n          attributes[<span class=\"hljs-variable constant_\">ID_KEY</span>] = property\n        <span class=\"hljs-keyword\">end</span>\n      <span class=\"hljs-keyword\">end</span>\n      attributes\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">expand_bem_class</span>(<span class=\"hljs-params\">property</span>)\n      convert_to_classes(parse_bem_shorthand(property)).join(<span class=\"hljs-string\">&quot; &quot;</span>)\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_bem_shorthand</span>(<span class=\"hljs-params\">property</span>)\n      breakdown = [&#123;&#125;]\n      previous_char = <span class=\"hljs-literal\">nil</span>\n      current_part = <span class=\"hljs-symbol\">:block</span>\n      property.each_char <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">char</span>|\n        breakdown.last[current_part] |<span class=\"hljs-params\"></span>|= <span class=\"hljs-string\">&#x27;&#x27;</span>\n        <span class=\"hljs-keyword\">if</span> char == <span class=\"hljs-string\">&#x27;_&#x27;</span>\n          <span class=\"hljs-keyword\">if</span> previous_char == <span class=\"hljs-string\">&#x27;_&#x27;</span>\n            previous_char = <span class=\"hljs-literal\">nil</span>\n            <span class=\"hljs-keyword\">unless</span> current_part == <span class=\"hljs-symbol\">:block</span>\n              breakdown.push(<span class=\"hljs-symbol\">block:</span> breakdown.last[<span class=\"hljs-symbol\">:block</span>])\n            <span class=\"hljs-keyword\">end</span>\n            current_part = <span class=\"hljs-symbol\">:element</span>\n          <span class=\"hljs-keyword\">else</span>\n            previous_char = char\n          <span class=\"hljs-keyword\">end</span>\n        <span class=\"hljs-keyword\">elsif</span> char == <span class=\"hljs-string\">&#x27;-&#x27;</span>\n          <span class=\"hljs-keyword\">if</span> previous_char == <span class=\"hljs-string\">&#x27;-&#x27;</span>\n            previous_char = <span class=\"hljs-literal\">nil</span>\n            <span class=\"hljs-keyword\">unless</span> current_part == <span class=\"hljs-symbol\">:block</span> |<span class=\"hljs-params\"></span>| current_part == <span class=\"hljs-symbol\">:element</span>\n              breakdown.push(\n                <span class=\"hljs-symbol\">block:</span> breakdown.last[<span class=\"hljs-symbol\">:block</span>],\n                <span class=\"hljs-symbol\">element:</span> breakdown.last[<span class=\"hljs-symbol\">:element</span>]\n              )\n            <span class=\"hljs-keyword\">end</span>\n            current_part = <span class=\"hljs-symbol\">:modifier</span>\n          <span class=\"hljs-keyword\">else</span>\n            previous_char = char\n          <span class=\"hljs-keyword\">end</span>\n        <span class=\"hljs-keyword\">else</span>\n          <span class=\"hljs-keyword\">if</span> previous_char == <span class=\"hljs-string\">&#x27;_&#x27;</span> |<span class=\"hljs-params\"></span>| previous_char == <span class=\"hljs-string\">&#x27;-&#x27;</span>\n            breakdown.last[current_part] += previous_char\n          <span class=\"hljs-keyword\">end</span>\n          breakdown.last[current_part] += char\n        <span class=\"hljs-keyword\">end</span>\n      <span class=\"hljs-keyword\">end</span>\n      breakdown\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">convert_to_classes</span>(<span class=\"hljs-params\">bem_breakdown</span>)\n      classes = []\n      bem_breakdown.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">item</span>|\n        current_class = <span class=\"hljs-string\">&#x27;&#x27;</span>\n        <span class=\"hljs-keyword\">if</span> item[<span class=\"hljs-symbol\">:block</span>].blank?\n          raise <span class=\"hljs-string\">&quot;BEM Block missing&quot;</span>\n        <span class=\"hljs-keyword\">else</span>\n          current_class += item[<span class=\"hljs-symbol\">:block</span>]\n        <span class=\"hljs-keyword\">end</span>\n        <span class=\"hljs-keyword\">unless</span> item[<span class=\"hljs-symbol\">:element</span>].blank?\n          current_class += <span class=\"hljs-string\">&quot;__<span class=\"hljs-subst\">#&#123;item[<span class=\"hljs-symbol\">:element</span>]&#125;</span>&quot;</span>\n        <span class=\"hljs-keyword\">end</span>\n        classes.push(current_class)\n        <span class=\"hljs-keyword\">unless</span> item[<span class=\"hljs-symbol\">:modifier</span>].blank?\n          current_class += <span class=\"hljs-string\">&quot;--<span class=\"hljs-subst\">#&#123;item[<span class=\"hljs-symbol\">:modifier</span>]&#125;</span>&quot;</span>\n          classes.push(current_class)\n        <span class=\"hljs-keyword\">end</span>\n      <span class=\"hljs-keyword\">end</span>\n      classes.uniq\n    <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now classes prefixed with <code>bem:</code> will receive special treatment:</p>\n<pre><code class=\"hljs haml\">.bem:Header__row--secondary--dark\n<span class=\"hljs-tag\">  %<span class=\"hljs-selector-tag\">a</span></span> Hello</code></pre>\n\n<p>will compile to:</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;Header__row Header__row--secondary Header__row--dark&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></code></pre>\n\n<p>Note that we were able to chain multiple modifiers in single expression. We can also use multiple elements in single expression:</p>\n<pre><code class=\"hljs haml\">.bem:Header__row--secondary--dark__bar--clear\n<span class=\"hljs-tag\">    %<span class=\"hljs-selector-tag\">a</span></span> Hello</code></pre>\n\n<p>will compile to:</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;Header__row Header__row--secondary Header__row--dark Header__bar Header__bar--clear&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></code></pre>\n\n<p>Of course this works with arbitrary selectors:</p>\n<pre><code class=\"hljs haml\"><span class=\"hljs-tag\">%<span class=\"hljs-selector-tag\">header</span><span class=\"hljs-selector-class\">.bem</span></span>:Header__row--secondary--dark\n<span class=\"hljs-tag\">    %<span class=\"hljs-selector-tag\">a</span></span> Hello</code></pre>\n\n<p>will compile to:</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">header</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;Header__row Header__row--secondary Header__row--dark&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">header</span>&gt;</span></code></pre>\n\n<p>What about cases when we want to use ruby helpers ? We can define two helper methods that expose this functionality:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">expand_bem_class</span>(<span class=\"hljs-params\">name</span>)\n  Haml::Parser.expand_bem_class(name)\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">expand_bem_classes</span>(<span class=\"hljs-params\">name</span>)\n  name.split(<span class=\"hljs-string\">&quot;.&quot;</span>).map&#123;|<span class=\"hljs-params\">name</span>| expand_bem_class name &#125;.join(<span class=\"hljs-string\">&quot; &quot;</span>)\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Of course, the usual caveats of tinkering with internals of vendor libraries apply. If tommorrow HAML changes the compiler API, then the monkey patch would have to updated to accomodate for that.</p>\n",
            "tags": []
        },
        {
            "id": "https://lorefnon.me/2016/04/04/embracing-bem-methodology-in-react-applications.html",
            "url": "https://lorefnon.me/2016/04/04/embracing-bem-methodology-in-react-applications.html",
            "title": "Embracing BEM methodology in React applications",
            "date_published": "2016-04-04T00:00:00.000Z",
            "content_html": "\n<a class=\"header-link\" href=\"#react-and-modular-css\"><h2 id=\"react-and-modular-css\">React and modular CSS</h2></a>\n\n<p><a href=\"https://github.com/facebook/react\">React</a> provides an elegant component oriented approach towards structuring our User interface. However it is not very prescriptive of how to modularize the CSS. Many React core team members have <a href=\"https://speakerdeck.com/vjeux/react-css-in-js\">opined</a> that it is better to ditch css entirely and embrace js based inline styles. However that decision does not go well with a lot of frontend teams and makes things difficult for newcomers.</p>\n\n<p>However there many popular approaches for modularizing CSS that have evolved from community experience independent of React. Once such approach is <a href=\"http://getbem.com/\">BEM</a> which has proven to be quite popular and effective in practice.</p>\n\n<p>This post outlines a few functional utilities to effectively and succinctly use BEM alongside React.</p>\n\n<a class=\"header-link\" href=\"#composing-class-names\"><h2 id=\"composing-class-names\">Composing class names</h2></a>\n\n<p>While ES6 template strings provide a decent solution for string interpolation, it becomes cumbersome when we assign/toggle many classnames based on props or state variables. <a href=\"https://github.com/JedWatson/classnames\">JedWatson/classnames</a> is a nifty functional utility that alleviates some of this pain. Some examples directly taken from the <a href=\"https://github.com/JedWatson/classnames/blob/master/README.md\">README</a> illustrate the use case very well:</p>\n<div class=\"highlight\"><pre><code class=\"javascript language-javascript\" data-lang=\"javascript\"><span class=\"nx\">classNames</span><span class=\"p\">(</span><span class=\"s1\">'foo'</span><span class=\"p\">,</span> <span class=\"s1\">'bar'</span><span class=\"p\">);</span> <span class=\"c1\">// =&gt; 'foo bar'</span>\n<span class=\"nx\">classNames</span><span class=\"p\">(</span><span class=\"s1\">'foo'</span><span class=\"p\">,</span> <span class=\"p\">&#123;</span> <span class=\"nx\">bar</span><span class=\"o\">:</span> <span class=\"kc\">true</span> <span class=\"p\">&#125;);</span> <span class=\"c1\">// =&gt; 'foo bar'</span>\n<span class=\"nx\">classNames</span><span class=\"p\">(&#123;</span> <span class=\"s1\">'foo-bar'</span><span class=\"o\">:</span> <span class=\"kc\">true</span> <span class=\"p\">&#125;);</span> <span class=\"c1\">// =&gt; 'foo-bar'</span>\n<span class=\"nx\">classNames</span><span class=\"p\">(&#123;</span> <span class=\"s1\">'foo-bar'</span><span class=\"o\">:</span> <span class=\"kc\">false</span> <span class=\"p\">&#125;);</span> <span class=\"c1\">// =&gt; ''</span>\n<span class=\"nx\">classNames</span><span class=\"p\">(&#123;</span> <span class=\"nx\">foo</span><span class=\"o\">:</span> <span class=\"kc\">true</span> <span class=\"p\">&#125;,</span> <span class=\"p\">&#123;</span> <span class=\"nx\">bar</span><span class=\"o\">:</span> <span class=\"kc\">true</span> <span class=\"p\">&#125;);</span> <span class=\"c1\">// =&gt; 'foo bar'</span>\n<span class=\"nx\">classNames</span><span class=\"p\">(&#123;</span> <span class=\"nx\">foo</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span> <span class=\"nx\">bar</span><span class=\"o\">:</span> <span class=\"kc\">true</span> <span class=\"p\">&#125;);</span> <span class=\"c1\">// =&gt; 'foo bar'</span>\n\n<span class=\"c1\">// lots of arguments of various types</span>\n<span class=\"nx\">classNames</span><span class=\"p\">(</span><span class=\"s1\">'foo'</span><span class=\"p\">,</span> <span class=\"p\">&#123;</span> <span class=\"nx\">bar</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span> <span class=\"nx\">duck</span><span class=\"o\">:</span> <span class=\"kc\">false</span> <span class=\"p\">&#125;,</span> <span class=\"s1\">'baz'</span><span class=\"p\">,</span> <span class=\"p\">&#123;</span> <span class=\"nx\">quux</span><span class=\"o\">:</span> <span class=\"kc\">true</span> <span class=\"p\">&#125;);</span> <span class=\"c1\">// =&gt; 'foo bar baz quux'</span>\n\n<span class=\"c1\">// other falsy values are just ignored</span>\n<span class=\"nx\">classNames</span><span class=\"p\">(</span><span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"kc\">false</span><span class=\"p\">,</span> <span class=\"s1\">'bar'</span><span class=\"p\">,</span> <span class=\"kc\">undefined</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"p\">&#123;</span> <span class=\"nx\">baz</span><span class=\"o\">:</span> <span class=\"kc\">null</span> <span class=\"p\">&#125;,</span> <span class=\"s1\">''</span><span class=\"p\">);</span> <span class=\"c1\">// =&gt; 'bar 1'</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#eliminating-redundancy-in-class-names-using-css-precompilers\"><h2 id=\"eliminating-redundancy-in-class-names-using-css-precompilers\">Eliminating redundancy in class names using CSS precompilers</h2></a>\n\n<p>CSS precompilers like <a href=\"http://sass-lang.com/\">SASS</a> and <a href=\"http://lesscss.org/\">LESS</a> allow us to augment the parent context in included scope using ampersand (<code>&amp;</code>) prefix. This significantly helps towards keeping our stylesheets DRY:</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">.block &#123;\n    background: white;\n\n    &amp;__element-one &#123;\n        border-bottom: 1px solid red;\n\n        &amp;--modifier-one &#123;\n            color: red;\n        &#125;\n\n    &#125;\n&#125;\n</code></pre></div>\n<a class=\"header-link\" href=\"#eliminating-redundancy-in-class-names-in-react-components\"><h2 id=\"eliminating-redundancy-in-class-names-in-react-components\">Eliminating redundancy in class names in react components</h2></a>\n\n<p><a href=\"https://www.npmjs.com/package/bem-classname\"><code>bem-classname</code></a> is a nifty utility that allows us to eliminate the redundancy while assigning classnames to DOM elements.</p>\n\n<p>The canonical approach is to pass the block, element and modifier names to the function exposed by the utility:</p>\n<div class=\"highlight\"><pre><code class=\"javascript language-javascript\" data-lang=\"javascript\"><span class=\"nx\">bemClassName</span><span class=\"p\">(</span><span class=\"s1\">'block'</span><span class=\"p\">,</span> <span class=\"s1\">'element'</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">'awesome'</span><span class=\"p\">]);</span> <span class=\"c1\">// block__element block__element--awesome</span>\n</code></pre></div>\n<p>However the function can also be bound to a block context allowing us to strip away some of the boilerplate:</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">import React from 'react'\nimport bem from 'bem-classname'\n\nconst Home = () =&gt; (\n  &lt;div className=&#123;className()&#125;&gt;\n    &lt;h1 className=&#123;className('header')&#125;&gt; Lorefnon &lt;/h1&gt;\n    &lt;div className=&#123;className('description')&#125;&gt;\n      Full Stack Web Application Developer\n    &lt;/div&gt;\n  &lt;/div&gt;\n)\n\nexport default Home\n\n// Private:\n\nconst className = bem.bind(null, 'Home')\n</code></pre></div>\n<p>The above stateless component generates the following markup:</p>\n<div class=\"highlight\"><pre><code class=\"html language-html\" data-lang=\"html\">  <span class=\"nt\">&lt;div</span> <span class=\"na\">class=</span><span class=\"s\">\"Home\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;h1</span> <span class=\"na\">class=</span><span class=\"s\">\"Home__header\"</span><span class=\"nt\">&gt;</span> Lorefnon <span class=\"nt\">&lt;/h1&gt;</span>\n    <span class=\"nt\">&lt;div</span> <span class=\"na\">class=</span><span class=\"s\">\"Home__description\"</span><span class=\"nt\">&gt;</span>\n      Full Stack Web Application Developer\n    <span class=\"nt\">&lt;/div&gt;</span>\n  <span class=\"nt\">&lt;/div&gt;</span>\n</code></pre></div>\n<p>Not that BEM does not restrict us to one block/element per node. So a single node can represent multiple blocks. In such cases it is helpful to combine the aforementioned two utilities.</p>\n\n<a class=\"header-link\" href=\"#compressing-classnames-in-production\"><h2 id=\"compressing-classnames-in-production\">Compressing classnames in production</h2></a>\n\n<p>While BEM is very useful from a developer perspective as it eliminates the tedium of dealing with CSS specificity to a significant extent - however it has been crticised for the elaborate classnames which contribute towards increased size of HTML &amp; CSS files.</p>\n\n<p>If your use case really demands this level of optimization, then there are utilities like <a href=\"https://www.npmjs.com/package/grunt-class-id-minifier\">grunt-class-id-minifier</a> which can compress these class names as a part of the build process.</p>\n\n<p>The plugin generates a mapping file which we can consume in our components as a normal javascript module.</p>\n<div class=\"highlight\"><pre><code class=\"javascript language-javascript\" data-lang=\"javascript\"><span class=\"nx\">module</span><span class=\"p\">.</span><span class=\"nx\">exports</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kd\">function</span> <span class=\"p\">()</span> <span class=\"p\">&#123;</span>\n    <span class=\"k\">return</span> <span class=\"p\">&#123;</span>\n        <span class=\"s2\">\"Home__header\"</span><span class=\"o\">:</span> <span class=\"s2\">\"a\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"Home__description\"</span><span class=\"o\">:</span> <span class=\"s2\">\"b\"</span>\n    <span class=\"p\">&#125;;</span>\n<span class=\"p\">&#125;);</span>\n</code></pre></div>\n<div class=\"highlight\"><pre><code class=\"javascript language-javascript\" data-lang=\"javascript\"><span class=\"kr\">import</span> <span class=\"nx\">mapper</span> <span class=\"nx\">from</span> <span class=\"s1\">'./map.js'</span>\n\n<span class=\"kr\">const</span> <span class=\"nx\">_className</span> <span class=\"o\">=</span> <span class=\"nx\">bem</span><span class=\"p\">.</span><span class=\"nx\">bind</span><span class=\"p\">(</span><span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"s1\">'Home'</span><span class=\"p\">)</span>\n\n<span class=\"kr\">const</span> <span class=\"nx\">className</span> <span class=\"o\">=</span> <span class=\"p\">(...</span><span class=\"nx\">args</span><span class=\"p\">)</span> <span class=\"o\">=&gt;</span> <span class=\"p\">&#123;</span>\n  <span class=\"kr\">const</span> <span class=\"nx\">c</span> <span class=\"o\">=</span> <span class=\"nx\">_className</span><span class=\"p\">(...</span><span class=\"nx\">args</span><span class=\"p\">)</span>\n  <span class=\"k\">return</span> <span class=\"nx\">mapper</span><span class=\"p\">[</span><span class=\"nx\">c</span><span class=\"p\">]</span> <span class=\"o\">||</span> <span class=\"nx\">c</span>\n<span class=\"p\">&#125;</span>\n</code></pre></div>\n",
            "tags": [
                "Javascript",
                "CSS"
            ]
        },
        {
            "id": "https://lorefnon.me/2016/03/31/database-driven-scheduling-with-clockwork-and-activejob.html",
            "url": "https://lorefnon.me/2016/03/31/database-driven-scheduling-with-clockwork-and-activejob.html",
            "title": "Database driven scheduling with Clockwork and ActiveJob",
            "date_published": "2016-03-31T00:00:00.000Z",
            "content_html": "\n\n<a class=\"header-link\" href=\"#on-cron-and-cron-management-dsls\"><h2 id=\"on-cron-and-cron-management-dsls\">On cron and cron management DSLs</h2></a>\n\n<p>The <a href=\"https://en.wikipedia.org/wiki/Cron\">cron utility</a> is the typical goto scheduling solution in unix/linux systems. Utilities like <a href=\"https://github.com/javan/whenever\">whenever</a> allow us to take advantage of cron through an elegant and declarative pure ruby DSL.</p>\n\n<p>The typical approach when using whenever for scheduling is to use deployment hooks to update the crontab from whenever's configuration during application deployment. However this approach falls short when the schedule is expected to be configurable at run time and especially if we want to give administrators fine grained controls over what is being scheduled and when.</p>\n\n<a class=\"header-link\" href=\"#database-driven-scheduling\"><h2 id=\"database-driven-scheduling\">Database driven scheduling</h2></a>\n\n<p>The post outlines an alternative solution using the library <a href=\"https://github.com/tomykaira/clockwork\">clockwork</a> that makes it easy to make event scheduling run time configurable through database models managed using familiar ruby ORMs.</p>\n\n<p>While clockwork handles the scheduling aspect, the responsibility of actual execution of the jobs is expected to be delegated to a background processor like <a href=\"https://github.com/mperham/sidekiq\">sidekiq</a> or <a href=\"https://github.com/collectiveidea/delayed_job\">delayed job</a>.</p>\n\n<a class=\"header-link\" href=\"#activejob-and-standardized-apis-for-background-processing\"><h2 id=\"activejob-and-standardized-apis-for-background-processing\">ActiveJob and standardized APIs for background processing</h2></a>\n\n<p>Rather than coupling our code to a specific background processor which might in turn may be coupled with a specific transport system (like Sidekiq and Redis) it is advisable to rely instead (as much as possible) on ActiveJob API which provides a standardized API for background processing in Rails ecosystem.</p>\n\n<a class=\"header-link\" href=\"#integration-with-admin-interfaces\"><h2 id=\"integration-with-admin-interfaces\">Integration with Admin interfaces</h2></a>\n\n<p>The benefit of the event system being manageable through ActiveRecord is that integrated admin interfaces like <a href=\"https://activeadmin.info\">ActiveAdmin</a> and <a href=\"https://github.com/thoughtbot/administrate\">Administrate</a> (which we might already have integrated in our existing applications) work out of the box and we get a complete schedule management interface with minimal extraneous boilerblate.</p>\n\n<a class=\"header-link\" href=\"#getting-started-with-our-app\"><h2 id=\"getting-started-with-our-app\">Getting started with our app</h2></a>\n\n<p>The rest of the tutorial walks through the creation of a Postgres backed Rails 5 application that illustrates the concepts outlined above.</p>\n\n<p>We start off with familiar rails application generation steps:</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"nv\">$ </span>gem install rails --pre --no-rdoc --no-ri\n\n<span class=\"nv\">$ </span>rails -v\nRails 5.0.0.beta3\n</code></pre></div>\n<p>Note that while skipping rdoc and ri is purely a matter of convenience (I did not need them at the time) - the <code>--pre</code> flag is required, as of this writing, for installing Rails 5 as it is still in beta.</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"nv\">$ </span>rails new rails5-clockwork-demo --database<span class=\"o\">=</span>postgresql\n\n      create\n      create  README.md\n      create  Rakefile\n      create  config.ru\n      create  .gitignore\n      create  Gemfile\n      create  app\n      create  app/assets/config/manifest.js\n      create  app/assets/javascripts/application.js\n      create  app/assets/javascripts/cable.coffee\n      create  app/assets/stylesheets/application.css\n      create  app/channels/application_cable/channel.rb\n      create  app/channels/application_cable/connection.rb\n      create  app/controllers/application_controller.rb\n      create  app/helpers/application_helper.rb\n      create  app/jobs/application_job.rb\n      create  app/mailers/application_mailer.rb\n      create  app/models/application_record.rb\n      create  app/views/layouts/application.html.erb\n      create  app/views/layouts/mailer.html.erb\n      create  app/views/layouts/mailer.text.erb\n      create  app/assets/images/.keep\n      create  app/assets/javascripts/channels\n      create  app/assets/javascripts/channels/.keep\n      create  app/controllers/concerns/.keep\n      create  app/models/concerns/.keep\n      create  bin\n      create  bin/bundle\n      create  bin/rails\n      create  bin/rake\n      create  bin/setup\n      create  bin/update\n      create  config\n      create  config/routes.rb\n      create  config/application.rb\n      create  config/environment.rb\n      create  config/secrets.yml\n      create  config/cable.yml\n      create  config/puma.rb\n      create  config/environments\n      create  config/environments/development.rb\n      create  config/environments/production.rb\n      create  config/environments/test.rb\n      create  config/initializers\n      create  config/initializers/active_record_belongs_to_required_by_default.rb\n      create  config/initializers/application_controller_renderer.rb\n      create  config/initializers/assets.rb\n      create  config/initializers/backtrace_silencers.rb\n      create  config/initializers/callback_terminator.rb\n      create  config/initializers/cookies_serializer.rb\n      create  config/initializers/cors.rb\n      create  config/initializers/filter_parameter_logging.rb\n      create  config/initializers/inflections.rb\n      create  config/initializers/mime_types.rb\n      create  config/initializers/per_form_csrf_tokens.rb\n      create  config/initializers/request_forgery_protection.rb\n      create  config/initializers/session_store.rb\n      create  config/initializers/wrap_parameters.rb\n      create  config/locales\n      create  config/locales/en.yml\n      create  config/boot.rb\n      create  config/database.yml\n      create  db\n      create  db/seeds.rb\n      create  lib\n      create  lib/tasks\n      create  lib/tasks/.keep\n      create  lib/assets\n      create  lib/assets/.keep\n      create  log\n      create  log/.keep\n      create  public\n      create  public/404.html\n      create  public/422.html\n      create  public/500.html\n      create  public/apple-touch-icon-precomposed.png\n      create  public/apple-touch-icon.png\n      create  public/favicon.ico\n      create  public/robots.txt\n      create  <span class=\"nb\">test</span>/fixtures\n      create  <span class=\"nb\">test</span>/fixtures/.keep\n      create  <span class=\"nb\">test</span>/fixtures/files\n      create  <span class=\"nb\">test</span>/fixtures/files/.keep\n      create  <span class=\"nb\">test</span>/controllers\n      create  <span class=\"nb\">test</span>/controllers/.keep\n      create  <span class=\"nb\">test</span>/mailers\n      create  <span class=\"nb\">test</span>/mailers/.keep\n      create  <span class=\"nb\">test</span>/models\n      create  <span class=\"nb\">test</span>/models/.keep\n      create  <span class=\"nb\">test</span>/helpers\n      create  <span class=\"nb\">test</span>/helpers/.keep\n      create  <span class=\"nb\">test</span>/integration\n      create  <span class=\"nb\">test</span>/integration/.keep\n      create  <span class=\"nb\">test</span>/test_helper.rb\n      create  tmp\n      create  tmp/.keep\n      create  tmp/cache\n      create  tmp/cache/assets\n      create  vendor/assets/javascripts\n      create  vendor/assets/javascripts/.keep\n      create  vendor/assets/stylesheets\n      create  vendor/assets/stylesheets/.keep\n      remove  config/initializers/cors.rb\n</code></pre></div>\n<p>Note the line <code>create  app/jobs/application_job.rb</code> above. Rails 5 comes pre-integrated with ActiveJob.</p>\n\n<p>Next we add clockwork and sidekiq to our Gemfile.</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">gem 'clockwork'\ngem 'sidekiq'\n</code></pre></div>\n<p>It may be tempting to just leave the in-memory adapter of ActiveJob in place but it should not be used in any production application. <a href=\"http://edgeguides.rubyonrails.org/active_job_basics.html\">Rails guides</a> explain it well enough:</p>\n\n<blockquote>\n<p>Rails itself only provides an in-process queuing system, which only keeps the jobs in RAM. If the process crashes or the machine is reset, then all outstanding jobs are lost with the default async back-end. This may be fine for smaller apps or non-critical jobs, but most production apps will need to pick a persistent backend.</p>\n</blockquote>\n\n<a class=\"header-link\" href=\"#implementing-the-event-model\"><h2 id=\"implementing-the-event-model\">Implementing the Event model</h2></a>\n\n<p>Next we need to define our models for persisting our schedules.</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">rails g model event name:string frequency:integer at:string job_name:string job_arguments:jsonb\n</code></pre></div>\n<p>Here the first three columns correspond to accessors mandated by Clockwork. Name is primary for descriptive logging purposes (more on this below). <code>frequency</code> specifies the recurrance frequency in seconds. <code>at</code> signifies point of occurance within the recurrance span. Following are the valid formats:</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">HH:MM\n H:MM\n**:MM\nHH:**\n(Mon|mon|Monday|monday) HH:MM\n</code></pre></div>\n<p>The last two columns <code>job_name</code> and <code>job_arguments</code> identify the job to be triggered. As would become obvious below, we did not need to provide the job name through the database - it could be inferred at the runtime through any custom logic expressed in ruby. But having it in database leads to a straightforward and transparent implementation and management.</p>\n\n<p>It may be tempting to just reuse the <code>name</code> field as the job_name as well, but it may obscure debugging when same job is being invoked as part of multiple events for different use cases. It is recommended to keep the <code>name</code> as something representative of the use case - eg. <code>enterprise_plan_customers_sales_aggregation_trigger</code>.</p>\n\n<p>Our model would look something like below:</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">class Event &lt; ApplicationRecord\n  validates :name, :frequency, :job_name, presence: true\nend\n</code></pre></div>\n<a class=\"header-link\" href=\"#clock-rb-file-\"><h2 id=\"clock-rb-file-\">\n<code>clock.rb</code> file:</h2></a>\n\n<p>The entry point of clockwork is the file <code>clock.rb</code>. This is the file that tells clockwork to\npoll the events table and execute the inferred job.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"nb\">require</span> <span class=\"s1\">'clockwork'</span>\n<span class=\"nb\">require</span> <span class=\"s1\">'clockwork/database_events'</span>\n<span class=\"n\">require_relative</span> <span class=\"s1\">'./config/boot'</span>\n<span class=\"n\">require_relative</span> <span class=\"s1\">'./config/environment'</span>\n\n<span class=\"k\">module</span> <span class=\"nn\">Clockwork</span>\n\n  <span class=\"c1\"># required to enable database syncing support</span>\n  <span class=\"no\">Clockwork</span><span class=\"o\">.</span><span class=\"n\">manager</span> <span class=\"o\">=</span> <span class=\"no\">DatabaseEvents</span><span class=\"o\">::</span><span class=\"no\">Manager</span><span class=\"o\">.</span><span class=\"n\">new</span>\n\n  <span class=\"n\">sync_database_events</span> <span class=\"ss\">model</span><span class=\"p\">:</span> <span class=\"o\">::</span><span class=\"no\">Event</span><span class=\"p\">,</span> <span class=\"ss\">every</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"o\">.</span><span class=\"n\">minute</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">event</span><span class=\"o\">|</span>\n    <span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">job_name</span><span class=\"o\">.</span><span class=\"n\">constantize</span><span class=\"o\">.</span><span class=\"n\">perform_later</span><span class=\"p\">(</span><span class=\"n\">event</span><span class=\"o\">.</span><span class=\"n\">job_arguments</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#configuring-activejob-to-use-sidekiq\"><h2 id=\"configuring-activejob-to-use-sidekiq\">Configuring ActiveJob to use sidekiq</h2></a>\n\n<p>We had added sidekiq as the persistence backend for ActiveJob but we have not configured ActiveJob to use it.</p>\n\n<p>That is one additional line of code in <code>config/application.rb</code></p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">module</span> <span class=\"nn\">Rails5ClockworkDemo</span>\n  <span class=\"k\">class</span> <span class=\"nc\">Application</span> <span class=\"o\">&lt;</span> <span class=\"no\">Rails</span><span class=\"o\">::</span><span class=\"no\">Application</span>\n\n    <span class=\"c1\"># Configure ActiveJob to use sidekiq</span>\n    <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">active_job</span><span class=\"o\">.</span><span class=\"n\">queue_adapter</span> <span class=\"o\">=</span> <span class=\"ss\">:sidekiq</span>\n\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#running-clockwork-\"><h2 id=\"running-clockwork-\">Running clockwork:</h2></a>\n\n<p>Clockwork can be executed by running <code>clockwork clock.rb</code> at project root. However we can not expect something exciting yet because we simply have no entries in the table:</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"nv\">$ </span>clockwork clock.rb\nI, <span class=\"o\">[</span>2016-04-01T02:02:54.032058 <span class=\"c\">#57534]  INFO -- : Starting clock for 1 events: [ sync_database_events_for_model_Event ]</span>\nI, <span class=\"o\">[</span>2016-04-01T02:02:54.032150 <span class=\"c\">#57534]  INFO -- : Triggering 'sync_database_events_for_model_Event'</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#adding-administrative-interface-\"><h2 id=\"adding-administrative-interface-\">Adding administrative interface:</h2></a>\n\n<p>We would be using ActiveAdmin for our admin interface for managing events. As of this writing to use ActiveAdmin along with Rails 5 we need to use the master branch of ActiveAdmin.</p>\n\n<p>While we will not go into elaboration of the ActiveAdmin DSL, most of the ideas should be applicable to alternative admin builders as well.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"c1\"># Gemfile.rb</span>\n\n<span class=\"n\">gem</span> <span class=\"s1\">'activeadmin'</span><span class=\"p\">,</span> <span class=\"ss\">github</span><span class=\"p\">:</span> <span class=\"s1\">'activeadmin'</span>\n</code></pre></div>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"nv\">$ </span>rails g active_admin:install\n</code></pre></div>\n<p>For now we skip authorization as well as authentication entirely - integrating ActiveAdmin with authentication systems is covered <a href=\"https://github.com/activeadmin/activeadmin/blob/master/docs/0-installation.md\">here</a> and usage in conjugation with authorization systems is covered <a href=\"https://github.com/activeadmin/activeadmin/blob/master/docs/13-authorization-adapter.md\">here</a> in the official docs.</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"nv\">$ </span>rails g active_admin:install --skip-users\nRunning via Spring preloader in process 59785\n      create  config/initializers/active_admin.rb\n      create  app/admin\n      create  app/admin/dashboard.rb\n       route  ActiveAdmin.routes<span class=\"o\">(</span>self<span class=\"o\">)</span>\n    generate  active_admin:assets\nRunning via Spring preloader in process 59787\n      create  app/assets/javascripts/active_admin.js.coffee\n      create  app/assets/stylesheets/active_admin.scss\n      create  db/migrate/20160331204250_create_active_admin_comments.rb\n</code></pre></div>\n<p>To present our Event model through ActiveAdmin we need to generate an ActiveAdmin Event resource.</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"nv\">$ </span>rails g active_admin:resource Event\n</code></pre></div>\n<p>The above command creates the following file for us:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"c1\"># app/admin/event.rb</span>\n\n<span class=\"no\">ActiveAdmin</span><span class=\"o\">.</span><span class=\"n\">register</span> <span class=\"no\">Event</span> <span class=\"k\">do</span>\n\n<span class=\"c1\"># See permitted parameters documentation:</span>\n<span class=\"c1\"># https://github.com/activeadmin/activeadmin/blob/master/docs/2-resource-customization.md#setting-up-strong-parameters</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># permit_params :list, :of, :attributes, :on, :model</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># or</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># permit_params do</span>\n<span class=\"c1\">#   permitted = [:permitted, :attributes]</span>\n<span class=\"c1\">#   permitted &lt;&lt; :other if params[:action] == 'create' &amp;&amp; current_user.admin?</span>\n<span class=\"c1\">#   permitted</span>\n<span class=\"c1\"># end</span>\n\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Once we configure permitted parameters as elaborated in the comments we have something like below:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"no\">ActiveAdmin</span><span class=\"o\">.</span><span class=\"n\">register</span> <span class=\"no\">Event</span> <span class=\"k\">do</span>\n\n  <span class=\"n\">permit_params</span> <span class=\"ss\">:name</span><span class=\"p\">,</span> <span class=\"ss\">:job_name</span><span class=\"p\">,</span> <span class=\"ss\">:job_arguments</span><span class=\"p\">,</span> <span class=\"ss\">:frequency</span><span class=\"p\">,</span> <span class=\"ss\">:at</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Now after we can run our migrations and booted up our server:</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"o\">=</span>&gt; Booting <span class=\"nv\">Puma</span>\n<span class=\"o\">=</span>&gt; Rails 5.0.0.beta3 application starting in development on http://localhost:3000\n<span class=\"o\">=</span>&gt; Run <span class=\"sb\">`</span>rails server -h<span class=\"sb\">`</span> <span class=\"k\">for </span>more startup <span class=\"nv\">options</span>\n<span class=\"o\">=</span>&gt; Ctrl-C to shutdown server\nPuma starting in single mode...\n* Version 3.2.0 <span class=\"o\">(</span>ruby 2.3.0-p0<span class=\"o\">)</span>, codename: Spring Is A Heliocentric Viewpoint\n* Min threads: 5, max threads: 5\n* Environment: development\n* Listening on tcp://localhost:3000\n</code></pre></div>\n<p>If this is the first time you are using Rails 5 the new default home page as well as puma as the default server can be a pleasant surprise.</p>\n\n<p><img src=\"/images/2016-03-31/rails5_home.png\"></p>\n\n<p>Our admin panel available at <code>/admin</code> provides us with the means to edit our events.</p>\n\n<p>However when we attempt to create an event we would be faced with an error because formtastic does not know out of the box how to handle jsonb field which we used for job arguments.</p>\n\n<p>While it is not difficult to <a href=\"https://stackoverflow.com/questions/33720697/activeadmin-formtastic-custom-input-json\">create custom form inputs</a> for formtastic and I have outlined an <a href=\"https://lorefnon.me/2015/03/02/dealing-with-json-fields-in-active-admin.html\">alternative approach</a> before, to keep the example simple let us simply use a textarea for the arguments field:</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">  form do |f|\n    f.inputs do\n      f.input :name\n      f.input :job_name\n      f.input :frequency\n      f.input :at\n      f.input :job_arguments, as: :text\n    end\n    f.actions\n  end\n</code></pre></div>\n<p>Now we can create an event to trigger a dummy job:</p>\n\n<p><img src=\"/images/2016-03-31/dummy_job_form.png\"></p>\n\n<a class=\"header-link\" href=\"#defining-our-jobs-\"><h2 id=\"defining-our-jobs-\">Defining our jobs:</h2></a>\n\n<p>Of course, for this job to be runnable, we need to define the job as well. We can use ActiveJob's generators for the same:</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"nv\">$ </span>rails g job dummy\nRunning via Spring preloader in process 63269\n      invoke  test_unit\n      create    <span class=\"nb\">test</span>/jobs/dummy_job_test.rb\n      create  app/jobs/dummy_job.rb\n</code></pre></div>\n<p>Our job implementation itself is fairly mundane but serves the purpose of illustration:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">DummyJob</span> <span class=\"o\">&lt;</span> <span class=\"no\">ApplicationJob</span>\n  <span class=\"n\">queue_as</span> <span class=\"ss\">:default</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">perform</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">)</span>\n    <span class=\"nb\">puts</span> <span class=\"s2\">\"Dummy Job Executed\"</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Now once our clockwork process synchronizes with the databases, it will pickup the dummy job and keep executing every one second:</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\">I, <span class=\"o\">[</span>2016-04-01T02:30:54.003679 <span class=\"c\">#57534]  INFO -- : Triggering 'sync_database_events_for_model_Event'</span>\nI, <span class=\"o\">[</span>2016-04-01T02:30:54.005132 <span class=\"c\">#57534]  INFO -- : Triggering 'execute_dummy_job'</span>\nI, <span class=\"o\">[</span>2016-04-01T02:30:55.005873 <span class=\"c\">#57534]  INFO -- : Triggering 'execute_dummy_job'</span>\nI, <span class=\"o\">[</span>2016-04-01T02:30:56.001670 <span class=\"c\">#57534]  INFO -- : Triggering 'execute_dummy_job'</span>\nI, <span class=\"o\">[</span>2016-04-01T02:30:57.001761 <span class=\"c\">#57534]  INFO -- : Triggering 'execute_dummy_job'</span>\n</code></pre></div>\n<p>In the rails development log we can see that ActiveRecord is queuing this job:</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\"><span class=\"o\">[</span>ActiveJob<span class=\"o\">]</span> Enqueued DummyJob <span class=\"o\">(</span>Job ID: 64813900-c70f-4b40-9dd7-452c4cac6b73<span class=\"o\">)</span> to Sidekiq<span class=\"o\">(</span>default<span class=\"o\">)</span>\n<span class=\"o\">[</span>ActiveJob<span class=\"o\">]</span> Enqueued DummyJob <span class=\"o\">(</span>Job ID: 0d0a66d1-a46b-4427-92db-83a301b38c1c<span class=\"o\">)</span> to Sidekiq<span class=\"o\">(</span>default<span class=\"o\">)</span>\n<span class=\"o\">[</span>ActiveJob<span class=\"o\">]</span> Enqueued DummyJob <span class=\"o\">(</span>Job ID: 1de45b36-7cc9-4a9a-9bb7-363591f64dd5<span class=\"o\">)</span> to Sidekiq<span class=\"o\">(</span>default<span class=\"o\">)</span>\n<span class=\"o\">[</span>ActiveJob<span class=\"o\">]</span> Enqueued DummyJob <span class=\"o\">(</span>Job ID: 483fe8a2-5acf-4830-80fb-6c6883f0f7c2<span class=\"o\">)</span> to Sidekiq<span class=\"o\">(</span>default<span class=\"o\">)</span>\n</code></pre></div>\n<p>Now if we run sidekiq, our background processor - we should see the enqued job getting executed in the <code>log/sidekiq.log</code>:</p>\n<div class=\"highlight\"><pre><code class=\"bash language-bash\" data-lang=\"bash\">2016-03-31T21:01:00.064Z 64128 TID-ox54l2v7s DummyJob JID-fc59a048d2d1fe2aeecc3452 INFO: start\nDummy Job Executed\n</code></pre></div>\n<p>This concludes our introductory post on database driven scheduling with clockwork. Please share any issues you might have faced or any suggestions for improvement in the comments.</p>\n\n<p>The source code for this post is available in this <a href=\"https://github.com/lorefnon/rails5-clockwork-demo\">github repo</a>.</p>\n\n",
            "tags": [
                "Ruby",
                "Rails"
            ]
        },
        {
            "id": "https://lorefnon.me/2016/01/16/protip--annotate-activeadmin-resources-along-with-models.html",
            "url": "https://lorefnon.me/2016/01/16/protip--annotate-activeadmin-resources-along-with-models.html",
            "title": "Tip: Annotate ActiveAdmin resources along with models",
            "date_published": "2016-01-16T00:00:00.000Z",
            "content_html": "\n\n\n          \n\n<p><a href=\"https://github.com/ctran/annotate_models\">Annotate</a> is a very useful utility for annotating schema information in Rails models. The gem prepends (or appends, as per your <a href=\"https://github.com/ctran/annotate_models#options\">configuration</a>) a summarized information about the table schema in each model file as comments) - saving multiple roundtrips to the <code>schema.rb</code> file during coding.</p>\n\n<p>For Example:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"c1\"># == Schema Information</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># Table name: roles</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#  id            :integer          not null, primary key</span>\n<span class=\"c1\">#  name          :string</span>\n<span class=\"c1\">#  resource_id   :integer</span>\n<span class=\"c1\">#  resource_type :string</span>\n<span class=\"c1\">#  created_at    :datetime</span>\n<span class=\"c1\">#  updated_at    :datetime</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\"># Indexes</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#  index_roles_on_name                                    (name)</span>\n<span class=\"c1\">#  index_roles_on_name_and_resource_type_and_resource_id  (name,resource_type,resource_id)</span>\n<span class=\"c1\">#</span>\n</code></pre></div>\n<p>However while working with admin interfaces powered by <a href=\"http://activeadmin.info\">ActiveAdmin</a> I have often found it convenient to have the model schema annotations available right in the <a href=\"http://activeadmin.info/docs/2-resource-customization.html\">ActiveAdmin resource files</a>. There is a very simple way to achieve that:</p>\n\n<p>The rake task <a href=\"https://github.com/ctran/annotate_models#configuration-in-rails\">generated</a> by Annotate (<code>lib/tasks/auto_annotate_models.rake</code>) has option to specify the model directory. This is primarily intended for projects with non standard directory configuration. As it so happens we can specify multiple directories separated by commas.</p>\n\n<p>So taking advantage of the fact that our ActiveAdmin resource files are conventionally named same as the models, we can just add the admin directory to the list of model directories:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">if</span> <span class=\"no\">Rails</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"o\">.</span><span class=\"n\">development?</span>\n  <span class=\"n\">task</span> <span class=\"ss\">:set_annotation_options</span> <span class=\"k\">do</span>\n    <span class=\"c1\"># You can override any of these by setting an environment variable of the</span>\n    <span class=\"c1\"># same name.</span>\n    <span class=\"no\">Annotate</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span><span class=\"p\">(</span>\n      <span class=\"s1\">'model_dir'</span>               <span class=\"o\">=&gt;</span> <span class=\"s1\">'app/models,app/admin'</span><span class=\"p\">,</span>\n      <span class=\"c1\"># ... other configuration options</span>\n    <span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Next time annotate is run, either manually invoked or through migration hooks, our ActiveAdmin resource files with annotated along with our model files.</p>\n\n<p>If you are not using the generated rake file, this approach of course works with the <code>--model-dir</code> command line option as well.</p>\n",
            "tags": [
                "Ruby"
            ]
        },
        {
            "id": "https://lorefnon.me/2016/01/16/useful-delegation-patterns-for-rails.html",
            "url": "https://lorefnon.me/2016/01/16/useful-delegation-patterns-for-rails.html",
            "title": "Useful delegation patterns for Rails",
            "date_published": "2016-01-16T00:00:00.000Z",
            "content_html": "\n<a class=\"header-link\" href=\"#about-delegation\"><h2 id=\"about-delegation\">About delegation</h2></a>\n\n<p>Delegation is a very useful software pattern and this post focusses on how this pattern can be applied in the context of a Rails application and the associated advantages of doing so.</p>\n\n<p>If you are unfamiliar with this pattern, <a href=\"https://en.wikipedia.org/wiki/Delegation_pattern\">Wikipedia</a> has a very good explanation: </p>\n\n<blockquote>\n<p>In software engineering, the delegation pattern is a design pattern in object-oriented programming where an object, instead of performing one of its stated tasks, delegates that task to an associated helper object.</p>\n\n<p>There is an Inversion of Responsibility in which a helper object, known as a delegate, is given the responsibility to execute a task for the delegator.</p>\n</blockquote>\n\n<p>Also, this <a href=\"https://stackoverflow.com/questions/7168714/what-is-the-purpose-of-a-delegation-pattern\">Stackoverflow post</a> has some interesting posts elaborating on the practical benefits of the concepts of delegation in a language neutral context.</p>\n\n<a class=\"header-link\" href=\"#implementing-delegators-in-ruby\"><h2 id=\"implementing-delegators-in-ruby\">Implementing Delegators in Ruby</h2></a>\n\n<p>Ruby's metaprogramming facilities enable us to implement delegation in a much easier and consise manner than many other object oriented languages.</p>\n\n<p>Using dynamic interception of method calls, it is very straightforward to forward method invocations to a target object. This is very well illustrated by the <a href=\"https://github.com/ruby/ruby/blob/trunk/lib/delegate.rb#L75-L89\">implementation</a> of <a href=\"https://github.com/sj26/ruby-1.9.3-p0/blob/master/lib/delegate.rb\">Delegate class</a> provided by Ruby standard library:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">Delegator</span> <span class=\"o\">&lt;</span> <span class=\"no\">BasicObject</span>\n\n  <span class=\"c1\">#...</span>\n\n  <span class=\"c1\">#</span>\n  <span class=\"c1\"># Handles the magic of delegation through \\_\\_getobj\\_\\_.</span>\n  <span class=\"c1\">#</span>\n  <span class=\"k\">def</span> <span class=\"nf\">method_missing</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">block</span><span class=\"p\">)</span>\n    <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"kp\">true</span>\n    <span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">__getobj__</span> <span class=\"p\">&#123;</span><span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"kp\">false</span><span class=\"p\">&#125;</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">r</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">target</span><span class=\"o\">.</span><span class=\"n\">respond_to?</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">)</span>\n      <span class=\"n\">target</span><span class=\"o\">.</span><span class=\"n\">__send__</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">block</span><span class=\"p\">)</span>\n    <span class=\"k\">elsif</span> <span class=\"o\">::</span><span class=\"no\">Kernel</span><span class=\"o\">.</span><span class=\"n\">respond_to?</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">)</span>\n      <span class=\"o\">::</span><span class=\"no\">Kernel</span><span class=\"o\">.</span><span class=\"n\">instance_method</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">bind</span><span class=\"p\">(</span><span class=\"nb\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">block</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span>\n      <span class=\"k\">super</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">block</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#wrapping-objects-with-simpledelegator\"><h2 id=\"wrapping-objects-with-simpledelegator\">Wrapping objects with SimpleDelegator</h2></a>\n\n<p>In practice we usually deal with <a href=\"https://ruby-doc.org/stdlib-2.1.0/libdoc/delegate/rdoc/SimpleDelegator.html\"><code>SimpleDelegator</code></a> subclass of <code>Delegator</code> more often. The constructor takes a single object and any method invocations are delegated to the target instance. </p>\n\n<p>We can simply subclass from <code>SimpleDelegator</code> and implement our customizations therein, and delegate to the parent object through a <code>super</code> call conveniently.</p>\n\n<p>Example from docs:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span>\n  <span class=\"k\">def</span> <span class=\"nf\">born_on</span>\n    <span class=\"no\">Date</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"mi\">1989</span><span class=\"p\">,</span> <span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">UserDecorator</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDelegator</span>\n  <span class=\"k\">def</span> <span class=\"nf\">birth_year</span>\n    <span class=\"n\">born_on</span><span class=\"o\">.</span><span class=\"n\">year</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"o\">&gt;</span> <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"no\">UserDecorator</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"no\">User</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">)</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#using-delegation-for-presenter-logic\"><h3 id=\"using-delegation-for-presenter-logic\">Using delegation for Presenter logic</h3></a>\n\n<p>This is arguably the most common use case for delegators. Often we end up adding a lot of methods in our models that have nothing to do with domain logic whatsoever. Does something like this look familiar?</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span>\n\n  <span class=\"c1\"># ...</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">formatted_date_of_birth</span>\n    <span class=\"n\">date_of_birth</span><span class=\"o\">.</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s2\">\"Born on %m/%d/%Y\"</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Such methods which are primarily written for handling presentation concerns come into the perview of Presenter logic and are best left out of models. Instead we can decorate our model instances using presenter classes before passing them to views:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">UserDecorator</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDelegator</span>\n\n <span class=\"k\">def</span> <span class=\"nf\">formatted_date_of_birth</span>\n  <span class=\"n\">date_of_birth</span><span class=\"o\">.</span><span class=\"n\">strftime</span><span class=\"p\">(</span><span class=\"s2\">\"Born on %m/%d/%Y\"</span><span class=\"p\">)</span>\n <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">UsersController</span> <span class=\"o\">&lt;</span> <span class=\"no\">ApplicationController</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">show</span>\n    <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"no\">User</span><span class=\"o\">.</span><span class=\"n\">find</span> <span class=\"n\">params</span><span class=\"o\">[</span><span class=\"ss\">:id</span><span class=\"o\">]</span>\n    <span class=\"vi\">@user</span> <span class=\"o\">=</span> <span class=\"no\">UserDecorator</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">user</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>I find this to be more elegant from an object oriented perspective compared to the conventional approach using Rails helper modules.</p>\n\n<p>There are many <a href=\"https://www.ruby-toolbox.com/categories/rails_presenters\">libraries</a> for implementing additional convenience utilities around presenters. While the above simple approach takes us quite far, if you find yourself repeating the decorator instantiation boilerplate, generators and conventions offered by a library like <a href=\"https://github.com/drapergem/draper\">Draper</a> can be helpful.</p>\n\n<p>Note that one of the biggest strengths of decorators is on demand composability. For instance we may have various user centric helper methods for reporting. We can extract them into a <code>UserReportPresenter</code> decorator that is used only in the <code>UserReportsController</code>. Accordingly we can have multiple use-case specific delegators layered one upon another, each delegating to its immediate target transparently.</p>\n\n<p>We may want to have some approach to restrict what can be decorated by a decorator. We may be tempted to define something like this:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">UserReportPresenter</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDecorator</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">initialize</span><span class=\"p\">(</span><span class=\"n\">decorated</span><span class=\"p\">)</span>\n    <span class=\"k\">unless</span> <span class=\"n\">decorated</span><span class=\"o\">.</span><span class=\"n\">is_a?</span> <span class=\"no\">User</span>\n      <span class=\"k\">raise</span> <span class=\"no\">ArgumentError</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"s2\">\"Expected entity being decorated to be User\"</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n    <span class=\"k\">super</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>However this is not something we would want to do as it breaks composability. One approach would be to \"unwrap\" the decorated before instance check:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">while</span> <span class=\"n\">decorated</span><span class=\"o\">.</span><span class=\"n\">is_a?</span> <span class=\"no\">Decorator</span>\n  <span class=\"n\">decorated</span> <span class=\"o\">=</span> <span class=\"n\">decorated</span><span class=\"o\">.</span><span class=\"n\">__getobj__</span>\n<span class=\"k\">end</span>\n<span class=\"k\">unless</span> <span class=\"n\">decorated</span><span class=\"o\">.</span><span class=\"n\">is_a?</span> <span class=\"no\">User</span>\n  <span class=\"k\">raise</span> <span class=\"no\">ArgumentError</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"s2\">\"Expected entity being decorated to be User\"</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>but I strongly recommend not resorting to <code>is_a?</code> checks at all and relying instead on behavior checks using <code>responds_to?</code>.</p>\n\n<a class=\"header-link\" href=\"#delegation-for-memoization-caching\"><h3 id=\"delegation-for-memoization-caching\">Delegation for memoization/caching</h3></a>\n\n<p>This is another good use case for delegation. We can wrap our models into Delegators that transparently cache or memoize method invocations:</p>\n\n<p>Example using <code>Rails.cache</code>:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">UserReportCachedDelegator</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDelegator</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">annual_performance_stats</span>\n    <span class=\"no\">Rails</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">fetch</span> <span class=\"s2\">\"user.</span><span class=\"si\">#&#123;</span><span class=\"nb\">id</span><span class=\"si\">&#125;</span><span class=\"s2\">.annual_performance_stats\"</span> <span class=\"k\">do</span>\n      <span class=\"k\">super</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>However one thing that we should keep in mind that SimpleDelegator allows the decorated target to be run time configurable. While this is not a problem in the above implementation as we use an entity specific key, this may become a problem if, for example, we were using transparent memoization through <a href=\"https://github.com/matthewrudy/memoist\">Memoist</a>:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">UserReportMemoizedDelegator</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDelegator</span>\n\n  <span class=\"kp\">extend</span> <span class=\"no\">Memoist</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">annual_performance_stats</span><span class=\"p\">;</span> <span class=\"k\">super</span><span class=\"p\">;</span> <span class=\"k\">end</span>\n  <span class=\"n\">memoize</span> <span class=\"ss\">:annual_performance_stats</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>The above implementation is broken because even if we were to change the decorated instance using <code>__setobj__</code> our memoized method would continue returning the output of invocation of the method on previously decorated instance.</p>\n\n<p>A simple solution for the above is to flush the cache when the decorated entity changes:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">MemoizedDelegator</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDelegator</span>\n\n  <span class=\"kp\">extend</span> <span class=\"no\">Memoist</span>\n\n   <span class=\"k\">def</span> <span class=\"nf\">__setobj__</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">)</span>\n     <span class=\"k\">super</span>\n     <span class=\"n\">flush_cache</span>\n   <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#using-delegation-for-collection-objects\"><h3 id=\"using-delegation-for-collection-objects\">Using delegation for collection objects</h3></a>\n\n<p>This is something I recently found to be useful. Sometimes when we need to define operations that make sense for a set of instances, we just resort to class methods in model. However a better object oriented design would be to implement such behaviors on a dedicated collection resource.</p>\n\n<p>Decorating <code>ActiveRecord::CollectionProxy</code> is helpful because we get facilities like scope chaining, lazy-loading etc. for free.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">EmployeesReportDelegator</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDelegator</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">month_wise_performance_stats</span>\n    <span class=\"n\">joins</span><span class=\"p\">(</span><span class=\"ss\">:assessments</span><span class=\"p\">)</span>\n      <span class=\"o\">.</span><span class=\"n\">group</span><span class=\"p\">(</span><span class=\"s1\">'MONTH(assessments.created_at)'</span><span class=\"p\">)</span>\n      <span class=\"o\">.</span><span class=\"n\">select</span><span class=\"p\">(</span><span class=\"s1\">'assessments.evaluation_rank as rank'</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#using-delegation-to-augment-lifecycle-hooks\"><h3 id=\"using-delegation-to-augment-lifecycle-hooks\">Using delegation to augment lifecycle hooks</h3></a>\n\n<p>This is occassionaly useful especially when dealing with third party SDKs. We can leverage <code>ActiveSupport::Callbacks</code> to wrap custom callback hooks around specific behaviors of decorated objects:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">MailDispatchDelegator</span> <span class=\"o\">&lt;</span> <span class=\"no\">SimpleDelegator</span>\n\n  <span class=\"kp\">include</span> <span class=\"no\">ActiveSupport</span><span class=\"o\">::</span><span class=\"no\">Callbacks</span>\n  <span class=\"n\">define_callbacks</span> <span class=\"ss\">:dispatch</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">dispatch</span>\n    <span class=\"n\">run_callbacks</span> <span class=\"ss\">:dispatch</span> <span class=\"k\">do</span>\n      <span class=\"k\">super</span>      \n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">MailFilterDelegator</span> <span class=\"o\">&lt;</span> <span class=\"no\">MailDispatchDelegator</span>\n\n  <span class=\"n\">set_callback</span> <span class=\"ss\">:dispatch</span><span class=\"p\">,</span> <span class=\"ss\">:before</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">object</span><span class=\"o\">|</span>\n    <span class=\"k\">if</span> <span class=\"n\">validated_domains</span><span class=\"o\">.</span><span class=\"n\">include?</span> <span class=\"n\">object</span><span class=\"o\">.</span><span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">domain</span>\n      <span class=\"k\">raise</span> <span class=\"no\">ValidationError</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"s2\">\"Domain not whitelisted\"</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#in-rails-any-module-can-delegate\"><h2 id=\"in-rails-any-module-can-delegate\">In Rails, any module can delegate</h2></a>\n\n<p>While creating a dedicated Delegator makes sense in a variety of use cases, often we want to just delegate just a few methods to a contained object. ActiveSupport Module extensions provide a convenient approach to delegate specific methods to any contained object. This comes in very handy in controllers:</p>\n\n<a class=\"header-link\" href=\"#delegating-helpers-to-model-instances-\"><h3 id=\"delegating-helpers-to-model-instances-\">Delegating helpers to model instances:</h3></a>\n\n<p>For example in a rails controller, we might want to expose a few model methods:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">ProductsController</span> <span class=\"o\">&lt;</span> <span class=\"no\">ApplicationController</span>\n\n  <span class=\"n\">before_action</span> <span class=\"ss\">:ensure_logged_in!</span>\n  <span class=\"n\">delegate</span> <span class=\"ss\">:available_products</span><span class=\"p\">,</span> <span class=\"ss\">to</span><span class=\"p\">:</span> <span class=\"ss\">:current_user</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">index</span>\n    <span class=\"vi\">@available_products</span> <span class=\"o\">=</span> <span class=\"n\">available_products</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>We can also simply expose the delegated methods as a helper_method to our views:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">ProductsController</span> <span class=\"o\">&lt;</span> <span class=\"no\">ApplicationController</span>\n\n  <span class=\"n\">before_action</span> <span class=\"ss\">:ensure_logged_in!</span>\n  <span class=\"n\">delegate</span> <span class=\"ss\">:available_products</span><span class=\"p\">,</span> <span class=\"ss\">to</span><span class=\"p\">:</span> <span class=\"ss\">:current_user</span>\n  <span class=\"n\">helper_method</span> <span class=\"ss\">:available_products</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>I have found this to be a common use case, and a class method that wraps the two can help in DRYing things up:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">def</span> <span class=\"nc\">self</span><span class=\"o\">.</span><span class=\"nf\">delegate_helper</span> <span class=\"o\">*</span><span class=\"n\">args</span>\n  <span class=\"n\">delegate</span> <span class=\"o\">*</span><span class=\"n\">args</span>\n  <span class=\"kp\">loop</span> <span class=\"k\">do</span>\n    <span class=\"n\">method_name</span> <span class=\"o\">=</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">shift</span>\n    <span class=\"k\">break</span> <span class=\"k\">unless</span> <span class=\"n\">method_name</span><span class=\"o\">.</span><span class=\"n\">is_a?</span> <span class=\"no\">Symbol</span>\n    <span class=\"n\">helper_method</span> <span class=\"n\">method_name</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>The above method allows us to take advantage of full api of <code>Module#delegate</code> which allows delegation of multiple methods to single target and configuration of generated method.</p>\n\n<p>So for example, we can do the following:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">SomeController</span> <span class=\"o\">&lt;</span> <span class=\"no\">ApplicationController</span>\n\n  <span class=\"n\">before_action</span> <span class=\"ss\">:ensure_logged_in!</span>\n  <span class=\"n\">delegate_helper</span> <span class=\"ss\">:designations</span><span class=\"p\">,</span> <span class=\"ss\">:products</span><span class=\"p\">,</span> \n                  <span class=\"ss\">to</span><span class=\"p\">:</span> <span class=\"ss\">:current_user</span><span class=\"p\">,</span> \n                  <span class=\"ss\">prefix</span><span class=\"p\">:</span> <span class=\"kp\">true</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Now delegated methods would be available as <code>current_user_designations</code> and <code>current_user_products</code> in our views.</p>\n\n<p><code>Module#delegate</code> works very well with instance variables and class variables as well. Here is an example from the <a href=\"http://api.rubyonrails.org/classes/Module.html#method-i-delegate\">official documentation</a> :</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">Foo</span>\n  <span class=\"no\">CONSTANT_ARRAY</span> <span class=\"o\">=</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"o\">]</span>\n  <span class=\"vc\">@@class_array</span>  <span class=\"o\">=</span> <span class=\"o\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"mi\">7</span><span class=\"o\">]</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">initialize</span>\n    <span class=\"vi\">@instance_array</span> <span class=\"o\">=</span> <span class=\"o\">[</span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"mi\">9</span><span class=\"p\">,</span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"mi\">11</span><span class=\"o\">]</span>\n  <span class=\"k\">end</span>\n  <span class=\"n\">delegate</span> <span class=\"ss\">:sum</span><span class=\"p\">,</span> <span class=\"ss\">to</span><span class=\"p\">:</span> <span class=\"ss\">:CONSTANT_ARRAY</span>\n  <span class=\"n\">delegate</span> <span class=\"ss\">:min</span><span class=\"p\">,</span> <span class=\"ss\">to</span><span class=\"p\">:</span> <span class=\"ss\">:@@class_array</span>\n  <span class=\"n\">delegate</span> <span class=\"ss\">:max</span><span class=\"p\">,</span> <span class=\"ss\">to</span><span class=\"p\">:</span> <span class=\"ss\">:@instance_array</span>\n<span class=\"k\">end</span>\n\n<span class=\"no\">Foo</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"o\">.</span><span class=\"n\">sum</span> <span class=\"c1\"># =&gt; 6</span>\n<span class=\"no\">Foo</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"o\">.</span><span class=\"n\">min</span> <span class=\"c1\"># =&gt; 4</span>\n<span class=\"no\">Foo</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"o\">.</span><span class=\"n\">max</span> <span class=\"c1\"># =&gt; 11</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#chaining-delegators\"><h3 id=\"chaining-delegators\">Chaining delegators</h3></a>\n\n<p>As you may have inferred at this point, we can easily chain delegated invocations:</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">class ProductsController &lt; ApplicationController\n\n  before_action :ensure_logged_in!\n  delegate :manager, to: :current_user\n  delegate :designation, to: :manager, prefix: :manager\n\nend\n</code></pre></div>\n<a class=\"header-link\" href=\"#delegation-as-an-alternative-to-concerns\"><h2 id=\"delegation-as-an-alternative-to-concerns\">Delegation as an alternative to Concerns</h2></a>\n\n<p>Since the official endorsement of concerns from Rails 4 concerns have soared in popularity, however I have often observend that concerns are overused, especially for use cases that are better handled by other patterns.</p>\n\n<p>Since this post is about delegation, let us look at a few things that delegation has to offer over concerns:</p>\n\n<a class=\"header-link\" href=\"#run-time-configurability-\"><h3 id=\"run-time-configurability-\">Run time configurability:</h3></a>\n\n<p>While it is true that concerns can be injected at run time, however code that runs in the included hooks potentially modifies the host instance making run time switching of concerns not very practical in most cases. Delegation offers a clearer approach and we have already demonstrated that switching delegated instances in delegator instances is quite useful.</p>\n\n<a class=\"header-link\" href=\"#on-demand-specialization-\"><h3 id=\"on-demand-specialization-\">On demand specialization:</h3></a>\n\n<p>This is particularly useful for objects that did not originate in our code. Rather than polluting the library generated objects with application specific behavior, which may cause subtle unintended side-effects, it is much more elegant to pass around decorated instances in application code and pass the unwrapped instances back to the library should there be a need to do so.</p>\n\n<p>All in all concnerns are more suitable for application specific classes where core functionality is shared among multiple classes, and delegation is more useful for implementing auxiliary use case specific behaviors or transparently augmenting existing behavior. </p>\n\n<p>A good example of former use case would be a cross-cutting functionality like using a <code>completed_at</code> column for scoping on completion status or checking if a model (eg. Payment, Project etc.) has been completed  :</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">module</span> <span class=\"nn\">CompletionSupport</span>\n  <span class=\"kp\">extend</span> <span class=\"no\">ActiveSupport</span><span class=\"o\">::</span><span class=\"no\">Concern</span>\n\n  <span class=\"n\">included</span> <span class=\"k\">do</span>\n\n    <span class=\"o\">%</span><span class=\"n\">i</span><span class=\"o\">[</span><span class=\"n\">complete</span> <span class=\"n\">completed</span><span class=\"o\">].</span><span class=\"n\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"nb\">name</span><span class=\"o\">|</span>\n      <span class=\"n\">scope</span> <span class=\"nb\">name</span><span class=\"p\">,</span> <span class=\"o\">-&gt;</span> <span class=\"p\">&#123;</span> <span class=\"n\">where</span> <span class=\"s1\">'completed_at is not null'</span> <span class=\"p\">&#125;</span>\n    <span class=\"k\">end</span>\n\n    <span class=\"n\">scope</span> <span class=\"ss\">:incomplete</span><span class=\"p\">,</span> <span class=\"o\">-&gt;</span> <span class=\"p\">&#123;</span> <span class=\"n\">where</span> <span class=\"n\">completed_at</span><span class=\"p\">:</span> <span class=\"kp\">nil</span> <span class=\"p\">&#125;</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">complete!</span>\n    <span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">completed_at</span> <span class=\"o\">=</span> <span class=\"no\">DateTime</span><span class=\"o\">.</span><span class=\"n\">now</span>\n    <span class=\"n\">save!</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">complete?</span>\n    <span class=\"n\">completed_at</span><span class=\"o\">.</span><span class=\"n\">present?</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"n\">alias_method</span> <span class=\"ss\">:completed?</span><span class=\"p\">,</span> <span class=\"ss\">:complete?</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">incomplete?</span>\n    <span class=\"o\">!</span> <span class=\"n\">complete?</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"n\">alias_method</span> <span class=\"ss\">:not_completed?</span><span class=\"p\">,</span> <span class=\"ss\">:incomplete?</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#delegation-in-command-line-applications\"><h2 id=\"delegation-in-command-line-applications\">Delegation in command line applications</h2></a>\n\n<p>Last but not the least, delegation makes sense in command line applications as well. An excellent example would be github's <a href=\"https://github.com/github/hub\">hub</a> command line utility that makes a lot of github <a href=\"https://github.com/github/hub#commands\">features</a> like <code>pull-requests</code> accessible from the command line, while delegating everything else to git.</p>\n\n<a class=\"header-link\" href=\"#some-alternatives\"><h2 id=\"some-alternatives\">Some alternatives</h2></a>\n\n<a class=\"header-link\" href=\"#observers\"><h3 id=\"observers\">Observers</h3></a>\n\n<p>While observer pattern can help towards decoupling and the advantags therein overlap with those offered by delegates in some cases, in general I refrain from using Observer pattern because it makes the flow of logic harder to trace - especially in larger applications.</p>\n\n<a class=\"header-link\" href=\"#refinements\"><h3 id=\"refinements\">Refinements</h3></a>\n\n<p>Refinements are a recent addition to the Ruby language where in we can selectively monkey-patch modules (and hence classes) with custom behavior. But a key aspect of refinements is lexical scoping. The offical docs explain this very well:</p>\n\n<blockquote>\n<p>Refinements are lexical in scope. When control is transferred outside the scope the refinement is deactivated. This means that if you require or load a file or call a method that is defined outside the current scope the refinement will be deactivated:</p>\n</blockquote>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">C</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">module</span> <span class=\"nn\">M</span>\n  <span class=\"n\">refine</span> <span class=\"n\">C</span> <span class=\"k\">do</span>\n    <span class=\"k\">def</span> <span class=\"nf\">foo</span>\n      <span class=\"nb\">puts</span> <span class=\"s2\">\"C#foo in M\"</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">call_foo</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n  <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">foo</span>\n<span class=\"k\">end</span>\n\n<span class=\"n\">using</span> <span class=\"n\">M</span>\n\n<span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">C</span><span class=\"o\">.</span><span class=\"n\">new</span>\n<span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">foo</span>       <span class=\"c1\"># prints \"C#foo in M\"</span>\n<span class=\"n\">call_foo</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"c1\">#=&gt; raises NoMethodError</span>\n</code></pre></div>\n<p>While this explicit aspect of Refinements is a commendable improvement over adhoc monkey-patching in many scenarios - the convenience offered by transparent overlaying of behavior that decorators offer us, is, in most practical cases, more appealing.</p>\n\n<p>The primary exception to the above would be cases where the code consuming the augmented instances rely on <code>instance_of?</code> checks to determine the identity of passed instance. Using refinements we are not changing the class of the instance, where as while passing the wrapped instance we fail on the <code>instance_of?</code> checks as the wrapped instances are actually instances of a different class though they implement interchangeable behavior.</p>\n\n<p>This concludes our post on delegation. As always any insights on pragmatic usage of this pattern is more than welcome. Please use the comments section to share any feedback or criticism.</p>\n\n",
            "tags": [
                "Ruby",
                "Rails"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/12/07/extending-the-ruby-case-statement-for-fun-and-profit.html",
            "url": "https://lorefnon.me/2015/12/07/extending-the-ruby-case-statement-for-fun-and-profit.html",
            "title": "Extending the ruby case statement for fun and profit",
            "date_published": "2015-12-07T00:00:00.000Z",
            "content_html": "\n<p>I have often found that, despite being one of the most powerful constructs of the language, ruby case statement is often undervalued in everyday code. </p>\n\n<p>This is especially true when the people involved are coming from C/Java background because the switch statements in those languages are very restrictive in comparision to ruby. While ruby's case statement still leaves quite a bit to be desired after a taste of pattern matching in languages like <a href=\"http://elixir-lang.org/getting-started/pattern-matching.html\">elixir</a> and <a href=\"https://kerflyn.wordpress.com/2011/02/14/playing-with-scalas-pattern-matching/\">scala</a>, nevertheless, with a little effort we can adapt ruby's case statement to handle variety of use cases very expressively.</p>\n\n<a class=\"header-link\" href=\"#under-the-hood-of-case-statement\"><h2 id=\"under-the-hood-of-case-statement\">Under the hood of case statement</h2></a>\n\n<p>Behind the scenes, ruby uses the case equality method (===) for matching in case statements. So our primary appraoch for adding custom behavior to case statement would be through overriden behavior implemented in this method. </p>\n\n<a class=\"header-link\" href=\"#proc-as-a-match-target\"><h2 id=\"proc-as-a-match-target\">Proc as a match target</h2></a>\n\n<p>An especially convenient aspect of proc is that it's case equality method results in invocation of the proc itself - this comes in handy for quickly matching conditions:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">def</span> <span class=\"nf\">palindrome?</span><span class=\"p\">(</span><span class=\"n\">word</span><span class=\"p\">)</span>\n  <span class=\"k\">case</span> <span class=\"n\">word</span>\n  <span class=\"k\">when</span> <span class=\"nb\">proc</span><span class=\"p\">&#123;</span><span class=\"o\">|</span><span class=\"n\">w</span><span class=\"o\">|</span> <span class=\"n\">w</span><span class=\"o\">.</span><span class=\"n\">reverse</span> <span class=\"o\">==</span> <span class=\"n\">w</span> <span class=\"p\">&#125;</span>\n    <span class=\"kp\">true</span>\n  <span class=\"k\">else</span>\n    <span class=\"kp\">false</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#more-expressive-code-with-custom-matchers\"><h2 id=\"more-expressive-code-with-custom-matchers\">More expressive code with custom matchers</h2></a>\n\n<p>Custom matchers can often help us make our code more expressive and closer to intent.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"no\">DivisibilityMatcher</span> <span class=\"o\">=</span> <span class=\"no\">Struct</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\">:divisor</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n  <span class=\"k\">def</span> <span class=\"nf\">===</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span>\n    <span class=\"n\">target</span> <span class=\"o\">%</span> <span class=\"n\">divisor</span> <span class=\"o\">==</span> <span class=\"mi\">0</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">divisible_by</span><span class=\"p\">(</span><span class=\"n\">num</span><span class=\"p\">)</span>\n  <span class=\"no\">DivisibilityMatcher</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">num</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">case</span> <span class=\"mi\">18</span>\n<span class=\"k\">when</span> <span class=\"n\">divisible_by</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"divisible by 5\"</span>\n<span class=\"k\">when</span> <span class=\"n\">divisible_by</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"divisible by 3\"</span>\n<span class=\"k\">when</span> <span class=\"n\">divisible_by</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"divisible by 2\"</span>\n<span class=\"k\">end</span>\n\n<span class=\"o\">=&gt;</span> <span class=\"n\">divisible</span> <span class=\"n\">by</span> <span class=\"mi\">3</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#matchers-for-membership-evaluation\"><h2 id=\"matchers-for-membership-evaluation\">Matchers for membership evaluation</h2></a>\n\n<p>A simple use case might be to extend case to handle membership evaluation:</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"no\">MembershipEvaluationMatcher</span> <span class=\"o\">=</span> <span class=\"no\">Struct</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\">:collection</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n  <span class=\"k\">def</span> <span class=\"nf\">===</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span>\n    <span class=\"n\">collection</span><span class=\"o\">.</span><span class=\"n\">include?</span> <span class=\"n\">target</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">member_of</span><span class=\"p\">(</span><span class=\"n\">collection</span><span class=\"p\">)</span>\n  <span class=\"no\">MembershipEvaluationMatcher</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">collection</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">case</span> <span class=\"mi\">1</span>\n<span class=\"k\">when</span> <span class=\"n\">member_of</span><span class=\"p\">(</span><span class=\"sx\">%w[a b c]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s1\">'case 1'</span>\n<span class=\"k\">when</span> <span class=\"n\">member_of</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s1\">'case 2'</span>\n<span class=\"k\">end</span>\n\n<span class=\"o\">=&gt;</span> <span class=\"k\">case</span> <span class=\"mi\">2</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#matcher-composition\"><h2 id=\"matcher-composition\">Matcher composition</h2></a>\n\n<p>Advantage of having matcher objects dedicatedly handling only the responsibility of matching is that we can compose them in ways that make sense from the perspective of match making. </p>\n\n<p>Let us extend our divisibility check to illustrate the above. You may have noticed that our checks don't fall through the conditions -- so while divisibility with 3 is reported, divisibility with 2 is not. Let us check both using a matcher.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"no\">CompositeDivisibilityMatcher</span> <span class=\"o\">=</span> <span class=\"no\">Struct</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\">:matchers</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n  <span class=\"k\">def</span> <span class=\"nf\">===</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span> \n    <span class=\"n\">combine_results</span> <span class=\"n\">matchers</span><span class=\"o\">.</span><span class=\"n\">map</span><span class=\"p\">&#123;</span><span class=\"o\">|</span><span class=\"n\">m</span><span class=\"o\">|</span> <span class=\"n\">m</span> <span class=\"o\">===</span> <span class=\"n\">target</span> <span class=\"p\">&#125;</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">combine_results</span> <span class=\"n\">match_results</span>\n    <span class=\"kp\">false</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">AllDivisibilityMatcher</span> <span class=\"o\">&lt;</span> <span class=\"no\">CompositeDivisibilityMatcher</span> \n  <span class=\"k\">def</span> <span class=\"nf\">combine_results</span> <span class=\"n\">match_results</span>\n    <span class=\"n\">match_results</span><span class=\"o\">.</span><span class=\"n\">reduce</span><span class=\"p\">(</span><span class=\"ss\">:&amp;</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">AnyDivisibilityMatcher</span> <span class=\"o\">&lt;</span> <span class=\"no\">CompositeDivisibilityMatcher</span>\n  <span class=\"k\">def</span> <span class=\"nf\">combine_results</span> <span class=\"n\">match_results</span>\n    <span class=\"n\">match_results</span><span class=\"o\">.</span><span class=\"n\">reduce</span><span class=\"p\">(</span><span class=\"ss\">:|</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"no\">DivisibilityMatcher</span> <span class=\"o\">=</span> <span class=\"no\">Struct</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\">:divisor</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n  <span class=\"k\">def</span> <span class=\"nf\">===</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">)</span>\n    <span class=\"n\">target</span> <span class=\"o\">%</span> <span class=\"n\">divisor</span> <span class=\"o\">==</span> <span class=\"mi\">0</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">&amp;</span><span class=\"p\">(</span><span class=\"n\">matcher</span><span class=\"p\">)</span>\n    <span class=\"no\">AllDivisibilityMatcher</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"nb\">self</span><span class=\"p\">,</span> <span class=\"n\">matcher</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">|</span><span class=\"p\">(</span><span class=\"n\">matcher</span><span class=\"p\">)</span>\n    <span class=\"no\">AnyDivisibilityMatcher</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"nb\">self</span><span class=\"p\">,</span> <span class=\"n\">matcher</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">divisible_by</span><span class=\"p\">(</span><span class=\"n\">num</span><span class=\"p\">)</span>\n  <span class=\"no\">DivisibilityMatcher</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">num</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n\n<span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"o\">.</span><span class=\"n\">.</span><span class=\"mi\">100</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">num</span><span class=\"o\">|</span>\n  <span class=\"k\">case</span> <span class=\"n\">num</span>\n  <span class=\"k\">when</span> <span class=\"n\">divisible_by</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span> <span class=\"o\">&amp;</span> <span class=\"n\">divisible_by</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n    <span class=\"nb\">puts</span> <span class=\"s1\">'FizzBuzz'</span>\n  <span class=\"k\">when</span> <span class=\"n\">divisible_by</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span>\n    <span class=\"nb\">puts</span> <span class=\"s1\">'Fizz'</span>\n  <span class=\"k\">when</span> <span class=\"n\">divisible_by</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n    <span class=\"nb\">puts</span> <span class=\"s1\">'Buzz'</span>\n  <span class=\"k\">else</span>\n    <span class=\"nb\">puts</span> <span class=\"n\">num</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>We can also take advantage of <a href=\"https://ruby-doc.org/core-1.9.3/Proc.html#method-i-curry\">proc currying</a> reduce some verbosity here.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"n\">is_divisible</span> <span class=\"o\">=</span> <span class=\"nb\">proc</span> <span class=\"p\">&#123;</span><span class=\"o\">|</span><span class=\"n\">a</span><span class=\"p\">,</span><span class=\"n\">b</span><span class=\"o\">|</span> <span class=\"n\">a</span> <span class=\"o\">%</span> <span class=\"n\">b</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"p\">&#125;</span>\n<span class=\"n\">is_divisible_by_all</span> <span class=\"o\">=</span> <span class=\"nb\">proc</span> <span class=\"p\">&#123;</span><span class=\"o\">|</span><span class=\"n\">arr</span><span class=\"p\">,</span> <span class=\"n\">a</span><span class=\"o\">|</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">is_divisible</span><span class=\"o\">.</span><span class=\"n\">curry</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">reduce</span><span class=\"p\">(</span><span class=\"ss\">:&amp;</span><span class=\"p\">)</span> <span class=\"p\">&#125;</span>\n<span class=\"n\">is_divisible_by_any</span> <span class=\"o\">=</span> <span class=\"nb\">proc</span> <span class=\"p\">&#123;</span><span class=\"o\">|</span><span class=\"n\">arr</span><span class=\"p\">,</span> <span class=\"n\">a</span><span class=\"o\">|</span> <span class=\"n\">arr</span><span class=\"o\">.</span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">is_divisible</span><span class=\"o\">.</span><span class=\"n\">curry</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">]</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">reduce</span><span class=\"p\">(</span><span class=\"ss\">:|</span><span class=\"p\">)</span> <span class=\"p\">&#125;</span>\n\n<span class=\"k\">case</span> <span class=\"mi\">18</span>\n<span class=\"k\">when</span> <span class=\"n\">is_divisible_by_all</span><span class=\"o\">.</span><span class=\"n\">curry</span><span class=\"o\">[[</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"o\">]]</span>\n<span class=\"nb\">puts</span> <span class=\"s1\">'div by 2 and 3'</span>\n<span class=\"k\">when</span> <span class=\"n\">is_divisible_by_any</span><span class=\"o\">.</span><span class=\"n\">curry</span><span class=\"o\">[[</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"o\">]]</span>\n<span class=\"nb\">puts</span> <span class=\"s1\">'div by 2 or 3'</span>\n<span class=\"k\">end</span>\n\n<span class=\"o\">=&gt;</span> <span class=\"n\">div</span> <span class=\"n\">by</span> <span class=\"mi\">2</span> <span class=\"ow\">and</span> <span class=\"mi\">3</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#matching-against-incomplete-data-structures\"><h2 id=\"matching-against-incomplete-data-structures\">Matching against incomplete data structures</h2></a>\n\n<p>We can extend this concept to match against analogous data structures that are incompletely specified. In the example below we match against a list where missing values are denoted by :_ . The case statement will ignore these missing items when matching.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">module</span> <span class=\"nn\">Matchers</span>\n  <span class=\"no\">ListMatcher</span> <span class=\"o\">=</span> <span class=\"no\">Struct</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\">:matchable_list</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n    <span class=\"k\">def</span> <span class=\"nf\">===</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">)</span>\n      <span class=\"k\">return</span> <span class=\"kp\">false</span> <span class=\"k\">unless</span> <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">length</span> <span class=\"o\">==</span> <span class=\"n\">matchable_list</span><span class=\"o\">.</span><span class=\"n\">length</span>\n      <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">each_with_index</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">idx</span><span class=\"o\">|</span>\n        <span class=\"k\">case</span> <span class=\"n\">matchable_list</span><span class=\"o\">[</span><span class=\"n\">idx</span><span class=\"o\">]</span>\n        <span class=\"k\">when</span> <span class=\"ss\">:_</span><span class=\"p\">,</span> <span class=\"n\">item</span>\n          <span class=\"k\">next</span>\n        <span class=\"k\">else</span>\n          <span class=\"k\">return</span> <span class=\"kp\">false</span>\n        <span class=\"k\">end</span>       \n      <span class=\"k\">end</span>\n      <span class=\"kp\">true</span>\n    <span class=\"k\">end</span> \n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">matches</span> <span class=\"n\">array</span>\n  <span class=\"no\">Matchers</span><span class=\"o\">::</span><span class=\"no\">ListMatcher</span><span class=\"o\">.</span><span class=\"n\">new</span> <span class=\"n\">array</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">case</span> <span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"o\">]</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"ss\">:_</span> <span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 1\"</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 2\"</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"ss\">:_</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 3\"</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"ss\">:_</span> <span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 4\"</span>\n<span class=\"k\">end</span>\n\n<span class=\"c1\"># Outputs: case 4</span>\n</code></pre></div>\n<a class=\"header-link\" href=\"#retrieving-the-missing-data-items\"><h2 id=\"retrieving-the-missing-data-items\">Retrieving the missing data items</h2></a>\n\n<p>If we are matching against incomplete data structures perhaps it would be nice to extract the missing items as well. This requires a bit more boilerplate though.</p>\n<div class=\"highlight\"><pre><code class=\"ruby language-ruby\" data-lang=\"ruby\"><span class=\"k\">module</span> <span class=\"nn\">Matchers</span>\n\n  <span class=\"no\">Matchable</span> <span class=\"o\">=</span> <span class=\"no\">Struct</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\">:target</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n    <span class=\"k\">def</span> <span class=\"nf\">matches</span>\n      <span class=\"vi\">@matches</span> <span class=\"o\">||=</span> <span class=\"o\">[]</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"no\">ListMatcher</span> <span class=\"o\">=</span> <span class=\"no\">Struct</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\">:matchable_list</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n    <span class=\"k\">def</span> <span class=\"nf\">===</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">)</span>\n      <span class=\"k\">return</span> <span class=\"kp\">false</span> <span class=\"k\">unless</span> <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">target</span><span class=\"o\">.</span><span class=\"n\">length</span> <span class=\"o\">==</span> <span class=\"n\">matchable_list</span><span class=\"o\">.</span><span class=\"n\">length</span>\n\n      <span class=\"n\">match_results</span> <span class=\"o\">=</span> <span class=\"o\">[]</span>\n\n      <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">target</span><span class=\"o\">.</span><span class=\"n\">each_with_index</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">idx</span><span class=\"o\">|</span>\n        <span class=\"k\">case</span> <span class=\"n\">matchable_list</span><span class=\"o\">[</span><span class=\"n\">idx</span><span class=\"o\">]</span>\n        <span class=\"k\">when</span> <span class=\"ss\">:_</span>\n          <span class=\"n\">match_results</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">item</span>\n          <span class=\"k\">next</span>\n        <span class=\"k\">when</span> <span class=\"n\">item</span>\n          <span class=\"k\">next</span>\n        <span class=\"k\">else</span>\n          <span class=\"k\">return</span> <span class=\"kp\">false</span>\n        <span class=\"k\">end</span>       \n      <span class=\"k\">end</span>\n\n      <span class=\"n\">list</span><span class=\"o\">.</span><span class=\"n\">matches</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">match_results</span>\n      <span class=\"kp\">true</span>\n    <span class=\"k\">end</span> \n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">matches</span> <span class=\"n\">array</span>\n  <span class=\"no\">Matchers</span><span class=\"o\">::</span><span class=\"no\">ListMatcher</span><span class=\"o\">.</span><span class=\"n\">new</span> <span class=\"n\">array</span>\n<span class=\"k\">end</span>\n\n<span class=\"n\">matchable</span> <span class=\"o\">=</span> <span class=\"no\">Matchers</span><span class=\"o\">::</span><span class=\"no\">Matchable</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">)</span>\n\n<span class=\"k\">case</span> <span class=\"n\">matchable</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"ss\">:_</span> <span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 1\"</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 2\"</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"ss\">:_</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 3\"</span>\n<span class=\"k\">when</span> <span class=\"n\">matches</span><span class=\"p\">(</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"ss\">:_</span> <span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">)</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"case 4\"</span>\n<span class=\"k\">end</span>\n\n<span class=\"nb\">puts</span> <span class=\"n\">matchable</span><span class=\"o\">.</span><span class=\"n\">matches</span>\n <span class=\"o\">=&gt;</span> <span class=\"o\">[[</span><span class=\"mi\">2</span><span class=\"o\">]]</span>\n</code></pre></div>\n<p>Running the matchable through the case statements multiple times will keep appending the match results to the matches.</p>\n\n<p>Thus we have explored a variety of use cases where the case construct can, perhaps unexpectedly, be applied to our advantage. </p>\n\n<p>This concludes on our exploration of extensibility of the ruby case equality and I hope that it helps you write more expressive and elegant code using matchers.</p>\n\n",
            "tags": [
                "Ruby"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/11/26/boost-your-content-focussed-site-with-structured-page-fragments.html",
            "url": "https://lorefnon.me/2015/11/26/boost-your-content-focussed-site-with-structured-page-fragments.html",
            "title": "Boost your content focussed site with Structured Page Fragments",
            "date_published": "2015-11-26T00:00:00.000Z",
            "content_html": "<h2 id=\"The-context\"><a href=\"#The-context\" class=\"headerlink\" title=\"The context\"></a>The context</h2><p>SPF.js a lightweight javascript library to incorporate dynamic page updates that dramatically reduces perceived page latency. Quoting from the Repo Homepage:</p>\n<blockquote>\n<p>Using progressive enhancement and HTML5, SPF integrates with your site to enable a faster, more fluid user experience by updating just the sections of the page that change during navigation, not the whole page. SPF provides a response format for sending document fragments, a robust system for script and style management, an in-memory cache, on-the-fly processing, and more.</p>\n</blockquote>\n<p>While for complex dynamic sites which have a significant amount of client side logic, I still recommend adopting a client side javascript framework, but for content focussed sites, a nifty utility like SPF.js can be very useful.</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Why-not-good-old-js-erb-templates\"><a href=\"#Why-not-good-old-js-erb-templates\" class=\"headerlink\" title=\"Why not good old js.erb templates ?\"></a>Why not good old js.erb templates ?</h2><p>While Rails allows us to render server generated javascript templates, using them to generate dynamic page updates is a bit cumbersome for most scenarios. Especially you have to handle page url updates manually, scroll back the pages manually etc. None of them are very complex concerns, but having a library deal with such cross cutting concerns is much more elegant IMHO.</p>\n<h2 id=\"What-about-turbolinks\"><a href=\"#What-about-turbolinks\" class=\"headerlink\" title=\"What about turbolinks ?\"></a>What about turbolinks ?</h2><p>While yes, turbolinks does enjoy being a part of the default Rails stack, but frankly, it has always seemed like a half baked product. While turbolinks does improve the experience over full page reloads, behind the scenes it still loads the full page content.</p>\n<p>SPF.js allows you to just fetch the parts of the page that really need updating. The GIF below, also taken from the official site, explains this much better:</p>\n<table style=\"margin: auto\">\n  <thead>\n    <tr>\n      <th> Full page re-rerendering </th>\n      <th> Partial section replacement with SPF.js </th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td> <img src=\"/images/animation-static-340x178.gif\"></td>\n      <td> <img src=\"/images/animation-dynamic-340x178.gif\"></td>\n    </tr>\n  </tbody>\n</table>\n\n<h2 id=\"But-doesn-39-t-the-latest-version-of-turbolinks-include-support-for-partial-page-replacement\"><a href=\"#But-doesn-39-t-the-latest-version-of-turbolinks-include-support-for-partial-page-replacement\" class=\"headerlink\" title=\"But doesn&#39;t the latest version of turbolinks include support for partial page replacement ?\"></a>But doesn&#39;t the latest version of turbolinks include support for partial page replacement ?</h2><p>Yes, but there is a <a href=\"https://github.com/rails/turbolinks/issues/628\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">lack of clarity</a> over when (and if) that feature will be officially released.</p>\n<p>In a nutshell, the version of turbolinks that is scheduled to ship with Rails 5, significantly diverges from what has hitherto been considered as the <a href=\"https://github.com/rails/turbolinks/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official turbolinks repo</a>, and will probably not contain, among other features, support for partial page replacements. While the future is not set in stone, and as DHH has <a href=\"https://github.com/rails/turbolinks/issues/628#issuecomment-157376926\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">put it</a>:</p>\n<blockquote>\n<p>But, hey, it&#39;s just code. If the current state of this repo serves your\nneeds, you don&#39;t need any official blessing from anyone to use it. You can\nuse it as-is, you can fork, you can do whatever you want. MIT baby!</p>\n</blockquote>\n<p>While I appreciate the freedom associated with open source licenses, I would rather bet on a well supported library that caters to the exact same use case and which is already being used in production in a wildly popular site - Youtube.</p>\n<h2 id=\"Integrating-SPF-js-with-Rails\"><a href=\"#Integrating-SPF-js-with-Rails\" class=\"headerlink\" title=\"Integrating SPF.js with Rails\"></a>Integrating SPF.js with Rails</h2><p>The rest of the post outlines the steps required to integrate SPF.js with a rails application. The code for this tutorial is available in <a href=\"https://github.com/lorefnon/rails-spfjs-demo\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Github</a>.</p>\n<p>We will create a dummy blog application. But hey, since this is just a demo application, we can get away with a little <a href=\"https://github.com/sevenwire/forgery\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Forgery</a>:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PostsController</span> &lt; <span class=\"hljs-title class_ inherited__\">ApplicationController</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">index</span>\n    <span class=\"hljs-variable\">@page</span> = params[<span class=\"hljs-symbol\">:page</span>].to_i\n    <span class=\"hljs-variable\">@num_pages</span> = <span class=\"hljs-number\">1000</span>\n    <span class=\"hljs-variable\">@posts</span> = <span class=\"hljs-number\">10</span>.times.map &#123; fake_post_summary &#125;\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">show</span>\n    <span class=\"hljs-variable\">@post</span> = fake_post\n  <span class=\"hljs-keyword\">end</span>\n\n  private\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fake_post</span>\n    <span class=\"hljs-title class_\">OpenStruct</span>.new fake_post_summary.to_h.merge!(\n      <span class=\"hljs-symbol\">id:</span> params[<span class=\"hljs-symbol\">:id</span>],\n      <span class=\"hljs-symbol\">body:</span> LoremIpsum.random(<span class=\"hljs-symbol\">paragraphs:</span> rand(<span class=\"hljs-number\">20</span>))\n    )\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fake_post_summary</span>\n    <span class=\"hljs-title class_\">OpenStruct</span>.new(\n      <span class=\"hljs-symbol\">id:</span> rand(<span class=\"hljs-number\">1000</span>),\n      <span class=\"hljs-symbol\">title:</span> LoremIpsum.lorem_ipsum(<span class=\"hljs-symbol\">words:</span> rand(<span class=\"hljs-number\">20</span>)),\n      <span class=\"hljs-symbol\">summary:</span> LoremIpsum.random(<span class=\"hljs-symbol\">paragraphs:</span> <span class=\"hljs-number\">1</span>),\n      <span class=\"hljs-symbol\">author:</span> <span class=\"hljs-title class_\">OpenStruct</span>.new(\n        <span class=\"hljs-symbol\">user_name:</span> Forgery(<span class=\"hljs-string\">&#x27;internet&#x27;</span>).user_name,\n        <span class=\"hljs-symbol\">email:</span> Forgery(<span class=\"hljs-string\">&#x27;internet&#x27;</span>).email_address\n      )\n    )\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span>\n</code></pre>\n\n<p>So now that we have our dummy posts in place, we just need to show them:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- posts/index.html.erb --&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;blog-container&quot;</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;blog-title title&quot;</span>&gt;</span> Lorefnon&#x27;s Awesome blog <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;page-title title&quot;</span>&gt;</span> Posts <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;posts-container&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> render <span class=\"hljs-string\">&#x27;posts/posts&#x27;</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span></code></pre>\n\n<br/>\n\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- posts/_posts.html.erb --&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;posts-list&quot;</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;posts&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">    &lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-variable\">@posts</span>.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">post</span>| </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> render <span class=\"hljs-string\">&#x27;posts/summary&#x27;</span>, <span class=\"hljs-symbol\">post:</span> post </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    &lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;navigation-links&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">  &lt;%=</span><span class=\"language-ruby\"> render <span class=\"hljs-string\">&#x27;posts/navigation_links&#x27;</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span></code></pre>\n\n<br/>\n\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- posts/_summary.html.erb --&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">data-post-id</span>=<span class=\"hljs-string\">&quot;&lt;%=</span></span></span><span class=\"language-ruby\"> post.id </span><span class=\"language-xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">%&gt;&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title post-title&quot;</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> link_to post.title, post_path(<span class=\"hljs-symbol\">id:</span> post.id) </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> post.summary </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span></code></pre>\n\n<br/>\n\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- posts/_navigation_links.html.erb --&gt;</span></span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-variable\">@page</span> &gt; <span class=\"hljs-number\">0</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">   &lt;%=</span><span class=\"language-ruby\"> link_to <span class=\"hljs-string\">&#x27;Previous Page&#x27;</span>, posts_path(<span class=\"hljs-symbol\">page:</span> <span class=\"hljs-variable\">@page</span>-<span class=\"hljs-number\">1</span>) </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-variable\">@page</span> &lt; <span class=\"hljs-variable\">@num_pages</span> -<span class=\"hljs-number\">1</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">   &lt;%=</span><span class=\"language-ruby\"> link_to <span class=\"hljs-string\">&#x27;Next Page&#x27;</span>, posts_path(<span class=\"hljs-symbol\">page:</span> <span class=\"hljs-variable\">@page</span>+<span class=\"hljs-number\">1</span>) </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span></code></pre>\n\n<br/>\n\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- posts/show.html.erb --&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;blog-container&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;post-title title&quot;</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> link_to <span class=\"hljs-variable\">@post</span>.title, post_path(<span class=\"hljs-symbol\">id:</span> <span class=\"hljs-variable\">@post</span>.id) </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;post-body&quot;</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> <span class=\"hljs-variable\">@post</span>.body </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span></code></pre>\n\n<p>The above templates have nothing particularly characteristic. If you would have written them yourself, I guess you would have implemented something very similar. I have presented above to particularly highlight that the way you structure your views does not need to be drastically altered to use SPF.js. Hence it is easy to take your existing sites and start using SPF.js.</p>\n<p>Our dummy blog looks something like this now:</p>\n<img src=\"/images/2015-11-26/blog_index.png\">\n\n<h2 id=\"Including-SPF\"><a href=\"#Including-SPF\" class=\"headerlink\" title=\"Including SPF\"></a>Including SPF</h2><p>Next step for us is to include SPF.js in the page. For that we will just add the cdn link to our layout. Other methods of including are available <a href=\"https://github.com/youtube/spfjs#download\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">here</a>.</p>\n<p>After this inclusion our template might look something like this:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span></span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Rails Spfjs Demo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span></span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> javascript_include_tag <span class=\"hljs-string\">&#x27;//ajax.googleapis.com/ajax/libs/spf/2.3.0/spf.js&#x27;</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> stylesheet_link_tag    <span class=\"hljs-string\">&#x27;application&#x27;</span>, <span class=\"hljs-symbol\">media:</span> <span class=\"hljs-string\">&#x27;all&#x27;</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> javascript_include_tag <span class=\"hljs-string\">&#x27;application&#x27;</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> csrf_meta_tags </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  &lt;%=</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">yield</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span></span>\n<span class=\"language-xml\">    spf.init();</span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span></span></code></pre>\n\n<h2 id=\"Making-navigation-links-SPF-aware\"><a href=\"#Making-navigation-links-SPF-aware\" class=\"headerlink\" title=\"Making navigation links SPF aware\"></a>Making navigation links SPF aware</h2><p>However just initializing SPF.js does not magically ajaxify all navigation links. In fact by so far SPF.js does not alter the navigation in any way. We need to explicitly enable SPFjs for links for which our server knows how to server partial content. For SPF to process a link, it should have the class &#39;spf-link&#39;. Let us start with our navigation links:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-variable\">@page</span> &gt; <span class=\"hljs-number\">0</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">   &lt;%=</span><span class=\"language-ruby\"> link_to <span class=\"hljs-string\">&#x27;Previous Page&#x27;</span>, posts_path(<span class=\"hljs-symbol\">page:</span> <span class=\"hljs-variable\">@page</span>-<span class=\"hljs-number\">1</span>), <span class=\"hljs-symbol\">class:</span> <span class=\"hljs-string\">&#x27;spf-link&#x27;</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-variable\">@page</span> &lt; <span class=\"hljs-variable\">@num_pages</span> -<span class=\"hljs-number\">1</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">   &lt;%=</span><span class=\"language-ruby\"> link_to <span class=\"hljs-string\">&#x27;Next Page&#x27;</span>, posts_path(<span class=\"hljs-symbol\">page:</span> <span class=\"hljs-variable\">@page</span>+<span class=\"hljs-number\">1</span>), <span class=\"hljs-symbol\">class:</span> <span class=\"hljs-string\">&#x27;spf-link&#x27;</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span></code></pre>\n\n<p>One great feature of SPF.js is that it handles graceful degradation. So, since we haven&#39;t done anything on the server side to generate partial contents, SPF will try to make an ajax request to server (with the special query parameter spf&#x3D;navigate) and once that response format does not match what SPF expects, it will allow a full page reload.</p>\n<h2 id=\"Server-side-handling-for-SPF\"><a href=\"#Server-side-handling-for-SPF\" class=\"headerlink\" title=\"Server side handling for SPF\"></a>Server side handling for SPF</h2><p>Let us move on to server side handling:</p>\n<p>As we have previously mentioned that SPF sends an ajax request using spf&#x3D;navigate query parameter. We can detect that in our controller and send out a special response that only includes the parts of the page we need to update:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PostsController</span> &lt; <span class=\"hljs-title class_ inherited__\">ApplicationController</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">index</span>\n    <span class=\"hljs-variable\">@page</span> = params[<span class=\"hljs-symbol\">:page</span>].to_i\n    <span class=\"hljs-variable\">@num_pages</span> = <span class=\"hljs-number\">1000</span>\n    <span class=\"hljs-variable\">@posts</span> = <span class=\"hljs-number\">10</span>.times.map &#123; fake_post_summary &#125;\n\n    <span class=\"hljs-keyword\">if</span> params[<span class=\"hljs-symbol\">:spf</span>] == <span class=\"hljs-string\">&#x27;navigate&#x27;</span>\n      render <span class=\"hljs-string\">&#x27;posts/index.json&#x27;</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n\n...</code></pre>\n\n<p>Next we will have to designate the parts that can be dynamically replace using an id. In our modified <code>posts/_summary.html.erb</code> below, <code>spf-posts-container</code> serves that purpose:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">data-post-id</span>=<span class=\"hljs-string\">&quot;&lt;%=</span></span></span><span class=\"language-ruby\"> post.id </span><span class=\"language-xml\"><span class=\"hljs-tag\"><span class=\"hljs-string\">%&gt;&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;title post-title&quot;</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> link_to post.title, post_path(<span class=\"hljs-symbol\">id:</span> post.id) </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> post.summary </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span></code></pre>\n\n\n<p>While SPF does not require DOM node IDs to begin with <code>spf-</code> prefix I think this is a good convention and makes the intent explict.</p>\n<p>Finally here is our json template that contains the partial page update, in the format that SPF.js <a href=\"https://youtube.github.io/spfjs/documentation/responses/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">can process</a>.</p>\n<p>index.json.erb:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\">&#123;</span>\n<span class=\"language-xml\">  &quot;body&quot;: &#123;</span>\n<span class=\"language-xml\">    &quot;spf-posts-container&quot;: &quot;&lt;%=</span><span class=\"language-ruby\"> j render <span class=\"hljs-string\">&#x27;posts/posts&#x27;</span> </span><span class=\"language-xml\">%&gt;&quot;</span>\n<span class=\"language-xml\">  &#125;</span>\n<span class=\"language-xml\">&#125;</span></code></pre>\n\n<p>While we are using a simple <code>json.erb</code> template, it should be noted that any generic approach that can generate json response in rails, works well. So if you are already using <code>rabl</code> or <code>jbuilder</code> in your APIs, you can continue using that.</p>\n<p>Now when a navigation link is clicked, the json response is fetched via ajax and the page is dynamically updated - resulting in a much smoother user experience. Also note that browser url has been automatically updated and the page scrolls to the top. SPF tries to emulate the experience the experience of page change as much as possible to prevent uncanny surprises.</p>\n<img src=\"/images/2015-11-26/spf_response.png\">\n\n<h2 id=\"Optional-Leveraging-rails-magic-for-leaner-controllers\"><a href=\"#Optional-Leveraging-rails-magic-for-leaner-controllers\" class=\"headerlink\" title=\"(Optional) Leveraging rails magic for leaner controllers\"></a>(Optional) Leveraging rails magic for leaner controllers</h2><p>While the above works, it is unweildy to handle the navigation link in each controller. We can alternatively make the <code>default_render</code> method that is used by rails to be SPF aware. The <a href=\"https://github.com/rails/rails/blob/7f18ea14c893cb5c9f04d4fda9661126758332b5/actionpack/lib/action_controller/metal/implicit_render.rb\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">default implementation</a> looks like this:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">default_render</span>(<span class=\"hljs-params\">*args</span>)\n  <span class=\"hljs-keyword\">if</span> template_exists?(action_name.to_s, _prefixes, <span class=\"hljs-symbol\">variants:</span> request.variant)\n    render(*args)\n  <span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-keyword\">if</span> block_given?\n      <span class=\"hljs-keyword\">yield</span>(*args)\n    <span class=\"hljs-keyword\">else</span>\n      logger.info <span class=\"hljs-string\">&quot;No template found for <span class=\"hljs-subst\">#&#123;<span class=\"hljs-variable language_\">self</span>.<span class=\"hljs-keyword\">class</span>.name&#125;</span>\\#<span class=\"hljs-subst\">#&#123;action_name&#125;</span>, rendering head :no_content&quot;</span> <span class=\"hljs-keyword\">if</span> logger\n      <span class=\"hljs-variable language_\">super</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>We can override this in our ApplicationController</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ApplicationController</span> &lt; <span class=\"hljs-title class_ inherited__\">ActionController::Base</span>\n\n  <span class=\"hljs-comment\"># Prevent CSRF attacks by raising an exception.</span>\n  <span class=\"hljs-comment\"># For APIs, you may want to use :null_session instead.</span>\n  protect_from_forgery <span class=\"hljs-symbol\">with:</span> <span class=\"hljs-symbol\">:exception</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">default_render</span>(<span class=\"hljs-params\">*args</span>)\n    <span class=\"hljs-keyword\">if</span> params[<span class=\"hljs-symbol\">:spf</span>] == <span class=\"hljs-string\">&#x27;navigate&#x27;</span>\n      render <span class=\"hljs-string\">&quot;<span class=\"hljs-subst\">#&#123;controller_name&#125;</span>/spf_<span class=\"hljs-subst\">#&#123;action_name&#125;</span>.json&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n      <span class=\"hljs-variable language_\">super</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now all we have to do is prefix the names of our SPF specific templates with <code>spf_</code> and we are done. Our <code>spf_index.json.erb</code> remains unchanged.</p>\n<p>We can clean up the action and remove SPF specific code:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PostsController</span> &lt; <span class=\"hljs-title class_ inherited__\">ApplicationController</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">index</span>\n    <span class=\"hljs-variable\">@page</span> = params[<span class=\"hljs-symbol\">:page</span>].to_i\n    <span class=\"hljs-variable\">@num_pages</span> = <span class=\"hljs-number\">1000</span>\n    <span class=\"hljs-variable\">@posts</span> = <span class=\"hljs-number\">10</span>.times.map &#123; fake_post_summary &#125;\n  <span class=\"hljs-keyword\">end</span>\n\n...</code></pre>\n\n<h2 id=\"Navigation-hooks\"><a href=\"#Navigation-hooks\" class=\"headerlink\" title=\"Navigation hooks\"></a>Navigation hooks</h2><p>While so far everything works pretty well, we may want to hook into navigation events for greater flexibility. This may be useful for sending events to analytics service or for highlighting specific parts of page. The latter is useful because in some cases when the part replaced is very small, user might not immediate notice a quick change in the page content.</p>\n<p>For instance <code>spfdone</code> event is invoked after the asynchronous update has been applied to the page. We can attach handlers to this event just like any other event, and hook custom logic:</p>\n<img src=\"/images/2015-11-26/spfdone.png\">\n\n<p>Let us highlight the listing of our posts using CSS 3 animations when loaded asynchronously:</p>\n<pre><code class=\"hljs js\">$(<span class=\"hljs-variable language_\">document</span>).<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&#x27;spfdone&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">event</span>) &#123;\n\n  <span class=\"hljs-keyword\">if</span> (event.<span class=\"hljs-property\">originalEvent</span>.<span class=\"hljs-property\">detail</span>.<span class=\"hljs-property\">response</span>.<span class=\"hljs-property\">body</span>[<span class=\"hljs-string\">&#x27;spf-posts-container&#x27;</span>]) &#123;\n    $(<span class=\"hljs-string\">&#x27;#spf-posts-container&#x27;</span>).<span class=\"hljs-title function_\">addClass</span>(<span class=\"hljs-string\">&#x27;flash&#x27;</span>)\n\n    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;\n      $(<span class=\"hljs-string\">&#x27;#spf-posts-container&#x27;</span>).<span class=\"hljs-title function_\">removeClass</span>(<span class=\"hljs-string\">&#x27;flash&#x27;</span>)\n    &#125;, <span class=\"hljs-number\">3000</span>)\n\n  &#125;\n\n&#125;);</code></pre>\n\n<br/>\n\n<pre><code class=\"hljs css\"><span class=\"hljs-selector-class\">.flash</span> &#123;\n  -moz-<span class=\"hljs-attribute\">animation</span>: flash <span class=\"hljs-number\">1s</span> ease-out;\n  -moz-<span class=\"hljs-attribute\">animation-iteration-count</span>: <span class=\"hljs-number\">1</span>;\n\n  -webkit-<span class=\"hljs-attribute\">animation</span>: flash <span class=\"hljs-number\">1s</span> ease-out;\n  -webkit-<span class=\"hljs-attribute\">animation-iteration-count</span>: <span class=\"hljs-number\">1</span>;\n\n  -ms-<span class=\"hljs-attribute\">animation</span>: flash <span class=\"hljs-number\">1s</span> ease-out;\n  -ms-<span class=\"hljs-attribute\">animation-iteration-count</span>: <span class=\"hljs-number\">1</span>;\n&#125;\n\n<span class=\"hljs-keyword\">@-webkit-keyframes</span> flash &#123;\n    <span class=\"hljs-number\">0%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: none; &#125;\n    <span class=\"hljs-number\">50%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#fbf8b2</span>; &#125;\n    <span class=\"hljs-number\">100%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: none; &#125;\n&#125;\n\n<span class=\"hljs-keyword\">@-moz-keyframes</span> flash &#123;\n    <span class=\"hljs-number\">0%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: none; &#125;\n    <span class=\"hljs-number\">50%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#fbf8b2</span>; &#125;\n    <span class=\"hljs-number\">100%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: none; &#125;\n&#125;\n\n<span class=\"hljs-keyword\">@-ms-keyframes</span> flash &#123;\n    <span class=\"hljs-number\">0%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: none; &#125;\n    <span class=\"hljs-number\">50%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-number\">#fbf8b2</span>; &#125;\n    <span class=\"hljs-number\">100%</span> &#123; <span class=\"hljs-attribute\">background-color</span>: none; &#125;\n&#125;</code></pre>\n\n<p>Now you should see a subtle flash when page content has been replaced.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>This concludes our small post on SPF integration with Rails. SPF allows for a lot more customization options beyond what our small covers. In particular SPF allows us to inject new scripts and styles dynamically, sophisticated <a href=\"https://youtube.github.io/spfjs/documentation/caching/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">cache management</a> and <a href=\"https://youtube.github.io/spfjs/documentation/versioning/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">resource versioning</a> support, which are all very useful features.</p>\n<p>The <a href=\"https://youtube.github.io/spfjs/documentation\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official documentation</a> is a great place to start exploring more.</p>\n",
            "tags": [
                "Javascript",
                "Rails",
                "SPF"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/11/22/an-answer-to-react-is-the-new-java.html",
            "url": "https://lorefnon.me/2015/11/22/an-answer-to-react-is-the-new-java.html",
            "title": "An answer to \"React is the new Java\"",
            "date_published": "2015-11-22T00:00:00.000Z",
            "content_html": "<p>This post is essentially my attempt to answer some of the concerns presented in this <a href=\"https://news.ycombinator.com/item?id=10609159\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">opinion</a> posted in HN. The author has likened the success of React with the success of Java, exemplifying how time again, what (s)he identifies as worse technology, has been pushed to a higher popularity rather than more competent alternatives available.</p>\n<blockquote>\n<p>I have been learning new technologies pretty much continuously. It&#39;s not impossible, especially if you follow sites like Hacker News, to keep a finger on the direction of the industry, and then try to stay on top of the next new hot technology of the year.</p>\n</blockquote>\n<blockquote>\n<p>But I hear you on the &quot;worse&quot; technology sometimes winning. You mentioned Java; it was worse than just about all other major contenders, and is only finally losing popularity.</p>\n</blockquote>\n<blockquote>\n<p>On a current technology fad: React seems to be designed to ignore 40 years of accumulated software best practices. [1] Separation of concerns? Who needs that any more? And the rationale for it is that it allows teams of 100 developers work together on an app.</p>\n</blockquote>\n<h2 id=\"Separation-of-Concerns\"><a href=\"#Separation-of-Concerns\" class=\"headerlink\" title=\"Separation of Concerns ?\"></a>Separation of Concerns ?</h2><p>Well, separation on concerns is a good thing to have. But only when the concerns actually translate to different responsibilities and not when they are multiple facets of the same problem.</p>\n<p>The way I see it, managing an identifyable entity in the presentation layer is a singular concern. Breaking up this presentation entity into decoupled parts - a chunk of text based HTML template, a stylesheet to make this template visually appealing and associated javascript that alters the DOM structure depending on user interaction of change of application state, does not facilitate separation of concerns, it makes things less cohesive. <a href=\"http://thebojan.ninja/2015/04/08/high-cohesion-loose-coupling/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Loose coupling, High Cohesion</a> is a classic best practice, proven time again, and React does not ignore this, it accentuates its importance.</p>\n<p>Especially in web-applications the styling rules are intrinsically linked to the DOM structure of a widget and so is the javascript that is responsible for syncing the application state to and from the DOM. Multitude of javascript libraries have recognized this long before React including but not limited to widely popular libraries like <a href=\"http://knockoutjs.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Knockout</a>, <a href=\"https://dojotoolkit.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Dojo</a> and <a href=\"https://www.sencha.com/products/extjs/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">ExtJS</a>.</p>\n<h2 id=\"Fads-are-not-born-from-thin-air\"><a href=\"#Fads-are-not-born-from-thin-air\" class=\"headerlink\" title=\"Fads are not born from thin air\"></a>Fads are not born from thin air</h2><p>Promotion of best practices like <a href=\"https://medium.com/@joshblack/stateless-components-in-react-0-14-f9798f8b992d#.h457qzmob\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Stateless components</a> and <a href=\"https://medium.com/@dan_abramov/mixins-are-dead-long-live-higher-order-components-94a0d2f9e750#.6lh6otq97\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">composition of higher order components</a> goes a long way towards ensuring separation of concerns where they matter.</p>\n<p>The upcoming Web Component technology is fueled by the widespread need for true component oriented building blocks and popularity of frameworks like Google Polymer highlights it very well.</p>\n<h2 id=\"JSX-and-designer-languages\"><a href=\"#JSX-and-designer-languages\" class=\"headerlink\" title=\"JSX and designer languages\"></a>JSX and designer languages</h2><blockquote>\n<p>Open standards? Nah, how about lock-in to custom language extensions that will prevent you from migrating your code to the next web standard! Much better.</p>\n</blockquote>\n<p>JSX is a custom language extension alright but it is not mandatory for using React. It is <a href=\"http://jamesknelson.com/learn-raw-react-no-jsx-flux-es6-webpack/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">fairly easy</a> to use vanilla javascript and benefit from all the features of React. In fact it is also easy to use React with other AltJS languages like <a href=\"http://blog.vjeux.com/2013/javascript/react-coffeescript.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Coffeescript</a>, <a href=\"http://lorefnon.me/2015/09/21/react-and-livescript-in-harmony.html\">Livescript</a> and <a href=\"https://github.com/Asana/typed-react\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Typescript</a>.</p>\n<p>While I agree that without JSX, the code is much more verbose - there are solutions like <a href=\"https://github.com/mlmorg/react-hyperscript\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">React hyperscript</a> that let you express the DOM structure within javascript, or <a href=\"https://github.com/wix/react-templates\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">React Templates</a> and <a href=\"https://github.com/jadejs/react-jade\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">React Jade</a> which allow you to use external templates with React.</p>\n<p>Also there is a <a href=\"https://facebook.github.io/jsx/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">draft specification</a> for JSX in place and some other frameworks have already <a href=\"https://github.com/insin/msx\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">started</a> adopting it.</p>\n<h2 id=\"About-open-standards\"><a href=\"#About-open-standards\" class=\"headerlink\" title=\"About open standards\"></a>About open standards</h2><h3 id=\"Web-Components\"><a href=\"#Web-Components\" class=\"headerlink\" title=\"Web Components\"></a>Web Components</h3><p>The reasons for not using an open standard like web components have been <a href=\"https://github.com/facebook/react/issues/5052#issuecomment-145594782\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">explained</a> by the React team:</p>\n<blockquote>\n<p>It has turned out that the spec is incomplete with regard to things like event delegation and there are still major changes being pushed from various sides, such as Mozilla. What was in Polymer&#x2F;Chrome is not the final incarnation so we&#39;ve had to revert some of the support that we already added (e.g. support for event handling in shadow trees).</p>\n</blockquote>\n<blockquote>\n<p>In terms of strategy, we&#39;ll go forward with as if it didn&#39;t exist and try to improve interop at the React or React-like component layer instead. I&#39;ve talked with members of other popular UI frameworks and they seem to feel the same. In fact, we probably have a better chance at implementing solid interop in user land.</p>\n</blockquote>\n<p>In fact there already exist some <a href=\"http://addyosmani.com/blog/component-interop-with-react-and-custom-elements/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">resources</a> for working with React and Web-components in same application.</p>\n<p>There is nothing preventing us from migrating to the next web standard. As others have pointed out in the thread, removing JSX is just a matter of running the transformer against the existing codebase and checking in the generated javascript. The output is still human readable.</p>\n<h3 id=\"XML-in-javascript\"><a href=\"#XML-in-javascript\" class=\"headerlink\" title=\"XML in javascript\"></a>XML in javascript</h3><p>Attempts towards seamless incorporation of XML in ecmascript is not a new idea. Actionscript has had that since ages. While E4X is an <a href=\"https://en.wikipedia.org/wiki/ECMAScript_for_XML\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">open standard</a>, pragmatic reasons have been <a href=\"http://blog.vjeux.com/2013/javascript/jsx-e4x-the-good-parts.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">put forward</a> by React team for not embracing it entirely:</p>\n<blockquote>\n<p>The major use case of XML within Javascript is to write HTML tags. Unfortunately, what E4X generates is not a DOM node. In order to use it to generate DOM nodes, you&#39;ve got to do a conversion phase not provided by default.</p>\n</blockquote>\n<blockquote>\n<p>The second use case of XML is to represent data. In Javascript world, this use case is already being fulfilled by JSON. E4X only supports strings as a data type where Javascript objects can contain numbers, booleans, functions ...</p>\n</blockquote>\n<blockquote>\n<p>All the code is not going to be converted to E4X right away. There&#39;s going to be a transition phase where E4X and non E4X code will have to co-exist. The fact that the objects E4X generates are not accessible from non E4X code means that none of the libraries ever written can work with E4X structures.</p>\n</blockquote>\n<h2 id=\"On-meritocracy-vs-mediocracy\"><a href=\"#On-meritocracy-vs-mediocracy\" class=\"headerlink\" title=\"On meritocracy vs mediocracy\"></a>On meritocracy vs mediocracy</h2><blockquote>\n<p>And how many app teams have 100 or more active developers? Probably fewer than a dozen, and I submit that none of them probably should. Certainly not the Facebook app: It has a lot of features, but not that many features, and yet it has a 150Mb footprint.</p>\n</blockquote>\n<blockquote>\n<p>When I hear things like that, I can&#39;t help but fill in &quot;junior&quot; or &quot;mediocre&quot; in front of &quot;developers.&quot; React helps to prevent people from breaking each others&#39; code when you have bloated development teams filled with junior developers. React has some cool ideas, but all told I think it&#39;s a step backward for software engineering, and certainly isn&#39;t as much of a help for small teams, especially if you want to have a CSS&#x2F;SCSS&#x2F;LESS expert styling your product without having to dig through JSX files, for instance.</p>\n</blockquote>\n<p>In a small app with a small team, there is little use for any framework at all, but software applications have this uncanny tendency to unexpectedly grow large depending on changing requirements, expanding scope. Given the above, I would certainly feel more comfortable working on a system where I can change the appearance of a component with confidence that will not introduce subtle changes in totally unrelated parts of my application, probably parts that I know nothing about.</p>\n<p>While yes, there are fewer teams that have 100 or more active developers, but high churn rates are an unavoidable problem especially in the startup ecosystems. While a competent developer will certainly be able to jump into an unknown codebase and in due time figure out his&#x2F;her way - but if the codebase is structured around best practices distilled by the community the time required in the same is drastically reduced. Optimizing the process around that seems like a very good idea.</p>\n<h2 id=\"On-stylesheets-a-system-of-cascading-problems\"><a href=\"#On-stylesheets-a-system-of-cascading-problems\" class=\"headerlink\" title=\"On stylesheets - a system of cascading problems\"></a>On stylesheets - a system of cascading problems</h2><p>Adding to the problem is that automated regression testing of CSS is time consuming and error prone. While there are <a href=\"https://css-tricks.com/automating-css-regression-testing/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">solutions</a> I think the crux of the problem is that our current styling system is a broken technology - globally shared stylesheets are evil and technologies like <a href=\"https://github.com/FormidableLabs/radium\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Radium</a> are steps in the right direction.</p>\n<p>While it isn&#39;t like we have not tried to solve this problem <a href=\"https://gridstylesheets.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">before</a>, I am really glad to see practical alternatives to stylesheets gathering traction.</p>\n<h2 id=\"The-good-parts\"><a href=\"#The-good-parts\" class=\"headerlink\" title=\"The good parts\"></a>The good parts</h2><blockquote>\n<p>I do like React&#39;s idea of the Virtual DOM for optimization, but you can get that without using React. [2] React Native is great for using native components and driving them from JavaScript, but it&#39;s also not the only game in town. [3]</p>\n</blockquote>\n<p>I agree, much has been written about these benefits, and the availability of alternatives is not exactly a secret either. I don&#39;t have much to add.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><blockquote>\n<p>Back to the original point, though: You can stay on top of the Hot New Technologies, but when there are good technical reasons to use alternate technologies, stay on top of those as well. And then explain clearly to your clients (or employers) why the current fad is a fad, and how to get the key benefits of that stack without its drawbacks. Oh, and choose clients (or employers) who will listen to strong technical arguments. :)</p>\n</blockquote>\n<p>While I disagree with the primary premise, this is a very strong and sound advise. I whole-heartedly agree that solutions should be rationally vetted and benchmarked before being put to use. I hope that arguments I have presented above are perceived as rationally just. Any comments or suggestions are more than welcome.</p>\n",
            "tags": [
                "Javascript",
                "React"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/11/15/a-minimal-setup-for-using-es6-modules-in-rails.html",
            "url": "https://lorefnon.me/2015/11/15/a-minimal-setup-for-using-es6-modules-in-rails.html",
            "title": "A minimal setup for using ES6 modules in Rails",
            "date_published": "2015-11-15T00:00:00.000Z",
            "content_html": "<p>While ES6 adoption is progressively improving across browsers, and the sprockets team is planning to integrate ES6 features into Rails asset pipeline in near future, using a widely popular transpiler: <a href=\"https://babeljs.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Babel</a> we can leverage many of those features right away. The specific aspect of interest for this post is ES6 modules feature which provides a standardized module system for javascript.</p>\n<p>While babel does have a solution for ES6 modules, rather than handling dependency resolution itself - it transpiles the modules to existing javascript based module systems - the most popular ones being <a href=\"https://github.com/amdjs\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">AMD</a> and <a href=\"https://commonjs.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">CommonJS</a>. This post does not go into a compartive analysis of them, but there is an excellent <a href=\"addyosmani.com/writing-modular-js/\">article</a> by <a href=\"https://twitter.com/addyosmani\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Addy Osmani</a> which provides an in-depth elaboration on the topic.</p>\n<p>The solution <a href=\"https://babeljs.io/docs/setup/#rails\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">recommended</a> by the Babel team for using babel with rails, is through an experimental <a href=\"https://github.com/TannerRogalsky/sprockets-es6\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">sprockets-es6</a> gem, which is intended to be a PoC for future work to be integrated into Sprockets. Quoting from the README:</p>\n<blockquote>\n<p>This plugin is primarily experimental and will never reach a stable 1.0. The purpose is to test out BabelJS features on Sprockets 3.x and include it by default in Sprockets 4.x.</p>\n</blockquote>\n<p>Apart from the experimental status, the key issue with using this gem is that it is non-trivial to get ES6 modules to work with it. The primary reason being that, as mentioned above, even though babel transpiles ES6 modules to CommonJS (or AMD), we still need to provide an implementation of the relevant module system that will enable the browsers to recognize the modules. This means we will have to include another dependency like <a href=\"https://github.com/maccman/sprockets-commonjs\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">sprockets-commonjs</a>. However there is a caveat:</p>\n<blockquote>\n<p>One caveat to the approach this library takes, is that dependencies loaded through require() will not be added to the dependency graph. This library will not parse the AST tree for require calls. This decision has been made for a variety of reasons, but it does mean you need to require files through both CommonJS and Sprockets.</p>\n</blockquote>\n<p>Using AMD modules with <a href=\"https://github.com/jwhitley/requirejs-rails\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">requirejs-rails</a> is something that works, however javascript community has largely adopted <a href=\"https://npmjs.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">npm</a> for package management framework. For example - jQuery plugin repository now states:</p>\n<blockquote>\n<p>The jQuery Plugin Registry is in read-only mode.\nNew plugin releases will not be processed.\nWe recommend moving to npm, using &quot;jquery-plugin&quot; as the keyword in your package.json. The npm blog has instructions for publishing your plugin to npm.</p>\n</blockquote>\n<p>There is however a simpler solution: Using the gem <a href=\"https://github.com/browserify-rails/browserify-rails\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">browserify-rails</a> which bridges sprockets and <a href=\"http://browserify.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">browserify</a>. Browserify is a javascript bundler that leverages CommonJS :</p>\n<blockquote>\n<p>Browserify lets you require(&#39;modules&#39;) in the browser by bundling up all of your dependencies</p>\n</blockquote>\n<p>The great thing about browserify is that we can hook in transforms which can take care of additional pre-processing before the <code>require</code>d files are bundled up. Of particular interest to us, is the browserify transform for babel - <a href=\"https://github.com/babel/babelify\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">babelify</a> which allows us to  sidestep the caveat above. We need to have a node installation on the system though, just having a javascript runtime is not sufficient - but this is not much of an issue because node.js is now widely supported on all widely used platforms.</p>\n<p>To get this to work we need to add <code>browserify-rails</code> to Gemfile:</p>\n<pre><code class=\"hljs ruby\">gem <span class=\"hljs-string\">&quot;browserify-rails&quot;</span></code></pre>\n\n<p>as well as a <code>package.json</code> in project root:</p>\n<pre><code class=\"hljs javascript\">&#123;\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;something&quot;</span>,\n    <span class=\"hljs-string\">&quot;license&quot;</span>: <span class=\"hljs-string\">&quot;MIT&quot;</span>,\n    <span class=\"hljs-string\">&quot;engines&quot;</span>: &#123;\n        <span class=\"hljs-string\">&quot;node&quot;</span>: <span class=\"hljs-string\">&quot;&gt;= 0.10&quot;</span>\n    &#125;,\n    <span class=\"hljs-string\">&quot;dependencies&quot;</span>: &#123;\n        <span class=\"hljs-string\">&quot;babel-preset-es2015&quot;</span>: <span class=\"hljs-string\">&quot;^6.1.18&quot;</span>,\n        <span class=\"hljs-string\">&quot;babelify&quot;</span>: <span class=\"hljs-string\">&quot;^7.2.0&quot;</span>,\n        <span class=\"hljs-string\">&quot;browserify&quot;</span>: <span class=\"hljs-string\">&quot;~&gt; 10.2.4&quot;</span>,\n        <span class=\"hljs-string\">&quot;browserify-incremental&quot;</span>: <span class=\"hljs-string\">&quot;^3.0.1&quot;</span>\n    &#125;\n&#125;</code></pre>\n\n<p>If we want to use other javascript libraries available through npm we can include them directly in the package.json. There is a single caveat though: We can not directly start using ES6 modules in our top level files (typically application.js) but only in our <code>require</code>d files:</p>\n<p>So our application.js can be fairly minimal with a single require statement:</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./main&#x27;</span>)</code></pre>\n\n<p>Now we can use ES6 modules in main.js</p>\n<p>main.js:</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">import</span> hello <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&#x27;./hello&#x27;</span>\n\n<span class=\"hljs-title function_\">hello</span>()</code></pre>\n\n<p>hello.js:</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">hello</span>(<span class=\"hljs-params\"></span>) &#123;\n    <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&#x27;hello world&#x27;</span>);\n&#125;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> hello;</code></pre>\n\n<p>If we run the server now and visit the home page, we should be greeted with a hello prompt.</p>\n",
            "tags": [
                "Javascript",
                "Rails",
                "ES6"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/11/15/utilities-for-efficient-filesystem-navigation-in-emacs.html",
            "url": "https://lorefnon.me/2015/11/15/utilities-for-efficient-filesystem-navigation-in-emacs.html",
            "title": "Utilities for efficient filesystem navigation in emacs",
            "date_published": "2015-11-15T00:00:00.000Z",
            "content_html": "<p>While most of time spent working on a project goes into coding, finding the right files or understanding the directory structure is fairly time consuming as well. This is especially true when we are exploring unknown projects - in particular, projects with custom directory structures as opposed to CoC frameworks. This post outlines a few tools which aid in project exploration and navigation across files which I have found to be useful in practice</p>\n<h2 id=\"Dired\"><a href=\"#Dired\" class=\"headerlink\" title=\"Dired\"></a>Dired</h2><p>While built into emacs, Dired is indespensable. I sincerely regret not spending the time required to develop familiarity with Dired when I was initially learning basics of Emacs. While the facilities provided by Dired are powerful enough to replace the full fledged file manager of your operating system, the real power comes from native integration with the rest of emacs.</p>\n<img src='/images/2015-11-15/dired.png'>\n\n<p>For instance, a Dired is buffer is just like a normal buffer, and all the dired buffers will be directly available from <code>list-buffers</code> - and from any alternative approaches to list buffers (eg. <code>helm-buffers-list</code> which we discuss shortly).</p>\n<p>I have found emacs bookmarks functionality to be particularly useful with Dired. Dired buffers can be bookmarked just like ordinary buffers and we can use <code>bookmark-jump</code> to quickly jump to important Dired buffers opened before.</p>\n<img src='/images/2015-11-15/bookmarks.png'>\n\n<h2 id=\"Neotree\"><a href=\"#Neotree\" class=\"headerlink\" title=\"Neotree\"></a>Neotree</h2><p>Neotree is a more conventional file manager - similar to what we find in IDEs. It is useful as an easily accessible persistent sidebar that provides the complete outline of the project. It is useful as a mini file manager though not as powerful as dired. The great part is that it is entirely usable through keyboard.</p>\n<img src='/images/2015-11-15/neotree.png'>\n\n<h2 id=\"Helm\"><a href=\"#Helm\" class=\"headerlink\" title=\"Helm\"></a>Helm</h2><p>Helm has been described as a package in a league of its own. Rather than being an isolated productivity tool, it improves our entire emacs experience through a powerful completion engine which may be different from the tab based completion pervasive in other editors&#x2F;IDEs or Shell but once the habit sets in, it is difficult to go back.</p>\n<p>We will not go into much depth into Helm, but the package is well documented and for getting started here is an excellent <a href=\"http://tuhdo.github.io/helm-intro.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">introductory article</a>.</p>\n<img src='/images/2015-11-15/helm.png'>\n\n<h2 id=\"Ag-and-Helm-Ag\"><a href=\"#Ag-and-Helm-Ag\" class=\"headerlink\" title=\"Ag and Helm-Ag\"></a>Ag and Helm-Ag</h2><p>While grep is arguably the most popular tool for finding files containing specific content, tools like the <a href=\"https://github.com/ggreer/the_silver_searcher\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Silver Searcher</a> improve upon grep by providing specialized tools for searching codebases. There is an <a href=\"https://github.com/Wilfred/ag.el\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">ag-mode</a> that integrates Ag with emacs and if you do use helm, there is a <a href=\"https://github.com/syohex/emacs-helm-ag\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">helm integration plugin</a> as well.</p>\n<img src='/images/2015-11-15/ag.png'>\n\n<h2 id=\"Projectile-and-Helm-Projectile\"><a href=\"#Projectile-and-Helm-Projectile\" class=\"headerlink\" title=\"Projectile and Helm-Projectile\"></a>Projectile and Helm-Projectile</h2><p><a href=\"http://batsov.com/projectile/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Projectile</a> is an amazing project management solution for solution.</p>\n<blockquote>\n<p>Projectile is a project interaction library for Emacs. Its goal is to provide a nice set of features operating on a project level without introducing external dependencies(when feasible). For instance - finding project files has a portable implementation written in pure Emacs Lisp without the use of GNU find (but for performance sake an indexing mechanism backed by external commands exists as well).</p>\n</blockquote>\n<p>Helm-projectile facilitates integration of projectile and helm, here is a great <a href=\"http://tuhdo.github.io/helm-projectile.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">introductory article</a> on getting started with this combo.</p>\n<h2 id=\"Ranger\"><a href=\"#Ranger\" class=\"headerlink\" title=\"Ranger\"></a>Ranger</h2><p>While Helm and Ag is useful for rapidly finding files when we know what we are looking for - however for exploring an unknown project and performing code review for changes across files, it is not the ideal solution. For this use case I have found a unix utility called Ranger very useful. Fortunately there also exists a Ranger mode for emacs which emulates similar feature within emacs. I have found its preview feature particularly complementary to the hierarchical tree based solutions.</p>\n<img src='/images/2015-11-15/ranger.png'>\n\n\n<p>This completes our detour into utilities make it easy to traverse projects in emacs. If there are other tools that this article could benefit from, please mention them in the comments below.</p>\n",
            "tags": [
                "Emacs",
                "Helm"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/09/21/react-and-livescript-in-harmony.html",
            "url": "https://lorefnon.me/2015/09/21/react-and-livescript-in-harmony.html",
            "title": "React and Livescript in harmony",
            "date_published": "2015-09-21T00:00:00.000Z",
            "content_html": "<h1 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h1><p><a href=\"http://livescript.net/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Livescript</a> is a programming language that compiles to readable javascript (similar to coffeescript) and provides language level facilities to <a href=\"http://livescript.net/#inspiration\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">encourage</a> functional programming. <a href=\"https://facebook.github.io/react/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">React.js</a> is a user interface library from <a href=\"https://facebook.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">facebook</a> that uses <a href=\"http://calendar.perfplanet.com/2013/diff/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">intelligent heuristics</a> for efficient DOM updates, simplifying the process of building data driven applications. This post outlines how the two can play well together, and tries to demostrate how livescript allows us write much more compact and succinct code. Basic familiarity with both of them is assumed.</p>\n<p>To begin with let us see what a basic component looks like:</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&#x27;application-container&#x27;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span></code></pre>\n\n<br>\n\n<pre><code class=\"hljs livescript\">ContactList = React.create-<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">do</span>\n  render: -&gt;\n    React.create-element <span class=\"hljs-string\">\\ul,</span> <span class=\"hljs-literal\">null</span>, @props.contacts.<span class=\"hljs-keyword\">map</span> <span class=\"hljs-function\"><span class=\"hljs-params\">(contact)</span>-&gt;</span>\n      React.create-element <span class=\"hljs-string\">\\li,</span> <span class=\"hljs-literal\">null</span>, contact.name\n\nel = React.create-element ContactList, contacts: [\n  * name: <span class=\"hljs-string\">&#x27;Harry Potter&#x27;</span>\n  * name: <span class=\"hljs-string\">&#x27;Albus Dumbledore&#x27;</span>\n]\n\nReact.render el, document.get-element-<span class=\"hljs-keyword\">by</span>-id <span class=\"hljs-string\">\\application-container</span></code></pre>\n\n<img src=\"/images/Screen Shot 2015-09-21 at 12.42.18 pm.png\">\n\n<p>This is very similar to what we would have written if we were using vanilla javascript. The only primary advantages are indentation based nesting, elimination of a lot of superfluous syntax - braces and parenthesis and implicit returns. However we can do much better than this.</p>\n<p>Because Livescript was forked from Coffeescript, it inherits Coffeescript&#39;s class syntax which we can use to extend <code>React.Component</code>. However the benefits of doing so are pretty-much marginal.</p>\n<pre><code class=\"hljs livescript\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ContactList</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">React</span>.Component\n\n  render: -&gt;\n    React.create-element <span class=\"hljs-string\">\\ul,</span> <span class=\"hljs-literal\">null</span>, @props.contacts.<span class=\"hljs-keyword\">map</span> <span class=\"hljs-function\"><span class=\"hljs-params\">(contact)</span>-&gt;</span>\n      React.create-element <span class=\"hljs-string\">\\li,</span> <span class=\"hljs-literal\">null</span>, contact.name</code></pre>\n\n<p>One thing that we may notice is that the above code does not use <a href=\"https://facebook.github.io/react/docs/jsx-in-depth.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">JSX</a>. While yes, it is <a href=\"https://github.com/facebook/react/issues/47#issuecomment-18877423\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">possible</a> to use JSX with livescript using backticks to escape xml constructs and then passing the generated js to babel, it is a hack we better forgo. As we will see soon, livescript native constructs allow for much more succinct expressions than the xml boilerplate that comes JSX.</p>\n<p>Livescript&#39;s feature that almost everything is a expression is particularly helpful when we have conditional logic in our dom generation code.</p>\n<pre><code class=\"hljs livescript\">element = React~create-element\n\nContactList = React.create-<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">do</span>\n\n  render: -&gt;\n    element <span class=\"hljs-string\">\\ul,</span> <span class=\"hljs-literal\">null</span>, @props.contacts.<span class=\"hljs-keyword\">map</span> <span class=\"hljs-function\"><span class=\"hljs-params\">(contact)</span>-&gt;</span>\n      element <span class=\"hljs-string\">\\li,</span> <span class=\"hljs-literal\">null</span>,\n        <span class=\"hljs-keyword\">if</span> contact.email\n          element <span class=\"hljs-string\">\\a,</span> href: <span class=\"hljs-string\">&quot;mailto:<span class=\"hljs-subst\">#&#123;contact.email&#125;</span>&quot;</span>, contact.name\n        <span class=\"hljs-keyword\">else</span>\n          contact.name\n\nel = element ContactList, contacts: [\n  * name: <span class=\"hljs-string\">&#x27;Harry Potter&#x27;</span>\n  * name: <span class=\"hljs-string\">&#x27;Albus Dumbledore&#x27;</span>\n    email: <span class=\"hljs-string\">&#x27;albus@hogwarts.magic&#x27;</span>\n]\n\nReact.render el, document.get-element-<span class=\"hljs-keyword\">by</span>-id <span class=\"hljs-string\">\\application-container</span></code></pre>\n\n<img src=\"/images/Screen Shot 2015-09-21 at 12.42.05 pm.png\">\n\n<p>When the render function becomes complex, it is often more readable to use livescript&#39;s pipe operator to chain the operations. This is particularly handy in conjugation with utility libraries geared towards functional programming - the example below uses <a href=\"http://ramdajs.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Ramda</a>. Other alternatives include <a href=\"http://underscorejs.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">underscore</a>, <a href=\"https://lodash.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">lodash</a>, <a href=\"http://www.preludels.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">prelude.ls</a> etc.</p>\n<pre><code class=\"hljs livescript\">element = React~create-element\n\nContactList = React.create-<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">do</span>\n\n  render-avatar: <span class=\"hljs-function\"><span class=\"hljs-params\">(contact)</span>-&gt;</span>\n    <span class=\"hljs-keyword\">if</span> contact.avatar\n    <span class=\"hljs-keyword\">then</span> element <span class=\"hljs-string\">\\img,</span> src: contact.avatar, height: <span class=\"hljs-number\">100</span>, width: <span class=\"hljs-number\">100</span>\n    <span class=\"hljs-keyword\">else</span> element <span class=\"hljs-string\">\\span,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&#x27;N/A&#x27;</span>\n\n  render-label: <span class=\"hljs-function\"><span class=\"hljs-params\">(contact)</span>-&gt;</span>\n    <span class=\"hljs-keyword\">if</span> contact.email\n    <span class=\"hljs-keyword\">then</span> element <span class=\"hljs-string\">\\a,</span> href: <span class=\"hljs-string\">&quot;mailto:<span class=\"hljs-subst\">#&#123;contact.email&#125;</span>&quot;</span>, contact.name\n    <span class=\"hljs-keyword\">else</span> element <span class=\"hljs-string\">\\span,</span> <span class=\"hljs-literal\">null</span>, contact.name\n\n  render-contact-row: <span class=\"hljs-function\"><span class=\"hljs-params\">(contact)</span>-&gt;</span>\n    element <span class=\"hljs-string\">\\tr,</span> key: contact.id, [\n      element <span class=\"hljs-string\">\\td,</span> <span class=\"hljs-literal\">null</span>, @render-avatar contact\n      element <span class=\"hljs-string\">\\td,</span> <span class=\"hljs-literal\">null</span>, @render-label contact\n    ]\n\n  render-head: -&gt;\n    element <span class=\"hljs-string\">\\thead,</span> <span class=\"hljs-literal\">null</span>, [\n      element <span class=\"hljs-string\">\\tr,</span> <span class=\"hljs-literal\">null</span>, [\n        element <span class=\"hljs-string\">\\th,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&#x27;Avatar&#x27;</span>\n        element <span class=\"hljs-string\">\\th,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&#x27;Name&#x27;</span>\n      ]\n    ]\n\n  render: -&gt;\n    @props.contacts\n    |&gt; R.<span class=\"hljs-keyword\">map</span> @~render-contact-row\n    |&gt; <span class=\"hljs-function\">~&gt;</span> element <span class=\"hljs-string\">\\tbody,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-literal\">it</span>\n    |&gt; <span class=\"hljs-function\">~&gt;</span> element <span class=\"hljs-string\">\\table,</span> class-name: <span class=\"hljs-string\">\\contacts</span> , [ @render-head!, <span class=\"hljs-literal\">it</span> ]\n\nel = element ContactList, contacts: [\n  * id: <span class=\"hljs-number\">1</span>\n    name: <span class=\"hljs-string\">&#x27;Harry Potter&#x27;</span>\n    avatar: <span class=\"hljs-string\">&#x27;http://cdn.playbuzz.com/cdn/8de88741-d729-4319-aa46-e8a544a20439/f7cade9d-8daf-42b3-8839-3e0e1f3db283.jpeg&#x27;</span>\n  * id: <span class=\"hljs-number\">2</span>,\n    name: <span class=\"hljs-string\">&#x27;Albus Dumbledore&#x27;</span>\n    email: <span class=\"hljs-string\">&#x27;albus@hogwarts.magic&#x27;</span>\n]\n\n\nReact.render el, document.get-element-<span class=\"hljs-keyword\">by</span>-id <span class=\"hljs-string\">\\application-container</span></code></pre>\n\n<img src=\"/images/Screen Shot 2015-09-21 at 2.15.15 pm.png\">\n\n<p>It may be tempting to further shorten the functions taking advantage of livescript&#39;s default argument <code>it</code>:</p>\n<pre><code class=\"hljs livescript\">render-avatar: -&gt;\n  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-literal\">it</span>.avatar\n  <span class=\"hljs-keyword\">then</span> element <span class=\"hljs-string\">\\img,</span> src: <span class=\"hljs-literal\">it</span>.avatar, height: <span class=\"hljs-number\">100</span>, width: <span class=\"hljs-number\">100</span>\n  <span class=\"hljs-keyword\">else</span> element <span class=\"hljs-string\">\\span,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&#x27;N/A&#x27;</span>\n\nrender-label: -&gt;\n  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-literal\">it</span>.email\n  <span class=\"hljs-keyword\">then</span> element <span class=\"hljs-string\">\\a,</span> href: <span class=\"hljs-string\">&quot;mailto:<span class=\"hljs-subst\">#&#123;<span class=\"hljs-literal\">it</span>.email&#125;</span>&quot;</span>, <span class=\"hljs-literal\">it</span>.name\n  <span class=\"hljs-keyword\">else</span> element <span class=\"hljs-string\">\\span,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-literal\">it</span>.name\n\nrender-contact-row: -&gt;\n  element <span class=\"hljs-string\">\\tr,</span> key: <span class=\"hljs-literal\">it</span>.id, [\n    element <span class=\"hljs-string\">\\td,</span> <span class=\"hljs-literal\">null</span>, @render-avatar <span class=\"hljs-literal\">it</span>\n    element <span class=\"hljs-string\">\\td,</span> <span class=\"hljs-literal\">null</span>, @render-label <span class=\"hljs-literal\">it</span>\n  ]</code></pre>\n\n<p>But I strongly recommend against doing that, because having the arguments specified in the function signature upfront enhances readability.</p>\n<p>Also note that the top down construction flow composition can also be realized in javascript using Ramda&#39;s <code>pipe</code> but livescript just makes it simpler by providing a language level operator.</p>\n<p>For simpler components (which are just responsible for presenting something passed as props, and do not need lifecycle methods etc.) it may be useful to define a micro-component builder:</p>\n<pre><code class=\"hljs livescript\"><span class=\"hljs-function\"><span class=\"hljs-title\">micro-component</span> = <span class=\"hljs-params\">(render)</span>-&gt;</span> React.create-factory React.create-<span class=\"hljs-keyword\">class</span> &#123; render &#125;</code></pre>\n\n<p>Once we have that, it makes it a lot more easier for us to follow React&#39;s recommendation of having lightweight modular components which can be easily composed:</p>\n<pre><code class=\"hljs livescript\">ContactAvatar = micro-component -&gt;\n  &#123; contact &#125; = @props\n  <span class=\"hljs-keyword\">if</span> contact.avatar\n  <span class=\"hljs-keyword\">then</span> element <span class=\"hljs-string\">\\img,</span> src: contact.avatar, height: <span class=\"hljs-number\">100</span>, width: <span class=\"hljs-number\">100</span>\n  <span class=\"hljs-keyword\">else</span> element <span class=\"hljs-string\">\\span,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&#x27;N/A&#x27;</span>\n\nContactLabel = micro-component -&gt;\n  &#123; contact &#125; = @props\n  <span class=\"hljs-keyword\">if</span> contact.email\n  <span class=\"hljs-keyword\">then</span> element <span class=\"hljs-string\">\\a,</span> href: <span class=\"hljs-string\">&quot;mailto:<span class=\"hljs-subst\">#&#123;contact.email&#125;</span>&quot;</span>, contact.name\n  <span class=\"hljs-keyword\">else</span> element <span class=\"hljs-string\">\\span,</span> <span class=\"hljs-literal\">null</span>, contact.name\n\nContactListRow = micro-component -&gt;\n  element <span class=\"hljs-string\">\\tr,</span> key: @props.contact.id, [\n    element <span class=\"hljs-string\">\\td,</span> <span class=\"hljs-literal\">null</span>, ContactAvatar @props\n    element <span class=\"hljs-string\">\\td,</span> <span class=\"hljs-literal\">null</span>, ContactLabel @props\n  ]\n\nContactList = micro-component -&gt;\n  element <span class=\"hljs-string\">\\table,</span> class-name: <span class=\"hljs-string\">\\contacts,</span> [\n    element <span class=\"hljs-string\">\\thead,</span> <span class=\"hljs-literal\">null</span>, [\n      element <span class=\"hljs-string\">\\tr,</span> <span class=\"hljs-literal\">null</span>, [\n        element <span class=\"hljs-string\">\\th,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&#x27;Avatar&#x27;</span>\n        element <span class=\"hljs-string\">\\th,</span> <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&#x27;Name&#x27;</span>\n      ]\n    ]\n    element <span class=\"hljs-string\">\\tbody,</span> <span class=\"hljs-literal\">null</span>, @props.contacts.<span class=\"hljs-keyword\">map</span> -&gt; ContactListRow <span class=\"hljs-keyword\">do</span>\n      contact: <span class=\"hljs-literal\">it</span>\n      key: <span class=\"hljs-literal\">it</span>.id\n  ]\n\nel = ContactList contacts: [\n  * id: <span class=\"hljs-number\">1</span>\n    name: <span class=\"hljs-string\">&#x27;Harry Potter&#x27;</span>\n    avatar: <span class=\"hljs-string\">&#x27;http://cdn.playbuzz.com/cdn/8de88741-d729-4319-aa46-e8a544a20439/f7cade9d-8daf-42b3-8839-3e0e1f3db283.jpeg&#x27;</span>\n  * id: <span class=\"hljs-number\">2</span>,\n    name: <span class=\"hljs-string\">&#x27;Albus Dumbledore&#x27;</span>\n    email: <span class=\"hljs-string\">&#x27;albus@hogwarts.magic&#x27;</span>\n]\nReact.render el, document.get-element-<span class=\"hljs-keyword\">by</span>-id <span class=\"hljs-string\">\\application-container</span>\n</code></pre>\n\n<p>Libraries like <a href=\"https://github.com/mlmorg/react-hyperscript\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\"><code>react-hyperscript</code></a> may be used to further reduce the dom construction boilerplate :</p>\n<pre><code class=\"hljs livescript\">\n<span class=\"hljs-built_in\">require</span>! &#123; react-hyperscript: h, react: React &#125;\n\nContactAvatar = micro-component -&gt;\n  &#123; contact &#125; = @props\n  <span class=\"hljs-keyword\">if</span> contact.avatar\n  <span class=\"hljs-keyword\">then</span> h <span class=\"hljs-string\">\\img,</span> src: contact.avatar, height: <span class=\"hljs-number\">100</span>, width: <span class=\"hljs-number\">100</span>\n  <span class=\"hljs-keyword\">else</span> h <span class=\"hljs-string\">\\span,</span> <span class=\"hljs-string\">&#x27;N/A&#x27;</span>\n\nContactLabel = micro-component -&gt;\n  &#123; contact &#125; = @props\n  <span class=\"hljs-keyword\">if</span> contact.email\n  <span class=\"hljs-keyword\">then</span> h <span class=\"hljs-string\">\\a,</span> href: <span class=\"hljs-string\">&quot;mailto:<span class=\"hljs-subst\">#&#123;contact.email&#125;</span>&quot;</span>, contact.name\n  <span class=\"hljs-keyword\">else</span> h <span class=\"hljs-string\">\\span,</span> contact.name\n\nContactListRow = micro-component -&gt;\n  h <span class=\"hljs-string\">\\tr,</span> key: @props.contact.id, [\n    h <span class=\"hljs-string\">\\td,</span> ContactAvatar @props\n    h <span class=\"hljs-string\">\\td,</span> ContactLabel @props\n  ]\n\nContactList = micro-component -&gt;\n  h <span class=\"hljs-string\">\\table.contacts,</span> [\n    h <span class=\"hljs-string\">\\thead,</span> [\n      h <span class=\"hljs-string\">\\tr,</span> [\n        h <span class=\"hljs-string\">\\th,</span> <span class=\"hljs-string\">&#x27;Avatar&#x27;</span>\n        h <span class=\"hljs-string\">\\th,</span> <span class=\"hljs-string\">&#x27;Name&#x27;</span>\n      ]\n    ]\n    h <span class=\"hljs-string\">\\tbody,</span> @props.contacts.<span class=\"hljs-keyword\">map</span> -&gt; ContactListRow <span class=\"hljs-keyword\">do</span>\n      contact: <span class=\"hljs-literal\">it</span>\n      key: <span class=\"hljs-literal\">it</span>.id\n  ]\n\nel = ContactList contacts: [\n  * id: <span class=\"hljs-number\">1</span>\n    name: <span class=\"hljs-string\">&#x27;Harry Potter&#x27;</span>\n    avatar: <span class=\"hljs-string\">&#x27;http://cdn.playbuzz.com/cdn/8de88741-d729-4319-aa46-e8a544a20439/f7cade9d-8daf-42b3-8839-3e0e1f3db283.jpeg&#x27;</span>\n  * id: <span class=\"hljs-number\">2</span>,\n    name: <span class=\"hljs-string\">&#x27;Albus Dumbledore&#x27;</span>\n    email: <span class=\"hljs-string\">&#x27;albus@hogwarts.magic&#x27;</span>\n]\nReact.render el, document.get-element-<span class=\"hljs-keyword\">by</span>-id <span class=\"hljs-string\">\\application-container</span>\n</code></pre>\n\n<p>Apart from getting rid of null for attribute hashes, hyperscript is particularly useful for shorter syntax for class names and ids. Also it insulates our codebase against changes in the DOM builder API, which have happened in past.</p>\n",
            "tags": [
                "Javascript",
                "React",
                "Functional Programming"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/08/24/smarter-knockout-applications-with-es-next.html",
            "url": "https://lorefnon.me/2015/08/24/smarter-knockout-applications-with-es-next.html",
            "title": "Smarter knockout applications with ES6/7",
            "date_published": "2015-08-24T00:00:00.000Z",
            "content_html": "<h1 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h1><p>This post is an outline of ES6&#x2F;7 features that we can leverage today in our <a href=\"http://knockoutjs.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Knockout</a> based applications to make them more maintainable.</p>\n<p>Thanks to powerful and reliable transpilers like <a href=\"http://babeljs.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Babel</a> we don&#39;t have to wait for mass adoption across browser vendors, to try out features from next generation javascript. While this post is essentially an overview written in a specific context, ie. Knockout applications, I encourage readers to refer to excellent online resources like <a href=\"https://leanpub.com/javascriptallongesix\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Javascript Allonge</a> for a broader coverage.</p>\n<h2 id=\"View-Models-as-ES-6-classes\"><a href=\"#View-Models-as-ES-6-classes\" class=\"headerlink\" title=\"View Models as ES 6 classes:\"></a>View Models as ES 6 classes:</h2><p>View models are typically defined as javascript constructor functions. ES6 classes offer a bit of syntax sugar over prototypal inheritance and the outcome might appeal to people coming other object oriented languages.</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomeViewModel</span> &#123;\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">firstName</span> = ko.<span class=\"hljs-title function_\">observable</span>();\n  &#125;\n&#125;\n\nko.<span class=\"hljs-property\">components</span>.<span class=\"hljs-title function_\">register</span>(&#123;\n  <span class=\"hljs-attr\">viewModel</span>: <span class=\"hljs-title class_\">SomeViewModel</span>,\n  <span class=\"hljs-attr\">template</span>: <span class=\"hljs-string\">&#x27;&lt;div data-bind=&quot;text: firstName&quot;&gt;&lt;/div&gt;&#x27;</span>\n&#125;)</code></pre>\n\n<h2 id=\"Arrow-functions-in-computed-properties\"><a href=\"#Arrow-functions-in-computed-properties\" class=\"headerlink\" title=\"Arrow functions in computed properties:\"></a>Arrow functions in computed properties:</h2><p>In computed properties it is more often than not desirable that the context of function be the same as that of the outer function. Patterns like <code>var self = this</code> have been adopted widely for situations like this.</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">SomeViewModel</span>(<span class=\"hljs-params\"></span>) &#123;\n  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">firstName</span> = ko.<span class=\"hljs-title function_\">observable</span>();\n  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">lastName</span> = ko.<span class=\"hljs-title function_\">observable</span>();\n  <span class=\"hljs-keyword\">var</span> self = <span class=\"hljs-variable language_\">this</span>;\n  <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">fullName</span> = ko.<span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) &#123;\n    <span class=\"hljs-keyword\">return</span> self.<span class=\"hljs-title function_\">firstName</span>() + <span class=\"hljs-string\">&#x27; &#x27;</span> + self.<span class=\"hljs-title function_\">lastName</span>();\n  &#125;);\n&#125;</code></pre>\n\n<p>Arrow functions simplify this use case by providing special syntax for functions which, as MDN <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">explains</a> it, capture the this value of the enclosing context</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomeViewModel</span> &#123;\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">firstName</span> = ko.<span class=\"hljs-title function_\">observable</span>();\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">lastName</span> = ko.<span class=\"hljs-title function_\">observable</span>();\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">fullName</span> = ko.<span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> &#123;\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">firstName</span>() + <span class=\"hljs-string\">&#x27; &#x27;</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">lastName</span>();\n    &#125;);\n  &#125;\n&#125;</code></pre>\n\n<p>Or for smaller functions we can reduce the verbosity even further:</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomeViewModel</span> &#123;\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\"></span>) &#123;\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">firstName</span> = ko.<span class=\"hljs-title function_\">observable</span>();\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">lastName</span> = ko.<span class=\"hljs-title function_\">observable</span>();\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">fullName</span> = ko.<span class=\"hljs-title function_\">computed</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">firstName</span>() + <span class=\"hljs-string\">&#x27; &#x27;</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-title function_\">lastName</span>());\n  &#125;\n&#125;</code></pre>\n\n<h2 id=\"Imports-for-code-organization\"><a href=\"#Imports-for-code-organization\" class=\"headerlink\" title=\"Imports for code organization:\"></a>Imports for code organization:</h2><p>JS imports are the new standard approach to deal with modularization in JS code, and I can only anticipate <a href=\"https://angular.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">more</a> and <a href=\"http://aurelia.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">more</a> libraries moving to them from older patterns like <a href=\"https://github.com/amdjs/amdjs-api/wiki/AMD\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">AMD</a> or <a href=\"http://wiki.commonjs.org/wiki/CommonJS\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">CommonJS</a>. Babel can transpile imports to require invocations that follow AMD&#x2F;CommonJS syntax so you can move to newer syntax progressively and continue using your existing loaders&#x2F;bundlers. My personal recommendation for bundler is <a href=\"http://webpack.github.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">webpack</a> which offers interesting features like <a href=\"http://webpack.github.io/docs/code-splitting.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Code splitting</a> out of the box.</p>\n<h2 id=\"Template-strings\"><a href=\"#Template-strings\" class=\"headerlink\" title=\"Template strings\"></a>Template strings</h2><p>Template strings make it easy to define small multi-line templates along side view models.</p>\n<pre><code class=\"hljs plaintext\">ko.components.register(&#123;\n  viewModel: SomeViewModel,\n  template:\n    `&lt;div&gt;\n      &lt;h1&gt; Hello friend, nice to meet you &lt;/h1&gt;\n      &lt;div&gt;\n        Dear &lt;span data-bind=&quot;text: firstName()&quot;&gt;&lt;/span&gt; It is nice to meet you.\n      &lt;/div&gt;\n    &lt;/div&gt;`\n&#125;);</code></pre>\n\n<p>Although for larger templates I recommend using something like <a href=\"https://github.com/webpack/raw-loader\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">webpack-raw-loader</a> so you can write:</p>\n<pre><code class=\"hljs javascript\">ko.<span class=\"hljs-property\">components</span>.<span class=\"hljs-title function_\">register</span>(&#123;\n  <span class=\"hljs-attr\">viewModel</span>: <span class=\"hljs-title class_\">SomeViewModel</span>,\n  <span class=\"hljs-attr\">template</span>: <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;./some_view_model.html&#x27;</span>)\n&#125;);</code></pre>\n\n<p>However larger templates more often than not indicate need for fine-grained modularization, so the above recommendation should be taken with a pinch of salt.</p>\n<h2 id=\"ES7-Decorators-for-Component-registration\"><a href=\"#ES7-Decorators-for-Component-registration\" class=\"headerlink\" title=\"ES7 Decorators for Component registration:\"></a>ES7 Decorators for Component registration:</h2><p>If you have been keeping up with advancements with Angular 2.0, you may have noticed the use of annotations for component registration. Here is an example from their <a href=\"https://angular.io/docs/js/latest/quickstart.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">quick start tutorial</a> showing how annotations go hand in hand with the new class syntax:</p>\n<pre><code class=\"hljs plaintext\">// Annotation section\n@Component(&#123;\n  selector: &#x27;my-app&#x27;\n&#125;)\n@View(&#123;\n  template: &#x27;&lt;h1&gt;Hello &#123;&#123; name &#125;&#125;&lt;/h1&gt;&#x27;\n&#125;)\n// Component controller\nclass MyAppComponent &#123;\n  name: string;\n  constructor() &#123;\n    this.name = &#x27;Alice&#x27;;\n  &#125;\n&#125;</code></pre>\n\n<p>While I refer to <a href=\"https://github.com/wycats/javascript-decorators\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">this excellent writeup</a> by <a href=\"https://twitter.com/wycats\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Yehuda Katz</a> on javascript decorators for an indepth overview, the following snippet is a quick overview as to how we can leverage javascript decorators to handle component registration in knockout:</p>\n<pre><code class=\"hljs plaintext\">function Component(params) &#123;\n  return function(viewModel) &#123;\n    ko.components.register(params.name, &#123;\n      viewModel: viewModel,\n      template: params.template\n    &#125;)\n  &#125;\n&#125;</code></pre>\n\n<p>Once our <code>Component</code> decorator has been defined we can simply use it like this:</p>\n<pre><code class=\"hljs plaintext\">@Component(&#123;\n  name: &#x27;my-app-component&#x27;,\n  template:\n    `&lt;div&gt;\n      ...\n    &lt;/div&gt;`\n&#125;)\nclass MyAppViewModel &#123;\n  constructor() &#123;\n    ...\n  &#125;\n&#125;</code></pre>\n\n<p>You may be tempted to use the <code>target.name</code> to enforce some module naming conventions, but before you tread that way please be aware of lack of IE support for <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Function#name</a>.</p>\n<p>This concludes this overview for now, though there is a lot to be explored in next generation javascript beyond this basic introduction. As always, I welcome any suggestions or requests for improvement in the comments section below.</p>\n",
            "tags": [
                "Javascript",
                "KnockoutJS"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/04/04/gathering-and-visualizing-rails-metrics-influxdb.html",
            "url": "https://lorefnon.me/2015/04/04/gathering-and-visualizing-rails-metrics-influxdb.html",
            "title": "Gathering and Visualizing metrics from Rails application using InfluxDB",
            "date_published": "2015-04-04T00:00:00.000Z",
            "content_html": "<h2 id=\"Overview\"><a href=\"#Overview\" class=\"headerlink\" title=\"Overview\"></a>Overview</h2><p>InfluxDB is a distributed time series database. It is a specialized data store for saving large volumes of timestamped event data and this makes it especially suited for storing metrics, lifecycle events and analytics. The <code>influxdb-rails</code> gem, maintained by the InfluxDB team, facilitates integration with Rails and makes it easy to save various metrics from a rails application to InfluxDB and visualize it through frontends like <a href=\"http://grafana.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Grafana</a>.</p>\n<p>The rest of this post, explores various aspects of a simple setup in which we build a rudimentary cms based site and monitor it using influxdb and grafana. We don&#39;t assume prior familiarity with InfluxDB, and elaborate on relevant aspects of time series databases on the go, but familiarity with Rails is assumed.</p>\n<p>This post also assumes that InfluxDB is installed as per the official <a href=\"http://influxdb.com/docs/v0.8/introduction/installation.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">installation instructions</a> with default configuration. If installation has been customized eg. ports have been changed, the configurations provided to <code>influxdb-rails</code> will have to be adapted accordingly. On mac influxdb can be installed using <a href=\"http://brew.sh/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Homebrew</a> : <code>brew install influxdb</code>.</p>\n<h2 id=\"Setting-up-a-basic-application\"><a href=\"#Setting-up-a-basic-application\" class=\"headerlink\" title=\"Setting up a basic application\"></a>Setting up a basic application</h2><p>Next, we bootstrap a simple rails application using the <a href=\"https://github.com/comfy/comfortable-mexican-sofa\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Comfortable mexican sofa</a> CMS to quickly setup a site with a few pages we can tinker with. This is not really important, but it simply helps us work with a reasonably more realistic setup than a typically crud ui generated through scaffolds.</p>\n<pre><code class=\"hljs bash\">rails new influxdb-cms-demo --database=mysql</code></pre>\n\n<p>In Gemfile:</p>\n<pre><code class=\"hljs ruby\">gem <span class=\"hljs-string\">&#x27;comfortable_mexican_sofa&#x27;</span>, <span class=\"hljs-string\">&#x27;~&gt; 1.12.0&#x27;</span>\ngem <span class=\"hljs-string\">&#x27;influxdb-rails&#x27;</span></code></pre>\n\n<p>Setting up CMS requires an additional step:</p>\n<pre><code class=\"hljs bash\">rails generate comfy:cms</code></pre>\n\n<p>Setting up InfluxDB adapter also requires an additional step:</p>\n<pre><code class=\"hljs bash\">rails g influxdb</code></pre>\n\n<p>The default configuration options are available in the generated <code>influxdb-rails.rb</code> and they correspond to the default settings of influxdb.</p>\n<pre><code class=\"hljs ruby\">InfluxDB::Rails.configure <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">config</span>|\n  config.influxdb_database = <span class=\"hljs-string\">&quot;rails&quot;</span>\n  config.influxdb_username = <span class=\"hljs-string\">&quot;root&quot;</span>\n  config.influxdb_password = <span class=\"hljs-string\">&quot;root&quot;</span>\n  config.influxdb_hosts    = [<span class=\"hljs-string\">&quot;localhost&quot;</span>]\n  config.influxdb_port     = <span class=\"hljs-number\">8086</span>\n\n  <span class=\"hljs-comment\"># config.series_name_for_controller_runtimes = &quot;rails.controller&quot;</span>\n  <span class=\"hljs-comment\"># config.series_name_for_view_runtimes       = &quot;rails.view&quot;</span>\n  <span class=\"hljs-comment\"># config.series_name_for_db_runtimes         = &quot;rails.db&quot;</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The last three lines signify the names of time series where the corresponding metrics would be stored, and we will use the same when querying the time series database.</p>\n<p>Before our application can start dispatching metrics to InfluxDB the database &quot;rails&quot; specified in the above configuration file would have to be created. InfluxDB admin provides a means to do that using the GUI. The admin interface may be accessed by visiting: <a href=\"http://localhost:8083/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">localhost:8083</a></p>\n<p><img src=\"/images/influxdb_landing_page.png\" alt=\"InfluxDB landing page\" loading=\"lazy\"></p>\n<p>The default username&#x2F;password combination is root&#x2F;root, which is not advisable for production use.</p>\n<p>The only option that is particularly relevant is database name: which we would have to change to &quot;rails&quot;.</p>\n<p><img src=\"/images/influxdb_create_database.png\" alt=\"InfluxDB creating database\" loading=\"lazy\"></p>\n<p>This would be a good point to run <code>db:migrate</code> and visit the CMS dashboard <code>/admin</code></p>\n<p>Once a new site has been bootstrapped, we can rapidly create multiple pages through the CMS admin interface. These steps are not elaborated here because the guided CMS admin makes it pretty trivial. Once a few pages have been setup, we have some metrics to explore in InfluxDB.</p>\n<p><img src=\"/images/new_page_cms.png\" alt=\"Add a new page in CMS\" loading=\"lazy\"></p>\n<h2 id=\"Data-exploration\"><a href=\"#Data-exploration\" class=\"headerlink\" title=\"Data exploration\"></a>Data exploration</h2><p>In the list of databases, we should have an option to <code>Explore Data</code>. Let us go ahead and click that:</p>\n<p><img src=\"/images/influxdb_database_list.png\" alt=\"InfluxDB database list\" loading=\"lazy\"></p>\n<p>We will be presented with a simple interface to read and write points (which are essentially multi-column timestamped datasets).</p>\n<p><img src=\"/images/influxdb_query_interface.png\" alt=\"InfluxDB Query interface\" loading=\"lazy\"></p>\n<p>This page also highlights an interesting aspect of InfluxDB - though it is not a relational database, it does provide an SQL like language to query the database.</p>\n<p>A basic query might look something like this:</p>\n<p><img src=\"/images/influxdb_select_all_query.png\" alt=\"InfluxDB Select All Query\" loading=\"lazy\"></p>\n<p>Besides controllers, we can also run similar queries for our timeseries for views and db:\n<img src=\"/images/influxdb_select_all_from_view.png\" alt=\"InfluxDB Select All from View Query\" loading=\"lazy\">\n<img src=\"/images/influxdb_select_all_from_db.png\" alt=\"InfluxDB Select All from DB Query\" loading=\"lazy\"></p>\n<h2 id=\"Configuring-additional-lifecycle-events\"><a href=\"#Configuring-additional-lifecycle-events\" class=\"headerlink\" title=\"Configuring additional lifecycle events\"></a>Configuring additional lifecycle events</h2><p>In a real applications we would want to aggregate additional metrics of our choosing. A popular solution for dispatching and subscribing to various lifecycle events that ruby community has developed is <code>ActiveSupport::Notifications</code> which Rails internally uses.</p>\n<p>Using <code>ActiveSupport::Notifications</code> we can subscribe to lifecycle events of a rails application and add callbacks to dispatch these metrics to InfluxDB.</p>\n<p>For example if we would like to track the execution times of queries in InfluxDB we can write an initializer:</p>\n<pre><code class=\"hljs ruby\">ActiveSupport::Notifications.subscribe(<span class=\"hljs-string\">&#x27;sql.active_record&#x27;</span>) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">name, start, finish, id, payload</span>|\n  InfluxDB::Rails.client.write_point(name, &#123; <span class=\"hljs-symbol\">value:</span> (finish-start), <span class=\"hljs-symbol\">start:</span> start, <span class=\"hljs-symbol\">finish:</span> finish &#125;)\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The value attribute is something that InfluxDB admin will use to generate graph by default. We can query this just like the previous queries:</p>\n<p><img src=\"/images/influxdb_lifecycle_event_query.png\" alt=\"InfluxDB Query lifecycle event\" loading=\"lazy\"></p>\n<p>More lifecycle events of Rails application can be found in the <a href=\"http://edgeguides.rubyonrails.org/active_support_instrumentation.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Rails guides</a>.</p>\n<p>In addition, the instrumentation API can be used directly to create a custom lifecycle events. Here is an example taken from the <a href=\"http://api.rubyonrails.org/classes/ActiveSupport/Notifications.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official documentation</a> that outlines how a part of application code can be wrapped into an instrumented block which we could subscribe to in an identical fashion.</p>\n<pre><code class=\"hljs ruby\">ActiveSupport::Notifications.instrument(<span class=\"hljs-string\">&#x27;render&#x27;</span>, <span class=\"hljs-symbol\">extra:</span> <span class=\"hljs-symbol\">:information</span>) <span class=\"hljs-keyword\">do</span>\n  render <span class=\"hljs-symbol\">text:</span> <span class=\"hljs-string\">&#x27;Foo&#x27;</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>While the InfluxDB admin interface provides a convenient dashboard to visualize the metrics, it is not ideal for complex, comparative or realtime visualizations. For such use cases it is better to resort to dedicated solutions like Grafana.</p>\n<h2 id=\"Setting-up-Grafana\"><a href=\"#Setting-up-Grafana\" class=\"headerlink\" title=\"Setting up Grafana\"></a>Setting up Grafana</h2><p>While Grafana releases binary downloads for most major versions of linux, there isn&#39;t one available for Mac. And neither is it available from Homebrew. However installation from the sources is straightforward if you have Go. It is important that the version of Go is correct (1.4 +) otherwise installation fails with totally incomprehensible errors. The version of Go available from Homebrew is outdated - however Google provides <a href=\"https://golang.org/doc/install\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">installers</a> which work like a charm. Once Go is setup properly, the <a href=\"https://github.com/grafana/grafana#building-the-backend\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">installation steps</a> for Grafana are straightforward.</p>\n<p>Another hiccup is that when running the web interface, Grafana uses the same default port as Rails (3000). To alleviate that we need to edit configuration file dev.ini in <code>$GOPATH/src/github.com/grafana/grafana/conf</code> and specify an alternate port</p>\n<pre><code class=\"hljs ini\"><span class=\"hljs-attr\">app_mode</span> = development\n\n<span class=\"hljs-section\">[server]</span>\n<span class=\"hljs-attr\">router_logging</span> = <span class=\"hljs-literal\">false</span>\n<span class=\"hljs-attr\">http_port</span> = <span class=\"hljs-number\">8000</span>\n\n<span class=\"hljs-section\">[log]</span>\n<span class=\"hljs-attr\">level</span> = Trace</code></pre>\n\n<p>Once this is configured running <code>./grafana web</code> from grafana source directory, should run the webserver on port 8000:</p>\n<p><img src=\"/images/grafana_startup_log.png\" alt=\"Grafana server log\" loading=\"lazy\"></p>\n<p>Now we can browse the Grafana dashboard and provide the default login details admin&#x2F;admin. Again it is not advisable to use this in production.</p>\n<p><img src=\"/images/grafana_login.png\" alt=\"Grafana Login\" loading=\"lazy\"></p>\n<p>The default dashboard is pretty bare:</p>\n<p><img src=\"/images/grafana_home.png\" alt=\"Grafana Home page\" loading=\"lazy\"></p>\n<p>Adding a new dashboard is straightforward:</p>\n<p><img src=\"/images/grafana_add_dashboard.png\" alt=\"Grafana : Adding a dashboard\" loading=\"lazy\"></p>\n<p>Once we have a dedicated dashboard for our Rails application we can start adding graphs:</p>\n<p><img src=\"/images/grafana_add_graph.png\" alt=\"Grafana : Add Graph\" loading=\"lazy\"></p>\n<p>It would be probably surprising to see a great looking graph instantly generated. After all no influxdb&#x2F;rails specific configuration has been done yet, so what data is being presented ?</p>\n<p><img src=\"/images/grafana_test_graph.png\" alt=\"Grafana : Default Graph\" loading=\"lazy\"></p>\n<p>Once we try to edit the data source, it would become clear that the graph being presented is infact coming from a dummy data source</p>\n<p><img src=\"/images/grafana_edit_graph.png\" alt=\"Grafana : Edit Graph\" loading=\"lazy\">\n<img src=\"/images/grafana_configure_graph_data_source.png\" alt=\"Grafana : Configure Graph Data Source\" loading=\"lazy\"></p>\n<p>At this point, because InfluxDB data source hasn&#39;t been configured hence no other data source is available :</p>\n<p><img src=\"/images/grafana_singular_data_source.png\" alt=\"Grafana : Missing Data Source\" loading=\"lazy\"></p>\n<p>The sidebar has a section for data sources that can be used for this task:\n<img src=\"/images/grafana_sidebar_close_up.png\" alt=\"Grafana : Sidebar\" loading=\"lazy\">\n<img src=\"/images/grafana_add_data_source.png\" alt=\"Grafana : Add data source\" loading=\"lazy\"></p>\n<p>While adding a data source it is of particular importance the version of InfluxDB is correct in the type field. Rest of the fields in form are self explanatory - It is advisable that in production Auth is configured to protect against intrusion.</p>\n<p><img src=\"/images/grafana_edit_data_source.png\" alt=\"Grafana : Edit data source\" loading=\"lazy\"></p>\n<p>Now in the graph editor multiple data sources should be available:</p>\n<p><img src=\"/images/grafana_multiple_data_source_selector.png\" alt=\"Grafana : Multiple data sources\" loading=\"lazy\"></p>\n<p>We can now specify the InfluxDB query to be made in the <code>Metrics</code> section:\n<img src=\"/images/grafana_metric_specification.png\" alt=\"Grafana : Specify Metric\" loading=\"lazy\"></p>\n<p>Since we don&#39;t have a lot of historical data at this point, for inspection we can adjust the time range to something recent:\n<img src=\"/images/grafana_range_selection.png\" alt=\"Grafana : Range Selection\" loading=\"lazy\"></p>\n<p>The dummy graph should now be replaced with a real visualization of our metric\n<img src=\"/images/grafana_metric_output.png\" alt=\"Grfana : Metric Output\" loading=\"lazy\"></p>\n<p>In similar fashion more graphs can be added and additional dashboards can be set up as per requirements.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>This concludes this post, in which we have setup a basic development setup of InfluxDB and explored how a time series datastore can be used to save metrics from our Rails application and how we can query this data store and derive actionable insights. Also we explored creation of dashboards using Grafana to visualize these metrics in near-real time.</p>\n<p>Our proof of concept setup, however is not suitable for production deployments with large volumes of data, in which case we would want to utilize advanced cluster management features of InfluxDB. Fortunately InfluxDB documentation already has a lot of <a href=\"http://influxdb.com/docs/v0.8/clustering/setup.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">helpful information</a> on scaling up production deployment which is only expected to mature over time. There are also <a href=\"https://customers.influxdb.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">commercial options</a> available for hosted InfluxDB which I encourage users to <a href=\"https://customers.influxdb.com/users/sign_up\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">try out</a> and evaluate.</p>\n<h2 id=\"Where-to-go-from-here\"><a href=\"#Where-to-go-from-here\" class=\"headerlink\" title=\"Where to go from here\"></a>Where to go from here</h2><ul>\n<li><a href=\"http://influxdb.com/docs/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">InfluxDB documentation</a></li>\n<li><a href=\"http://docs.grafana.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Grafana Documentation</a></li>\n</ul>\n",
            "tags": [
                "Ruby",
                "Rails",
                "InfluxDB",
                "Grafana"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/03/02/dealing-with-json-fields-in-active-admin.html",
            "url": "https://lorefnon.me/2015/03/02/dealing-with-json-fields-in-active-admin.html",
            "title": "Dealing with JSON data in Active Admin",
            "date_published": "2015-03-02T00:00:00.000Z",
            "content_html": "<p>Many a times, depending on the requirements, it makes sense to store\nunstructured json data in database fields. PostgreSQL recognizes this\nrequirement and provides a dedicated json field that automatically\nhandles JSON validation. As has been outlined in the\n<a href=\"http://edgeguides.rubyonrails.org/active_record_postgresql.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">RoR Guides</a>\n, it is pretty simple to take advantage of this feature from Rails.\nHowever if you also use <a href=\"https://github.com/activeadmin/activeadmin\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">ActiveAdmin</a> to manage your admin interface,\nyou will quickly find out that library <a href=\"https://github.com/justinfrench/formtastic\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Formtastic</a> that ActiveAdmin\nuses to manage its forms, leaves a lot to be desired when it comes to\nJSON editing support.</p>\n<p>In this post we outline a simple approach to improve JSON editing\nsupport in ActiveAdmin using the excellent <a href=\"https://github.com/josdejong/jsoneditor/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">JSON editor widget</a>\nby <a href=\"https://github.com/josdejong\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Jos de Jong</a>. It is worth pointing\nout that our implementation has very little to do with PostgreSQL\nand may be used without modifications if you are storing JSON in say MySQL\ntext fields. Of course you will need to handle server side validation yourself in that case.</p>\n<p>The source code for the post is available on <a href=\"https://github.com/lorefnon/activeadmin-jsoneditor-demo\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Github</a>.</p>\n<p>Let us have a simple product model with following schema:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">CreateProducts</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Migration</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">change</span>\n    create_table <span class=\"hljs-symbol\">:products</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">t</span>|\n      t.string <span class=\"hljs-symbol\">:name</span>\n      t.text <span class=\"hljs-symbol\">:description</span>\n      t.json <span class=\"hljs-symbol\">:metadata</span>\n      t.timestamps\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>You may expect providing admin support for this model will just be\na matter of adding a file <code>app/admin/product.rb</code>:</p>\n<pre><code class=\"hljs ruby\">ActiveAdmin.register Product <span class=\"hljs-keyword\">do</span>\n  permit_params <span class=\"hljs-symbol\">:name</span>, <span class=\"hljs-symbol\">:description</span>, <span class=\"hljs-symbol\">:metadata</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>However the moment you try to create a new instance, you will be greeted\nwith an error message:</p>\n<p><img src=\"/images/formtastic_unknown_input.png\" alt=\"Formtastic unknown input error\" loading=\"lazy\"></p>\n<p>So basically Formtastic has no input field pre-configured for json\nfield. A rudimentary workaround is fairly simple - We explicitly ask\nit to use a textarea for metadata field</p>\n<pre><code class=\"hljs ruby\">ActiveAdmin.register Product <span class=\"hljs-keyword\">do</span>\n\n  permit_params <span class=\"hljs-symbol\">:name</span>, <span class=\"hljs-symbol\">:description</span>, <span class=\"hljs-symbol\">:metadata</span>\n\n  form <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">f</span>|\n    f.inputs <span class=\"hljs-keyword\">do</span>\n      f.input <span class=\"hljs-symbol\">:name</span>\n      f.input <span class=\"hljs-symbol\">:description</span>\n      f.input <span class=\"hljs-symbol\">:metadata</span>, <span class=\"hljs-symbol\">as:</span> <span class=\"hljs-symbol\">:text</span>\n    <span class=\"hljs-keyword\">end</span>\n    f.actions\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>This does the job:</p>\n<p><img src=\"/images/aa1.png\" alt=\"Form with explicitly specified textarea\" loading=\"lazy\"></p>\n<p>But seriously, if you have to edit this json very frequently or manage\nlarge json entries, a simple textarea is not an ideal solution. Plus\nif you accidentally enter some invalid json, You will be provided with a\nfeedback only post submission:</p>\n<p><img src=\"/images/aa2.png\" alt=\"Error in JSON field\" loading=\"lazy\">\n<img src=\"/images/aa3.png\" alt=\"JSON validation error\" loading=\"lazy\"></p>\n<p>The <a href=\"https://github.com/josdejong/jsoneditor/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">JSON editor widget</a>\nby <a href=\"https://github.com/josdejong\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Jos de Jong</a> provides a lot better json editing\ninterface. You can try it out <a href=\"http://jsoneditoronline.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">online</a>.</p>\n<p>If you like what you see, you will be pleased to find that the widget\nis pretty easy to integrate right inside ActiveAdmin.</p>\n<p>Let us first configure our form to add a class to the json field\nso that we can handle json input fields in a generic fashion.</p>\n<pre><code class=\"hljs ruby\">ActiveAdmin.register Product <span class=\"hljs-keyword\">do</span>\n\n  permit_params <span class=\"hljs-symbol\">:name</span>, <span class=\"hljs-symbol\">:description</span>, <span class=\"hljs-symbol\">:metadata</span>\n\n  form <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">f</span>|\n    f.inputs <span class=\"hljs-keyword\">do</span>\n      f.input <span class=\"hljs-symbol\">:name</span>\n      f.input <span class=\"hljs-symbol\">:description</span>\n      f.input <span class=\"hljs-symbol\">:metadata</span>, <span class=\"hljs-symbol\">as:</span> <span class=\"hljs-symbol\">:text</span>, <span class=\"hljs-symbol\">input_html:</span> &#123; <span class=\"hljs-symbol\">class:</span> <span class=\"hljs-string\">&#x27;jsoneditor-target&#x27;</span> &#125;\n    <span class=\"hljs-keyword\">end</span>\n    f.actions\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Next we will need to download the <a href=\"http://jsoneditoronline.org/downloads/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">relevant files</a> and add to our vendor\ndirectory. I have already changed the files to use sprockets urls, so you can\ngrab the files form the repo.</p>\n<p>Next we modify the active_admin.js.coffee:</p>\n<pre><code class=\"hljs coffeescript\"><span class=\"hljs-comment\">#= require active_admin/base</span>\n<span class=\"hljs-comment\">#= require jsoneditor</span>\n<span class=\"hljs-comment\">#= require jsoneditor_activeadmin_integration</span></code></pre>\n\n<p>Once we have the required files in place, integration is pretty simple -\n<code>app/assets/javascripts/jsoneditor_activeadmin_integration</code>:</p>\n<pre><code class=\"hljs coffeescript\">$ -&gt;\n\n  $(<span class=\"hljs-string\">&#x27;.jsoneditor-target&#x27;</span>).each -&gt;\n\n    target = $ this\n\n    container = $(<span class=\"hljs-string\">&#x27;&lt;div class=&quot;jsoneditor-container&quot;&gt;&#x27;</span>)\n      .insertAfter target\n\n    editor = <span class=\"hljs-keyword\">new</span> JSONEditor container[<span class=\"hljs-number\">0</span>],\n      modes: [<span class=\"hljs-string\">&#x27;code&#x27;</span>, <span class=\"hljs-string\">&#x27;form&#x27;</span>, <span class=\"hljs-string\">&#x27;text&#x27;</span>, <span class=\"hljs-string\">&#x27;tree&#x27;</span>, <span class=\"hljs-string\">&#x27;view&#x27;</span>]\n      change: <span class=\"hljs-function\">-&gt;</span>\n        target.val editor.get()\n\n    editor.set(\n      <span class=\"hljs-keyword\">try</span>\n        <span class=\"hljs-built_in\">JSON</span>.parse target.val()\n    )\n\n    target.hide()</code></pre>\n\n<p>This simply hides the textarea for json field, and adds a json editor\nwidget. When the editor is updated, the hidden textarea is updated\nwith the new value - so our form continues to work just as expected,\nwithout Formtastic having to be aware of the widget at all.</p>\n<p>I had to explicitly override some of the conflicting styles from\nActiveAdmin which were messing up the Editor Widget css:</p>\n<pre><code class=\"hljs scss\"><span class=\"hljs-selector-class\">.jsoneditor-container</span>, <span class=\"hljs-selector-class\">.jsoneditor-contextmenu</span> &#123;\n    <span class=\"hljs-selector-tag\">table</span> &#123;\n        <span class=\"hljs-attribute\">width</span>: auto;\n        <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span>;\n    &#125;\n\n    <span class=\"hljs-selector-class\">.jsoneditor</span> &#123;\n        <span class=\"hljs-attribute\">background</span>: white;\n    &#125;\n\n    <span class=\"hljs-selector-tag\">button</span>, <span class=\"hljs-selector-tag\">button</span><span class=\"hljs-selector-pseudo\">:hover</span>, <span class=\"hljs-selector-class\">.menu</span> <span class=\"hljs-selector-tag\">button</span>, <span class=\"hljs-selector-class\">.menu</span> <span class=\"hljs-selector-tag\">button</span><span class=\"hljs-selector-pseudo\">:hover</span> &#123;\n        <span class=\"hljs-attribute\">background</span>: none;\n        <span class=\"hljs-attribute\">text-shadow</span>: none;\n        <span class=\"hljs-attribute\">box-shadow</span>: none;\n        <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">0</span>;\n    &#125;\n&#125;\n\n<span class=\"hljs-selector-class\">.jsoneditor-container</span> &#123;\n    <span class=\"hljs-attribute\">margin-left</span>: <span class=\"hljs-number\">20%</span>;\n    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">80%</span>;\n&#125;</code></pre>\n\n<p>And we are pretty much done:\n<img src=\"/images/aa4.png\" alt=\"Widget integrated with Active Admin\" loading=\"lazy\"></p>\n<p>I realize that the default styling of the widget sticks out a bit against\n the default styling of ActiveAdmin page, but all that is needed to rectify is a few CSS\nrules which I leave as an exercise for the reader.</p>\n<p>As always, any feedback and suggestions are more than welcome.</p>\n",
            "tags": [
                "Ruby",
                "Rails",
                "ActiveAdmin"
            ]
        },
        {
            "id": "https://lorefnon.me/2015/01/03/leveraging-strategy-pattern-in-rails.html",
            "url": "https://lorefnon.me/2015/01/03/leveraging-strategy-pattern-in-rails.html",
            "title": "Leveraging the strategy pattern in Rails - I",
            "date_published": "2015-01-03T00:00:00.000Z",
            "content_html": "<h1 id=\"To-begin-with-what-is-strategy-pattern\"><a href=\"#To-begin-with-what-is-strategy-pattern\" class=\"headerlink\" title=\"To begin with, what is strategy pattern ?\"></a>To begin with, what is strategy pattern ?</h1><p>Quoting from <a href=\"http://en.wikipedia.org/wiki/Strategy_pattern\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Wikipedia</a>,</p>\n<blockquote>\n<p>the strategy pattern (also known as the policy pattern) is a software design\npattern that enables an algorithm&#39;s behavior to be selected at runtime.</p>\n</blockquote>\n<h1 id=\"So-how-does-this-help-us\"><a href=\"#So-how-does-this-help-us\" class=\"headerlink\" title=\"So how does this help us ?\"></a>So how does this help us ?</h1><p>Strategy pattern just helps us escape the soup of complex nested conditionals\nand model behavior selection in an object oriented fashion. To understand why this is\nrequired let us explore a fictional example:</p>\n<h1 id=\"An-adventure\"><a href=\"#An-adventure\" class=\"headerlink\" title=\"An adventure\"></a>An adventure</h1><p>Suppose that we are developing a social network for book lovers. To encourage users\nto read more we decide to show a recommendations panel which highlights books that\nare trending in the community.</p>\n<p>Our (over-simplified) implementation might be something like:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n\n  has_many <span class=\"hljs-symbol\">:recommendations</span>\n  has_many <span class=\"hljs-symbol\">:tags</span>\n\n  scope <span class=\"hljs-symbol\">:popular</span>, -&gt; &#123;  where <span class=\"hljs-string\">&#x27;recommendations_count &gt; 100&#x27;</span> &#125;\n\n  <span class=\"hljs-comment\"># Return a random subset of recommended books</span>\n  <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-comment\"># Yes, this approach is sub-optimal for large number of popular books. Better</span>\n  <span class=\"hljs-comment\"># approaches are outlined here:</span>\n  <span class=\"hljs-comment\"># http://stackoverflow.com/questions/4329396/mysql-select-10-random-rows-from-600k-rows-fast</span>\n  <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.recommended\n    popular.order(<span class=\"hljs-string\">&#x27;RAND()&#x27;</span>).limit(<span class=\"hljs-number\">5</span>)\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Recommendation</span>\n  belongs_to <span class=\"hljs-symbol\">:user</span>, <span class=\"hljs-symbol\">counter_cache:</span> <span class=\"hljs-literal\">true</span>\n  belongs_to <span class=\"hljs-symbol\">:book</span>, <span class=\"hljs-symbol\">counter_cache:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>In home&#x2F;index.html.erb</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&#x27;recommended-book-list&#x27;</span>&gt;</span></span>\n<span class=\"language-xml\">  &lt;%</span><span class=\"language-ruby\"> Book.recommended.each <span class=\"hljs-keyword\">do</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> book.title </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span>\n<span class=\"language-xml\">  &lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span></code></pre>\n\n<p>So far so good, however we realize that for users who have been using our service\nfor a while, it makes more sense to show recommendations based on their intersts. So we do a\nshotgun surgery and modify our code to the following:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.recommended_for user\n    <span class=\"hljs-keyword\">if</span> user.blank? |<span class=\"hljs-params\"></span>| (user.recommendations_count &lt; <span class=\"hljs-number\">5</span>)\n      popular\n    <span class=\"hljs-keyword\">else</span>\n      not_recommended_by(user).where(<span class=\"hljs-symbol\">tags:</span> user.recommended_tags)\n    <span class=\"hljs-keyword\">end</span>.order(<span class=\"hljs-string\">&#x27;RAND()&#x27;</span>).limit(<span class=\"hljs-number\">5</span>)\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n  has_many <span class=\"hljs-symbol\">:recommendations</span>\n  has_many <span class=\"hljs-symbol\">:recommended_books</span>,\n    <span class=\"hljs-symbol\">through:</span> <span class=\"hljs-symbol\">:recommendations</span>,\n    <span class=\"hljs-symbol\">source:</span> <span class=\"hljs-symbol\">:book</span>\n  has_many <span class=\"hljs-symbol\">:recommended_tags</span>,\n    <span class=\"hljs-symbol\">through:</span> <span class=\"hljs-symbol\">:recommended_books</span>,\n    <span class=\"hljs-symbol\">source:</span> <span class=\"hljs-symbol\">:tags</span>\n\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n  scope <span class=\"hljs-symbol\">:not_recommended_by</span>, -&gt; (user) <span class=\"hljs-keyword\">do</span>\n    joins(<span class=\"hljs-symbol\">:recommendations</span>)\n      .where(<span class=\"hljs-string\">&#x27;recommendations.user_id != ?&#x27;</span>, user.id)\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>And our template becomes something like:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&#x27;recommended-book-list&#x27;</span>&gt;</span></span>\n<span class=\"language-xml\">  &lt;%</span><span class=\"language-ruby\"> Book.recommended_for(current_user).each <span class=\"hljs-keyword\">do</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span>&gt;</span> &lt;%=</span><span class=\"language-ruby\"> book.title </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span></span>\n<span class=\"language-xml\">  &lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span></span></code></pre>\n\n<p>We see that at this point our <code>recommended_for</code> method is burdened with multiple\nresponsibilities - the decision for the approach to be used as well as the logic\nfor multiple approaches all reside in the same method, which is not very ideal.</p>\n<p>Let us push this further. Say, after a couple of months our social networks gains\na lot of traction and we strike a very profitable deal with a major publishing\nfirm &#39;Jackass Kangaroo Publications&#39; and as a part of the deal we need to ensure\nthat the recommended books include only those which have been published by this\npublication.</p>\n<p>No problem, we just need add a few lines of code:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.recommended_for user\n    query = Book\n\n    <span class=\"hljs-comment\"># Comment this out when deal with Jackass Kangaroo Publication is over.</span>\n    query = query.where(<span class=\"hljs-symbol\">publisher:</span> Publisher.where(<span class=\"hljs-symbol\">name:</span> <span class=\"hljs-string\">&#x27;Jackass Kangaroo Publication&#x27;</span>).first)\n\n    <span class=\"hljs-keyword\">if</span> user.blank? |<span class=\"hljs-params\"></span>| (user.recommendations_count &lt; <span class=\"hljs-number\">5</span>)\n      query.popular\n    <span class=\"hljs-keyword\">else</span>\n      query.not_recommended_by(user).where(<span class=\"hljs-symbol\">tags:</span> user.recommended_tags)\n    <span class=\"hljs-keyword\">end</span>.order(<span class=\"hljs-string\">&#x27;RAND()&#x27;</span>).limit(<span class=\"hljs-number\">5</span>)\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>No words are needed to describe the ugliness of the code above. Our eyes bleed but we\nchoose to look away and carry on with our buisness.</p>\n<p>Of course, the journey of our social network is not all rosy. We get hit by a\nlawsuit making our deal with <code>Jackass Kangaroo Publications</code> illegal in a specific country.\nBut why bother backing off from this insanity when all problems can be resolved\nby adding just another condition:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.recommended_for user\n    query = Book\n\n    <span class=\"hljs-comment\"># Comment this out when deal with Jackass Kangaroo Publication is over.</span>\n    <span class=\"hljs-keyword\">unless</span> user.located_in? <span class=\"hljs-variable constant_\">DISPUTED_DEMOGRAPHY</span>\n      query = query.where(<span class=\"hljs-symbol\">publisher:</span> Publisher.where(<span class=\"hljs-symbol\">name:</span> <span class=\"hljs-string\">&#x27;Jackass Kangaroo Publication&#x27;</span>).first)\n    <span class=\"hljs-keyword\">end</span>\n\n    ...\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<h1 id=\"A-downhill-slope\"><a href=\"#A-downhill-slope\" class=\"headerlink\" title=\"A downhill slope\"></a>A downhill slope</h1><p>So requirements keep stacking up and we keep adding conditions. Fast forward a few years, and\na sincere programmer who is new to the project, unfamiliar with our rocky history and now is responsible\nfor maintenance of the project is staring\nblankly at the entangled mess of conditional statements. Of course the crutial details of the deal\nand the subsequent lawsuits are now lost in sands of time, and none of the present team members\nhave any idea what is going on.</p>\n<h1 id=\"Retrospection\"><a href=\"#Retrospection\" class=\"headerlink\" title=\"Retrospection\"></a>Retrospection</h1><p>The question now is, what could be done to avoid a situation like this ? As you might have guessed\nat this point, burdening the Book class with responsibility to determine various aspects of\napplication that affect our recommendation policy as well as the complete implementation of all these policies\nis cumbersome. What we can do is that we can refactor out the specific strategies into dedicated\nclasses that encapsulate the actual implementation details. This is exactly what the strategy pattern\nencourages us to embrace.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">module</span> Strategies\n  <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RecommendationGeneration</span> &lt; <span class=\"hljs-title class_ inherited__\">Struct</span>.new(user, scoped_collection)\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">scoped_collection</span>\n      <span class=\"hljs-variable language_\">super</span> |<span class=\"hljs-params\"></span>| Book\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">applicable?</span>\n      <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">execute</span>\n    <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n<br>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">module</span> Strategies\n  <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DefaultRecommendationGeneration</span> &lt; <span class=\"hljs-title class_ inherited__\">RecommendationGeneration</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">applicable?</span>\n          <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-keyword\">end</span>\n\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">scoped_collection</span>\n          <span class=\"hljs-variable language_\">super</span> |<span class=\"hljs-params\"></span>| popular\n        <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">execute</span>\n          scoped_collection.order(<span class=\"hljs-string\">&#x27;RAND()&#x27;</span>).limit(<span class=\"hljs-number\">5</span>)\n    <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n<br>\n<pre><code class=\"hljs ruby\">\n<span class=\"hljs-keyword\">module</span> Strategies\n  <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserAdaptedRecommendationGeneration</span> &lt; <span class=\"hljs-title class_ inherited__\">RecommendationGeneration</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">applicable?</span>\n      user.present?\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">scoped_collection</span>\n      <span class=\"hljs-keyword\">if</span> user.present?\n        not_recommended_by(user).where(<span class=\"hljs-symbol\">tags:</span> user.recommended_tags)\n      <span class=\"hljs-keyword\">else</span>\n            <span class=\"hljs-variable language_\">super</span>\n          <span class=\"hljs-keyword\">end</span>\n        <span class=\"hljs-keyword\">end</span>\n\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">execute</span>\n          Strategies::DefaultRecommendation\n            .new(user, scoped_collection)\n                .execute\n        <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n<br>\n<pre><code class=\"hljs ruby\">\n<span class=\"hljs-keyword\">module</span> Strategies\n  <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PartnershipAdaptedRecommendationGeneration</span> &lt; <span class=\"hljs-title class_ inherited__\">RecommendationGeneration</span>\n\n    <span class=\"hljs-comment\"># It is better to model buisness constraints in the persistance layer</span>\n        <span class=\"hljs-comment\"># rather than relying on implicit assumptions.</span>\n        <span class=\"hljs-comment\">#</span>\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">applicable?</span>\n          ! partner_publisher.blank?\n        <span class=\"hljs-keyword\">end</span>\n\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">partner_publisher</span>\n          Partnership\n            .legal_in(user.demography)\n        .having_recommendation_priviledge\n                .active\n                .first\n                .publisher\n        <span class=\"hljs-keyword\">end</span>\n\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">scoped_collection</span>\n          Book.where(<span class=\"hljs-symbol\">publisher:</span> partner_publisher)\n        <span class=\"hljs-keyword\">end</span>\n\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">execute</span>\n          Strategies::UserAdaptedRecommendationGeneration\n                .new(user, scoped_collection)\n                .execute\n        <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now our <code>recommended_for</code> method just has to decide which is the applicable strategy and execute\nit:</p>\n<pre><code class=\"hljs ruby\">\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n\n  <span class=\"hljs-variable constant_\">RECOMMENDATION_STRATEGIES</span> = [\n    PartnershipAdaptedRecommendationGeneration\n        UserAdaptedRecommendationGeneration\n        DefaultRecommendationGeneration\n  ]\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.recommended_for user\n    <span class=\"hljs-variable constant_\">RECOMMENDATION_STRATEGIES</span>.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">strategy_class</span>|\n          strategy = strategy_class.new(user)\n          <span class=\"hljs-keyword\">if</span> strategy.applicable?\n            strategy.execute\n                <span class=\"hljs-keyword\">break</span>\n          <span class=\"hljs-keyword\">end</span>\n        <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span>\n</code></pre>\n\n<p>This is signficantly better than our prior approach and aligns well with the tenets of\n<a href=\"http://en.wikipedia.org/wiki/SOLID_(object-oriented_design)\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">SOLID</a> principles. Apart from\nexplaining the use of strategy pattern it also illustrates how strategies can reuse existing\nstrategies by means of composition thus keeping our code DRY.</p>\n<p>So we see that, the strategy pattern is especially helpful when it comes to applications where\nrequirements are rapidly changing all the time. Since the core logic is encapsulated\ninto interchangeable concrete implementations, strategy implementations can be\nintroduced or switched with relative ease at a later phase.</p>\n<p>While this post focussed on use of strategy pattern to simply complex logic in model layer, in\nsubsequent posts we will cover how this pattern can simplify our implementations in controller\nand view layers as well.</p>\n<p>This concludes the post. Please feel free to let me know about your suggestions for improvements, or\nmistakes that I might have made in the post above.</p>\n",
            "tags": [
                "Ruby",
                "Rails",
                "Design Patterns"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/10/12/decrypting-an-obfuscated-font-with-ocr.html",
            "url": "https://lorefnon.me/2014/10/12/decrypting-an-obfuscated-font-with-ocr.html",
            "title": "Decrypting an obfuscated font with OCR",
            "date_published": "2014-10-12T00:00:00.000Z",
            "content_html": "<p>I recently came across [this site](the site <a href=\"http://protext.herokuapp.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">http://protext.herokuapp.com/</a>) which demostrates a strategy for copy protection using an obfuscated font. So basically if you copy the text in the header you will realize that text copied is not exactly what is visible on the screen. The text is presented through a font that maps the characters to glyphs of a different character and hence though the output is human readable the underlying text is not. This is presented as a means towards protecting the site from crawlers and scrapers. In the post below I intend to demonstrate that this is not as full-proof as non-technical folks would be led to believe.</p>\n<img src=\"/images/protext_site.png\" style=\"border: 1px solid silver;\"/>\n\n<p>The Achilles heel of such strategies is that the unecrypted text is visible to the user. So a decent <a href=\"http://en.wikipedia.org/wiki/Optical_character_recognition\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">OCR</a> will be able to parse the output and generate the text to reasonable accuracy. So though this technique certainly presents hinderences to a scraper it is not a full proof solution. Through simple code snippets we see below how this can be accomplished in ruby.</p>\n<p>We can directly get the screenshot of the entire site using a tool like phantomJS and pass it on to OCR but the approach below is much more accurate.</p>\n<p>First of all download the font used for the text. The path should be clearly visible in the source of the site and can be scraped using conventional text parsing through regular expressions.</p>\n<img src=\"/images/protext_css_source.png\"/>\n\n<p>Alternatively it can be manually downloaded through devtools:</p>\n<img src=\"/images/protext_devtools_font.png\"/>\n\n<p>Now we need two gems:</p>\n<ul>\n<li><a href=\"https://www.ruby-toolbox.com/projects/tesseract-ocr\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Tesseract-OCR</a> - Ruby bindings for Tesseract OCR</li>\n<li><a href=\"https://www.ruby-toolbox.com/projects/magick_title\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Magic Title</a> - to convert the text to image using a specific font.</li>\n</ul>\n<p>Quoting the <a href=\"http://code.google.com/p/tesseract-ocr/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Tesseract OCR Website</a>:</p>\n<blockquote>\n<p>Tesseract is probably the most accurate open source OCR engine available. Combined with the Leptonica Image Processing Library it can read a wide variety of image formats and convert them to text in over 60 languages. It was one of the top 3 engines in the 1995 UNLV Accuracy test. Between 1995 and 2006 it had little work done on it, but since then it has been improved extensively by Google. It is released under the Apache License 2.0.</p>\n</blockquote>\n<p>Installing Tesseract on OS X is as simple as <code>brew install tesseract</code> and it is also available through several linux package managers.</p>\n<p>The ruby gems can be installed by adding the following to your Gemfile:</p>\n<pre><code>gem &#39;magick_title&#39;, &#39;&gt;= 0.2.0&#39;\ngem &#39;tesseract-ocr&#39;\n</code></pre>\n<p>Now in irb (or a ruby script) you can do:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;magick_title&#x27;</span>\nMagickTitle.options[<span class=\"hljs-symbol\">:font</span>] = <span class=\"hljs-string\">&quot;font_dfcb813d6c003fb3e2fca9f5295e9f58.ttf&quot;</span>  <span class=\"hljs-comment\"># Font downloaded from the site</span>\nMagickTitle.options[<span class=\"hljs-symbol\">:font_path</span>] =  Proc.new&#123; <span class=\"hljs-string\">&#x27;/tmp&#x27;</span> &#125;  <span class=\"hljs-comment\"># Directory where the font resides on our system</span>\nMagickTitle.options[<span class=\"hljs-symbol\">:destination</span>] =  Proc.new&#123; MagicTitle.root &#125; <span class=\"hljs-comment\"># Defaults to current directory</span></code></pre>\n\n<p>Now let us fetch the string from the site header. For the sake of keeping the example minimal we omit the actual scraping code here:</p>\n<pre><code>str =  &quot;1zb SN358 y6JBl HJL 7Nagq JRb6 kzb n2vP 9JV. F + h = t.&quot;\n</code></pre>\n<p><code>MagickTitle.say(str)</code> will give us an image containing the text in exactly the same form as is visible to end user.</p>\n<p>Now we pass the image to Tesseract engine:</p>\n<pre><code class=\"hljs ruby\">e = <span class=\"hljs-title class_\">Tesseract::Engine</span>.new &#123;|<span class=\"hljs-params\">e</span>|\n    e.language  = <span class=\"hljs-symbol\">:eng</span>\n    e.blacklist = <span class=\"hljs-string\">&#x27;|&#x27;</span>\n&#125;</code></pre>\n\n<p>We can get the string using:</p>\n<pre><code>&gt; e.text_for(&quot;./#&#123;MagickTitle.say(str).filename&#125;&quot;)\n=&gt; &quot;The quick brown fox jumps over\\nthe lazy dog 1 2 3\\n\\n&quot;\n</code></pre>\n<p>As you can see that result is not perfect but quite accurate.</p>\n<p>To further improve the performance of the solution we can create an image of every character through MagickTitle and pass it to Tesseract to generate a character by character map. Now large chunks of text can be translated using this map much more efficiently.</p>\n",
            "tags": [
                "Ruby",
                "OCR"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/09/13/commit-messages-from-generator-outputs.html",
            "url": "https://lorefnon.me/2014/09/13/commit-messages-from-generator-outputs.html",
            "title": "Commit messages from generator outputs",
            "date_published": "2014-09-13T00:00:00.000Z",
            "content_html": "<p>A practise I always follow while working with tools that generate code is that any code that is generated and not written by me is committed in isolation. This makes skimming through commit logs later easier because generators often generate many files upfront that wouldn&#39;t be edited until much later. So the subsequent commit wouldn&#39;t be littered with changes that aren&#39;t directly related to the actual operation mentioned in the commit message. Also while browsing through commit diffs keeping generated code in their own commits speeds up the reviewing process - because in most cases we already have an idea of what the generated could be, so it can be skipped.</p>\n<p>Now, if you use well designed frameworks with elegant command line interfaces, like Rails then the actual command typed along with the command output eg.</p>\n<pre><code>rails generate model post title:string body:text\n\ninvoke  active_record\ncreate    db/migrate/20140913191020_create_posts.rb\ncreate    app/models/post.rb\ninvoke    rspec\ncreate      spec/models/post_spec.rb\n</code></pre>\n<p>is expressive enough for a commit message. A person familiar enough with the framework can instantly see the above and know what happened there. In such case, spending time writing an explanatory commit message for a auto-generated code is pretty much a waste of time.</p>\n<p>So I have created a simple zsh function which does exactly the above:</p>\n<pre><code>GC ()\n&#123;\n  cmd=&quot;$@&quot;\n  output=$(&quot;$@&quot;)\n  git add .\n  git commit -m &quot;$cmd&quot; -m &quot;$output&quot;\n&#125;\n</code></pre>\n<p>Add it to your zshrc, and next time you can simply type :</p>\n<pre><code>GC rails g model comment body:text commenter:string\n</code></pre>\n<p>GC will add all the generated code (please ensure you have a clean state before running the generator - GC will not help you that) and committing it with the message as the command combined with the output of generator in separate paragraphs.</p>\n<pre><code>commit 029cb2e60187a196d918a08563d95775d73f5100\nAuthor: Lorefnon &lt;lorefnon@gmail.com&gt;\nDate:   Sun Sep 14 00:58:03 2014 +0530\n\n    rails g model comment body:text commenter:string\n\n          invoke  active_record\n          create    db/migrate/20140913192803_create_comments.rb\n          create    app/models/comment.rb\n          invoke    rspec\n          create      spec/models/comment_spec.rb\n</code></pre>\n",
            "tags": [
                "ZSH",
                "Productivity Hacks"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/09/07/devise-multiple-emails.html",
            "url": "https://lorefnon.me/2014/09/07/devise-multiple-emails.html",
            "title": "Effectively debugging KnockoutJS applications.",
            "date_published": "2014-09-07T00:00:00.000Z",
            "content_html": "\n\n          \n\n<p><a href=\"https://github.com/plataformatec/devise\">Devise</a> is an incredibly popular authorization gem for Rails. Unfortunately allowing a user to log in through multiple emails is not as straightforward as one might expect. This post outlines a way to do just that.</p>\n\n<p>The code for this blog is available <a href=\"https://github.com/lorefnon/devise_multi_email_demo.git\">here</a>. We start off with a rudimentary devise installation (you may want to checkout <a href=\"https://github.com/lorefnon/devise_multi_email_demo/tree/3d5be26be7986aaf73c18497cffd67a9365e38cb\">Commit:3d5be26</a> as a starting point - if you are not familiar with devise I suggest you take a look at the official documentation. As you may have noticed I am writing this post against Rails 4.2 Beta which Devise master does not support as of this writing. Luckily <a href=\"https://github.com/lucasmazza\">lucasmazza</a> has already submitted a pull request for 4.2 compatibility and we just need to use the branch <code>lm-rails-4-2</code>.</p>\n\n<a class=\"header-link\" href=\"#creating-email-model\"><h2 id=\"creating-email-model\">Creating Email model</h2></a>\n\n<p>First step is creating an email model.</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">rails g model email email:string user_id:integer\n</code></pre></div>\n<p>Next we setup the relationships between user and email:</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">Email</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n  <span class=\"n\">belongs_to</span> <span class=\"ss\">:user</span>\n  <span class=\"n\">validates</span> <span class=\"ss\">:email</span><span class=\"p\">,</span> <span class=\"ss\">email</span><span class=\"p\">:</span> <span class=\"kp\">true</span><span class=\"p\">,</span> <span class=\"ss\">presence</span><span class=\"p\">:</span> <span class=\"kp\">true</span><span class=\"p\">,</span> <span class=\"ss\">uniqueness</span><span class=\"p\">:</span> <span class=\"kp\">true</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>The email format validation comes from <a href=\"https://github.com/balexand/email_validator\">email_validator</a> gem.</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n  <span class=\"c1\"># Include default devise modules. Others available are:</span>\n  <span class=\"c1\"># :confirmable, :lockable, :timeoutable and :omniauthable</span>\n  <span class=\"n\">devise</span> <span class=\"ss\">:database_authenticatable</span><span class=\"p\">,</span> <span class=\"ss\">:registerable</span><span class=\"p\">,</span>\n         <span class=\"ss\">:recoverable</span><span class=\"p\">,</span> <span class=\"ss\">:rememberable</span><span class=\"p\">,</span> <span class=\"ss\">:trackable</span><span class=\"p\">,</span> <span class=\"ss\">:validatable</span>\n\n  <span class=\"n\">has_many</span> <span class=\"ss\">:emails</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>Once we have done that, we can do away with the email field provided by devise. Instead of that, let us have a default email reference which may be used as a primary means of communication eg. for sending\nnewsletters, fetching gravatars etc. So here we go:</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">rails g migration add_default_email_to_users default_email_id:integer\n</code></pre></div>\n<p>In <code>db/migrate/20140907091858_add_default_email_to_users.rb</code></p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">AddDefaultEmailToUsers</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Migration</span>\n  <span class=\"k\">def</span> <span class=\"nf\">change</span>\n    <span class=\"n\">remove_column</span> <span class=\"ss\">:users</span><span class=\"p\">,</span> <span class=\"ss\">:email</span>\n    <span class=\"n\">add_column</span> <span class=\"ss\">:users</span><span class=\"p\">,</span> <span class=\"ss\">:default_email_id</span><span class=\"p\">,</span> <span class=\"ss\">:integer</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>In user model:</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"n\">belongs_to</span> <span class=\"ss\">:default_email</span><span class=\"p\">,</span> <span class=\"n\">class_name</span><span class=\"p\">:</span> <span class=\"s2\">\"Email\"</span>\n</code></pre></div>\n\n<a class=\"header-link\" href=\"#setting-up-the-registration-flow-\"><h2 id=\"setting-up-the-registration-flow-\">Setting up the registration flow:</h2></a>\n\n<p>At this point if we try visiting a devise sign up page, we will\nget an obvious error because devise views expect an email field in\nmodel.</p>\n\n<p><image src=\"/images/devise_email_not_found.png\"></image></p>\n\n<p>We resort to a simple hack rather than put in a lot of effort in rewiring Devise. We add email accessors which (as far as devise is concerned) behave just like the email field devise had generated, but internally act as proxy to default email. Duck typing FTW.</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n\n  <span class=\"n\">devise</span> <span class=\"ss\">:database_authenticatable</span><span class=\"p\">,</span> <span class=\"ss\">:registerable</span><span class=\"p\">,</span>\n         <span class=\"ss\">:recoverable</span><span class=\"p\">,</span> <span class=\"ss\">:rememberable</span><span class=\"p\">,</span> <span class=\"ss\">:trackable</span>\n\n  <span class=\"n\">has_many</span> <span class=\"ss\">:emails</span><span class=\"p\">,</span> <span class=\"ss\">dependent</span><span class=\"p\">:</span> <span class=\"ss\">:destroy</span>\n  <span class=\"n\">after_commit</span> <span class=\"ss\">:save_default_email</span><span class=\"p\">,</span> <span class=\"ss\">on</span><span class=\"p\">:</span> <span class=\"ss\">:create</span>\n\n  <span class=\"n\">belongs_to</span> <span class=\"ss\">:default_email</span><span class=\"p\">,</span> <span class=\"n\">class_name</span><span class=\"p\">:</span> <span class=\"s2\">\"Email\"</span>\n  <span class=\"n\">validates</span> <span class=\"ss\">:default_email</span><span class=\"p\">,</span> <span class=\"ss\">presence</span><span class=\"p\">:</span> <span class=\"kp\">true</span>\n  <span class=\"n\">default_scope</span> <span class=\"p\">&#123;</span> <span class=\"n\">includes</span> <span class=\"ss\">:default_email</span> <span class=\"p\">&#125;</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">email</span>\n    <span class=\"n\">default_email</span><span class=\"o\">.</span><span class=\"n\">email</span> <span class=\"k\">rescue</span> <span class=\"kp\">nil</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">email</span><span class=\"o\">=</span> <span class=\"n\">email</span>\n    <span class=\"nb\">self</span><span class=\"o\">.</span><span class=\"n\">default_email</span> <span class=\"o\">=</span> <span class=\"n\">emails</span><span class=\"o\">.</span><span class=\"n\">where</span><span class=\"p\">(</span><span class=\"ss\">email</span><span class=\"p\">:</span> <span class=\"n\">email</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">first_or_initialize</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"kp\">private</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">save_default_email</span>\n    <span class=\"k\">if</span> <span class=\"n\">default_email</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">blank?</span>\n      <span class=\"n\">default_email</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"nb\">self</span>\n    <span class=\"k\">elsif</span> <span class=\"n\">default_email</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">!=</span> <span class=\"nb\">self</span>\n      <span class=\"k\">raise</span> <span class=\"no\">Exceptions</span><span class=\"o\">::</span><span class=\"no\">EmailConflict</span>\n    <span class=\"k\">end</span>\n    <span class=\"n\">default_email</span><span class=\"o\">.</span><span class=\"n\">save!</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>Note that we have removed <code>:validatable</code> which is added by default\nby devise. Also the after commit hook is required because when we are saving the user\nfor the first time, user id is nil when email is instantiated and hence will have to assign it once we have saved the user. An email conflict will be raised if the email\nis already associated with another account. Handling that error gracefully is left as an exercise for the reader.</p>\n\n<a class=\"header-link\" href=\"#setting-up-the-login-flow-\"><h2 id=\"setting-up-the-login-flow-\">Setting up the login flow:</h2></a>\n\n<p>While registration should work smoothly at this point, if we try to login we will run into trouble:</p>\n\n<p><img src=\"/images/devise_login_flow_fail.png\"></p>\n\n<p>The problem is obvious. Devise tries to search using email field which does not exist. So we need to\nconfigure devise to find using the emails table we have created.</p>\n\n<p>This can be done by overriding the class method <code>find_first_by_auth_conditions</code> :</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n\n  <span class=\"k\">def</span> <span class=\"nc\">self</span><span class=\"o\">.</span><span class=\"nf\">having_email</span> <span class=\"n\">email</span>\n    <span class=\"no\">User</span>\n      <span class=\"o\">.</span><span class=\"n\">includes</span><span class=\"p\">(</span><span class=\"ss\">:emails</span><span class=\"p\">)</span>\n      <span class=\"o\">.</span><span class=\"n\">joins</span><span class=\"p\">(</span><span class=\"ss\">emails</span><span class=\"p\">:</span> <span class=\"p\">&#123;</span>\n        <span class=\"ss\">email</span><span class=\"p\">:</span>  <span class=\"n\">email</span>\n      <span class=\"p\">&#125;)</span>\n      <span class=\"o\">.</span><span class=\"n\">first</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"k\">def</span> <span class=\"nc\">self</span><span class=\"o\">.</span><span class=\"nf\">find_first_by_auth_conditions</span> <span class=\"n\">warden_conditions</span>\n    <span class=\"n\">conditions</span> <span class=\"o\">=</span> <span class=\"n\">warden_conditions</span><span class=\"o\">.</span><span class=\"n\">dup</span>\n    <span class=\"k\">if</span> <span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"n\">conditions</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span><span class=\"ss\">:email</span><span class=\"p\">)</span>\n      <span class=\"n\">having_email</span> <span class=\"n\">email</span>\n    <span class=\"k\">else</span>\n      <span class=\"k\">super</span><span class=\"p\">(</span><span class=\"n\">warden_conditions</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"kp\">private</span>\n\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>Once we have done that, login flow should as intended.</p>\n\n<a class=\"header-link\" href=\"#interface-for-managing-emails\"><h2 id=\"interface-for-managing-emails\">Interface for managing emails</h2></a>\n\n<p>At this point a user can login and signup but he can not manage the emails which are associated with his/her account. Let us take care of that.</p>\n\n<p>The default edit account view of devise looks something like this:</p>\n\n<p><img src=\"/images/devise_default_edit.png\"></p>\n\n<p>Note that this form works perfectly well - thanks to our email accessor hack. But users don't have the ability to add new emails or delete existing emails.</p>\n\n<p>We will to augment this form to accept nested attributes for emails. For nested forms probably the most popular solution is <a href=\"https://github.com/ryanb/nested_form\">nested_form</a> but it has been unmaintained for a while. So I resorted to <a href=\"https://github.com/nathanvda/cocoon\">cocoon</a> which is more actively maintained. Both of them work in a similar fashion - through unobstructive javascript.</p>\n\n<p>First we have to configure our model to accept nested attributes for emails - this part is easy:</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n  <span class=\"n\">accepts_nested_attributes_for</span> <span class=\"ss\">:emails</span><span class=\"p\">,</span> <span class=\"n\">reject_if</span><span class=\"p\">:</span> <span class=\"ss\">:all_blank</span><span class=\"p\">,</span> <span class=\"n\">allow_destroy</span><span class=\"p\">:</span> <span class=\"kp\">true</span>\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>Nest we need to generate devise views using <code>rails g devise:views</code> and edit the <code>app/views/devise/registrations/edit.html.erb</code>.</p>\n\n<p>We edit the template to add nested form for emails:</p>\n\n<div class=\"highlight\"><pre><code class=\"erb\"><span class=\"x\">&lt;h2&gt;Edit </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">resource_name</span><span class=\"o\">.</span><span class=\"n\">to_s</span><span class=\"o\">.</span><span class=\"n\">humanize</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/h2&gt;</span>\n\n<span class=\"cp\">&lt;%=</span> <span class=\"n\">form_for</span><span class=\"p\">(</span><span class=\"n\">resource</span><span class=\"p\">,</span> <span class=\"ss\">as</span><span class=\"p\">:</span> <span class=\"n\">resource_name</span><span class=\"p\">,</span> <span class=\"ss\">url</span><span class=\"p\">:</span> <span class=\"n\">registration_path</span><span class=\"p\">(</span><span class=\"n\">resource_name</span><span class=\"p\">),</span> <span class=\"ss\">html</span><span class=\"p\">:</span> <span class=\"p\">&#123;</span> <span class=\"nb\">method</span><span class=\"p\">:</span> <span class=\"ss\">:put</span> <span class=\"p\">&#125;)</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">f</span><span class=\"o\">|</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">  </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">devise_error_messages!</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n\n<span class=\"x\">  &lt;div&gt;</span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">label</span> <span class=\"ss\">:email</span><span class=\"p\">,</span> <span class=\"s2\">\"Default Email\"</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;br /&gt;</span>\n<span class=\"x\">  </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">email_field</span> <span class=\"ss\">:email</span><span class=\"p\">,</span> <span class=\"ss\">autofocus</span><span class=\"p\">:</span> <span class=\"kp\">true</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/div&gt;</span>\n\n<span class=\"x\">  &lt;div&gt;</span>\n<span class=\"x\">    </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">fields_for</span> <span class=\"ss\">:emails</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">email_f</span><span class=\"o\">|</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">      </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">render</span> <span class=\"s1\">'email_fields'</span><span class=\"p\">,</span> <span class=\"ss\">f</span><span class=\"p\">:</span> <span class=\"n\">email_f</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">    </span><span class=\"cp\">&lt;%</span> <span class=\"k\">end</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">    &lt;div class=\"links\"&gt;</span>\n<span class=\"x\">      </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">link_to_add_association</span> <span class=\"s1\">'Add Email'</span><span class=\"p\">,</span> <span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"ss\">:emails</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">    &lt;/div&gt;</span>\n<span class=\"x\">  &lt;/div&gt;</span>\n\n<span class=\"x\">  </span><span class=\"cp\">&lt;%</span> <span class=\"k\">if</span> <span class=\"n\">devise_mapping</span><span class=\"o\">.</span><span class=\"n\">confirmable?</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">resource</span><span class=\"o\">.</span><span class=\"n\">pending_reconfirmation?</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">    &lt;div&gt;Currently waiting confirmation for: </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">resource</span><span class=\"o\">.</span><span class=\"n\">unconfirmed_email</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/div&gt;</span>\n<span class=\"x\">  </span><span class=\"cp\">&lt;%</span> <span class=\"k\">end</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n\n<span class=\"x\">  &lt;div&gt;</span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">label</span> <span class=\"ss\">:password</span> <span class=\"cp\">%&gt;</span><span class=\"x\"> &lt;i&gt;(leave blank if you don't want to change it)&lt;/i&gt;&lt;br /&gt;</span>\n<span class=\"x\">    </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">password_field</span> <span class=\"ss\">:password</span><span class=\"p\">,</span> <span class=\"ss\">autocomplete</span><span class=\"p\">:</span> <span class=\"s2\">\"off\"</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/div&gt;</span>\n\n<span class=\"x\">  &lt;div&gt;</span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">label</span> <span class=\"ss\">:password_confirmation</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;br /&gt;</span>\n<span class=\"x\">    </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">password_field</span> <span class=\"ss\">:password_confirmation</span><span class=\"p\">,</span> <span class=\"ss\">autocomplete</span><span class=\"p\">:</span> <span class=\"s2\">\"off\"</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/div&gt;</span>\n\n<span class=\"x\">  &lt;div&gt;</span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">label</span> <span class=\"ss\">:current_password</span> <span class=\"cp\">%&gt;</span><span class=\"x\"> &lt;i&gt;(we need your current password to confirm your changes)&lt;/i&gt;&lt;br /&gt;</span>\n<span class=\"x\">    </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">password_field</span> <span class=\"ss\">:current_password</span><span class=\"p\">,</span> <span class=\"ss\">autocomplete</span><span class=\"p\">:</span> <span class=\"s2\">\"off\"</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/div&gt;</span>\n\n<span class=\"x\">  &lt;div&gt;</span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">submit</span> <span class=\"s2\">\"Update\"</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/div&gt;</span>\n<span class=\"cp\">&lt;%</span> <span class=\"k\">end</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n\n<span class=\"x\">&lt;h3&gt;Cancel my account&lt;/h3&gt;</span>\n\n<span class=\"x\">&lt;p&gt;Unhappy? </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">button_to</span> <span class=\"s2\">\"Cancel my account\"</span><span class=\"p\">,</span> <span class=\"n\">registration_path</span><span class=\"p\">(</span><span class=\"n\">resource_name</span><span class=\"p\">),</span> <span class=\"ss\">data</span><span class=\"p\">:</span> <span class=\"p\">&#123;</span> <span class=\"ss\">confirm</span><span class=\"p\">:</span> <span class=\"s2\">\"Are you sure?\"</span> <span class=\"p\">&#125;,</span> <span class=\"nb\">method</span><span class=\"p\">:</span> <span class=\"ss\">:delete</span> <span class=\"cp\">%&gt;</span><span class=\"x\">&lt;/p&gt;</span>\n\n<span class=\"cp\">&lt;%=</span> <span class=\"n\">link_to</span> <span class=\"s2\">\"Back\"</span><span class=\"p\">,</span> <span class=\"ss\">:back</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n</code></pre></div>\n\n<p>Cocoon mandates a separate partial for email fields, which in our case is very simple:</p>\n\n<div class=\"highlight\"><pre><code class=\"erb\"><span class=\"x\">&lt;div class=\"nested-fields\"&gt;</span>\n<span class=\"x\">  &lt;div&gt;</span>\n<span class=\"x\">      </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">label</span> <span class=\"ss\">:email</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">      </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">email_field</span> <span class=\"ss\">:email</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">      </span><span class=\"cp\">&lt;%=</span> <span class=\"n\">link_to_remove_association</span> <span class=\"s2\">\"remove email\"</span><span class=\"p\">,</span> <span class=\"n\">f</span> <span class=\"cp\">%&gt;</span><span class=\"x\"></span>\n<span class=\"x\">  &lt;/div&gt;</span>\n<span class=\"x\">&lt;/div&gt;</span>\n</code></pre></div>\n\n<p>At this point if we try saving the form, we will notice that email fields are not getting saved. The reason is that the strong parameters specified by devise does not include our email fields. Fortunately devise provides a way to configure that :</p>\n\n<p>In <code>ApplicationController</code> :</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">ApplicationController</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActionController</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n  <span class=\"c1\"># Prevent CSRF attacks by raising an exception.</span>\n  <span class=\"c1\"># For APIs, you may want to use :null_session instead.</span>\n\n  <span class=\"n\">protect_from_forgery</span> <span class=\"ss\">with</span><span class=\"p\">:</span> <span class=\"ss\">:exception</span>\n  <span class=\"n\">before_action</span> <span class=\"ss\">:configure_permitted_parameters</span><span class=\"p\">,</span> <span class=\"k\">if</span><span class=\"p\">:</span> <span class=\"ss\">:devise_controller?</span>\n\n  <span class=\"kp\">protected</span>\n\n  <span class=\"k\">def</span> <span class=\"nf\">configure_permitted_parameters</span>\n    <span class=\"n\">devise_parameter_sanitizer</span><span class=\"o\">.</span><span class=\"n\">for</span><span class=\"p\">(</span><span class=\"ss\">:account_update</span><span class=\"p\">)</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">u</span><span class=\"o\">|</span>\n      <span class=\"n\">u</span><span class=\"o\">.</span><span class=\"n\">permit</span> <span class=\"ss\">:email</span><span class=\"p\">,</span> <span class=\"ss\">:password</span><span class=\"p\">,</span> <span class=\"ss\">:password_confirmation</span><span class=\"p\">,</span> <span class=\"ss\">:current_password</span><span class=\"p\">,</span> <span class=\"n\">emails_attributes</span><span class=\"p\">:</span> <span class=\"o\">[</span><span class=\"ss\">:email</span><span class=\"p\">,</span> <span class=\"ss\">:id</span><span class=\"p\">,</span> <span class=\"ss\">:_destroy</span><span class=\"o\">]</span>\n    <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>Note that <code>:_destroy</code> symbol in the attribute list. It is required because to destroy nested models, rails uses a virtual attribute called _destroy. When _destroy is set, the nested model will be deleted.</p>\n\n<p>If we try adding, removing and editing emails now, everything should work smoothly.\n<img src=\"/images/devise_nested_form_edit.png\"></p>\n\n<p>In a production setting we will most certainly need to send out confirmation mails before activating the emails. We skip the additional steps for the sake of brevity.</p>\n\n<a class=\"header-link\" href=\"#omniauth-integration-\"><h2 id=\"omniauth-integration-\">Omniauth integration:</h2></a>\n\n<p>One of the things we all love about devise is that it integrates beautifully with\n<a href=\"https://github.com/intridea/omniauth\">omniauth</a> making integration with a plethora of social services painless. However due to the fundamental changes we have made, omniauth integration requires jumping through a few extra hoops.</p>\n\n<p>We use Facebook login as an example below:</p>\n\n<p>Firstly, of course we need to create an application on <a href=\"https://developers.facebook.com\">https://developers.facebook.com</a>. Once we have created an application, and have obtained the API key and secret, we configure devise omniauth parameters:</p>\n\n<p>In Gemfile</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"n\">gem</span> <span class=\"s1\">'omniauth'</span>\n<span class=\"n\">gem</span> <span class=\"s1\">'omniauth-facebook'</span>\n</code></pre></div>\n\n<p>In config/initializers/devise.rb</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"no\">Devise</span><span class=\"o\">.</span><span class=\"n\">setup</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">config</span><span class=\"o\">|</span>\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n  <span class=\"n\">config</span><span class=\"o\">.</span><span class=\"n\">omniauth</span> <span class=\"ss\">:twitter</span><span class=\"p\">,</span> <span class=\"no\">Rails</span><span class=\"o\">.</span><span class=\"n\">application</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">fb_app_id</span><span class=\"p\">,</span> <span class=\"no\">Rails</span><span class=\"o\">.</span><span class=\"n\">application</span><span class=\"o\">.</span><span class=\"n\">secrets</span><span class=\"o\">.</span><span class=\"n\">fb_app_secret</span>\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>In config/secrets.yml</p>\n\n<div class=\"highlight\"><pre><code class=\"yaml\"><span class=\"l-Scalar-Plain\">development</span><span class=\"p-Indicator\">:</span>\n  <span class=\"l-Scalar-Plain\">fb_app_id</span><span class=\"p-Indicator\">:</span> <span class=\"l-Scalar-Plain\">&lt;add api key here&gt;</span>\n  <span class=\"l-Scalar-Plain\">fb_app_secret</span><span class=\"p-Indicator\">:</span> <span class=\"l-Scalar-Plain\">&lt;add api secret here&gt;</span>\n</code></pre></div>\n\n<p>In app/models/user.rb</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n  <span class=\"n\">devise</span> <span class=\"ss\">:omniauthable</span><span class=\"p\">,</span> <span class=\"n\">omniauth_providers</span><span class=\"p\">:</span> <span class=\"o\">[</span><span class=\"ss\">:facebook</span><span class=\"o\">]</span>\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>In config/routes.rb</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\">  <span class=\"n\">devise_for</span> <span class=\"ss\">:users</span><span class=\"p\">,</span> <span class=\"ss\">controllers</span><span class=\"p\">:</span> <span class=\"p\">&#123;</span> <span class=\"n\">omniauth_callbacks</span><span class=\"p\">:</span> <span class=\"s2\">\"users/omniauth_callbacks\"</span> <span class=\"p\">&#125;</span>\n</code></pre></div>\n\n<p>where <code>users/omniauth_callbacks</code> is a controller we define to which facebook will redirect to after authenticating our application.</p>\n\n<p>If you have used omniauth with devise before, there is nothing out of the ordinary so far.</p>\n\n<p>Just like we wish to allow the user to sign up through multiple emails, we also wish to allow a user to sign up through multiple social networks. (s)he may be registered in different social networks with different emails. A simple and elegant way to represent a user's presence in multiple third party sites is through a separate <code>UserIdentity</code> model.</p>\n<div class=\"highlight\"><pre><code class=\"text language-text\" data-lang=\"text\">rails g model UserIdentity user_id:integer email_id:integer uid:string provider:string\n</code></pre></div>\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">UserIdentity</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n  <span class=\"n\">belongs_to</span> <span class=\"ss\">:user</span>\n  <span class=\"n\">belongs_to</span> <span class=\"ss\">:email</span>\n  <span class=\"n\">validates</span> <span class=\"ss\">:user</span><span class=\"p\">,</span> <span class=\"ss\">:email</span><span class=\"p\">,</span> <span class=\"ss\">:uid</span><span class=\"p\">,</span> <span class=\"ss\">:provider</span><span class=\"p\">,</span> <span class=\"ss\">presence</span><span class=\"p\">:</span> <span class=\"kp\">true</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>Our callback controller is intentially very simple. Depending on your use case you may want to check if the user is newly created and direct him/her to a profile completion page. For the sake of simplicity, we just redirect any user to the profile page.</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">Users</span><span class=\"o\">::</span><span class=\"no\">OmniauthCallbacksController</span> <span class=\"o\">&lt;</span> <span class=\"no\">Devise</span><span class=\"o\">::</span><span class=\"no\">OmniauthCallbacksController</span>\n  <span class=\"k\">def</span> <span class=\"nf\">facebook</span>\n    <span class=\"vi\">@user</span> <span class=\"o\">=</span> <span class=\"no\">User</span><span class=\"o\">.</span><span class=\"n\">from_omniauth</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">env</span><span class=\"o\">[</span><span class=\"s2\">\"omniauth.auth\"</span><span class=\"o\">]</span><span class=\"p\">)</span>\n    <span class=\"n\">sign_in_and_redirect</span> <span class=\"vi\">@user</span><span class=\"p\">,</span> <span class=\"ss\">:event</span> <span class=\"o\">=&gt;</span> <span class=\"ss\">:authentication</span> <span class=\"c1\">#this will throw if @user is not activated</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>In the <code>from_omniauth</code> class method of user we need to identify user based on the auth parameters passed.\nLuckily facebook provides us with the email, so we can use that to identify a user.</p>\n\n<p>Four scenarios are possible:</p>\n\n<ul>\n<li><p><strong>User is signing up for the first time through facebook.</strong>\nIn this case we just use the email obtained from facebook as the default email and register the user</p></li>\n<li><p><strong>User already has an account and has chosen to login through facebook for the first time</strong>\nWe can identify this situation if user's existing email is the same as the one he has used in Facebook. In this case we create a new UserIdentity for an existing user.</p></li>\n<li><p><strong>User had logged in using facebook before, using the same email</strong>\nNothing needs to be created. We just log the user in.</p></li>\n<li><p><strong>User had logged in using facebook before, using a different email</strong>\nWe keep the existing email, but associate the user identity with the new email.</p></li>\n</ul>\n\n<p>Here is our implementation</p>\n\n<div class=\"highlight\"><pre><code class=\"ruby\"><span class=\"k\">class</span> <span class=\"nc\">User</span> <span class=\"o\">&lt;</span> <span class=\"no\">ActiveRecord</span><span class=\"o\">::</span><span class=\"no\">Base</span>\n\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n\n  <span class=\"k\">def</span> <span class=\"nc\">self</span><span class=\"o\">.</span><span class=\"nf\">from_omniauth</span> <span class=\"n\">auth</span>\n\n    <span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"no\">Email</span>\n      <span class=\"o\">.</span><span class=\"n\">includes</span><span class=\"p\">(</span><span class=\"ss\">:user</span><span class=\"p\">)</span>\n      <span class=\"o\">.</span><span class=\"n\">where</span><span class=\"p\">(</span><span class=\"ss\">email</span><span class=\"p\">:</span> <span class=\"n\">auth</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"o\">.</span><span class=\"n\">email</span><span class=\"p\">)</span>\n      <span class=\"o\">.</span><span class=\"n\">first_or_initialize</span>\n\n    <span class=\"n\">ui</span> <span class=\"o\">=</span> <span class=\"no\">UserIdentity</span>\n      <span class=\"o\">.</span><span class=\"n\">where</span><span class=\"p\">(</span><span class=\"ss\">provider</span><span class=\"p\">:</span> <span class=\"n\">auth</span><span class=\"o\">.</span><span class=\"n\">provider</span><span class=\"p\">,</span> <span class=\"ss\">uid</span><span class=\"p\">:</span> <span class=\"n\">auth</span><span class=\"o\">.</span><span class=\"n\">uid</span><span class=\"p\">)</span>\n      <span class=\"o\">.</span><span class=\"n\">first_or_initialize</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">persisted?</span>\n      <span class=\"c1\"># Existing user, Existing social identity</span>\n      <span class=\"k\">if</span> <span class=\"o\">!</span> <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">persisted?</span>\n        <span class=\"c1\"># Email changed on third party site</span>\n        <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">user</span>\n        <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">save!</span>\n        <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"n\">email</span>\n      <span class=\"k\">elsif</span> <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">==</span> <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">user</span>\n        <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">user</span>\n      <span class=\"k\">else</span>\n        <span class=\"k\">raise</span> <span class=\"no\">Exceptions</span><span class=\"o\">::</span><span class=\"no\">EmailConflict</span><span class=\"o\">.</span><span class=\"n\">new</span>\n      <span class=\"k\">end</span>\n    <span class=\"k\">elsif</span> <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">persisted?</span>\n      <span class=\"c1\"># Existing User, new identity</span>\n      <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">user</span>\n      <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">save!</span>\n      <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">user</span>\n    <span class=\"k\">else</span>\n      <span class=\"c1\"># New user new identity</span>\n      <span class=\"n\">email</span><span class=\"o\">.</span><span class=\"n\">save!</span>\n      <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"no\">User</span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span>\n        <span class=\"ss\">password</span><span class=\"p\">:</span> <span class=\"no\">Devise</span><span class=\"o\">.</span><span class=\"n\">friendly_token</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">20</span><span class=\"o\">]</span><span class=\"p\">,</span>\n        <span class=\"n\">default_email</span><span class=\"p\">:</span> <span class=\"n\">email</span>\n      <span class=\"p\">)</span>\n      <span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">save!</span>\n      <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">user</span>\n      <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"n\">email</span>\n      <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">save!</span>\n    <span class=\"k\">end</span>\n\n    <span class=\"n\">ui</span><span class=\"o\">.</span><span class=\"n\">user</span>\n  <span class=\"k\">end</span>\n\n  <span class=\"o\">.</span><span class=\"n\">.</span><span class=\"o\">.</span>\n\n<span class=\"k\">end</span>\n</code></pre></div>\n\n<p>The code above raises an <code>EmailConflict</code> exception if we end up in a scenario where an existing user is logging in and the email is associated with another account. Gracefully handling the error is left as an exercise for the reader. Also we assume that the social login provider will provide us with an email.\nWhile this is true for many providers like Github, not all providers provide with emails. A prominent example is twitter. Since this is not intended to be a comprehensive tutorial on omniauth, for the sake of brevity we don't\nelaborate on those scenarios. A good way to handle such a case would be to direct a user to a profile completion after login where he/she can enter the email and warn them if an account already exists for that email.</p>\n\n<p>So we conclude the post with a functional setup that allows a user to have multiple emails associated with a devise account. Feel free to bug me if you face any issues. Any comments and suggestions are also welcome.</p>\n\n\n",
            "tags": [
                "Ruby",
                "Rails"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/09/07/devise-multiple-emails.html",
            "url": "https://lorefnon.me/2014/09/07/devise-multiple-emails.html",
            "title": "Allowing multiple emails for a user in Devise",
            "date_published": "2014-09-07T00:00:00.000Z",
            "content_html": "<p><a href=\"https://github.com/plataformatec/devise\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Devise</a> is an incredibly popular authorization gem for Rails. Unfortunately allowing a user to log in through multiple emails is not as straightforward as one might expect. This post outlines a way to do just that.</p>\n<p>The code for this blog is available <a href=\"https://github.com/lorefnon/devise_multi_email_demo.git\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">here</a>. We start off with a rudimentary devise installation (you may want to checkout <a href=\"https://github.com/lorefnon/devise_multi_email_demo/tree/3d5be26be7986aaf73c18497cffd67a9365e38cb\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Commit:3d5be26</a> as a starting point - if you are not familiar with devise I suggest you take a look at the official documentation. As you may have noticed I am writing this post against Rails 4.2 Beta which Devise master does not support as of this writing. Luckily <a href=\"https://github.com/lucasmazza\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">lucasmazza</a> has already submitted a pull request for 4.2 compatibility and we just need to use the branch <code>lm-rails-4-2</code>.</p>\n<h2 id=\"Creating-Email-model\"><a href=\"#Creating-Email-model\" class=\"headerlink\" title=\"Creating Email model\"></a>Creating Email model</h2><p>First step is creating an email model.</p>\n<pre><code>rails g model email email:string user_id:integer\n</code></pre>\n<p>Next we setup the relationships between user and email:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Email</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  belongs_to <span class=\"hljs-symbol\">:user</span>\n  validates <span class=\"hljs-symbol\">:email</span>, <span class=\"hljs-symbol\">email:</span> <span class=\"hljs-literal\">true</span>, <span class=\"hljs-symbol\">presence:</span> <span class=\"hljs-literal\">true</span>, <span class=\"hljs-symbol\">uniqueness:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The email format validation comes from <a href=\"https://github.com/balexand/email_validator\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">email_validator</a> gem.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  <span class=\"hljs-comment\"># Include default devise modules. Others available are:</span>\n  <span class=\"hljs-comment\"># :confirmable, :lockable, :timeoutable and :omniauthable</span>\n  devise <span class=\"hljs-symbol\">:database_authenticatable</span>, <span class=\"hljs-symbol\">:registerable</span>,\n         <span class=\"hljs-symbol\">:recoverable</span>, <span class=\"hljs-symbol\">:rememberable</span>, <span class=\"hljs-symbol\">:trackable</span>, <span class=\"hljs-symbol\">:validatable</span>\n\n  has_many <span class=\"hljs-symbol\">:emails</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Once we have done that, we can do away with the email field provided by devise. Instead of that, let us have a default email reference which may be used as a primary means of communication eg. for sending\nnewsletters, fetching gravatars etc. So here we go:</p>\n<pre><code>rails g migration add_default_email_to_users default_email_id:integer\n</code></pre>\n<p>In <code>db/migrate/20140907091858_add_default_email_to_users.rb</code></p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AddDefaultEmailToUsers</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Migration</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">change</span>\n    remove_column <span class=\"hljs-symbol\">:users</span>, <span class=\"hljs-symbol\">:email</span>\n    add_column <span class=\"hljs-symbol\">:users</span>, <span class=\"hljs-symbol\">:default_email_id</span>, <span class=\"hljs-symbol\">:integer</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>In user model:</p>\n<pre><code class=\"hljs ruby\">belongs_to <span class=\"hljs-symbol\">:default_email</span>, <span class=\"hljs-symbol\">class_name:</span> <span class=\"hljs-string\">&quot;Email&quot;</span></code></pre>\n\n<h2 id=\"Setting-up-the-registration-flow\"><a href=\"#Setting-up-the-registration-flow\" class=\"headerlink\" title=\"Setting up the registration flow:\"></a>Setting up the registration flow:</h2><p>At this point if we try visiting a devise sign up page, we will\nget an obvious error because devise views expect an email field in\nmodel.</p>\n<image src=\"/images/devise_email_not_found.png\" />\n\n<p>We resort to a simple hack rather than put in a lot of effort in rewiring Devise. We add email accessors which (as far as devise is concerned) behave just like the email field devise had generated, but internally act as proxy to default email. Duck typing FTW.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n\n  devise <span class=\"hljs-symbol\">:database_authenticatable</span>, <span class=\"hljs-symbol\">:registerable</span>,\n         <span class=\"hljs-symbol\">:recoverable</span>, <span class=\"hljs-symbol\">:rememberable</span>, <span class=\"hljs-symbol\">:trackable</span>\n\n  has_many <span class=\"hljs-symbol\">:emails</span>, <span class=\"hljs-symbol\">dependent:</span> <span class=\"hljs-symbol\">:destroy</span>\n  after_commit <span class=\"hljs-symbol\">:save_default_email</span>, <span class=\"hljs-symbol\">on:</span> <span class=\"hljs-symbol\">:create</span>\n\n  belongs_to <span class=\"hljs-symbol\">:default_email</span>, <span class=\"hljs-symbol\">class_name:</span> <span class=\"hljs-string\">&quot;Email&quot;</span>\n  validates <span class=\"hljs-symbol\">:default_email</span>, <span class=\"hljs-symbol\">presence:</span> <span class=\"hljs-literal\">true</span>\n  default_scope &#123; includes <span class=\"hljs-symbol\">:default_email</span> &#125;\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">email</span>\n    default_email.email <span class=\"hljs-keyword\">rescue</span> <span class=\"hljs-literal\">nil</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">email=</span> email\n    <span class=\"hljs-variable language_\">self</span>.default_email = emails.where(<span class=\"hljs-symbol\">email:</span> email).first_or_initialize\n  <span class=\"hljs-keyword\">end</span>\n\n  private\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_default_email</span>\n    <span class=\"hljs-keyword\">if</span> default_email.user.blank?\n      default_email.user = <span class=\"hljs-variable language_\">self</span>\n    <span class=\"hljs-keyword\">elsif</span> default_email.user != <span class=\"hljs-variable language_\">self</span>\n      raise Exceptions::EmailConflict\n    <span class=\"hljs-keyword\">end</span>\n    default_email.save!\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Note that we have removed <code>:validatable</code> which is added by default\nby devise. Also the after commit hook is required because when we are saving the user\nfor the first time, user id is nil when email is instantiated and hence will have to assign it once we have saved the user. An email conflict will be raised if the email\nis already associated with another account. Handling that error gracefully is left as an exercise for the reader.</p>\n<h2 id=\"Setting-up-the-login-flow\"><a href=\"#Setting-up-the-login-flow\" class=\"headerlink\" title=\"Setting up the login flow:\"></a>Setting up the login flow:</h2><p>While registration should work smoothly at this point, if we try to login we will run into trouble:</p>\n<img src=\"/images/devise_login_flow_fail.png\"/>\n\n<p>The problem is obvious. Devise tries to search using email field which does not exist. So we need to\nconfigure devise to find using the emails table we have created.</p>\n<p>This can be done by overriding the class method <code>find_first_by_auth_conditions</code> :</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.having_email email\n    User\n      .includes(<span class=\"hljs-symbol\">:emails</span>)\n      .joins(<span class=\"hljs-symbol\">emails:</span> &#123;\n        <span class=\"hljs-symbol\">email:</span>  email\n      &#125;)\n      .first\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.find_first_by_auth_conditions warden_conditions\n    conditions = warden_conditions.dup\n    <span class=\"hljs-keyword\">if</span> email = conditions.delete(<span class=\"hljs-symbol\">:email</span>)\n      having_email email\n    <span class=\"hljs-keyword\">else</span>\n      <span class=\"hljs-variable language_\">super</span>(warden_conditions)\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  private\n\n  ...\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Once we have done that, login flow should as intended.</p>\n<h2 id=\"Interface-for-managing-emails\"><a href=\"#Interface-for-managing-emails\" class=\"headerlink\" title=\"Interface for managing emails\"></a>Interface for managing emails</h2><p>At this point a user can login and signup but he can not manage the emails which are associated with his&#x2F;her account. Let us take care of that.</p>\n<p>The default edit account view of devise looks something like this:</p>\n<img src=\"/images/devise_default_edit.png\"/>\n\n<p>Note that this form works perfectly well - thanks to our email accessor hack. But users don&#39;t have the ability to add new emails or delete existing emails.</p>\n<p>We will to augment this form to accept nested attributes for emails. For nested forms probably the most popular solution is <a href=\"https://github.com/ryanb/nested_form\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">nested_form</a> but it has been unmaintained for a while. So I resorted to <a href=\"https://github.com/nathanvda/cocoon\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">cocoon</a> which is more actively maintained. Both of them work in a similar fashion - through unobstructive javascript.</p>\n<p>First we have to configure our model to accept nested attributes for emails - this part is easy:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n  accepts_nested_attributes_for <span class=\"hljs-symbol\">:emails</span>, <span class=\"hljs-symbol\">reject_if:</span> <span class=\"hljs-symbol\">:all_blank</span>, <span class=\"hljs-symbol\">allow_destroy:</span> <span class=\"hljs-literal\">true</span>\n  ...\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Nest we need to generate devise views using <code>rails g devise:views</code> and edit the <code>app/views/devise/registrations/edit.html.erb</code>.</p>\n<p>We edit the template to add nested form for emails:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span>&gt;</span>Edit &lt;%=</span><span class=\"language-ruby\"> resource_name.to_s.humanize </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">&lt;%=</span><span class=\"language-ruby\"> form_for(resource, <span class=\"hljs-symbol\">as:</span> resource_name, <span class=\"hljs-symbol\">url:</span> registration_path(resource_name), <span class=\"hljs-symbol\">html:</span> &#123; <span class=\"hljs-symbol\">method:</span> <span class=\"hljs-symbol\">:put</span> &#125;) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">f</span>| </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">  &lt;%=</span><span class=\"language-ruby\"> devise_error_messages! </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&lt;%=</span><span class=\"language-ruby\"> f.label <span class=\"hljs-symbol\">:email</span>, <span class=\"hljs-string\">&quot;Default Email&quot;</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">br</span> /&gt;</span></span>\n<span class=\"language-xml\">  &lt;%=</span><span class=\"language-ruby\"> f.email_field <span class=\"hljs-symbol\">:email</span>, <span class=\"hljs-symbol\">autofocus:</span> <span class=\"hljs-literal\">true</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> f.fields_for <span class=\"hljs-symbol\">:emails</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">email_f</span>| </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">      &lt;%=</span><span class=\"language-ruby\"> render <span class=\"hljs-string\">&#x27;email_fields&#x27;</span>, <span class=\"hljs-symbol\">f:</span> email_f </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    &lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;links&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">      &lt;%=</span><span class=\"language-ruby\"> link_to_add_association <span class=\"hljs-string\">&#x27;Add Email&#x27;</span>, f, <span class=\"hljs-symbol\">:emails</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  &lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">if</span> devise_mapping.confirmable? &amp;&amp; resource.pending_reconfirmation? </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>Currently waiting confirmation for: &lt;%=</span><span class=\"language-ruby\"> resource.unconfirmed_email </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\">  &lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&lt;%=</span><span class=\"language-ruby\"> f.label <span class=\"hljs-symbol\">:password</span> </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">i</span>&gt;</span>(leave blank if you don&#x27;t want to change it)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">i</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">br</span> /&gt;</span></span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> f.password_field <span class=\"hljs-symbol\">:password</span>, <span class=\"hljs-symbol\">autocomplete:</span> <span class=\"hljs-string\">&quot;off&quot;</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&lt;%=</span><span class=\"language-ruby\"> f.label <span class=\"hljs-symbol\">:password_confirmation</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">br</span> /&gt;</span></span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> f.password_field <span class=\"hljs-symbol\">:password_confirmation</span>, <span class=\"hljs-symbol\">autocomplete:</span> <span class=\"hljs-string\">&quot;off&quot;</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&lt;%=</span><span class=\"language-ruby\"> f.label <span class=\"hljs-symbol\">:current_password</span> </span><span class=\"language-xml\">%&gt; <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">i</span>&gt;</span>(we need your current password to confirm your changes)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">i</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">br</span> /&gt;</span></span>\n<span class=\"language-xml\">    &lt;%=</span><span class=\"language-ruby\"> f.password_field <span class=\"hljs-symbol\">:current_password</span>, <span class=\"hljs-symbol\">autocomplete:</span> <span class=\"hljs-string\">&quot;off&quot;</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&lt;%=</span><span class=\"language-ruby\"> f.submit <span class=\"hljs-string\">&quot;Update&quot;</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\">&lt;%</span><span class=\"language-ruby\"> <span class=\"hljs-keyword\">end</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h3</span>&gt;</span>Cancel my account<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h3</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>Unhappy? &lt;%=</span><span class=\"language-ruby\"> button_to <span class=\"hljs-string\">&quot;Cancel my account&quot;</span>, registration_path(resource_name), <span class=\"hljs-symbol\">data:</span> &#123; <span class=\"hljs-symbol\">confirm:</span> <span class=\"hljs-string\">&quot;Are you sure?&quot;</span> &#125;, <span class=\"hljs-symbol\">method:</span> <span class=\"hljs-symbol\">:delete</span> </span><span class=\"language-xml\">%&gt;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span>\n<span class=\"language-xml\"></span>\n<span class=\"language-xml\">&lt;%=</span><span class=\"language-ruby\"> link_to <span class=\"hljs-string\">&quot;Back&quot;</span>, <span class=\"hljs-symbol\">:back</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\"></span></code></pre>\n\n<p>Cocoon mandates a separate partial for email fields, which in our case is very simple:</p>\n<pre><code class=\"hljs erb\"><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;nested-fields&quot;</span>&gt;</span></span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\">      &lt;%=</span><span class=\"language-ruby\"> f.label <span class=\"hljs-symbol\">:email</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">      &lt;%=</span><span class=\"language-ruby\"> f.email_field <span class=\"hljs-symbol\">:email</span> </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">      &lt;%=</span><span class=\"language-ruby\"> link_to_remove_association <span class=\"hljs-string\">&quot;remove email&quot;</span>, f </span><span class=\"language-xml\">%&gt;</span>\n<span class=\"language-xml\">  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span></code></pre>\n\n<p>At this point if we try saving the form, we will notice that email fields are not getting saved. The reason is that the strong parameters specified by devise does not include our email fields. Fortunately devise provides a way to configure that :</p>\n<p>In <code>ApplicationController</code> :</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ApplicationController</span> &lt; <span class=\"hljs-title class_ inherited__\">ActionController::Base</span>\n  <span class=\"hljs-comment\"># Prevent CSRF attacks by raising an exception.</span>\n  <span class=\"hljs-comment\"># For APIs, you may want to use :null_session instead.</span>\n\n  protect_from_forgery <span class=\"hljs-symbol\">with:</span> <span class=\"hljs-symbol\">:exception</span>\n  before_action <span class=\"hljs-symbol\">:configure_permitted_parameters</span>, <span class=\"hljs-symbol\">if:</span> <span class=\"hljs-symbol\">:devise_controller?</span>\n\n  protected\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">configure_permitted_parameters</span>\n    devise_parameter_sanitizer.<span class=\"hljs-keyword\">for</span>(<span class=\"hljs-symbol\">:account_update</span>) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">u</span>|\n      u.permit <span class=\"hljs-symbol\">:email</span>, <span class=\"hljs-symbol\">:password</span>, <span class=\"hljs-symbol\">:password_confirmation</span>, <span class=\"hljs-symbol\">:current_password</span>, <span class=\"hljs-symbol\">emails_attributes:</span> [<span class=\"hljs-symbol\">:email</span>, <span class=\"hljs-symbol\">:id</span>, <span class=\"hljs-symbol\">:_destroy</span>]\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Note that <code>:_destroy</code> symbol in the attribute list. It is required because to destroy nested models, rails uses a virtual attribute called _destroy. When _destroy is set, the nested model will be deleted.</p>\n<p>If we try adding, removing and editing emails now, everything should work smoothly.\n<img src=\"/images/devise_nested_form_edit.png\"/></p>\n<p>In a production setting we will most certainly need to send out confirmation mails before activating the emails. We skip the additional steps for the sake of brevity.</p>\n<h2 id=\"Omniauth-integration\"><a href=\"#Omniauth-integration\" class=\"headerlink\" title=\"Omniauth integration:\"></a>Omniauth integration:</h2><p>One of the things we all love about devise is that it integrates beautifully with\n<a href=\"https://github.com/intridea/omniauth\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">omniauth</a> making integration with a plethora of social services painless. However due to the fundamental changes we have made, omniauth integration requires jumping through a few extra hoops.</p>\n<p>We use Facebook login as an example below:</p>\n<p>Firstly, of course we need to create an application on <a href=\"https://developers.facebook.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">https://developers.facebook.com</a>. Once we have created an application, and have obtained the API key and secret, we configure devise omniauth parameters:</p>\n<p>In Gemfile</p>\n<pre><code class=\"hljs ruby\">gem <span class=\"hljs-string\">&#x27;omniauth&#x27;</span>\ngem <span class=\"hljs-string\">&#x27;omniauth-facebook&#x27;</span></code></pre>\n\n<p>In config&#x2F;initializers&#x2F;devise.rb</p>\n<pre><code class=\"hljs ruby\">Devise.setup <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">config</span>|\n  ...\n  config.omniauth <span class=\"hljs-symbol\">:twitter</span>, Rails.application.secrets.fb_app_id, Rails.application.secrets.fb_app_secret\n  ...\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>In config&#x2F;secrets.yml</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">development:</span>\n  <span class=\"hljs-attr\">fb_app_id:</span> <span class=\"hljs-string\">&lt;add</span> <span class=\"hljs-string\">api</span> <span class=\"hljs-string\">key</span> <span class=\"hljs-string\">here&gt;</span>\n  <span class=\"hljs-attr\">fb_app_secret:</span> <span class=\"hljs-string\">&lt;add</span> <span class=\"hljs-string\">api</span> <span class=\"hljs-string\">secret</span> <span class=\"hljs-string\">here&gt;</span></code></pre>\n\n<p>In app&#x2F;models&#x2F;user.rb</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  ...\n  devise <span class=\"hljs-symbol\">:omniauthable</span>, <span class=\"hljs-symbol\">omniauth_providers:</span> [<span class=\"hljs-symbol\">:facebook</span>]\n  ...\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>In config&#x2F;routes.rb</p>\n<pre><code class=\"hljs ruby\">devise_for <span class=\"hljs-symbol\">:users</span>, <span class=\"hljs-symbol\">controllers:</span> &#123; <span class=\"hljs-symbol\">omniauth_callbacks:</span> <span class=\"hljs-string\">&quot;users/omniauth_callbacks&quot;</span> &#125;</code></pre>\n\n<p>where <code>users/omniauth_callbacks</code> is a controller we define to which facebook will redirect to after authenticating our application.</p>\n<p>If you have used omniauth with devise before, there is nothing out of the ordinary so far.</p>\n<p>Just like we wish to allow the user to sign up through multiple emails, we also wish to allow a user to sign up through multiple social networks. (s)he may be registered in different social networks with different emails. A simple and elegant way to represent a user&#39;s presence in multiple third party sites is through a separate <code>UserIdentity</code> model.</p>\n<pre><code>rails g model UserIdentity user_id:integer email_id:integer uid:string provider:string\n</code></pre>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserIdentity</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  belongs_to <span class=\"hljs-symbol\">:user</span>\n  belongs_to <span class=\"hljs-symbol\">:email</span>\n  validates <span class=\"hljs-symbol\">:user</span>, <span class=\"hljs-symbol\">:email</span>, <span class=\"hljs-symbol\">:uid</span>, <span class=\"hljs-symbol\">:provider</span>, <span class=\"hljs-symbol\">presence:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Our callback controller is intentially very simple. Depending on your use case you may want to check if the user is newly created and direct him&#x2F;her to a profile completion page. For the sake of simplicity, we just redirect any user to the profile page.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Users::OmniauthCallbacksController</span> &lt; <span class=\"hljs-title class_ inherited__\">Devise::OmniauthCallbacksController</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">facebook</span>\n    <span class=\"hljs-variable\">@user</span> = User.from_omniauth(request.env[<span class=\"hljs-string\">&quot;omniauth.auth&quot;</span>])\n    sign_in_and_redirect <span class=\"hljs-variable\">@user</span>, <span class=\"hljs-symbol\">:event</span> =&gt; <span class=\"hljs-symbol\">:authentication</span> <span class=\"hljs-comment\">#this will throw if <span class=\"hljs-doctag\">@user</span> is not activated</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>In the <code>from_omniauth</code> class method of user we need to identify user based on the auth parameters passed.\nLuckily facebook provides us with the email, so we can use that to identify a user.</p>\n<p>Four scenarios are possible:</p>\n<ul>\n<li><p><strong>User is signing up for the first time through facebook.</strong>\nIn this case we just use the email obtained from facebook as the default email and register the user</p>\n</li>\n<li><p><strong>User already has an account and has chosen to login through facebook for the first time</strong>\nWe can identify this situation if user&#39;s existing email is the same as the one he has used in Facebook. In this case we create a new UserIdentity for an existing user.</p>\n</li>\n<li><p><strong>User had logged in using facebook before, using the same email</strong>\nNothing needs to be created. We just log the user in.</p>\n</li>\n<li><p><strong>User had logged in using facebook before, using a different email</strong>\nWe keep the existing email, but associate the user identity with the new email.</p>\n</li>\n</ul>\n<p>Here is our implementation</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n\n  ...\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.from_omniauth auth\n\n    email = Email\n      .includes(<span class=\"hljs-symbol\">:user</span>)\n      .where(<span class=\"hljs-symbol\">email:</span> auth.info.email)\n      .first_or_initialize\n\n    ui = UserIdentity\n      .where(<span class=\"hljs-symbol\">provider:</span> auth.provider, <span class=\"hljs-symbol\">uid:</span> auth.uid)\n      .first_or_initialize\n\n    <span class=\"hljs-keyword\">if</span> ui.persisted?\n      <span class=\"hljs-comment\"># Existing user, Existing social identity</span>\n      <span class=\"hljs-keyword\">if</span> ! email.persisted?\n        <span class=\"hljs-comment\"># Email changed on third party site</span>\n        email.user = ui.user\n        email.save!\n        ui.email = email\n      <span class=\"hljs-keyword\">elsif</span> email.user == ui.user\n        ui.user\n      <span class=\"hljs-keyword\">else</span>\n        raise Exceptions::EmailConflict.new\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">elsif</span> email.persisted?\n      <span class=\"hljs-comment\"># Existing User, new identity</span>\n      ui.user = email.user\n      ui.save!\n      ui.user\n    <span class=\"hljs-keyword\">else</span>\n      <span class=\"hljs-comment\"># New user new identity</span>\n      email.save!\n      user = <span class=\"hljs-title class_\">User</span>.new(\n        <span class=\"hljs-symbol\">password:</span> Devise.friendly_token[<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">20</span>],\n        <span class=\"hljs-symbol\">default_email:</span> email\n      )\n      user.save!\n      ui.user = user\n      ui.email = email\n      ui.save!\n    <span class=\"hljs-keyword\">end</span>\n\n    ui.user\n  <span class=\"hljs-keyword\">end</span>\n\n  ...\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The code above raises an <code>EmailConflict</code> exception if we end up in a scenario where an existing user is logging in and the email is associated with another account. Gracefully handling the error is left as an exercise for the reader. Also we assume that the social login provider will provide us with an email.\nWhile this is true for many providers like Github, not all providers provide with emails. A prominent example is twitter. Since this is not intended to be a comprehensive tutorial on omniauth, for the sake of brevity we don&#39;t\nelaborate on those scenarios. A good way to handle such a case would be to direct a user to a profile completion after login where he&#x2F;she can enter the email and warn them if an account already exists for that email.</p>\n<p>So we conclude the post with a functional setup that allows a user to have multiple emails associated with a devise account. Feel free to bug me if you face any issues. Any comments and suggestions are also welcome.</p>\n",
            "tags": [
                "Ruby",
                "Rails",
                "Devise",
                "Integration"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/09/03/in-memory-zipping-ruby.html",
            "url": "https://lorefnon.me/2014/09/03/in-memory-zipping-ruby.html",
            "title": "In-Memory Zipping in Ruby",
            "date_published": "2014-09-03T00:00:00.000Z",
            "content_html": "<p><a href=\"https://github.com/rubyzip/rubyzip\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Rubyzip</a> is pretty much the defacto solution for manipulating zip files in ruby. However an underdocumented feature of this library is that it allows for creating zip files in memory ie. without actually writing anything to a file.</p>\n<p>There are many situations when this can come in handy. For example in a Web application it may be faster to zip a small number of files on the fly and deliver it to client without writing to disc. This is especially handy in cloud environments where direct disc access is prohibited.</p>\n<p>This can be accomplished as follows:</p>\n<pre><code class=\"hljs ruby\">file_stream = Zip::ZipOutputStream.write_buffer <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">zip</span>|\n  zip.put_next_entry <span class=\"hljs-string\">&quot;hello.txt&quot;</span>\n  zip.print <span class=\"hljs-string\">&quot;Hello World&quot;</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The above creates a zip file with a single file hello.txt containing the text &quot;Hello World&quot;</p>\n<p>Creating directory structures is just as easy:</p>\n<pre><code class=\"hljs ruby\">file_stream = Zip::ZipOutputStream.write_buffer <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">zip</span>|\n  zip.put_next_entry <span class=\"hljs-string\">&quot;dir1/hello.txt&quot;</span>\n  zip.print <span class=\"hljs-string\">&quot;Hello&quot;</span>\n  zip.put_next_entry <span class=\"hljs-string\">&quot;dir2/hello.txt&quot;</span>\n  zip.print <span class=\"hljs-string\">&quot;World&quot;</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Finally, before we can read from the stream we will have to rewind it first. As an illustrative example the following shows a typical Rails controller that renders a zipped file to client.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SomeController</span> &lt; <span class=\"hljs-title class_ inherited__\">ApplicationController</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">some_action</span>\n    file_stream = Zip::ZipOutputStream.write_buffer <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">zip</span>|\n      zip.put_next_entry <span class=\"hljs-string\">&quot;dir1/hello.txt&quot;</span>\n      zip.print <span class=\"hljs-string\">&quot;Hello&quot;</span>\n      zip.put_next_entry <span class=\"hljs-string\">&quot;dir2/hello.txt&quot;</span>\n      zip.print <span class=\"hljs-string\">&quot;World&quot;</span>\n    <span class=\"hljs-keyword\">end</span>\n    file_stream.rewind\n    respond_to <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">format</span>|\n      format.zip <span class=\"hljs-keyword\">do</span>\n        send_data file_stream.read, <span class=\"hljs-symbol\">filename:</span> <span class=\"hljs-string\">&quot;zip_file.zip&quot;</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>A user visiting this action will be downloading a file named zip_file.zip containing two files in their respective directories.</p>\n<p>For <code>format.zip</code> to be available we will have to register <code>application/zip</code> mimetype. Add the following to an initializer:</p>\n<pre><code class=\"hljs ruby\">Mime::Type.register <span class=\"hljs-string\">&quot;application/zip&quot;</span>, <span class=\"hljs-symbol\">:zip</span></code></pre>\n\n<p>This concludes this small article. Please feel free to leave your suggestions in the comments below.</p>\n",
            "tags": [
                "Ruby"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/07/27/optimizing-sti-columns.html",
            "url": "https://lorefnon.me/2014/07/27/optimizing-sti-columns.html",
            "title": "Optimizing space taken by type column in Rails STI",
            "date_published": "2014-07-27T00:00:00.000Z",
            "content_html": "<p>The <a href=\"http://api.rubyonrails.org/classes/ActiveRecord/Base.html#label-Single+table+inheritance\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Single Table Inheritance</a>\nfacility in Rails is quite awesome in that it is simple, minimal and easy to understand.\nHowever that simplicity comes with a small price - the type column stores the full name of the relevant class as a string.\nThis becomes especially unweildy if you scope your models inside a module.</p>\n<p>Let us illustrate this with an example:</p>\n<p>Let us say, we have a database of institutions. For non profit and commercial institutions we have two subclasses of <code>Institution::Base</code> namely, <code>Institution::NonProfit</code>, <code>Institution::Commercial</code>.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-comment\">#app/models/institution.rb</span>\n<span class=\"hljs-keyword\">module</span> Institution\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">self</span>.table_name_prefix\n    <span class=\"hljs-string\">&#x27;institution_&#x27;</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-comment\"># app/models/institution/base.rb</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Institution::Base</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-comment\">#app/models/institution/non_profit.rb</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Institution::NonProfit</span> &lt; <span class=\"hljs-title class_ inherited__\">Institution::Base</span>\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-comment\">#app/models/institution/commercial.rb</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Institution::Commercial</span> &lt; <span class=\"hljs-title class_ inherited__\">Institution::Base</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>We deliberately keep the schema simple:</p>\n<pre><code class=\"hljs ruby\">create_table <span class=\"hljs-string\">&quot;institution_bases&quot;</span>, <span class=\"hljs-symbol\">force:</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">t</span>|\n    t.string   <span class=\"hljs-string\">&quot;name&quot;</span>\n    t.string   <span class=\"hljs-string\">&quot;type&quot;</span>\n    t.datetime <span class=\"hljs-string\">&quot;created_at&quot;</span>\n    t.datetime <span class=\"hljs-string\">&quot;updated_at&quot;</span>\n <span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The subclasses simply reuse the table and Rails distinguishes between them using the type column. If we  try to store some sample entries, we would notice that the value stored in type field contains the fully namespaces class name: <code>Institution::NonProfit</code>, <code>Institution::Commercial</code> etc.</p>\n<p>Since we know that our application will not store models from other namespace in this table, the extra space taken by the module name is wasteful. In fact storing the name in its entirety is wasteful. So this post highlights a simple approach to minimise the space taken by type column without sacrificing the ease of use of STI in rails.</p>\n<p>It turns out we can override the methods Rails uses to convert the table name to class name and vice versa:</p>\n<p>The relevant methods are <code>find_sti_class</code> which is responsible for the translating the value stored in the type column to the respective ActiveRecord model and <code>sti_name</code> which is responsible for retriving the value stored in type column given an ActiveRecord subclass.</p>\n<p>So we override the default implementations to the following:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Institution::Base</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n\n  <span class=\"hljs-variable constant_\">ALLOWED_CLASSES</span> = <span class=\"hljs-string\">%w[Institution::NonProfit Institution::Commercial]</span>\n\n  <span class=\"hljs-keyword\">class</span> &lt;&lt; <span class=\"hljs-variable language_\">self</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">find_sti_class</span> type_name\n      idx = type_name.to_i\n      <span class=\"hljs-variable language_\">super</span> <span class=\"hljs-keyword\">if</span> idx == <span class=\"hljs-number\">0</span>\n      <span class=\"hljs-variable constant_\">ALLOWED_CLASSES</span>[idx-<span class=\"hljs-number\">1</span>].constantize\n    <span class=\"hljs-keyword\">rescue</span> NameError, TypeError\n      <span class=\"hljs-variable language_\">super</span>\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">sti_name</span>\n      idx = <span class=\"hljs-variable constant_\">ALLOWED_CLASSES</span>.index(<span class=\"hljs-variable language_\">self</span>.name)\n      <span class=\"hljs-keyword\">if</span> idx.<span class=\"hljs-literal\">nil</span>?\n        <span class=\"hljs-variable language_\">super</span>\n      <span class=\"hljs-keyword\">else</span>\n        idx + <span class=\"hljs-number\">1</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Once we have done this the STI subsystem of ActiveRecord will the use the <code>ALLOWED_CLASSES</code> to infer the name Institution classes using the index stored in the database column.</p>\n<p>What is particularly nice is that if have any existing data, we don&#39;t end up getting\nany errors when trying to save or retrieve them since we delegate to default implementations. Although it would be a better option to write a migration to change the type column to integer.</p>\n<p>The eagle eyed among us might have noticed we are offsetting the index in the <code>ALLOWED_CLASSES</code> index by 1. This is a basic precaution because calling <code>to_i</code> on a string that is not a numeric string returns <code>0</code> instead of raising an error. So delegating to default implementation incase of zero value allows us to retain legacy compatibility.</p>\n<p>You might want to ask why the array ALLOWED_CLASS_NAMES is a string array rather than an actual array of classes. Having an array of classes leads to RecursiveDependency errors while autoloading when fetching the entries from databases.</p>\n<p>While this is nice and good, this functionality is generic and doesn&#39;t really belong to the <code>Institution::Base</code> class. What if we need another module tomorrow which is unreleated but needs the same functionality?</p>\n<p>So in the spirit of reusability and separation of concerns we create a <code>concern</code> for this:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">module</span> OptimallyInheritable\n  extend ActiveSupport::Concern\n\n  <span class=\"hljs-keyword\">module</span> ClassMethods\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">support_sti_for</span> cls_list\n      <span class=\"hljs-variable\">@sti_cls_list</span> = []\n      <span class=\"hljs-variable\">@sti_cls_list</span> += cls_list\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">sti_cls_list</span>\n      <span class=\"hljs-variable\">@sti_cls_list</span>\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">find_sti_class</span> type_name\n      idx = type_name.to_i\n      <span class=\"hljs-variable language_\">super</span> <span class=\"hljs-keyword\">if</span> idx == <span class=\"hljs-number\">0</span>\n      sti_cls_list[type_name.to_i-<span class=\"hljs-number\">1</span>].constantize\n    <span class=\"hljs-keyword\">rescue</span> NameError, TypeError\n      <span class=\"hljs-variable language_\">super</span>\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">sti_name</span>\n      idx = sti_cls_list.index(<span class=\"hljs-variable language_\">self</span>.name)\n      <span class=\"hljs-keyword\">if</span> idx.<span class=\"hljs-literal\">nil</span>?\n        <span class=\"hljs-variable language_\">super</span>\n      <span class=\"hljs-keyword\">else</span>\n        idx + <span class=\"hljs-number\">1</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>And our <code>Institution::Base</code> class just reduces to:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Institution::Base</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  <span class=\"hljs-keyword\">include</span> OptimallyInheritable\n  support_sti_for <span class=\"hljs-string\">%w[Institution::NonProfit Institution::Commercial]</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>All seems kosher, so we take our implementation for a test drive:</p>\n<pre><code>&gt; Institution::Base.all\nInstitution::Base Load (0.4ms)  SELECT `institution_bases`.* FROM `institution_bases`\n=&gt; #&lt;ActiveRecord::Relation [#&lt;Institution::Commercial id: 3, name: &quot;loremipsum&quot;, type: &quot;2&quot;, created_at: &quot;2014-07-17 12:27:26&quot;, updated_at: &quot;2014-07-17 12:27:26&quot;&gt;]&gt;\n</code></pre>\n<p>While laoding instances of base class works well, we run into issues when we try to load all commercial\ninstitutions:</p>\n<pre><code>2.1.2 :005 &gt; Institution::Commercial.all\nNoMethodError: undefined method `index&#39; for nil:NilClass\n               from /Users/lorefnon/Workspace/sample/app/models/concerns/optimally_inheritable.rb:24:in `sti_name&#39;\n               from /Users/lorefnon/.rvm/gems/ruby-2.1.2@sample/gems/activerecord-4.1.4/lib/active_record/inheritance.rb:170:in `block in type_condition&#39;\n               from /Users/lorefnon/.rvm/gems/ruby-2.1.2@sample/gems/activerecord-4.1.4/lib/active_record/inheritance.rb:170:in `map&#39;\n               from /Users/lorefnon/.rvm/gems/ruby-2.1.2@sample/gems/activerecord-4.1.4/lib/active_record/inheritance.rb:170:in `type_condition&#39;\n               from /Users/lorefnon/.rvm/gems/ruby-2.1.2@sample/gems/activerecord-4.1.4/lib/active_record/core.rb:170:in `relation&#39;\n</code></pre>\n<p>The problem is obvious : the variable <code>sti_class_list</code> is not available in subclasses.</p>\n<p>So we rectify our solution:</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">sti_cls_list</span>\n  <span class=\"hljs-keyword\">if</span> superclass.respond_to? <span class=\"hljs-symbol\">:sti_cls_list</span>\n    superclass.sti_cls_list\n  <span class=\"hljs-keyword\">else</span>\n    <span class=\"hljs-variable\">@sti_cls_list</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>This resolves the aforementioned issues.</p>\n<p>Now that we have reached the end of the post, it would be a good time to highlight the drawbacks of our approach:</p>\n<ol>\n<li>Firstly, The array passed to <code>support_sti_for</code> function will have to be kept in sync with the class names, if the name of any model class changes in future.</li>\n<li>Secondly, While it is safe to add new entries to supported classes, their order can not be arbitrarily changed without running a data correction script first.</li>\n</ol>\n<p>This concludes our post. The full source code is available at <a href=\"https://github.com/lorefnon/sti_optimization_demo.git\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Github</a>. As always, any criticism or feedback is welcome.</p>\n",
            "tags": [
                "Ruby",
                "Rails",
                "ActiveRecord"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/07/13/presenting-sql-views-through-active-admin.html",
            "url": "https://lorefnon.me/2014/07/13/presenting-sql-views-through-active-admin.html",
            "title": "Presenting SQL views through ActiveAdmin",
            "date_published": "2014-07-13T00:00:00.000Z",
            "content_html": "<p><a href=\"http://en.wikipedia.org/wiki/View_(SQL)\"> SQL Views </a> are a handy feature that allow us to\nsave a query whose results are computed&#x2F;collated dynamically whenever the view is requested.\nBecause the abstraction provided by a view is semantically close to a table we can leverage\nActiveRecord to interface with the view through a proxy model and use it to\npresent the result set through <a href=\"http://activeadmin.info/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">ActiveAdmin</a> interface.</p>\n<p>This can be very useful for reporting and visual inspection, especially by\nnon technical staff.</p>\n<p>The rest of the post elaborates on a simple approach for doing this through\ncode examples. Please note that henceforth we use the term view\nto refer to an SQL View rather than Rails view templates. Also the code is\nwritten for Rails 4 but should be usable with Rails 3 as well.</p>\n<p>For the sake of illustration we use an example database containing\ngeographical information of Indian cities. The full code is available <a href=\"https://github.com/lorefnon/active_admin_view_demo\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">here</a>.\nFor brevity we just mention the generator commands and\nmodel classes here:</p>\n<pre><code class=\"hljs sh\">rails g model City name:string district_id:<span class=\"hljs-built_in\">integer</span>\nrails g model District name:string state_id:<span class=\"hljs-built_in\">integer</span>\nrails g model State name:string</code></pre>\n\n<pre><code class=\"hljs ruby\"><span class=\"hljs-comment\"># app/models/state.rb</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">State</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  has_many <span class=\"hljs-symbol\">:districts</span>\n  has_many <span class=\"hljs-symbol\">:cities</span>, <span class=\"hljs-symbol\">through:</span> <span class=\"hljs-symbol\">:districts</span>\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-comment\"># app/models/district.rb</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">District</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  belongs_to <span class=\"hljs-symbol\">:state</span>\n  has_many <span class=\"hljs-symbol\">:cities</span>\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-comment\"># app/models/city.rb</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">City</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  belongs_to <span class=\"hljs-symbol\">:district</span>\n  has_one <span class=\"hljs-symbol\">:state</span>, <span class=\"hljs-symbol\">through:</span> <span class=\"hljs-symbol\">:district</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Note: Using the most recent Rails version, 4.1.4, will cause numerous dependency\nconflicts, hence we use Rails 4.0.0 with ActiveAdmin edge.Since we don&#39;t plan\nto use any cutting edge features in this example this should be an acceptable\ncompromise.</p>\n<p>We stick to default Devise based AdminUser for authentication. Once we generate\nactive admin resources for our models, we have something like this:</p>\n<img src=\"/images/active_admin_states.png\" />\n<img src=\"/images/active_admin_districts.png\" />\n<img src=\"/images/active_admin_cities.png\" />\n\n<p>The view that we intend to create combines the data in the three tables\njoins.</p>\n<pre><code>SELECT cities.id AS id, states.name AS state, districts.name AS district, cities.name AS city\nFROM states\nINNER JOIN districts ON districts.state_id = states.id\nINNER JOIN cities ON cities.district_id = districts.id\n</code></pre>\n<img src=\"/images/joins_states.png\" />\n\n<p>To create the view we generate a migration:</p>\n<pre><code>rails g migration create_state_district_city_view\n</code></pre>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">CreateStateDistrictCityView</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Migration</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">up</span>\n    <span class=\"hljs-variable language_\">self</span>.connection.execute <span class=\"hljs-string\">%Q( CREATE OR REPLACE VIEW state_district_city_view AS</span>\n<span class=\"hljs-string\">      SELECT cities.id AS id, states.name AS state, districts.name AS district, cities.name AS city</span>\n<span class=\"hljs-string\">      FROM states</span>\n<span class=\"hljs-string\">      INNER JOIN districts ON districts.state_id = states.id</span>\n<span class=\"hljs-string\">      INNER JOIN cities ON cities.district_id = districts.id</span>\n<span class=\"hljs-string\">    )</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">down</span>\n    <span class=\"hljs-variable language_\">self</span>.connection.execute <span class=\"hljs-string\">&quot;DROP VIEW IF EXISTS state_district_city_view;&quot;</span>\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now a view, as far as read access is concerned, behaves similar to a table, we\ncan just define a normal ActiveRecord model to access this view.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">StateDistrictCityViewProxy</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n    <span class=\"hljs-variable language_\">self</span>.table_name = <span class=\"hljs-string\">&quot;state_district_city_view&quot;</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>We can take the proxy model for a test drive using IRB:</p>\n<pre><code class=\"hljs ruby\">&gt; StateDistrictCityViewProxy.limit(<span class=\"hljs-number\">10</span>).to_a\n  StateDistrictCityViewProxy Load (<span class=\"hljs-number\">0</span>.4ms)  <span class=\"hljs-variable constant_\">SELECT</span> <span class=\"hljs-string\">`state_district_city_view`</span>.* <span class=\"hljs-variable constant_\">FROM</span> <span class=\"hljs-string\">`state_district_city_view`</span> <span class=\"hljs-variable constant_\">LIMIT</span> <span class=\"hljs-number\">10</span>\n=&gt; [#&lt;StateDistrictCityViewProxy id: 1, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Agali&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 2, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Amadagur&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 3, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Amarapuram&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 4, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Anantapur&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 5, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Atmakur&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 6, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Bathalapalle&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 7, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Beluguppa&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 8, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Bommanahal&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 9, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Brahmasamudram&quot;&gt;, #&lt;StateDistrictCityViewProxy id: 10, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Bukkapatnam&quot;&gt;]</code></pre>\n\n<p>Now that we have a model, generating an ActiveAdmin resource is as simple as:</p>\n<pre><code> rails g active_admin:resource StateDistrictCityViewProxy\n</code></pre>\n<p>At this point upon visiting the index page in ActiveAdmin we might have expected\na fancy paginated table but instead we are greeted with a not-so-helpful error:</p>\n<img src=\"/images/err1.png\"/>\n\n<p>The problem is immediately obvious if we try to get the attributes of a model instance:</p>\n<pre><code>&gt; s1 = StateDistrictCityViewProxy.first\n  StateDistrictCityViewProxy Load (0.3ms)  SELECT `state_district_city_view`.* FROM `state_district_city_view` LIMIT 1\n=&gt; #&lt;StateDistrictCityViewProxy id: 1, state: &quot;Andhra Pradesh&quot;, district: &quot;Anantapur&quot;, city: &quot;Agali&quot;&gt;\n&gt; s1.attributes\n=&gt; &#123;&quot;id&quot;=&gt;1, &quot;state&quot;=&gt;&quot;Andhra Pradesh&quot;, &quot;district&quot;=&gt;&quot;Anantapur&quot;, &quot;city&quot;=&gt;&quot;Agali&quot;, nil=&gt;nil&#125;\n</code></pre>\n<p>So the question is where is the nil coming from? The problem is that an SQL view doesn&#39;t have a primary key. Rails doesn&#39;t automatically\nassume that our <code>id</code> field is a primary key.</p>\n<pre><code>&gt; StateDistrictCityViewProxy.primary_key\n=&gt; nil\n</code></pre>\n<p>We can not somehow add a primary key to an SQL view, that is utterly pointless. However we can force ActiveRecord to use the <code>id</code> attribute\nas primary key.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">StateDistrictCityViewProxy</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  <span class=\"hljs-variable language_\">self</span>.table_name = <span class=\"hljs-string\">&quot;state_district_city_view&quot;</span>\n  <span class=\"hljs-variable language_\">self</span>.primary_key = <span class=\"hljs-string\">&quot;id&quot;</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>And voila. We have our fancy table:</p>\n<img src=\"/images/active_admin_view.png\"/>\n\n<h1 id=\"Caveats\"><a href=\"#Caveats\" class=\"headerlink\" title=\"Caveats:\"></a>Caveats:</h1><p>While everything looks great at this point, our setup has a couple of issues that need to be resolved:</p>\n<h2 id=\"schema-rb\"><a href=\"#schema-rb\" class=\"headerlink\" title=\"schema.rb\"></a>schema.rb</h2><p>If you take a look at schema.rb the problem immediately becomes obvious. Nothing about our view is to be found.\nThe problem is that Rails is blissfully oblivious of our SQL views and the sql statements\nin our migrations have not introducted any changes in schema.rb. So when you regenerate the database from\nschema.yml the view will not be created. This has multiple solutions. A simple one\nis to get rid of schema.rb in favor of sql schema format.</p>\n<p>In config&#x2F;application.rb:</p>\n<pre><code>config.active_record.schema_format = :sql\n</code></pre>\n<p>Next time we run <code>rake db:migrate</code> a <code>structure.sql</code> file will be generated that contains the SQL\nfor generating our views.</p>\n<p>An alternative option is the gem <a href=\"https://github.com/lomba/schema_plus\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">schema_plus</a> that augments ActiveRecord\nwith support for views among other advanced database features.</p>\n<h2 id=\"Edit-x2F-Delete-actions\"><a href=\"#Edit-x2F-Delete-actions\" class=\"headerlink\" title=\"Edit&#x2F;Delete actions\"></a>Edit&#x2F;Delete actions</h2><p>Our ActiveAdmin view table has been blessed with <code>Edit</code> and <code>Delete</code> actions for every row, which\noviously trigger an error. For example, here is what we end up with when clicking on <code>Delete</code> :</p>\n<img src=\"/images/err2.png\"/>\n\n<p>Let us declare the proxy model as readonly.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">StateDistrictCityViewProxy</span> &lt; <span class=\"hljs-title class_ inherited__\">ActiveRecord::Base</span>\n  <span class=\"hljs-variable language_\">self</span>.table_name = <span class=\"hljs-string\">&quot;state_district_city_view&quot;</span>\n  <span class=\"hljs-variable language_\">self</span>.primary_key = <span class=\"hljs-string\">&quot;id&quot;</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">readonly?</span>\n    <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Next we simply remove the irrelevant actions from the ActiveAdmin view:</p>\n<pre><code class=\"hljs ruby\">ActiveAdmin.register StateDistrictCityViewProxy <span class=\"hljs-keyword\">do</span>\n\n  actions <span class=\"hljs-symbol\">:index</span>, <span class=\"hljs-symbol\">:show</span>\n\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now that the quirks of our setup have been ironed out, feel free to go ahead and try it out.\nOf course SQL views are not the only solution for a problem like this and the aforementioned table could have been\nbuilt entirely through DSLs provided by ActiveAdmin. But nonetheless, SQL views are something that\nmost DBAs are already familiar with and is a hassle free setup. If you already have a legacy database\nwith views or need to use views for other auxiliary purposes, the aforementioned approach may make\nthings easy for you.</p>\n<p>Any suggestion or criticism is welcome.</p>\n",
            "tags": [
                "Ruby",
                "Rails",
                "ActiveAdmin"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/03/10/decoupling-frontend-with-gulp-and-node-http-proxy.html",
            "url": "https://lorefnon.me/2014/03/10/decoupling-frontend-with-gulp-and-node-http-proxy.html",
            "title": "Decoupling your frontend development with gulp and http-proxy",
            "date_published": "2014-03-10T00:00:00.000Z",
            "content_html": "<p>In past developers have often relied on backend-specific toolchains for\nweb application frontends. Some examples would be <a href=\"http://edgeguides.rubyonrails.org/asset_pipeline.html\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Rails asset pipeline</a> or\nthe legacy ant based toolchain for YUI. However recently node.js based tooling support\nfor frontend technologies has significantly evolved and it is quite viable\nto use a node.js based toolchain for managing your frontend projects, even if\nthe backend is not node.js, thus keeping the workflow decoupled from the backend.</p>\n<p>This has multiple advantages, primary among them being that javascript\ndevelopers can configure their tools using a language they already are\nfamiliar with without relying on server-side developers.</p>\n<p>The workflow I outline in this post utilizes <a href=\"http://gulpjs.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">gulp</a> and node module <a href=\"https://www.npmjs.org/package/http-proxy\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">http-proxy</a>.</p>\n<p>Gulp is a build system. I prefer it over alternative task runners like grunt\nand mimosa because, as the gulp&#39;s website states quite succinctly :</p>\n<blockquote>\n<p>gulp&#39;s use of streams and code-over-configuration makes for a simpler and more intuitive build.</p>\n</blockquote>\n<p>A claim that I have found to be true in practice.</p>\n<p>The http-proxy library helps us connect with our backend seemlessly and at the same\ntime keep the codebase in a separate project. By configuring a proxy server\nwe can load frontend assets from our local system while route the rest of the\nrequests to a potentially remote backend. This is particularly helpful when\nwe have multiple loosely coupled mini-applications backed by a single monolithic\nserver-side codebase.</p>\n<p>An alternative to this would be to configure the backend to support <a href=\"http://www.html5rocks.com/en/tutorials/cors/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">cross origin\nrequests</a>, but this is really unnecessary if eventually the application will be\nserved from the same domain.</p>\n<p>Let us say we have a javascript heavy dashboard which we would like to develop\nin a separate project. Here is the directory structure I&#39;ll use. Please note that following this\ndirectory structure is not mandatory and is mainly illustrative.</p>\n<pre><code class=\"hljs bash\">project\n  |_ gulpfile.js    <span class=\"hljs-comment\"># task runner configuration</span>\n  |_ dashboard      <span class=\"hljs-comment\"># generated files go here</span>\n  |  |_ css\n  |  |_ js\n  |_ node_modules   <span class=\"hljs-comment\"># node.js dependencies are installed here</span>\n  |_ package.json   <span class=\"hljs-comment\"># configuration for node.js packages</span>\n  |_ server.js      <span class=\"hljs-comment\"># proxy server</span>\n  |_ src            <span class=\"hljs-comment\"># source files</span>\n     |_ css\n     |_ js</code></pre>\n\n<p>When deploying the application we can simply drop the dashboard folder to the\nweb-root of our application eg. the public folder of a Rails application.</p>\n<p>Next we illustrate usage of http-proxy module to create a simple proxy server.</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-comment\">// server.js</span>\n\n<span class=\"hljs-keyword\">var</span> httpProxy = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;http-proxy&#x27;</span>),\n    connect = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;connect&#x27;</span>),\n    livereload = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;connect-livereload&#x27;</span>)\n\n<span class=\"hljs-keyword\">var</span> proxy = httpProxy.<span class=\"hljs-title function_\">createProxyServer</span>()\n\n<span class=\"hljs-keyword\">var</span> app = <span class=\"hljs-title function_\">connect</span>()\n    .<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-string\">&#x27;/dashboard&#x27;</span>, connect.<span class=\"hljs-title function_\">static</span>(__dirname+<span class=\"hljs-string\">&#x27;/dashboard&#x27;</span>))\n    .<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res</span>)&#123;\n        <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">url</span>.<span class=\"hljs-title function_\">indexOf</span>(<span class=\"hljs-string\">&#x27;dashboard&#x27;</span>) == -<span class=\"hljs-number\">1</span>) &#123;\n            proxy.<span class=\"hljs-title function_\">web</span>(req, res, &#123;\n                <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:3000&#x27;</span>\n            &#125;)\n        &#125;\n    &#125;)\n    .<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">4000</span>)</code></pre>\n\n<p>Before running the server, install the node.js dependencies:</p>\n<pre><code class=\"hljs bash\">npm install --save connect http-proxy connect-livereload</code></pre>\n\n<p>What the above script does is simply serve the urls that\nhave dashboard in the url from dashboard folder while\ndirecting the rest of the requests to another server, which\nin case is simply <code>http://localhost:3000</code></p>\n<p>For complex routing we can use some of the <a href=\"https://nodejsmodules.org/tags/router\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">routing libraries</a>\nfor node.js but for our example the simple script above works\npretty well.</p>\n<p>Our gulp tasks go in gulpfile.js. Configuring gulp tasks is fairly\nsimple. While the <a href=\"https://github.com/gulpjs/gulp/blob/master/docs/README.md\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">official documentation</a>\nis a thorough reference, we illustrate the workflow through some examples.\nFor example creating a task to clean our target js and css\nfolders is as simple as:</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> gulp = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;gulp&#x27;</span>),\n    clean = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;gulp-clean&#x27;</span>)\n\ngulp.<span class=\"hljs-title function_\">task</span>(<span class=\"hljs-string\">&#x27;clean&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;\n    gulp.<span class=\"hljs-title function_\">src</span>([<span class=\"hljs-string\">&#x27;./dashboard/js/*&#x27;</span>, <span class=\"hljs-string\">&#x27;./dashboard/css/*&#x27;</span>])\n        .<span class=\"hljs-title function_\">pipe</span>(<span class=\"hljs-title function_\">clean</span>())\n&#125;)</code></pre>\n\n<p>The stream based based approach really shines when we use pre-processors for\nour js or css files. For example to use stylus for css we can add:</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> stylus = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;gulp-stylus&#x27;</span>)\n\ngulp.<span class=\"hljs-title function_\">task</span>(<span class=\"hljs-string\">&#x27;css&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;\n    gulp.<span class=\"hljs-title function_\">src</span>(<span class=\"hljs-string\">&#x27;./src/css/*.styl&#x27;</span>)\n        .<span class=\"hljs-title function_\">pipe</span>(<span class=\"hljs-title function_\">stylus</span>())\n        .<span class=\"hljs-title function_\">pipe</span>(gulp.<span class=\"hljs-title function_\">dest</span>(<span class=\"hljs-string\">&#x27;./dashboard/css&#x27;</span>))\n&#125;)</code></pre>\n\n<p>To manage dependencies with browserify we can have:</p>\n<pre><code class=\"hljs javascript\">gulp.<span class=\"hljs-title function_\">task</span>(<span class=\"hljs-string\">&#x27;js&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;\n    gulp.<span class=\"hljs-title function_\">src</span>(<span class=\"hljs-string\">&#x27;./src/js/index.js&#x27;</span>)\n        .<span class=\"hljs-title function_\">pipe</span>(<span class=\"hljs-title function_\">browserify</span>())\n        .<span class=\"hljs-title function_\">pipe</span>(gulp.<span class=\"hljs-title function_\">dest</span>(<span class=\"hljs-string\">&#x27;./dashboard/js&#x27;</span>))\n&#125;)\n</code></pre>\n\n<p>As I hope is clear, the stream based approach makes configuration fairly\nsimple, intuitive and consistent throughout.</p>\n<p>Of course associated packages above like <code>gulp-stylus</code>, <code>gulp-browserify</code>, <code>gulp-clean</code>\nhave to be installed through npm before we can use them.</p>\n<p>While we can run <code>gulp js</code>, <code>gulp css</code>, <code>gulp clean</code> etc. from the command line\nwe would probably want to have a default task that we run most of the time:</p>\n<pre><code class=\"hljs javascript\">gulp.<span class=\"hljs-title function_\">task</span>(<span class=\"hljs-string\">&#x27;default&#x27;</span>, [<span class=\"hljs-string\">&#x27;clean&#x27;</span>, <span class=\"hljs-string\">&#x27;js&#x27;</span>, <span class=\"hljs-string\">&#x27;css&#x27;</span>])</code></pre>\n\n<p>Now running <code>gulp</code> will cleanup the dashboard&#x2F;js and dashboard&#x2F;css folders and\nrun our js and css tasks.</p>\n<p>To streamline our workflow we configure a watcher which can monitor our files, and\nrun the associated tasks automatically. Writing a simple watcher is as simple as:</p>\n<pre><code class=\"hljs javascript\">gulp.<span class=\"hljs-title function_\">task</span>(<span class=\"hljs-string\">&#x27;watch&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;\n    gulp.<span class=\"hljs-title function_\">watch</span>(<span class=\"hljs-string\">&#x27;./src/js/**/*&#x27;</span>, [<span class=\"hljs-string\">&#x27;default&#x27;</span>])\n&#125;)</code></pre>\n\n<p>And why stop here, let us automate browser refreshes too. We can use <a href=\"http://livereload.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">livereload</a> to\nautomatically reload our browser whenever the files change.</p>\n<p>We can add a watcher that notifies the livereload server with changes:</p>\n<pre><code class=\"hljs javascript\">gulp.<span class=\"hljs-title function_\">task</span>(<span class=\"hljs-string\">&#x27;watch&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;\n    <span class=\"hljs-keyword\">var</span> server = <span class=\"hljs-title function_\">livereload</span>()\n    gulp.<span class=\"hljs-title function_\">watch</span>(<span class=\"hljs-string\">&#x27;./src/js/**/*&#x27;</span>, [<span class=\"hljs-string\">&#x27;default&#x27;</span>])\n    gulp.<span class=\"hljs-title function_\">watch</span>(<span class=\"hljs-string\">&#x27;./dashboard/**/*&#x27;</span>)\n        .<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">file</span>)&#123;\n            server.<span class=\"hljs-title function_\">changed</span>(file.<span class=\"hljs-property\">path</span>)\n        &#125;)\n&#125;)</code></pre>\n\n<p>Please note that we could not have hooked up the callback to the watcher we\nalready had because then it would not guarantee that the pre-processors have\nactually completed before our browser refreshes. Please never use timers for\nsituations like this.</p>\n<p>If you have been using livereload for a while then you probably have the browser\nextension for livereload. But in case you haven&#39;t you can use a middleware for\nexpress in the server.js file. This is especially convenient for testing on\nseveral browsers.</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> app = <span class=\"hljs-title function_\">connect</span>()\n    .<span class=\"hljs-title function_\">use</span>(connect.<span class=\"hljs-title function_\">logger</span>(<span class=\"hljs-string\">&#x27;dev&#x27;</span>))\n    .<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-title function_\">livereload</span>(&#123;\n        <span class=\"hljs-attr\">port</span>: <span class=\"hljs-number\">35729</span>\n    &#125;))\n    .<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-string\">&#x27;/dashboard&#x27;</span>, connect.<span class=\"hljs-title function_\">static</span>(__dirname+<span class=\"hljs-string\">&#x27;/dashboard&#x27;</span>))\n    .<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res</span>)&#123;\n        <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">url</span>.<span class=\"hljs-title function_\">indexOf</span>(<span class=\"hljs-string\">&#x27;dashboard&#x27;</span>) == -<span class=\"hljs-number\">1</span>) &#123;\n            proxy.<span class=\"hljs-title function_\">web</span>(req, res, &#123;\n                <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">&#x27;http://localhost:3000&#x27;</span>\n            &#125;)\n        &#125;\n    &#125;)\n    .<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">4000</span>)</code></pre>\n\n<p>35729 is the default port on which livereload server runs. Note that this\nrelieves us from having to add the livereload script in our page manually\nbecause the middleware takes care of it for us.</p>\n<p>If you use the above configuration, you will soon notice something strange.\nWhen we edit a css file our entire page refreshes. If you have used livereload\nbefore or have seen the demos you know that this should not happen. It should\njust transparently reload the css files.</p>\n<p>It happens because of the way our gulp tasks are configured. Whenever a file\nin src directory changes we run both our js and css tasks which cause both\njs and css files to be regerated and thus prompt livereload to refresh the page.</p>\n<p>To remedy this we have to modify the watch handler:</p>\n<pre><code class=\"hljs javascript\">gulp.<span class=\"hljs-title function_\">task</span>(<span class=\"hljs-string\">&#x27;watch&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;\n    <span class=\"hljs-keyword\">var</span> server = <span class=\"hljs-title function_\">livereload</span>()\n    gulp.<span class=\"hljs-title function_\">watch</span>(<span class=\"hljs-string\">&#x27;./src/js/**/*.js&#x27;</span>, [<span class=\"hljs-string\">&#x27;js&#x27;</span>])\n    gulp.<span class=\"hljs-title function_\">watch</span>(<span class=\"hljs-string\">&#x27;./src/css/**/*.styl&#x27;</span>, [<span class=\"hljs-string\">&#x27;css&#x27;</span>])\n    gulp.<span class=\"hljs-title function_\">watch</span>(<span class=\"hljs-string\">&#x27;./dashboard/**/*&#x27;</span>)\n        .<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&#x27;change&#x27;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">file</span>)&#123;\n            server.<span class=\"hljs-title function_\">changed</span>(file.<span class=\"hljs-property\">path</span>)\n        &#125;)\n&#125;)</code></pre>\n\n<p>If you try now, you will notice that css changes no longer refresh the full\npage as expected.</p>\n<p>While the above was not an indepth introduction to any of the technologies involved,\nI hope that it gave a basic idea about how node.js based tools can be used\nfor a streamlined frontend development workflow. As always any comment or criticism is\nwelcome.</p>\n",
            "tags": [
                "Javascript",
                "Gulp"
            ]
        },
        {
            "id": "https://lorefnon.me/2014/02/02/configuring-emacs-for-rails.html",
            "url": "https://lorefnon.me/2014/02/02/configuring-emacs-for-rails.html",
            "title": "Configuring Emacs as a productive development environment for Rails development.",
            "date_published": "2014-02-02T00:00:00.000Z",
            "content_html": "<h2 id=\"Updates\"><a href=\"#Updates\" class=\"headerlink\" title=\"Updates\"></a>Updates</h2><ul>\n<li>The default keybindings have been updated based on the feedback from <a href=\"https://github.com/asok\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Asok</a>, the author of the awesmoe <code>projectile-rails</code> package.</li>\n</ul>\n<hr>\n<p>This post outlines some of the Emacs extensions (open source, of course) which can significantly ease the life of a Rails developer. While Rails is, by design, quite a productive framework, having the dev environment properly setup can multiply developer efficiency by an order of magnitude. Although almost all of this information is available online elsewhere, I nevertheless wanted to summarize my explorations in form of a basic guide to easily configure extensions I have found to be useful, during the course of my Rails projects. While the primary audience is a forgetful me from the future, I hope developers new to Rails or Emacs (or both) will find this helpful to get up and running with Emacs and Rails, without having to wade through reams of documentation right upfront. I have tried my best to link the appropriate authoritative resources, which may be helpful for people looking forward to customizing and extending the setup.</p>\n<p>While the setup below has been tested only in Linux Elementary, it should work for other Posix environments as well. Please ensure that you have got atleast <a href=\"http://www.gnu.org/software/emacs/#Obtaining\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Emacs 24</a> and can download packages through <a href=\"https://github.com/technomancy/package.el\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\"><code>package.el</code></a>. If you are not familiar with package management in emacs <a href=\"https://github.com/bbatsov\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Bozhidar Batsov</a> has presented <a href=\"http://batsov.com/articles/2012/02/19/package-management-in-emacs-the-good-the-bad-and-the-ugly/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">a great introduction</a>. Adding the following snippet to your <code>~/.emacs</code> should provide access to <a href=\"http://marmalade-repo.org/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">marmalade</a> and <a href=\"http://melpa.milkbox.net/#/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">melpa</a> package archives:</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">require</span> &#x27;package)\n(<span class=\"hljs-name\">add-to-list</span> &#x27;package-archives\n    &#x27;(<span class=\"hljs-string\">&quot;marmalade&quot;</span> .\n      <span class=\"hljs-string\">&quot;http://marmalade-repo.org/packages/&quot;</span>))\n(<span class=\"hljs-name\">add-to-list</span> &#x27;package-archives\n    &#x27;(<span class=\"hljs-string\">&quot;melpa&quot;</span> . <span class=\"hljs-string\">&quot;http://melpa.milkbox.net/packages/&quot;</span>) <span class=\"hljs-literal\">t</span>)\n(<span class=\"hljs-name\">package-initialize</span>)</code></pre>\n\n<h1 id=\"Syntax-Checking\"><a href=\"#Syntax-Checking\" class=\"headerlink\" title=\"Syntax Checking\"></a>Syntax Checking</h1><p>While the <code>ruby-mode</code> bundled with Emacs works well with syntax highlighting, it does not automatically handle syntax checking. Luckily we have <a href=\"http://www.emacswiki.org/emacs/FlyMake\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">flymake</a>, which is a generic on the fly syntax checking system. We can install <a href=\"https://github.com/purcell/flymake-ruby\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">flymake-ruby</a> which facilitates syntax checking for ruby through our package manager. Just hit <code>M-x package-install</code> and type in <code>flymake-ruby</code>.</p>\n<p>Once flymake-ruby is installed, we just have to hook it up with the ruby-mode.</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">require</span> &#x27;flymake-ruby)\n(<span class=\"hljs-name\">add-hook</span> &#x27;ruby-mode-hook &#x27;flymake-ruby-load)</code></pre>\n\n<p>And voila, no syntax errors go unnoticed ever again:</p>\n<p><img src=\"/images/emacs-flymake.png\" alt=\"Emacs flymake screenshot\" loading=\"lazy\"></p>\n<h1 id=\"Sane-indentation\"><a href=\"#Sane-indentation\" class=\"headerlink\" title=\"Sane indentation\"></a>Sane indentation</h1><p>The default indentation system attempts to align the arguments of a function\nwith the opening bracket vertically.</p>\n<pre><code class=\"hljs ruby\">function_call (arg1,\n               arg2);</code></pre>\n\n<p>While this is subjective, but if you, like me, find this behaviour erratic - the following will make emacs indent code inside parenthesis similar to elsewhere.</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">setq</span> ruby-deep-indent-paren <span class=\"hljs-literal\">nil</span>)</code></pre>\n\n<h1 id=\"Ruby-shell-inside-emacs\"><a href=\"#Ruby-shell-inside-emacs\" class=\"headerlink\" title=\"Ruby shell inside emacs\"></a>Ruby shell inside emacs</h1><p><a href=\"https://github.com/nonsequitur/inf-ruby\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">inf-ruby</a> provides a REPL buffer connected to a Ruby subprocess. It is available through the package manager. Once installed you would probably want to bind it to a convenient shortcut. The following would bind it to <code>C-c r r</code>.</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">global-set-key</span> (<span class=\"hljs-name\">kbd</span> <span class=\"hljs-string\">&quot;C-c r r&quot;</span>) &#x27;inf-ruby)</code></pre>\n\n<h1 id=\"Integration-with-RVM\"><a href=\"#Integration-with-RVM\" class=\"headerlink\" title=\"Integration with RVM\"></a>Integration with RVM</h1><p>If you use RVM for managing ruby versions, you would want to use <a href=\"https://github.com/senny/rvm.el\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">rvm.el</a>. Once installed you will just have to call <code>rvm-activate-corresponding-ruby</code> and rvm.el will automatically pick up your ruby version and gemset from .rvmrc file.</p>\n<p>The following will bind the aforementioned command to <code>C-c r a</code></p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">global-set-key</span> (<span class=\"hljs-name\">kbd</span> <span class=\"hljs-string\">&quot;C-c r a&quot;</span>) &#x27;rvm-activate-corresponding-ruby)</code></pre>\n\n<p><img src=\"/images/emacs-rvm.png\" alt=\"rvm.el\" loading=\"lazy\"></p>\n<p>It seamlessly integrates with <code>inf-ruby</code> so if you invoke <code>inf-ruby</code> after the previous step, you will get the version of ruby and gemset you expect.</p>\n<h1 id=\"Project-management-with-projectile\"><a href=\"#Project-management-with-projectile\" class=\"headerlink\" title=\"Project management with projectile\"></a>Project management with projectile</h1><p>So far the steps had nothing to do with Rails and were equally useful for vanilla ruby projects. However for managing large Rails applications some basic project management facilities might come in handy.</p>\n<p>While there are a plethora of project management utilities for emacs, One that is particularly simple and easy to install is <a href=\"https://github.com/bbatsov/projectile\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">projectile</a>. It is available through the package manager. Once installed it can be configured as a global mode as follows:</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">projectile-global-mode</span>)</code></pre>\n\n<p>or it can be hooked into particular modes:</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">add-hook</span> &#x27;ruby-mode-hook &#x27;projectile-on)</code></pre>\n\n<p>I would also strongly recommend using the <a href=\"http://www.emacswiki.org/emacs/InteractivelyDoThings\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">ido-mode</a> which, among other things, provides various enhancements to make navigation between files and buffers easy. The default behaviour of <code>C-x C-f</code> and <code>C-x C-b</code> are changed to a more interactive version, which shows a list of matched options while typing right inside the minibuffer. <a href=\"https://github.com/lewang/flx\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">flx-ido</a> is an extension which further enhances the matching capabilities of ido to perform fuzzy matching (a-la sublime text) which can be a great productivity boost, particularly if you are a bit sloppy with keyboard. <code>ido</code> is built into emacs and <code>flx-ido</code> is available through package manager.</p>\n<p><code>flx-ido-mode</code> activates the ido mode augmenting with flexible matching.</p>\n<p>You may want to use following snippet to display ido completions vertically instead of horizontally, as is the default behaviour.</p>\n<pre><code class=\"hljs lisp\"><span class=\"hljs-comment\">;; Display ido results vertically, rather than horizontally</span>\n (<span class=\"hljs-name\">setq</span> ido-decorations (<span class=\"hljs-name\">quote</span> (<span class=\"hljs-string\">&quot;\\n-&gt; &quot;</span> <span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-string\">&quot;\\n   &quot;</span> <span class=\"hljs-string\">&quot;\\n   ...&quot;</span> <span class=\"hljs-string\">&quot;[&quot;</span> <span class=\"hljs-string\">&quot;]&quot;</span> <span class=\"hljs-string\">&quot; [No match]&quot;</span> <span class=\"hljs-string\">&quot; [Matched]&quot;</span> <span class=\"hljs-string\">&quot; [Not readable]&quot;</span> <span class=\"hljs-string\">&quot; [Too big]&quot;</span> <span class=\"hljs-string\">&quot; [Confirm]&quot;</span>)))\n (<span class=\"hljs-name\">defun</span> ido-disable-line-truncation () (<span class=\"hljs-name\">set</span> (<span class=\"hljs-name\">make-local-variable</span> &#x27;truncate-lines) <span class=\"hljs-literal\">nil</span>))\n (<span class=\"hljs-name\">add-hook</span> &#x27;ido-minibuffer-setup-hook &#x27;ido-disable-line-truncation)\n (<span class=\"hljs-name\">defun</span> ido-define-keys () <span class=\"hljs-comment\">;; C-n/p is more intuitive in vertical layout</span>\n   (<span class=\"hljs-name\">define-key</span> ido-completion-map (<span class=\"hljs-name\">kbd</span> <span class=\"hljs-string\">&quot;C-n&quot;</span>) &#x27;ido-next-match)\n   (<span class=\"hljs-name\">define-key</span> ido-completion-map (<span class=\"hljs-name\">kbd</span> <span class=\"hljs-string\">&quot;C-p&quot;</span>) &#x27;ido-prev-match))\n (<span class=\"hljs-name\">add-hook</span> &#x27;ido-setup-hook &#x27;ido-define-keys)</code></pre>\n\n<p><img src=\"/images/emacs-ido-vertical.png\" alt=\"Emacs ido vertical completions\" loading=\"lazy\"></p>\n<p>Projectile integrates with ido and uses it as its indexing method. For projectile to recognize the project root, you just have to drop an empty .projectile file there. Once that is done, you can simply perform a fuzzy search for files using <code>C-c C-p f</code> and directories using <code>C-c C-p d</code></p>\n<p><img src=\"/images/emacs-projectile-file-search.png\" alt=\"Projectile find file\" loading=\"lazy\">\n<img src=\"/images/emcas-projectile-dir-search.png\" alt=\"Projectile find dir\" loading=\"lazy\"></p>\n<p><a href=\"https://github.com/asok/projectile-rails\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Projectile Rails</a> builds upon <code>projectile</code> to provide project management facilities specifically tailored for Rails applications. It is available through package manager and can be hooked up with projectile using :</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">add-hook</span> &#x27;projectile-mode-hook &#x27;projectile-rails-on)</code></pre>\n\n<p>Projectile Rails adds a large number of keybindings to ease navigation across files in a rails project, running rake tasks, invoking console etc.\nFollowing is the list of commands and associated bindings taken from the home page of projectile rails.</p>\n<table>\n<thead><tr>\n<th>Command</th>\n<th>Keybinding</th>\n<th>Description</th>\n</tr></thead>\n<tbody>\n<tr>\n<td>projectile-rails-find-model</td>\n<td><kbd>C-c r m</kbd></td>\n<td>Find a model using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-current-model</td>\n<td><kbd>C-c r M</kbd></td>\n<td>Go to a model connected with the current resource.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-controller</td>\n<td><kbd>C-c r c</kbd></td>\n<td>Find a controller using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-current-controller</td>\n<td><kbd>C-c r C</kbd></td>\n<td>Go to a controller connected with the current resource.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-view</td>\n<td><kbd>C-c r v</kbd></td>\n<td>Find a template or partial using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-current-view</td>\n<td><kbd>C-c r V</kbd></td>\n<td>Go to a view connected with the current resource.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-helper</td>\n<td><kbd>C-c r h</kbd></td>\n<td>Find a helper using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-current-helper</td>\n<td><kbd>C-c r H</kbd></td>\n<td>Go to a helper connected with the current resource.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-lib</td>\n<td><kbd>C-c r l</kbd></td>\n<td>Find a lib using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-feature</td>\n<td><kbd>C-c r f</kbd></td>\n<td>Find a feature using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-spec</td>\n<td><kbd>C-c r p</kbd></td>\n<td>Find a spec using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-current-spec</td>\n<td><kbd>C-c r P</kbd></td>\n<td>Go to a spec connected with the current resource.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-migration</td>\n<td><kbd>C-c r n</kbd></td>\n<td>Find a migration using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-current-migration</td>\n<td><kbd>C-c r N</kbd></td>\n<td>Go to a migration connected with the current resource.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-javascript</td>\n<td><kbd>C-c r j</kbd></td>\n<td>Find a javascript using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-stylesheet</td>\n<td><kbd>C-c r s</kbd></td>\n<td>Find a stylesheet using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-log</td>\n<td><kbd>C-c r o</kbd></td>\n<td>Find a log file and enable <code>auto-revert-tail-mode</code> in its buffer.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-initializer</td>\n<td><kbd>C-c r i</kbd></td>\n<td>Find an initializer file using <code>projectile-completions-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-environment</td>\n<td><kbd>C-c r e</kbd></td>\n<td>Find an environment file using <code>projectile-completions-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-locale</td>\n<td><kbd>C-c r a</kbd></td>\n<td>Find a locale file using <code>projectile-completions-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-mailer</td>\n<td><kbd>C-c r @</kbd></td>\n<td>Find a mailer file using <code>projectile-completions-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-find-layout</td>\n<td><kbd>C-c r y</kbd></td>\n<td>Find a layout file using <code>projectile-completions-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-console</td>\n<td>\n<kbd>C-c r ! c</kbd>, <kbd>C-c r r</kbd>\n</td>\n<td>Run <code>rails console</code> command in <code>inf-ruby</code> buffer.</td>\n</tr>\n<tr>\n<td>projectile-rails-server</td>\n<td>\n<kbd>C-c r ! s</kbd>, <kbd>C-c r R</kbd>\n</td>\n<td>Run <code>rails server</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-rake</td>\n<td><kbd>C-c r ! r</kbd></td>\n<td>Select a rake task to run using <code>projectile-completion-system</code>.</td>\n</tr>\n<tr>\n<td>projectile-rails-generate</td>\n<td><kbd>C-c r ! g</kbd></td>\n<td>Run <code>rails generate</code> command.</td>\n</tr>\n<tr>\n<td>projectile-rails-extract-region</td>\n<td><kbd>C-c r x</kbd></td>\n<td>Extract the selected region to a partial.</td>\n</tr>\n<tr>\n<td>projectile-rails-goto-file-at-point</td>\n<td>\n<kbd>C-c r RET</kbd>, <kbd>C-c r g f</kbd>\n</td>\n<td>Go to a file at point. Depending on the context that might be a constant, template or partial, or a gem.</td>\n</tr>\n<tr>\n<td>projectile-rails-goto-gemfile</td>\n<td><kbd>C-c r g g</kbd></td>\n<td>Go to <code>Gemfile</code> file.</td>\n</tr>\n<tr>\n<td>projectile-rails-goto-routes</td>\n<td><kbd>C-c r g r</kbd></td>\n<td>Go to <code>config/routes.rb</code> file.</td>\n</tr>\n<tr>\n<td>projectile-rails-goto-schema</td>\n<td><kbd>C-c r g d</kbd></td>\n<td>Go to <code>db/schema.rb</code> file.</td>\n</tr>\n<tr>\n<td>projectile-rails-goto-spec-helper</td>\n<td><kbd>C-c r g l</kbd></td>\n<td>Go to <code>spec/spec_helper.rb</code> file.</td>\n</tr>\n</tbody>\n</table>\n\n<p>Note that <code>rails console</code> uses <code>inf-ruby</code>, so integration with rvm is smooth and effortless.</p>\n<p><img src=\"/images/projectile-rails-console.png\" alt=\"Projectile Rails console\" loading=\"lazy\"></p>\n<h1 id=\"Intelligent-Code-navigation-and-Completion-with-Robe\"><a href=\"#Intelligent-Code-navigation-and-Completion-with-Robe\" class=\"headerlink\" title=\"Intelligent Code navigation and Completion with Robe\"></a>Intelligent Code navigation and Completion with Robe</h1><p><a href=\"https://github.com/dgutov/robe\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Robe</a> is a code assistance tool that uses a Ruby REPL subprocess with your application or gem code loaded, to provide information about loaded classes and modules, and where each method is defined.</p>\n<p>Robe is available via package manager. Once installed it can be hooked into ruby mode.</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">require</span> &#x27;robe)\n(<span class=\"hljs-name\">add-hook</span> &#x27;ruby-mode-hook &#x27;robe-mode)</code></pre>\n\n<p>If you are using rvm you  may want to instruct robe to auto-trigger <code>rvm-activate-corresponding-ruby</code>.</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">defadvice</span> inf-ruby-console-auto (<span class=\"hljs-name\">before</span> activate-rvm-for-robe activate)\n  (<span class=\"hljs-name\">rvm-activate-corresponding-ruby</span>))</code></pre>\n\n<p><code>robe-jump</code> bound by default to <code>M-.</code> can be used to jump to definitions of various classes and methods. While it is not ideal, in most of the scenarios, the expected entry is present in the first few suggestions.</p>\n<p>For intelligent completion robe can be integrated with <a href=\"http://company-mode.github.io/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">company mode</a>. Company mode is a modern and modular completion system for emacs which accepts a multitude of pluggable back-ends and front-ends to provide rich completions on the fly. Robe provides a backend to the completion in form of company-robe. This can be configured as follows :</p>\n<pre><code class=\"hljs lisp\">(<span class=\"hljs-name\">global-company-mode</span> <span class=\"hljs-literal\">t</span>)\n(<span class=\"hljs-name\">push</span> &#x27;company-robe company-backends)</code></pre>\n\n<p>Now all you have to do is hit <code>robe-start</code> when you navigate into your project. After that at any point\nif you trigger <code>company-robe</code> you should be greeted with an intellisense like method definitions.</p>\n<p>Completion will start automatically after you type a few letters. Use M-n, M-p, &lt;tab&gt; and &lt;return&gt; to complete. Search through the completions with C-s, C-r and C-o. Even the documentations are available right from the editor (Press F1 at any menu entry).</p>\n<p><img src=\"/images/emacs-robe-completions.png\" alt=\"Emacs robe completions\" loading=\"lazy\"></p>\n<p>One of the caveats is that robe requires <code>pry</code> and <code>pry-doc</code> to be in Gemfile. This is a problem when working with third party projects and I don&#39;t have a workaround for that yet.</p>\n<p>Also Ruby being a dynamic language which strives to push the limits on flexibility, perfect completion is simply not possible. Many of known caveats are listed <a href=\"https://github.com/dgutov/robe#notes\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">here</a> and some are being actively being worked upon. But nevertheless, I have found the setup to be quite useful for day to day development and hope you do too.</p>\n<p>I hope that this quick detour into the world of emacs-extensions has motivated you to atleast try out Emacs. How far you go down the rabbit hole is of-course for you to decide. As always, any criticism, suggestions and comments are welcome.</p>\n",
            "tags": [
                "Rails",
                "Emacs"
            ]
        },
        {
            "id": "https://lorefnon.me/2012/12/12/sharing-jade-templates-between-nodejs-server-and-client.html",
            "url": "https://lorefnon.me/2012/12/12/sharing-jade-templates-between-nodejs-server-and-client.html",
            "title": "Sharing Jade templates between Node.js server and client",
            "date_published": "2012-12-12T00:00:00.000Z",
            "content_html": "<p>Although there are several templating options available for the client eg. <a href=\"http://handlebarsjs.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Handlebars</a>, <a href=\"http://mustache.github.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Mustache</a>, <a href=\"http://beebole.com/pure/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Pure</a> etc. nevertheless, <a href=\"http://jade-lang.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Jade</a> is attractive in its own right.  Its succinct syntax is cleaner even than <a href=\"http://haml.info/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Haml</a>, which is arguably the predecessor and inspiration-source of all the minimalist whitespace sensitive templating systems. Using Node.js on the server offers an interesting opportunity to reuse the same servers on the server as well as client. This has been made particulary easy by the <a href=\"https://github.com/search?q=jade&ref=commandbar\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">numerous community contributions</a> by Jade enthusiasts which I will attempt to highlight in this post.</p>\n<p>When using Jade on the client the most naive approach would be  fetching our typical .jade file via ajax and then parsing the file and then  manipulating the structure and  interpolating the various variables. However,  we can pre-process the jade file beforehand thereby eliminating the heavyweight parsing step in the client. The end result of the pre-processing is a function which takes in the variables needed to render the template and then outputs the resultant HTML string which can be injected into the DOM.</p>\n<p>Preprocessing also takes care of <a href=\"https://github.com/visionmedia/jade#template-inheritance\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">template-inheritance</a> and <a href=\"https://github.com/visionmedia/jade#includes\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">template-inclusion</a> seamlessly which are difficult to implement in pure clienside parsing without an added layer of complexity and overhead of multiple ajax calls.</p>\n<p>Client-side rendering is made possible by a Jade feature called jade-runtime. On supplying a -c flag to jade, it generates the compiled javascript template which can be used along with the <a href=\"https://github.com/visionmedia/jade/blob/master/runtime.js\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">runtime.js</a> .</p>\n<p><a href=\"https://github.com/jgallen23/clientjade\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">Clientjade</a> takes the process to next level of simplicity.  It is simple npm module which provides you with a command line utility to compile several jade templates into a single compiled javascript file. Compilation is as simple as:</p>\n<pre><code>clientjade test1.jade test2.jade &gt; templates.js\n</code></pre>\n<p>Once templates.js has been included in the page,  individual templates can be accessed using their filenames.</p>\n<pre><code>jade.render($(&#39;#target&#39;), &#39;test1&#39;, &#123; name: &#39;Bob&#39; &#125;);\n</code></pre>\n<p>First argument is the DOM node where the template is to be rendered, second is a reference to the template and last is the data required to render the template.</p>\n<p>While this entire procedure is very simple, inclusion of multiple compiled templates in an HTML page leads to headaches.  Reason is that every individual compiled file assigns an empty hash to internal object containing references to templates. While in casual usage this is usually not a problem because you can always compile all the templates you need into a single javascript file, this can become troublesome if you are loading templates on-the-fly, as per requirements. The most common scenario is the case when an AMD loader eg. RequireJS is being used to manage dependencies.</p>\n<p>Fortunately there is a sister project <a href=\"https://github.com/mysociety/node-jade-amd\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">node-jade-amd</a> which focusses on exactly this usage scenario. As you might expect, after installing the <a href=\"https://github.com/mysociety/node-jade-amd\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">jade-amd</a> npm module you have a handy command line utility using which is as simple as :</p>\n<pre><code>jade-amd --from &lt;source-folder&gt; --to &lt;destination-folder&gt;\n</code></pre>\n<p>The compiled templates have a dependency on jadeRuntime amd module which can be obtained by :</p>\n<pre><code>jade-amd --runtime &gt; jadeRuntime.js\n</code></pre>\n<p>Then the compiled template can be used just like you would use any other amd module :</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-built_in\">require</span>([ <span class=\"hljs-string\">&#x27;templates/person&#x27;</span> ],            <span class=\"hljs-comment\">// Compiled template AMD modules</span>\n    <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">personTemplate</span>) &#123;\n        <span class=\"hljs-keyword\">var</span> rendered_content = <span class=\"hljs-title function_\">personTemplate</span>(&#123;\n              <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&#x27;Joe Bloggs&#x27;</span>                <span class=\"hljs-comment\">// Data to be used in the template</span>\n         &#125;);\n    &#125;\n);</code></pre>\n<p>Note that explitly requiring the runtime is not necessary because it is implicitly required by the compiled templates.</p>\n<p>If repeated manual recompilation feels like a headache, and you dont already have a file watcher setup there is a connect middleware <a href=\"https://github.com/storify/jade-browser\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">jade-browser</a> which exposes jade templates to the web browser and also provides a few additional features like express-like render function with partial handling. If you already using <a href=\"http://gruntjs.com/\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">grunt</a>, you can checkout the plugin <a href=\"https://github.com/phated/grunt-jade\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">grunt-jade</a> .</p>\n<p>So jade is an immensely popular templating solution among Node.js developers and the benefit of this is that there are numerous compilation options available to fit into your development toolchain.  I hope this quick detour around jade was helpful.  There are multiple other similar projects aiming to solve similar scenarios.  The ones aforementioned, were a few that I recently used. Please feel free to express any opinions or criticisms. If there is a project with related objectives which is particularly noteworthy,  feel free to add a link.</p>\n",
            "tags": [
                "Javascript",
                "Jade",
                "Node.js"
            ]
        },
        {
            "id": "https://lorefnon.me/2012/09/08/creating-a-basic-command-line-based-todo-app-using-ruby-and-sqlite.html",
            "url": "https://lorefnon.me/2012/09/08/creating-a-basic-command-line-based-todo-app-using-ruby-and-sqlite.html",
            "title": "Creating a basic command line based todo app using ruby and sqlite.",
            "date_published": "2012-09-08T00:00:00.000Z",
            "content_html": "<p>This tutorial aims to demonstrate how Ruby can be used to create simple command line applications.  A basic familiarity with Ruby and SQLite is assumed. Also availability of a POSIX compliant system is assumed. Although it is quite possible to port this tutorial to other proprietary platforms, I will not make any effort in this regard because of sheer lack of interest. In the tutorial, we create a simple command line based Task management application which is persisted through a local sqlite database. Thanks to the awesome commander library for ruby, the usual legwork of dealing with command line arguments and managing flags is greatly simplified.</p>\n<p>Hopefully you are already using RVM. So we begin by creating a new gemset :</p>\n<pre><code>rvm gemset create task-trooper\nrvm gemset use task-trooper\n</code></pre>\n<p>Running gem list presents us with the following :</p>\n<pre><code>*** LOCAL GEMS ***\n\nbundler (1.1.5)\nrake (0.9.2.2)\nrubygems-bundler (1.0.3)\nrvm (1.11.3.5)\n</code></pre>\n<p>If you are not using rvm (though I would highly recommend you to use it) you would have to manually install bundler at this point.</p>\n<p>If you dont already have SQLite, you will have to install it using your favourite package manager. Installation for ubuntu is as simple as :</p>\n<pre><code>sudo apt-get install sqlite3 libsqlite3-dev\n</code></pre>\n<p>Let us create a project directory and a Gemfile for managing our ruby dependencies :</p>\n<pre><code>mkdir task-trooper\ncd task-trooper\ntouch Gemfile\n</code></pre>\n<p>Populate your gemfile with the following :</p>\n<pre><code class=\"hljs ruby\">source <span class=\"hljs-string\">&quot;http://rubygems.org&quot;</span>\ngem <span class=\"hljs-string\">&quot;commander&quot;</span>\ngem <span class=\"hljs-string\">&quot;sqlite3&quot;</span>\ngem <span class=\"hljs-string\">&quot;sequel&quot;</span></code></pre>\n\n<p>and run <strong>bundle install</strong>.\nCommander is a ruby library for managing command line arguments. sqlite3 is the ruby adapter for sqlite. And since we dont want to dabble with SQL strings, we use a simple ruby ORM  Sequel.\nIf all goes well, the dependencies will be fetched and you should see something like this :</p>\n<pre><code>Fetching gem metadata from http://rubygems.org/........\nUsing highline (1.6.14)\nUsing commander (4.1.2)\nUsing sequel (3.39.0)\nInstalling sqlite3 (1.3.6) with native extensions\nUsing bundler (1.1.5)\nYour bundle is complete! Use `bundle show [gemname]` to see where a bundled gem is installed.\n</code></pre>\n<p>Now, let us begin with the actual application code.\nWe will eventually deploy it as a rubygem. For now let us just focus on the core essentials.\nFor now our application code resides in a single file : task-trooper.rb</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;rubygems&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&quot;bundler/setup&quot;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;commander/import&#x27;</span>\n\nprogram <span class=\"hljs-symbol\">:name</span>, <span class=\"hljs-string\">&quot;Task Trooper&quot;</span>\nprogram <span class=\"hljs-symbol\">:version</span>, <span class=\"hljs-string\">&#x27;1.0.0&#x27;</span>\nprogram <span class=\"hljs-symbol\">:description</span>, <span class=\"hljs-string\">&#x27;A simple command line based task manager&#x27;</span></code></pre>\n\n<p>The above code does not add a lot of functionality, it simply simply supplies the name of the application and some version related information. Nevertheless the commander DSL takes care of some bootstrapping for us. Try running the follwing :\n    $ ruby task-trooper.rb</p>\n<p>This was expected. Let us see what help has to offer:</p>\n<pre><code>$ ruby task-trooper.rb --help\n\n  NAME:\n\n    Task Trooper\n\n  DESCRIPTION:\n\n    A simple command line based task manager\n\n  COMMANDS:\n\n    help                 Display global or [command] help documentation.\n\n  GLOBAL OPTIONS:\n\n    -h, --help\n        Display help documentation\n\n    -v, --version\n        Display version information\n\n    -t, --trace\n        Display backtrace when an error occurs\n</code></pre>\n<p>Not so bad, huh ?</p>\n<p>Now we extend our code to incorporate database features :</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;rubygems&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&quot;bundler/setup&quot;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;commander/import&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;sequel&#x27;</span>\n\nprogram <span class=\"hljs-symbol\">:name</span>, <span class=\"hljs-string\">&quot;Task Trooper&quot;</span>\nprogram <span class=\"hljs-symbol\">:version</span>, <span class=\"hljs-string\">&#x27;1.0.0&#x27;</span>\nprogram <span class=\"hljs-symbol\">:description</span>, <span class=\"hljs-string\">&#x27;A simple command line based task manager&#x27;</span>\n\n<span class=\"hljs-variable constant_\">DB</span> = Sequel.sqlite(<span class=\"hljs-string\">&#x27;tasks_db.db&#x27;</span>)\n\n<span class=\"hljs-keyword\">unless</span> <span class=\"hljs-variable constant_\">DB</span>.table_exists? <span class=\"hljs-symbol\">:tasks</span>\n  <span class=\"hljs-variable constant_\">DB</span>.create_table(<span class=\"hljs-symbol\">:tasks</span>) <span class=\"hljs-keyword\">do</span>\n      primary_key <span class=\"hljs-symbol\">:id</span>\n  String <span class=\"hljs-symbol\">:title</span>\n  String <span class=\"hljs-symbol\">:description</span>\n  Boolean <span class=\"hljs-symbol\">:completed</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\nds = <span class=\"hljs-variable constant_\">DB</span>[<span class=\"hljs-symbol\">:tasks</span>]</code></pre>\n\n<p>The above piece of code shows how easy it is to use the Sequel library to manage database. The above code simply checks for the existence of a database table. In case the table does not exist, it is created. For now we keep the schema simple. Please note that thanks to database-agonistic api of Sequel you can use any other database here instead of Sqlite and all that would require is the alteration of one single line of configuration. Its time now to implement our first command :</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:new</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper new&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Creates a new task&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    puts <span class=\"hljs-string\">&#x27;Task created!&#x27;</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>The syntax and description methods simply provide the metadata which will be presented in the help text. As far as the actual action is concerned, it simply\nprints Task created! and exits.</p>\n<p>Lets checkout if the command new is actually available.</p>\n<pre><code>$ ruby task-trooper.rb new\n\nTask created!\n\n$ ruby task-trooper.rb new --help\n\n  NAME:\n\n    new\n\n  SYNOPSIS:\n\n    task-trooper new\n\n  DESCRIPTION:\n\n    Creates a new task\n</code></pre>\n<p>Great ! That works. Of course, at this point our task does not do anything. So let us add some functionality.</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:new</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper new&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Creates a new task&#x27;</span>\n  c.option <span class=\"hljs-string\">&#x27;--title STRING&#x27;</span>, String, <span class=\"hljs-string\">&#x27;Title of the task&#x27;</span>\n  c.option <span class=\"hljs-string\">&#x27;--description STRING&#x27;</span>, String, <span class=\"hljs-string\">&#x27;Task Description&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> options.title.<span class=\"hljs-literal\">nil</span>?\n      options.title = ask(<span class=\"hljs-string\">&#x27;Provide a title for the task :&#x27;</span>)\n    <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">if</span> options.description.<span class=\"hljs-literal\">nil</span>?\n      options.description = ask(<span class=\"hljs-string\">&#x27;Provide a description for the task :&#x27;</span>)\n    <span class=\"hljs-keyword\">end</span>\n    ds.insert(<span class=\"hljs-symbol\">:title</span> =&gt; options.title, <span class=\"hljs-symbol\">:description</span> =&gt; options.description, <span class=\"hljs-symbol\">:completed</span> =&gt; <span class=\"hljs-literal\">false</span>)\n    say <span class=\"hljs-string\">&#x27;Task added !&#x27;</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>So, in the above code we specified the options that this command will expect.\nif the title and description are not provided, the user will be prompted for\nthese options. Once both title and description are available, a record will be\ninserted in the database.</p>\n<p>Next, we need some way to show to the list of tasks. Thats not difficult either.</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:list</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper list&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Lists the tasks.&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    ds.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">task</span>|\n      status = <span class=\"hljs-keyword\">if</span> task[<span class=\"hljs-symbol\">:completed</span>] <span class=\"hljs-keyword\">then</span> <span class=\"hljs-string\">&quot;completed&quot;</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">&quot;pending&quot;</span> <span class=\"hljs-keyword\">end</span>\n      puts <span class=\"hljs-string\">&quot;Task [<span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:id</span>]&#125;</span>] - &lt;<span class=\"hljs-subst\">#&#123;status&#125;</span>&gt; : <span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:title</span>]&#125;</span>&quot;</span>\n    <span class=\"hljs-keyword\">end</span>\n    pending_count = ds.where(<span class=\"hljs-symbol\">:completed</span> =&gt; <span class=\"hljs-literal\">false</span>).count\n    count = ds.count\n    completed_count = count - pending_count\n    puts <span class=\"hljs-string\">&quot;\\n&quot;</span>\n    puts <span class=\"hljs-string\">&quot;Out of <span class=\"hljs-subst\">#&#123;count&#125;</span> Total Tasks : <span class=\"hljs-subst\">#&#123;pending_count&#125;</span> pending, <span class=\"hljs-subst\">#&#123;completed_count&#125;</span> completed.&quot;</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>So, at this point basic creation and listing of tasks is available to us.</p>\n<pre><code>$ ruby task-trooper.rb new --title &quot;Water plants&quot; --description &quot;The plants in the garden have to be watered before sundown.&quot;\nTask added !\n\n$ ruby task-trooper.rb new\nProvide a title for the task :\nAdd fertilizer\nProvide a description for the task :\nAdd some fertilizer to the pot of roses.\nTask added !\n\n$ ruby task-trooper.rb list\nTask [1] - &lt;pending&gt; : Water plants\nTask [2] - &lt;pending&gt; : Add fertilizer\n\nOut of 2 Total Tasks : 2 pending, 0 completed.\n</code></pre>\n<p>Next, we need a way to mark a task as completed :</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:done</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper done &lt;id&gt;&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Mark a task as done&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> args.first.<span class=\"hljs-literal\">nil</span>?\n      puts <span class=\"hljs-string\">&#x27;Please specify the task to be marked as complete&#x27;</span>\n    <span class=\"hljs-keyword\">else</span>\n      items = ds.where(<span class=\"hljs-symbol\">:id</span> =&gt; args.first)\n      <span class=\"hljs-keyword\">if</span> items.count &gt; <span class=\"hljs-number\">0</span>\n        items.update(<span class=\"hljs-symbol\">:completed</span> =&gt; <span class=\"hljs-literal\">true</span>)\n        puts <span class=\"hljs-string\">&quot;Updated&quot;</span>\n      <span class=\"hljs-keyword\">else</span>\n        puts <span class=\"hljs-string\">&#x27;No item found&#x27;</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Try running <strong>ruby task-trooper.rb done 1</strong> follwed by <strong>ruby task-trooper.rb list</strong>\nto make sure that the task has indeed been marked as done.</p>\n<p>After this, we add facility to show details for a task and delete a task :</p>\n<pre><code class=\"hljs ruby\">command <span class=\"hljs-symbol\">:show</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper show &lt;id&gt;&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Shows the description of a task&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> args.first.<span class=\"hljs-literal\">nil</span>?\n      puts <span class=\"hljs-string\">&quot;Please specify the task to be shown.&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n      ds.where(<span class=\"hljs-symbol\">:id</span> =&gt; args.first).each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">task</span>|\n        puts <span class=\"hljs-string\">&quot;Title : <span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:title</span>]&#125;</span>&quot;</span>\n        puts <span class=\"hljs-string\">&quot;Description : &quot;</span>\n        puts task[<span class=\"hljs-symbol\">:description</span>]\n        puts <span class=\"hljs-string\">&quot;Completed : <span class=\"hljs-subst\">#&#123;task[<span class=\"hljs-symbol\">:completed</span>]&#125;</span>&quot;</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\ncommand <span class=\"hljs-symbol\">:delete</span> <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">c</span>|\n  c.syntax = <span class=\"hljs-string\">&#x27;task-trooper delete &lt;id&gt;&#x27;</span>\n  c.description = <span class=\"hljs-string\">&#x27;Delete a task&#x27;</span>\n  c.action <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">args, options</span>|\n    <span class=\"hljs-keyword\">if</span> args.first.<span class=\"hljs-literal\">nil</span>?\n      puts <span class=\"hljs-string\">&quot;Please specify the task to be deleted&quot;</span>\n    <span class=\"hljs-keyword\">else</span>\n      items = ds.where(<span class=\"hljs-symbol\">:id</span> =&gt; args.first)\n      <span class=\"hljs-keyword\">if</span> items.count &gt; <span class=\"hljs-number\">0</span>\n        items.delete\n        puts <span class=\"hljs-string\">&quot;Deleted&quot;</span>\n      <span class=\"hljs-keyword\">else</span>\n        puts <span class=\"hljs-string\">&quot;No task found&quot;</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now that we have all the basic facilities up and running, lets us proceed to\ncreate a ruby gem so we can make the application available to other users.</p>\n<p>We create a bin director, move our script to it and make it executable.</p>\n<pre><code>mkdir bin\nmv task-trooper.rb bin/task-trooper\nchmod a+x bin/task-trooper\n</code></pre>\n<p>Also, we need to add a shebang to direct the shell to run it with ruby.\n    #!&#x2F;usr&#x2F;bin&#x2F;env ruby</p>\n<p>Next, we need to add a gemspec to specify the required metadata for the\ngem.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-title class_\">Gem::Specification</span>.new <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">s</span>|\n  s.name = <span class=\"hljs-string\">&#x27;task-trooper&#x27;</span>\n  s.version = <span class=\"hljs-string\">&#x27;1.0.0&#x27;</span>\n  s.date = <span class=\"hljs-string\">&#x27;2012-09-09&#x27;</span>\n  s.summary = <span class=\"hljs-string\">&quot;Task Trooper&quot;</span>\n  s.description = <span class=\"hljs-string\">&quot;Simple command line based task manager&quot;</span>\n  s.authors = [ <span class=\"hljs-string\">&quot;Lorefnon&quot;</span> ]\n  s.email = <span class=\"hljs-string\">&#x27;lorefnon@gmail.com&#x27;</span>\n  s.executables &lt;&lt; <span class=\"hljs-string\">&#x27;task-trooper&#x27;</span>\n\n  [<span class=\"hljs-string\">&#x27;commander&#x27;</span>, <span class=\"hljs-string\">&#x27;sqlite3&#x27;</span>, <span class=\"hljs-string\">&#x27;sequel&#x27;</span>].each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">dep</span>|\n    s.add_dependency dep\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>We might also want to have our sqlite database in a hidden folder in users\nhome directory. This is easily accomplished :</p>\n<pre><code class=\"hljs ruby\">config_dir = File.expand_path(<span class=\"hljs-string\">&#x27;~/.task-trooper&#x27;</span>)\n<span class=\"hljs-keyword\">unless</span> Dir[config_dir].length &gt; <span class=\"hljs-number\">0</span>\n  Dir::mkdir(config_dir)\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-variable constant_\">DB</span> = Sequel.sqlite(<span class=\"hljs-string\">&quot;<span class=\"hljs-subst\">#&#123;config_dir&#125;</span>/tasks.db&quot;</span>)\n\n<span class=\"hljs-keyword\">unless</span> <span class=\"hljs-variable constant_\">DB</span>.table_exists? <span class=\"hljs-symbol\">:tasks</span>\n  <span class=\"hljs-variable constant_\">DB</span>.create_table(<span class=\"hljs-symbol\">:tasks</span>) <span class=\"hljs-keyword\">do</span>\n    primary_key <span class=\"hljs-symbol\">:id</span>\n    String <span class=\"hljs-symbol\">:title</span>\n    String <span class=\"hljs-symbol\">:description</span>\n    Boolean <span class=\"hljs-symbol\">:completed</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Having done that, we can build our gem :\n    gem build task-trooper.gemset</p>\n<p>We can test our gem in a fresh rvm gemset\n    rvm gemset create test\n    rvm gemset use test\n    gem install .&#x2F;task-trooper-1.0.0.gem</p>\n<p>Hold your breath while the dependencies are auto-matically fetched and installed. Now you can use task-trooper as you would use any other command line executable.\nHere is an obligatory screenshot :</p>\n<img src=\"/images/task_trooper.png\" />\n\n<p>So in less than an hour we were able to create a simple but functional todo app which is persisted in an Sqlite database. We can easily see that creating simple command line applications is not at all cumbersome in ruby. I do really hope that you can expand upon the material presented above to create some nifty CLI-apps. For some inspiration do check out : cli-apps.org .</p>\n<p>Also, as usual feel free to provide your suggestions, criticism or details regarding any problems that you faced.</p>\n",
            "tags": [
                "Ruby",
                "SQLite"
            ]
        },
        {
            "id": "https://lorefnon.me/2012/08/15/a-websocket-powered-tic-tac-toe-game-using-ruby-eventmachine--part-1.html",
            "url": "https://lorefnon.me/2012/08/15/a-websocket-powered-tic-tac-toe-game-using-ruby-eventmachine--part-1.html",
            "title": "A Websocket powered Tic tac toe game using Ruby EventMachine  Part 1",
            "date_published": "2012-08-15T00:00:00.000Z",
            "content_html": "<p>Lately I have been fiddling around a bit with websockets. Websocket support is now available in most of the modern browsers and Flash based shims are available for older browsers. Having bi-directional communication stream between server and the browser based client opens up a whole new world of opportunities for dynamic web applications.</p>\n<p>Implementing a web-socket server in ruby is fairly easy given the plethora of libraries available. One such useful gem is em-websocket which is essentially an Event-Machine based asynchronous web-socket server.</p>\n<p>In this post I present a small tutorial implementing a simple tic-tac-toe game. Though the game will be pretty barebones, I hope it will serve as a good introduction to web-socket api.</p>\n<p>In the part-1 we focus primarily on the server-part to which we can communicate from the browser using the javascript console. In later parts we will create a client side frontend and further enhance server side facilities.</p>\n<p>First, we ensure that Ruby is installed (I have used ruby-1.9.3 for the tutorial) . eventmachine and em-websocket are available as ruby gems. So installing them is as easy as :\n    gem install eventmachine\n    gem install em-websocket</p>\n<p>To see if em-websocket is working without hassles, run the following minimal web-socket implementation.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;eventmachine&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;em-websocket&#x27;</span>\n\nEventMachine.run &#123;\n\n    EventMachine::WebSocket.start(<span class=\"hljs-symbol\">:host</span> =&gt; <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-symbol\">:port</span> =&gt; <span class=\"hljs-number\">8080</span>) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">ws</span>|\n        ws.onopen &#123;\n          puts <span class=\"hljs-string\">&quot;WebSocket connection open&quot;</span>\n        &#125;\n        ws.onclose &#123;\n          puts <span class=\"hljs-string\">&quot;Connection closed&quot;</span>\n        &#125;\n    <span class=\"hljs-keyword\">end</span>\n&#125;</code></pre>\n\n<p>What this code does is it creates a socket-server which listens at localhost:8080 . Callbacks have been provided for open and close events, so when a client creates a connection or a connection gets closed the associated callbacks print an appropriate message to the terminal.</p>\n<p>run the webserver with :</p>\n<pre><code>ruby server.rb\n</code></pre>\n<p>The server should go into an event-loop without any errors. Now fire up your browsers javascript console (or NodeJS console) and try :</p>\n<pre><code>socket = new WebSocket(&quot;ws://localhost:8080&quot;)\n</code></pre>\n<p>If all goes well, it should return true and the message Websocket connection open should be displayed in the terminal.</p>\n<p>So far, so good. But the main purpose of a server is to relay data to the client. How do we do that ? Turns out that is pretty simple too.</p>\n<pre><code class=\"hljs ruby\">EventMachine.run &#123;\n\n    EventMachine::WebSocket.start(<span class=\"hljs-symbol\">:host</span> =&gt; <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-symbol\">:port</span> =&gt; <span class=\"hljs-number\">8080</span>) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">ws</span>|\n        ws.onopen &#123;\n          puts <span class=\"hljs-string\">&quot;WebSocket connection open&quot;</span>\n          <span class=\"hljs-comment\"># publish message to the client</span>\n          ws.send <span class=\"hljs-string\">&quot;Hello Client&quot;</span>\n        &#125;\n\n        ws.onclose &#123;\n          puts <span class=\"hljs-string\">&quot;Connection closed&quot;</span>\n        &#125;\n    <span class=\"hljs-keyword\">end</span>\n&#125;</code></pre>\n\n<p>Using the send  method, the server sends data to the client. The client side socket has an onmessage event that enables you to recieve the data.</p>\n<pre><code class=\"hljs javascript\">socket = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WebSocket</span>(<span class=\"hljs-string\">&quot;ws://localhost:8080&quot;</span>);\nsocket.<span class=\"hljs-property\">onmessage</span> = <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">msg</span>)&#123;\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(msg.<span class=\"hljs-property\">data</span>)\n&#125;</code></pre>\n\n<p>Remember we said something socket being a two-way communication channel. The send message is available on the client too and the message can be received in the server in very similar way :</p>\n<p>Let us modify our server to enable it to receive data.</p>\n<pre><code class=\"hljs ruby\">ws.onmessage &#123; |<span class=\"hljs-params\">msg</span>|\n  puts msg\n  ws.send msg\n&#125;</code></pre>\n<p>What it does is, it prints any data that it receives and relays it back to the client. So now if you run in the javascript console :</p>\n<pre><code class=\"hljs javascript\">socket.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-string\">&quot;Hello world&quot;</span>)</code></pre>\n\n<p>You should receive the message back.</p>\n<p>Now that we have a basic familiarity with the usage of web-sockets lets proceed with our game :</p>\n<p>The flow of the game is like this : A client, after opening the connection, requests the server to register it. Upon registration, if a free player is available, then he is paired up with this player and game begins. If a player is not free the player is added to a queue and once a new player arrives , they both commence a new game.</p>\n<p>For now let us not delve into user-registration and score management and satisfy ourselves with an anonymous player vs player game.</p>\n<p>In the simple examples above we have only focussed on a single client at a time. If in response to the actions of a client other players have to be relayed information the situation becomes slightly complex. The typical way to deal with such scenarios is to use a Pub-sub system. While a redis based pub-sub system is an excellent solution, we are not using one here to keep things simple and also we have the advantage that it is priorly known that players will always interact in pairs.</p>\n<p>Let us organize our code in an object oriented fashion :</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GameController</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">add_player</span> player\n    <span class=\"hljs-comment\"># if partner is available</span>\n    <span class=\"hljs-comment\">#   pair_up with partner</span>\n    <span class=\"hljs-comment\"># else</span>\n    <span class=\"hljs-comment\">#   enqueue partner</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">pair_up</span> player, partner\n    <span class=\"hljs-comment\"># create a new game</span>\n    <span class=\"hljs-comment\"># appoint one of the player as first, and start the game</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">end_game</span> game, players\n    <span class=\"hljs-comment\"># re-allocate partner if someone is waiting</span>\n    <span class=\"hljs-comment\"># ... call add_player - and a new game proceeds</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\nEventMachine.run &#123;\n  <span class=\"hljs-variable\">@gc</span> = GameController.new\n  EventMachine::WebSocket.start(<span class=\"hljs-symbol\">:host</span> =&gt; <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-symbol\">:port</span> =&gt; <span class=\"hljs-number\">8080</span>) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">ws</span>|\n\n    ws.onmessage <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">req</span>|\n      req = <span class=\"hljs-variable constant_\">JSON</span>.parse(req)\n      <span class=\"hljs-keyword\">case</span> req[<span class=\"hljs-string\">&#x27;action&#x27;</span>]\n      <span class=\"hljs-keyword\">when</span> <span class=\"hljs-string\">&#x27;register&#x27;</span>\n        player = <span class=\"hljs-title class_\">Player</span>.new ws\n        puts <span class=\"hljs-string\">&quot;Registering player : <span class=\"hljs-subst\">#&#123;player.id&#125;</span>&quot;</span>\n        <span class=\"hljs-variable\">@gc</span>.add_player player\n        player.notify (&#123;<span class=\"hljs-symbol\">:success</span> =&gt; <span class=\"hljs-literal\">true</span>, <span class=\"hljs-symbol\">:id</span> =&gt; player.id&#125;)\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n&#125;</code></pre>\n\n<p>In the above example : when we have received a message from the client : we check if it is a request for registration. We have abstracted out the game management facilites in an external GameController class (yet unimplemented) which would take care of managing the users and games.</p>\n<p>For the sake of consistency, lets have all client server communications serialized as JSON.</p>\n<p>Rather than Running around with socket references, we encapsulate all the functionality of a single client in a player class :</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Player</span>\n  <span class=\"hljs-keyword\">attr_accessor</span> <span class=\"hljs-symbol\">:socket</span>\n  <span class=\"hljs-keyword\">attr_reader</span> <span class=\"hljs-symbol\">:id</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">initialize</span> ws\n    <span class=\"hljs-variable\">@id</span> = rand(<span class=\"hljs-number\">5000</span>)\n    <span class=\"hljs-variable\">@socket</span> = ws\n    <span class=\"hljs-variable\">@score</span> = <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">notify</span> msg_hash\n    <span class=\"hljs-variable\">@socket</span>.send <span class=\"hljs-variable constant_\">JSON</span>.dump msg_hash\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Also, we add a stub for a game class which will take care of managing the game state. The Game class instance would represent a single ongoing game between two opponents.</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Game</span>\n  <span class=\"hljs-keyword\">attr_reader</span> <span class=\"hljs-symbol\">:id</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">initialize</span> player1, player2, game_controller\n    <span class=\"hljs-variable\">@id</span> = rand(<span class=\"hljs-number\">5000</span>)\n    <span class=\"hljs-comment\"># create initial game state</span>\n    <span class=\"hljs-comment\"># notify the players about the game</span>\n    start\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">start</span>\n    <span class=\"hljs-variable\">@players</span>.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">id, player</span>|\n      ws = player.socket\n      ws.onmessage <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">msg</span>|\n        <span class=\"hljs-comment\"># parse the msg</span>\n        <span class=\"hljs-comment\"># is the user request valid in the current context of the game</span>\n        <span class=\"hljs-comment\"># if yes :</span>\n        <span class=\"hljs-comment\">#   change the state of the game to reflect this</span>\n        <span class=\"hljs-comment\">#   notify the opponent about the changed state</span>\n        <span class=\"hljs-comment\"># if no:</span>\n        <span class=\"hljs-comment\">#   notify the initiator about failure</span>\n        <span class=\"hljs-comment\"># has the game concluded:</span>\n        <span class=\"hljs-comment\"># Declare the winner, if any.</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span></code></pre>\n\n<p>Now that basic overview of the code is clear, implementing the details is not very difficult. Here is the complete code :</p>\n<pre><code class=\"hljs ruby\"><span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;eventmachine&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;em-websocket&#x27;</span>\n<span class=\"hljs-keyword\">require</span> <span class=\"hljs-string\">&#x27;json&#x27;</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Player</span>\n  <span class=\"hljs-keyword\">attr_accessor</span> <span class=\"hljs-symbol\">:score</span>, <span class=\"hljs-symbol\">:socket</span>\n  <span class=\"hljs-keyword\">attr_reader</span> <span class=\"hljs-symbol\">:id</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">initialize</span> ws\n    <span class=\"hljs-variable\">@id</span> = rand(<span class=\"hljs-number\">5000</span>)\n    <span class=\"hljs-variable\">@socket</span> = ws\n    <span class=\"hljs-variable\">@score</span> = <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">notify</span> msg_hash\n    <span class=\"hljs-variable\">@socket</span>.send <span class=\"hljs-variable constant_\">JSON</span>.dump msg_hash\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Game</span>\n  <span class=\"hljs-keyword\">attr_reader</span> <span class=\"hljs-symbol\">:id</span>\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">initialize</span> player1, player2, game_controller\n    <span class=\"hljs-variable\">@id</span> = rand(<span class=\"hljs-number\">5000</span>)\n    <span class=\"hljs-variable\">@players</span> = &#123;&#125;\n    [player1, player2].each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">player</span>|\n      <span class=\"hljs-variable\">@players</span>[player.id] = player\n    <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-variable\">@game_controller</span> = game_controller\n    <span class=\"hljs-variable\">@state</span> = [[<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>],[<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>],[<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>]]\n    <span class=\"hljs-variable\">@players</span>.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">id, player</span>|\n      player.notify(&#123; <span class=\"hljs-symbol\">:msg</span> =&gt; <span class=\"hljs-string\">&quot;Game initiated !!!&quot;</span> &#125;)\n    <span class=\"hljs-keyword\">end</span>\n    player1.notify(&#123;<span class=\"hljs-symbol\">:msg</span> =&gt; <span class=\"hljs-string\">&quot;Your turn&quot;</span>&#125;)\n    player2.notify(&#123;<span class=\"hljs-symbol\">:msg</span> =&gt; <span class=\"hljs-string\">&quot;Opponent&#x27;s turn&quot;</span>&#125;)\n    <span class=\"hljs-variable\">@next_player</span> = player1.id\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">start</span>\n    <span class=\"hljs-variable\">@players</span>.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">id, player</span>|\n      ws = player.socket\n      ws.onmessage <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">msg</span>|\n        puts <span class=\"hljs-string\">&quot;Message received : <span class=\"hljs-subst\">#&#123;msg&#125;</span>&quot;</span>\n        msg = <span class=\"hljs-variable constant_\">JSON</span>.parse msg\n        puts <span class=\"hljs-string\">&quot;id received : <span class=\"hljs-subst\">#&#123;msg[<span class=\"hljs-string\">&#x27;id&#x27;</span>]&#125;</span>&quot;</span>\n        puts <span class=\"hljs-string\">&quot;players : <span class=\"hljs-subst\">#&#123;<span class=\"hljs-variable\">@players</span>.to_json&#125;</span>&quot;</span>\n        initiator = <span class=\"hljs-variable\">@players</span>[msg[<span class=\"hljs-string\">&#x27;id&#x27;</span>]]\n\n        puts <span class=\"hljs-string\">&quot;initiator ===&gt; &quot;</span>, initiator.to_json\n        partner = find_partner initiator\n        <span class=\"hljs-keyword\">case</span> msg[<span class=\"hljs-string\">&#x27;action&#x27;</span>]\n        <span class=\"hljs-keyword\">when</span> <span class=\"hljs-string\">&#x27;move&#x27;</span>\n          validation_result = validate_move msg\n          initiator.notify(validation_result)\n          <span class=\"hljs-keyword\">if</span> validation_result[<span class=\"hljs-symbol\">:success</span>]\n            update_state msg\n            <span class=\"hljs-variable\">@next_player</span> = partner.id\n            update_gamestate partner\n\n            <span class=\"hljs-keyword\">if</span> victorious?\n              initiator.notify (&#123; <span class=\"hljs-symbol\">:msg</span> =&gt; <span class=\"hljs-string\">&quot;You win&quot;</span> &#125;)\n              partner.notify(&#123; <span class=\"hljs-symbol\">:msg</span> =&gt; <span class=\"hljs-string\">&quot;You lose&quot;</span> &#125;)\n              <span class=\"hljs-variable\">@game_controller</span>.end_game <span class=\"hljs-variable language_\">self</span>, <span class=\"hljs-variable\">@players</span>\n            <span class=\"hljs-keyword\">elsif</span> finished?\n              resp = &#123;<span class=\"hljs-symbol\">:msg</span> =&gt; <span class=\"hljs-string\">&quot;Game Over&quot;</span>&#125;\n              initiator.notify resp\n              partner.notify resp\n              <span class=\"hljs-variable\">@game_controller</span>.end_game <span class=\"hljs-variable language_\">self</span>, <span class=\"hljs-variable\">@players</span>\n            <span class=\"hljs-keyword\">end</span>\n          <span class=\"hljs-keyword\">else</span>\n            update_gamestate initiator\n          <span class=\"hljs-keyword\">end</span>\n        <span class=\"hljs-keyword\">end</span>\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">validate_move</span> msg\n    res = &#123;<span class=\"hljs-symbol\">:success</span> =&gt; <span class=\"hljs-literal\">true</span>&#125;\n    <span class=\"hljs-keyword\">if</span> msg[<span class=\"hljs-string\">&#x27;id&#x27;</span>] != <span class=\"hljs-variable\">@next_player</span>\n      res = &#123;<span class=\"hljs-symbol\">:success</span> =&gt; <span class=\"hljs-literal\">false</span>, <span class=\"hljs-symbol\">:error</span> =&gt; <span class=\"hljs-string\">&quot;Move out of turn&quot;</span>&#125;\n    <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-variable\">@state</span>[msg[<span class=\"hljs-string\">&#x27;x&#x27;</span>]][msg[<span class=\"hljs-string\">&#x27;y&#x27;</span>]] != <span class=\"hljs-number\">0</span>\n      res = &#123;<span class=\"hljs-symbol\">:success</span> =&gt; <span class=\"hljs-literal\">false</span>, <span class=\"hljs-symbol\">:error</span> =&gt; <span class=\"hljs-string\">&quot;Overrite not allowed&quot;</span>&#125;\n    <span class=\"hljs-keyword\">end</span>\n    res\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update_state</span> msg\n    <span class=\"hljs-variable\">@state</span>[msg[<span class=\"hljs-string\">&#x27;x&#x27;</span>]][msg[<span class=\"hljs-string\">&#x27;y&#x27;</span>]] = msg[<span class=\"hljs-string\">&#x27;id&#x27;</span>]\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">update_gamestate</span> player\n    player.notify (&#123;<span class=\"hljs-symbol\">:game_state</span> =&gt; <span class=\"hljs-variable\">@state</span> &#125;)\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">find_partner</span> player\n    <span class=\"hljs-variable\">@players</span>.each &#123; |<span class=\"hljs-params\">id, pl</span>| <span class=\"hljs-keyword\">return</span> pl <span class=\"hljs-keyword\">unless</span>  id == player.id &#125;\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">victorious?</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">teq</span> a,b,c\n      a != <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> a == b <span class=\"hljs-keyword\">and</span> b ==c\n    <span class=\"hljs-keyword\">end</span>\n    i = <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-keyword\">while</span> i &lt; <span class=\"hljs-number\">3</span>\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">if</span> teq <span class=\"hljs-variable\">@state</span>[i][<span class=\"hljs-number\">0</span>], <span class=\"hljs-variable\">@state</span>[i][<span class=\"hljs-number\">1</span>], <span class=\"hljs-variable\">@state</span>[i][<span class=\"hljs-number\">2</span>]\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">if</span> teq <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">0</span>][i], <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">1</span>][i], <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">2</span>][i]\n      i = i+<span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">end</span>\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">if</span> teq <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>], <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">1</span>][<span class=\"hljs-number\">1</span>], <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">2</span>][<span class=\"hljs-number\">2</span>]\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">if</span> teq <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">2</span>][<span class=\"hljs-number\">0</span>], <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">1</span>][<span class=\"hljs-number\">1</span>], <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">2</span>]\n    <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">finished?</span>\n    <span class=\"hljs-keyword\">not</span> <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">0</span>].<span class=\"hljs-keyword\">include</span>? (<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">and</span>\n      <span class=\"hljs-keyword\">not</span> <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">1</span>].<span class=\"hljs-keyword\">include</span>? (<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">and</span>\n      <span class=\"hljs-keyword\">not</span>  <span class=\"hljs-variable\">@state</span>[<span class=\"hljs-number\">2</span>].<span class=\"hljs-keyword\">include</span>? (<span class=\"hljs-number\">0</span>)\n  <span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GameController</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">initialize</span>\n    <span class=\"hljs-variable\">@games</span> = &#123;&#125;\n    <span class=\"hljs-variable\">@free_players</span> = []\n    <span class=\"hljs-variable\">@engaged_players</span> = []\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">add_player</span> player\n    puts <span class=\"hljs-string\">&quot;Adding player : <span class=\"hljs-subst\">#&#123;player.id&#125;</span>&quot;</span>\n    partner = <span class=\"hljs-variable\">@free_players</span>.pop\n    <span class=\"hljs-keyword\">if</span> partner.<span class=\"hljs-literal\">nil</span>?\n      <span class=\"hljs-variable\">@free_players</span> &lt;&lt; player\n      puts <span class=\"hljs-string\">&quot;Putting on wait&quot;</span>\n      player.notify (&#123;\n        <span class=\"hljs-symbol\">:msg</span> =&gt; <span class=\"hljs-string\">&quot;You will have to wait till we find a partner for you&quot;</span>\n      &#125;)\n    <span class=\"hljs-keyword\">else</span>\n      puts <span class=\"hljs-string\">&quot;Pairing up : <span class=\"hljs-subst\">#&#123;player.id&#125;</span>, <span class=\"hljs-subst\">#&#123;partner.id&#125;</span>&quot;</span>\n      pair_up player, partner\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">pair_up</span> player, partner\n    puts <span class=\"hljs-string\">&quot;Starting game between player <span class=\"hljs-subst\">#&#123;player.id&#125;</span> and <span class=\"hljs-subst\">#&#123;partner.id&#125;</span>&quot;</span>\n    game = <span class=\"hljs-title class_\">Game</span>.new player, partner, <span class=\"hljs-variable language_\">self</span>\n    <span class=\"hljs-variable\">@games</span>[game.id] = game.id\n    game.start\n  <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">end_game</span> game, players\n    <span class=\"hljs-variable\">@games</span>[game.id] = <span class=\"hljs-literal\">nil</span>\n    players.each <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">id, player</span>|\n      add_player player\n    <span class=\"hljs-keyword\">end</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\nEventMachine.run &#123;\n  <span class=\"hljs-variable\">@gc</span> = GameController.new\n  EventMachine::WebSocket.start(<span class=\"hljs-symbol\">:host</span> =&gt; <span class=\"hljs-string\">&quot;0.0.0.0&quot;</span>, <span class=\"hljs-symbol\">:port</span> =&gt; <span class=\"hljs-number\">8080</span>) <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">ws</span>|\n\n    ws.onmessage <span class=\"hljs-keyword\">do</span> |<span class=\"hljs-params\">req</span>|\n      req = <span class=\"hljs-variable constant_\">JSON</span>.parse(req)\n      <span class=\"hljs-keyword\">case</span> req[<span class=\"hljs-string\">&#x27;action&#x27;</span>]\n      <span class=\"hljs-keyword\">when</span> <span class=\"hljs-string\">&#x27;register&#x27;</span>\n        player = <span class=\"hljs-title class_\">Player</span>.new ws\n        puts <span class=\"hljs-string\">&quot;Registering player : <span class=\"hljs-subst\">#&#123;player.id&#125;</span>&quot;</span>\n        <span class=\"hljs-variable\">@gc</span>.add_player player\n        player.notify (&#123;<span class=\"hljs-symbol\">:success</span> =&gt; <span class=\"hljs-literal\">true</span>, <span class=\"hljs-symbol\">:id</span> =&gt; player.id&#125;)\n      <span class=\"hljs-keyword\">end</span>\n    <span class=\"hljs-keyword\">end</span>\n\n  <span class=\"hljs-keyword\">end</span>\n&#125;\n</code></pre>\n\n<p>While I have skipped over the details of management of game, I believe the code above is fairly readable.</p>\n<p>And yes, I am aware of the several issues with the code above. The most obvious one is that serialized state passed to client contains the id of other player as well. So it is easy to cheat the game.  Apart from this there are several other things I have looked over. What if a player passes in a request that cannot be parsed as JSON ? A malformed request initiates an exception that crashes the whole game.  These issues will be resolved and  a score management system and a front-end will be added in the later parts of the tutorial. So stay tuned.</p>\n<p>Here is a snapshot of my Javascript console showing a game in progress :</p>\n<img src=\"/images/game.png\" />\n\n<p>As always, feel free to provide your suggestions and to point out errors.</p>\n",
            "tags": [
                "Ruby",
                "EventMachine",
                "Websockets"
            ]
        },
        {
            "id": "https://lorefnon.me/2012/08/12/effectively-debugging-knockoutjs-applications.html",
            "url": "https://lorefnon.me/2012/08/12/effectively-debugging-knockoutjs-applications.html",
            "title": "Effectively debugging KnockoutJS applications.",
            "date_published": "2012-08-12T00:00:00.000Z",
            "content_html": "<p>This post aims to provide some explanation about the lifecycle of dynamic data-bindings in KnockoutJS to  ease debugging of KO applications .</p>\n<p>A developer can remain perfectly oblivious of all that is going on under the hood and let the magic of declarative bindings do all the heavy-lifting of data-synchronization and it all works fine untill something unexpected happens. What now ? While most of the bugs in code can be directly resolved by inspecting the data-bind attributes manually, but if the complexity of application grows beyond a level an understanding of what goes on under the sheets becomes necessary.</p>\n<p>While UI does appear to be getting magically updated when the models change, in reality the code underneath is all plain javascript. So what happens when something doesnt turn out to be as expected ? Where do we start debugging from ?</p>\n<p>The first and most obvious point of commencement is the observable. While we can (and sometimes might need to) begin from the observable function and dig down, debugging process is much simplified if we have a bit of familiarity with the way KO works internally. At this point I would like to underline that KO code is written very well and in general is easy to understand.</p>\n<p>This knowledge is also helpful for development of custom bindings.</p>\n<p>KO relies on bindingHandlers to manage bindings. So corresponding to every built in binding (eg. visible, text, html, value etc.)  we have a bindingHandler which has the same name. The text  binding is handled by a function <strong>ko.bindingHandlers.text</strong>, the value binding by <strong>ko.bindingHandlers.value</strong> and likewise.</p>\n<p>Let us checkout a simple example :</p>\n<pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;jquery-1.7.1.min.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;knockout-latest.debug.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;index.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>\n      Please Enter your name :\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;text&quot;</span> <span class=\"hljs-attr\">data-bind</span>=<span class=\"hljs-string\">&quot;value:name&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">input</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>\n      Hello <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">data-bind</span>=<span class=\"hljs-string\">&quot;text: name&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span></code></pre>\n\n<pre><code class=\"hljs javascript\">$(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)&#123;\n    <span class=\"hljs-keyword\">var</span> vmodel = &#123;\n        <span class=\"hljs-attr\">name</span>: ko.<span class=\"hljs-title function_\">observable</span>(<span class=\"hljs-string\">&quot;Lorefnon&quot;</span>)\n    &#125;\n    ko.<span class=\"hljs-title function_\">applyBindings</span>(vmodel);\n&#125;);</code></pre>\n\n<p>There are two binders involved : text-binder and value-binder. Let us inspect the <strong>ko.bindingHandlers.text</strong>in javascript.   It has a single member : update function. Yes, you guessed it right  this is the function that is called when the span is to be updated. Let us checkout what it does :</p>\n<pre><code class=\"hljs javascript\">ko.<span class=\"hljs-property\">bindingHandlers</span>[<span class=\"hljs-string\">&#x27;text&#x27;</span>] = &#123;\n    <span class=\"hljs-string\">&#x27;update&#x27;</span>: <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">element, valueAccessor</span>) &#123;\n        ko.<span class=\"hljs-property\">utils</span>.<span class=\"hljs-title function_\">setTextContent</span>(element, <span class=\"hljs-title function_\">valueAccessor</span>());\n    &#125;\n&#125;;</code></pre>\n\n<p>The code is straightforward and self explanatory. You can just add a breakpoint to the update function and it will be triggered every time that particular DOM node is updated. As expected the actual DOM manipulation takes place in the <strong>ko.utils.setTextContent</strong></p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-attr\">setTextContent</span>: <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">element, textContent</span>) &#123;\n     <span class=\"hljs-keyword\">var</span> value = ko.<span class=\"hljs-property\">utils</span>.<span class=\"hljs-title function_\">unwrapObservable</span>(textContent);\n     <span class=\"hljs-keyword\">if</span> ((value === <span class=\"hljs-literal\">null</span>) || (value === <span class=\"hljs-literal\">undefined</span>)) value = <span class=\"hljs-string\">&quot;&quot;</span>;\n     <span class=\"hljs-string\">&#x27;innerText&#x27;</span> <span class=\"hljs-keyword\">in</span> element ? element.<span class=\"hljs-property\">innerText</span> = value : element.<span class=\"hljs-property\">textContent</span> = value;\n     <span class=\"hljs-keyword\">if</span> (ieVersion &gt;= <span class=\"hljs-number\">9</span>) &#123;\n         <span class=\"hljs-comment\">// Believe it or not, this actually fixes an IE9 rendering bug</span>\n         <span class=\"hljs-comment\">// (See https://github.com/SteveSanderson/knockout/issues/209)</span>\n         element.<span class=\"hljs-property\">style</span>.<span class=\"hljs-property\">display</span> = element.<span class=\"hljs-property\">style</span>.<span class=\"hljs-property\">display</span>;\n     &#125;\n&#125;,\n</code></pre>\n\n<p>What about the other side of the code : What do you do to intercept a change in a form element ? Let us checkout the <strong>ko.bindingHandlers.value</strong></p>\n<img src=\"/images/ko.png\" />\n\n<p>As you probably have already guessed, the init function creates the bindings to intercept any change in the form element. The actual handler that is called each time when the input element changes its value is the valueUpdateHandler function defined inside init :</p>\n<pre><code class=\"hljs javascript\"><span class=\"hljs-keyword\">var</span> valueUpdateHandler = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) &#123;\n     <span class=\"hljs-keyword\">var</span> modelValue = <span class=\"hljs-title function_\">valueAccessor</span>();\n     <span class=\"hljs-keyword\">var</span> elementValue = ko.<span class=\"hljs-property\">selectExtensions</span>.<span class=\"hljs-title function_\">readValue</span>(element);\n     ko.<span class=\"hljs-property\">jsonExpressionRewriting</span>.<span class=\"hljs-title function_\">writeValueToProperty</span>(modelValue, allBindingsAccessor, <span class=\"hljs-string\">&#x27;value&#x27;</span>, elementValue, <span class=\"hljs-comment\">/* checkIfDifferent: */</span> <span class=\"hljs-literal\">true</span>);\n&#125;</code></pre>\n\n<p>elementValue holds the changed value which is in the next line synced back.</p>\n<p>So here is an overview of how bindings work : when you call <strong>ko.applyBindings</strong> the library traverses the DOM hunting for data-bind attributes. When it finds a data-bind attribute  it first of all figures out which bindingHandler is to be called from the part of data-bind attribute value that preceded the colon. The corresponding handlers update method set to be called each time the value of corresponding view model attribute changes and it is the responsibility of the update method to alter the DOM node as directed by the data-bind specification.</p>\n<p>For those nodes which are editable by user (ie. the form elements) the corresponding bindingHandlers also have an init method which sets up the bindings for reverse synchronization.</p>\n<p>This summarizes the way data-bindings work under the hood. I hope that this post helps to improve your understanding of KO library.</p>\n",
            "tags": [
                "Javascript",
                "KnockoutJS"
            ]
        },
        {
            "id": "https://lorefnon.me/2012/08/11/debunking-10-common-knockoutjs-myths.html",
            "url": "https://lorefnon.me/2012/08/11/debunking-10-common-knockoutjs-myths.html",
            "title": "Debunking 10 common KnockoutJS myths",
            "date_published": "2012-08-11T00:00:00.000Z",
            "content_html": "<p>It seems that among the developer community, there exist multiple misconceptions regarding KnockoutJS. This is particularly true for developers who are not familiar with the MVVM pattern or declarative style followed by Knockout. This posts aims to clarify some of these misconceptions.</p>\n<p>I was particularly motivated to write this post after <a href=\"http://stackoverflow.com/questions/5112899/knockout-js-vs-backbone-js-vs/6340870#6340870\" target=\"_blank\" rel=\"noopener external nofollow noreferrer\">this discussion</a> at Stackoverflow.</p>\n<h1 id=\"KnockoutJS-is-tied-to-specific-server-side-back-ends\"><a href=\"#KnockoutJS-is-tied-to-specific-server-side-back-ends\" class=\"headerlink\" title=\"KnockoutJS is tied to specific server side back-ends.\"></a>KnockoutJS is tied to specific server side back-ends.</h1><p>This mainly stems from the similarities of the declarative binding style used in KO with the WPF declarative bindings. Since I do not work with Microsoft technologies, I can not really assert if the WPF declarative binding style was indeed an inspiration behind KO, however I would like to highlight that KO is strictly a client side library and an ASP.net backend (or any specific server side backend for that matter) is not mandatory. In fact KO will work happily with no server-side code at all. I strongly recommend people to checkout the basic examples presented in the site using jsfiddle and convince yourself that this is indeed the case.</p>\n<p>On a sidenote, there do exist libraries that aim to provide seamless integration layers between KO and ASP.net MVC eg. KnockoutMVC which claims to facilitate creation of complex client side applications without writing a single line of javascript. I strongly advocate against using such esoteric frameworks.</p>\n<h1 id=\"KnockoutJS-has-hard-wired-dependency-on-jQuery-and-jQuery-templating-plugin\"><a href=\"#KnockoutJS-has-hard-wired-dependency-on-jQuery-and-jQuery-templating-plugin\" class=\"headerlink\" title=\"KnockoutJS has hard-wired dependency on jQuery and jQuery-templating plugin.\"></a>KnockoutJS has hard-wired dependency on jQuery and jQuery-templating plugin.</h1><p>Again this is absolutely incorrect. The core functionality provided by KO is framework agonistic. And as far as templating is concerned integrating of third party templating engines is not very difficult. Since KO is open source you can probably find support for your favourite templating engine already available. For example the ko.mustache extension by Marcin Wtorkowski adds support for mustache templating engine.</p>\n<h1 id=\"Because-of-the-level-of-abstraction-offered-by-declarative-bindings-KnockoutJS-is-difficult-to-debug\"><a href=\"#Because-of-the-level-of-abstraction-offered-by-declarative-bindings-KnockoutJS-is-difficult-to-debug\" class=\"headerlink\" title=\"Because of the level of abstraction offered by declarative bindings, KnockoutJS is difficult to debug.\"></a>Because of the level of abstraction offered by declarative bindings, KnockoutJS is difficult to debug.</h1><p>While it is true that KO hides away the boiler plate code for data synchronization and the users are concerned with declaring the bindings in attributes, when things go wrong (either at your end or if you happen to discover a bug in the library) you will have to dig into the layers of abstraction. Fortunately in case of KO, the abstractions are not very convoluted and a basic understanding of the binding management lifecycle makes debugging pretty easy. KO source code is well written and not very difficult to understand, although that certainly is a subjective opinion.</p>\n<p>I plan to highlight some guidelines for debugging KO applications in a future post.</p>\n<h1 id=\"It-is-difficult-to-properly-test-a-KnockoutJS-application\"><a href=\"#It-is-difficult-to-properly-test-a-KnockoutJS-application\" class=\"headerlink\" title=\"It is difficult to properly test a KnockoutJS application.\"></a>It is difficult to properly test a KnockoutJS application.</h1><p>There is simply no reason for this to be true considering that KO is plain simple javascript. In particular KO is well tested and has a comprehensive test suite, which alleviates the developer from writing test cases for boilerplate code for managing data synchronizations. The domain logic is still javascript and KO does not abstract away any client-server interaction so testing the core of your application mostly involves testing your own javascript code only.</p>\n<p>Also, with a basic understanding of KO handlers, the bindingHandlers can be mocked, providing a greater control to the developer.</p>\n<h1 id=\"KnockoutJS-applications-do-not-degrade-gracefully-in-absence-of-javascript\"><a href=\"#KnockoutJS-applications-do-not-degrade-gracefully-in-absence-of-javascript\" class=\"headerlink\" title=\"KnockoutJS applications do not degrade gracefully in absence of javascript.\"></a>KnockoutJS applications do not degrade gracefully in absence of javascript.</h1><p>Graceful degradation in absense of javascript depends on the way your application has been architectured. Although KO being a pure javascript library, does not offer any support for graceful degradation in absence of javascript, nevertheless unlike many of the competing technologies it does not hinder graceful degradation.</p>\n<p>To create a KO application that degrades gracefully, just ensure that the initial state of the page that is rendered by the server suffices to convey the information that a user should see in absence of javascript. Fallback mechanisms (eg simple forms and links) should be available that provide the complete (or partial) application functionality in absence of javascript. Then when you create your view models you can instantiate them from the data already available from the DOM and future data can be loaded via ajax without refreshing the page.</p>\n<p>A good example for this functionality can be a grid. The basic HTML page served by the server can contain a simple HTML table with support for traditional links for pagination. Then you can create your view models from the data present in the table ( or ajax if a bit of redundant data load does not matter for you) and utilize KO for interactive bindings.</p>\n<p>Since KO does not use special inline markup or custom html tags, but rather simple data-bind attributes which are anyways not visible in absence of javascript, it does not hinder graceful degradation.</p>\n<h1 id=\"Although-simple-attribute-binding-works-well-designing-complex-interactive-UI-results-in-cluttered-code\"><a href=\"#Although-simple-attribute-binding-works-well-designing-complex-interactive-UI-results-in-cluttered-code\" class=\"headerlink\" title=\"Although simple attribute-binding works well, designing complex interactive UI results in cluttered code.\"></a>Although simple attribute-binding works well, designing complex interactive UI results in cluttered code.</h1><p>Again code organization is something that KO does not enforce upon you. A very nice way to make to code modular and easy to understand is to use custom bindings. Custom bindings are not something to be used as a last resort . Creating them is easy and utilizing them you can write very succinct code that is easily understandable and manageable. Infact properly using custom bindings can significantly improve performance as compared to several data-bind attributes for same property across several adjacent DOM nodes.</p>\n<p>A few people strongly believe that doing something slightly abnormal (somewhat different from the advertised use-cases) the developer has to go to great lengths in case of KnockoutJS. This is certainly not the case. KnockoutJS does an elegant job at data binding. Not only can the actual value stored in text nodes be mapped to JavaScript objects, practically any attribute and even individual styles can be mapped to JavaScript data structures. Combine with that the fact that mapping can be directed to dynamic objects which actually derive their data from other data structures and the excellent integration of KnockoutJS with jQuery templating system, EVERY single type of UI binding can be made in knockoutJS with lesser number of lines than backbone provided you craft your viewmodels and templates creatively.\n7. Doing anything serious using KnockoutJS requires verbose inline scripts.</p>\n<p>This is also incorrect. Please read the above paragraph on properly using dynamic objects and custom bindings.</p>\n<p>Yes code like</p>\n<pre><code class=\"hljs html\">The item is <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">data-bind</span>=<span class=\"hljs-string\">&quot;text: price() &gt; 50 ? &#x27;expensive&#x27; : &#x27;affordable&#x27;&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span> today.</code></pre>\n\n<p>is certainly ugly. But you can simply define a custom attribute that depends on price using ko.computable and have that in the view-model. As a developer you already are smart enough to avoid embedding javascript application logic inside html. KO does not come in your way.</p>\n<h1 id=\"KnockoutJS-does-not-offer-a-multitude-of-widgets\"><a href=\"#KnockoutJS-does-not-offer-a-multitude-of-widgets\" class=\"headerlink\" title=\"KnockoutJS does not offer a multitude of widgets.\"></a>KnockoutJS does not offer a multitude of widgets.</h1><p>This is absolutely correct. But KO noway advertises the same. It is essentially a data-binding library that does one thing and does it well. It is not a complete application SDK or UI framework.</p>\n<h1 id=\"Integrating-KnockoutJS-with-a-restful-backend-is-difficult\"><a href=\"#Integrating-KnockoutJS-with-a-restful-backend-is-difficult\" class=\"headerlink\" title=\"Integrating KnockoutJS with a restful backend is difficult.\"></a>Integrating KnockoutJS with a restful backend is difficult.</h1><p>As I previously pointed out, KO does not abstract out client server interaction. In fact the management of your Model layer is left almost entirely to you. Having said that, if your restful backend makes data available as json, the backbone mapping plugin makes it trivial to sync server data with view models.</p>\n<p>If the structure of the data fetched from sever differs significantly from the way view models are organized, then you anyway have to write code for transforming the code.</p>\n<p>The knockout-rest plugin by Francesco Pontillo provides a very easy and intuitive way to integrate view-models with a restful backend.</p>\n<h1 id=\"Using-libraries-like-KnockoutJS-have-serious-negative-impact-on-SEO\"><a href=\"#Using-libraries-like-KnockoutJS-have-serious-negative-impact-on-SEO\" class=\"headerlink\" title=\"Using libraries like KnockoutJS have serious negative impact on SEO.\"></a>Using libraries like KnockoutJS have serious negative impact on SEO.</h1><p>If you follow the guidelines presented above on graceful degradation then there is no reason why this should happen.</p>\n<p>Even if you are not concerned about graceful degradation, and your application is heavily dependent on Ajax based content fetching,  These  guidelines from Google, can make your website crawlable.</p>\n<p>I sincerely hope that this post was successful in removing many of the common misconceptions regarding KnockoutJS and I also hope that you will be able to appreciate the power of this fantastic library. Please leave your suggestions and opinions in the comments section below. Also if you have been working on a project that enhances or extends the capabilities of KnockoutJS please feel free to drop in a link.</p>\n",
            "tags": [
                "Javascript",
                "KnockoutJS"
            ]
        }
    ]
}